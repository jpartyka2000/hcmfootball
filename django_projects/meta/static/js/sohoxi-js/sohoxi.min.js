/**
* Soho XI Controls v4.3.1
* Date: 02/08/2017 5:43:08 PM
* Revision: e252d2880f89e8aed3b77d55c708c04fa428414c
*/

!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){function b(b){return this.element=a(b),this.url=this.getCurrentURL(),window.Soho=window.Soho||{},window.Soho.base||a.detectBaseTag(),this}function c(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}function d(b){var d,e,f,g=b.nodeName.toLowerCase(),h=!isNaN(a.attr(b,"tabindex"));return"area"===g?(d=b.parentNode,e=d.name,!(!b.href||!e||"map"!==d.nodeName.toLowerCase())&&(!!(f=a("img[usemap=#"+e+"]")[0])&&c(f))):(/input|select|textarea|button|object/.test(g)?!b.disabled:"a"===g?b.href||h:h)&&c(b)}function e(b){this.settings=a.extend({},D,b),Soho.logTimeStart("ListFilter"),this.init(),Soho.logTimeEnd("ListFilter")}function f(a){return a&&!(a instanceof jQuery)}function g(a,b){return!!f(a)&&a[b]&&"function"==typeof a[b]}function h(a,b){return!!g(a,b)&&(a[b](),!0)}function i(b,c){var d=[];return a.each(b,function(b,e){a.each(a(e).data(),function(b,f){h(f,c)&&d.push({elem:a(e),control:f})})}),d}function j(b,c,d){if(b&&c){b=a(b);var e=b.find("*").add(b);d&&(e=e.not(d.join(", ")));var f=i(e,c);return b.trigger("sift-"+c+"-complete",[f]),b}}function k(a,b,c){var d;return b&&"object"==typeof b&&(void 0!==b[a]?d=b[a]:c&&b.get&&"function"==typeof b.get&&(d=b.get(a))),d}function l(a){return"t.b("+a+");"}function m(a,b){for(var c=0,d=b.length;c<d;c++)if(b[c].o===a.n)return a.tag="#",!0}function n(a,b,c){for(var d=0,e=c.length;d<e;d++)if(c[d].c===a&&c[d].o===b)return!0}function o(a){return a.replace(L,"\\\\").replace(S,"\\'").replace(J,"\\n").replace(K,"\\r").replace(M,"\\u2028").replace(N,"\\u2029")}function p(a,b,c,d,e,f){function g(){}function h(){}g.prototype=a,h.prototype=a.subs;var i,j=new g;j.subs=new h,j.subsText={},j.buf="",d=d||{},j.stackSubs=d,j.subsText=f;for(i in b)d[i]||(d[i]=b[i]);for(i in d)j.subs[i]=d[i];e=e||{},j.stackPartials=e;for(i in c)e[i]||(e[i]=c[i]);for(i in e)j.partials[i]=e[i];return j}function q(a){return String(null===a||void 0===a?"":a)}function r(a){"}"===a.n.substr(a.n.length-1)&&(a.n=a.n.substring(0,a.n.length-1))}function s(a){return a.trim?a.trim():a.replace(/^\s*|\s*$/g,"")}function t(a,b,c){if(b.charAt(c)!==a.charAt(0))return!1;for(var d=1,e=a.length;d<e;d++)if(b.charAt(c+d)!==a.charAt(d))return!1;return!0}function u(a){return a=q(a),T.test(a)?a.replace(O,"&amp;").replace(P,"&lt;").replace(Q,"&gt;").replace(R,"&#39;").replace(S,"&quot;"):a}function v(a,b,c,d){var e=[],f=null,g=null,h=null;for(g=c[c.length-1];a.length>0;){if(h=a.shift(),g&&"<"===g.tag&&!(h.tag in U))throw new Error("Illegal content in < super tag.");if(H.tags[h.tag]<=H.tags.$||m(h,d))c.push(h),h.nodes=v(a,h.tag,c,d);else{if("/"===h.tag){if(0===c.length)throw new Error("Closing tag without opener: /"+h.n);if(f=c.pop(),h.n!==f.n&&!n(h.n,f.n,d))throw new Error("Nesting error: "+f.n+" vs. "+h.n);return f.end=h.i,e}"\n"===h.tag&&(h.last=0===a.length||"\n"===a[0].tag)}e.push(h)}if(c.length>0)throw new Error("missing closing tag: "+c.pop().n);return e}function w(a){var b=[];for(var c in a)b.push('"'+o(c)+'": function(c,p,t,i) {'+a[c]+"}");return"{ "+b.join(",")+" }"}function x(a){var b=[];for(var c in a.partials)b.push('"'+o(c)+'":{name:"'+o(a.partials[c].name)+'", '+x(a.partials[c])+"}");return"partials: {"+b.join(",")+"}, subs: "+w(a.subs)}function y(a){return~a.indexOf(".")?"d":"f"}function z(a,b){var c="<"+(b.prefix||""),d=c+a.n+V++;return b.partials[d]={name:a.n,partials:{}},b.code+='t.b(t.rp("'+o(d)+'",c,p,"'+(a.indent||"")+'"));',d}function A(a,b){b.code+="t.b(t.t(t."+y(a.n)+'("'+o(a.n)+'",c,p,0)));'}function B(b){this.element=a(b),Soho.logTimeStart("Validator"),this.init(),Soho.logTimeEnd("Validator")}a.fn.personalize=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="personalize",e={colors:"",theme:""},f=a.extend({},e,b);return c.prototype={init:function(){return this.makeSohoObject().handleEvents(),this.settings.colors&&this.setColors(this.settings.colors),this.settings.theme&&this.setTheme(this.settings.theme),this},makeSohoObject:function(){var a=this;return window.Soho=window.Soho||{},window.Soho.theme="light",window.Soho.setTheme=function(b){a.setTheme(b)},window.Soho.setColors=function(b){a.setColors(b)},window.Soho.getColorStyleSheet=function(b){return a.getColorStyleSheet(b)},this},handleEvents:function(){var a=this;return this.element.on("updated."+d,function(){a.updated()}).on("changecolors."+d,function(b,c,d){a.setColors(c,d)}).on("changetheme."+d,function(b,c){a.setTheme(c)}),this},validateHex:function(a){return a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),"#"+a},appendStyleSheet:function(a){var b=document.getElementById("soho-personalization");b&&b.parentNode.removeChild(b),b=document.createElement("style"),b.setAttribute("id","soho-personalization"),b.appendChild(document.createTextNode(a)),document.head.appendChild(b)},getColorStyleSheet:function(a){if(Soho.colors=a,"string"==typeof a&&(Soho.colors={},Soho.colors.header=a),!a||""===a)return this;var b={header:"2578A9",subheader:"368AC0",text:"ffffff",verticalBorder:"133C59",horizontalBorder:"134D71",inactive:"1d5f8a",hover:"133C59"};return Soho.colors.header=this.validateHex(Soho.colors.header||b.header),Soho.colors.text=this.validateHex(Soho.colors.text||b.text),Soho.colors.subheader=this.validateHex(Soho.colors.subheader||this.getLuminousColorShade(Soho.colors.header,.2)),Soho.colors.inactive=this.validateHex(Soho.colors.inactive||this.getLuminousColorShade(Soho.colors.header,-.22)),Soho.colors.verticalBorder=this.validateHex(Soho.colors.verticalBorder||this.getLuminousColorShade(Soho.colors.header,.1)),Soho.colors.horizontalBorder=this.validateHex(Soho.colors.horizontalBorder||this.getLuminousColorShade(Soho.colors.header,-.4)),Soho.colors.hover=this.validateHex(Soho.colors.hover||this.getLuminousColorShade(Soho.colors.header,-.5)),".tab-container.module-tabs.is-personalizable { border-top: 1px solid "+Soho.colors.horizontalBorder+" !important; border-bottom: 1px solid "+Soho.colors.horizontalBorder+" !important} .module-tabs.is-personalizable .tab:not(:first-child) { border-left: 1px solid "+Soho.colors.verticalBorder+" !important} .module-tabs.is-personalizable { background-color: "+Soho.colors.inactive+" !important} .module-tabs.is-personalizable .tab.is-selected { background-color: "+Soho.colors.header+" !important} .accordion.panel .accordion-header.is-selected { background-color: "+Soho.colors.subheader+" !important; color: "+Soho.colors.text+" !important} .builder-header.is-personalizable{ background-color: "+Soho.colors.subheader+"} .header.is-personalizable { background-color: "+Soho.colors.header+"} .header.is-personalizable .title { color: "+Soho.colors.text+"} .header.is-personalizable h1 { color: "+Soho.colors.text+"} .module-tabs.is-personalizable .tab-more { border-left: "+Soho.colors.verticalBorder+" !important} .module-tabs.is-personalizable .tab-more:hover { background-color: "+Soho.colors.hover+" !important} .module-tabs.is-personalizable .tab-more.is-open { background-color: "+Soho.colors.hover+" !important} .module-tabs.is-personalizable .tab-more.is-selected { background-color: "+Soho.colors.header+" !important} .header .toolbar > .toolbar-searchfield-wrapper.active .searchfield { background-color: "+Soho.colors.hover+" !important; border-bottom-color: "+Soho.colors.hover+" !important} .subheader.is-personalizable { background-color: "+Soho.colors.subheader+" !important} .builder .sidebar .header {border-right: 1px solid "+Soho.colors.hover+" !important} .module-tabs.is-personalizable .tab:hover { background-color: "+Soho.colors.hover+" !important} .module-tabs.has-toolbar.is-personalizable .tab-list-container + .toolbar { border-left: "+Soho.colors.verticalBorder+' !important} .module-tabs.is-personalizable [class^="btn"] { background-color: '+Soho.colors.inactive+" !important} .hero-widget.is-personalizable { background-color: "+Soho.colors.subheader+" } .hero-widget.is-personalizable .hero-bottom { background-color: "+Soho.colors.header+" } .hero-widget.is-personalizable .hero-footer .hero-footer-nav li::before { color: "+Soho.colors.verticalBorder+" } .hero-widget.is-personalizable .chart-container .arc { stroke: "+Soho.colors.subheader+" } .hero-widget.is-personalizable .chart-container .bar { stroke: "+Soho.colors.subheader+" } .hero-widget.is-personalizable .chart-container.line-chart .dot { stroke: "+Soho.colors.subheader+" }"},setColors:function(a){if(a)return this.appendStyleSheet(this.getColorStyleSheet(a)),this},getLuminousColorShade:function(a,b){a=this.validateHex(a).substr(1),b=b||0;var c,d,e="#";for(d=0;d<3;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},availableThemes:["light","dark","high-contrast"],setTheme:function(b){if(Soho.theme!==b&&(Soho.theme=b,-1!==this.availableThemes.indexOf(b))){this.blockUi();var c=this,d=a("#stylesheet, #sohoxi-stylesheet"),e=a('<link rel="stylesheet">'),f=d.attr("href");e.on("load",function(){d.remove(),c.unBlockUi()}),e.attr({id:d.attr("id"),href:f.substring(0,f.lastIndexOf("/"))+"/"+b+"-theme"+(f.indexOf(".min")>-1?".min":"")+".css"}),d.removeAttr("id"),d.after(e)}},blockUi:function(){this.pageOverlay=this.pageOverlay||a('<div style="background: '+("light"===Soho.theme?"#f0f0f0;":"dark"===Soho.theme?"#313236;":"#bdbdbd;")+'display: block;height: 100%;left: 0;position: fixed;text-align: center;top: 0;width: 100%;z-index: 10000;"></div>'),a("body").append(this.pageOverlay)},unBlockUi:function(){var a=this;a.pageOverlay.fadeOut(300,function(){a.pageOverlay.remove(),a.pageOverlay=void 0})},updated:function(){return this.teardown().init()},teardown:function(){return this.element.off("updated."+d),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.initialize=function(b){"use strict";function c(b,c){this.settings=a.extend({},c),this.element=a(b),Soho.logTimeStart(e),this.init(),Soho.logTimeEnd(e)}var d,e="initialize",f={locale:Locale.currentLocale.name||"en-US"};return"string"==typeof b?(d={},d.locale=b):d=a.extend({},f,b),c.prototype={init:function(){var a=this;return Locale.set(this.settings.locale).done(function(){a.initAll()}),this},initAll:function(){var b=this;return this.element.filter(":not(.no-init)").each(function(){function c(b,c){var d=a.fn.parseOptions(b);a(b)[c](d)}function d(a){var b=f.find(a);return f.filter(a).length&&(b=b.add(f)),b}function e(b,e){void 0===e&&(e="."+b),a.fn[b]&&d(e).each(function(){var d=a(this);d.is(g)&&'[data-trackdirty="true"]'!==e||d.parents().hasClass("no-init")||(d.is(".icon")||!d.parents(".toolbar").length||d.parents().hasClass("masthead"))&&c(this,b)}),d(".radio-section input:radio.handle").change(function(){if(this.checked){var b=a(this).closest(".option"),c=b.siblings(),d='button, select, input[type="text"]';a(d,b).removeAttr("disabled"),a(d,c).attr("disabled","disabled")}})}var f=a(this),g=".no-init, [data-init]";a.fn.zoom&&a("head").zoom(),a.fn.applicationmenu&&d("#application-menu").applicationmenu({triggers:f.find(".application-menu-trigger")}),a.fn.personalize&&d("body").personalize();for(var h=[["icon"],["splitter"],["tabs",".tab-container:not(.vertical)"],["verticaltabs",".tab-container.vertical"],["dropdown","select.dropdown:not(.multiselect)"],["dropdown","select.dropdown-xs:not(.multiselect)"],["dropdown","select.dropdown-sm:not(.multiselect)"],["dropdown","select.dropdown-lg:not(.multiselect)"],["modal"],["slider",'input[type="range"], .slider'],["editor"],["tooltip","[title]"],["tree"],["rating"],["listbuilder"],["compositeform",".composite-form"],["progress",".progress-bar"],["mask","input[data-mask]"],["autocomplete",".autocomplete:not([data-init])"],["multiselect","select[multiple]:not(.dropdown), .multiselect:not([data-init])"],["button",".btn, .btn-toggle, .btn-secondary, .btn-primary, .btn-modal-primary, .btn-tertiary, .btn-icon, .btn-actions, .btn-menu, .btn-split, .btn-secondary-border"],["hideFocus","a.hide-focus, a.tick, a.hyperlink, .checkbox, .radio, .switch"],["circlepager"],["trackdirty",'[data-trackdirty="true"]'],["clearable",'[data-clearable="true"]'],["textarea","textarea"],["spinbox"],["arrange"],["swaplist"],["colorpicker"],["datepicker"],["timepicker"],["tag"],["busyindicator",".busy, .busy-xs, .busy-sm"],["header"],["fileupload"],["fileuploadadvanced",".fileupload-advanced"],["about"],["contextualactionpanel",".contextual-action-panel-trigger"],["expandablearea",".expandable-area"],["signin"],["homepage"],["lookup",".lookup:not([data-init])"],["wizard"],["popdown","[data-popdown]"]],i=0;i<h.length;i++)e.apply(null,h[i]);if(a.fn.popupmenu){d("[data-popupmenu]:not("+g+", .btn-actions, .btn-filter, .btn-menu)").each(function(){var b=a(this),c=a.extend({},a.fn.parseOptions(this)),d=b.attr("data-popupmenu");d&&(c.menuId=d),b.popupmenu(c)}),d(".btn-filter, .btn-menu, .btn-actions").filter(":not("+g+")").each(function(){var b=a(this);b.parents(".toolbar").length>0||c(b,"popupmenu")})}if(a.fn.popover&&d("[data-popover]:not("+g+")").each(function(){var b=a(this),c=b.attr("data-trigger"),d=b.attr("data-title"),e=b.attr("data-placement");b.popover({content:a("#"+b.attr("data-popover")),trigger:c||"click",title:d||void 0,placement:e||"right"})}),a.fn.listview&&d(".listview:not("+g+")").each(function(){var b=a(this),c=b.attr("data-dataset"),d=b.attr("data-tmpl"),e=a.fn.parseOptions(this)||{};e.dataset=e.dataset||c,e.template=e.template||d,window[e.dataset]&&(e.dataset=window[e.dataset]),e.template&&e.template.length&&(e.template=a("#"+e.template).html()),b.listview(e)}),a.fn.searchfield){var j=d(".searchfield:not("+g+")"),k=j.filter(function(){return a(this).parents(".toolbar").length});j=j.not(k),j.each(function(){c(this,"searchfield")})}a.fn.accordion&&d(".accordion:not("+g+")").each(function(){var b=a(this);b.parents(".application-menu").length||c(b,"accordion")}),a.fn.toolbar&&d(".toolbar:not("+g+")").each(function(){var d=a(this);d.parents(".header, .contextual-action-panel .modal-header").length&&!b.element.is(".toolbar")||c(d,"toolbar")}),d('[data-translate="text"]').each(function(){var b=a(this);b.text(Locale.translate(b.text()))}),d(".block").on("click",function(){a(this).toggleClass("is-selected")}),a.fn.validate&&d('[data-validate-on="submit"]').validate(),d(".breadcrumb ol").attr("aria-label",Locale.translate("Breadcrumb"))}),this.element.triggerHandler("initialized"),a.fn.validate&&b.element.validate(),this}},this.each(function(){new c(this,d)})},b.prototype={getCurrentURL:function(){return window.location.href.replace(window.location.hash,"")},getBaseURL:function(a){return a?0===a.indexOf("/")?window.location.origin+a:(a=(-1===a.indexOf("#")?"#":"")+a,this.url+a):this.url}},a.getBaseURL=function(a){return a},a.detectBaseTag=function(){var c=a("base[href]");c.length&&(window.Soho.base=new b(c),a.getBaseURL=window.Soho.base.getBaseURL.bind(window.Soho.base))},window.Soho=window.Soho||{},window.Soho.utils={},window.Soho.DOM={},a.fn.bindFirst=function(b,c){this.on(b,c),this.each(function(){var c=a._data(this,"events")[b.split(".")[0]],d=c.pop();c.splice(0,0,d)})},window.Soho.uniqueIdCount=0,a.fn.uniqueId=function(b,c,d){var e=a(this).attr("id");if(e&&a("#"+e).length<2)return e;c=c?c+"-":"",d=d?"-"+d:"",b=b||a(this).attr("class");var f=c+b+Soho.uniqueIdCount+d;return Soho.uniqueIdCount=Soho.uniqueIdCount+1,f},a.fn.cssPropSupport=function(b){"use strict";if(!b)return null;var c=a("<div></div>")[0],d=b.toString(),e=["Moz","Webkit","O","ms"],f=d.charAt(0).toUpperCase()+d.substr(1);if(b in c.style)return a(c).remove(),b;for(var g=0;g<e.length;g++){var h=e[g]+f;if(h in c.style)return a(c).remove(),h}return a(c).remove(),null},a.fn.transitionEndName=function(){return{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"oTransitionEnd",transition:"transitionend"}[a.fn.cssPropSupport("transition")]||null},a.extend(a.expr[":"],{focusable:function(b){return d(b,isNaN(a.attr(b,"tabindex")))}}),a.fn.onTouchClick=function(b,c,d){return b=null!==b||void 0!==b?"."+b:"",c=null!==c||void 0!==c?c:"",this.each(function(){var e,f=a(this),g=d?"one":"on",h=!1;return f[g]("touchstart"+b,c,function(a){e={x:a.originalEvent.touches[0].pageX,y:a.originalEvent.touches[0].pageY}}),f[g]("touchmove"+b,c,function(a){var b;b={x:a.originalEvent.touches[0].pageX,y:a.originalEvent.touches[0].pageY},(b.x>=e.x+10||b.x<=e.x-10||b.y>=e.y+10||b.y<=e.y-10)&&(h=!0)}),f[g]("touchend"+b+" touchcancel"+b,c,function(b){var c=a(this);return h?void(h=!1):(setTimeout(function(){h=!1,b.preventDefault(),c.attr("disabled")||c.trigger("click")},0),!1)}),f})},a.fn.offTouchClick=function(b,c){return b=null!==b||void 0!==b?"."+b:"",c=null!==c||void 0!==c?c:"",this.each(function(){return a(this).off("touchend"+b+" touchcancel"+b+" touchstart"+b+" touchmove"+b,c)})},a.fn.listEvents=function(){var b={};return this.each(function(){b=a._data(this,"events")}),b},a.fn.placeholderPolyfill=function(b){if(!("placeholder"in document.createElement("input"))){var c=a.extend({className:"is-placeholder"},b),d=function(a,b,c){c&&a.attr("type",b)};a("[placeholder]").each(function(){var b=a(this),e=b.is('input[type="password"]');b.removeClass(c.className).on("focus.placeholderPolyfill, click.placeholderPolyfill",function(){b.val()===b.attr("placeholder")&&b.data("placeholder")&&b.get(0).setSelectionRange(0,0)}).on("keydown.placeholderPolyfill",function(){d(b,"password",e),b.val()===b.attr("placeholder")&&b.data("placeholder")&&(b.val(""),b.removeClass(c.className))}).on("blur.placeholderPolyfill",function(){""===b.val()?(d(b,"text",e),b.addClass(c.className),b.val(b.attr("placeholder")),b.data("placeholder",!0)):b.data("placeholder",!1)}).trigger("blur.placeholderPolyfill").parents("form").on("submit",function(){a("[placeholder]",this).each(function(){var b=a(this);b.val()===b.attr("placeholder")&&b.data("placeholder")&&b.val("")})})})}return this},a.fn.parseOptions=function(b,c){var d;if(c=c||"data-options",(d=a(b).attr(c))&&d.length&&d.indexOf("{")>-1)try{d=JSON.parse(d.replace(/'/g,'"'))}catch(a){var e=/({|,)(?:\s*)(?:')?([A-Za-z_$\.][A-Za-z0-9_ \-\.$]*)(?:')?(?:\s*):/g;d=d.replace(e,'$1"$2":'),e=/:(?:\s*)(?!(true|false|null|undefined))([A-Za-z_$\.#][A-Za-z0-9_ \-\.$]*)/g,d=d.replace(e,':"$2"'),d=JSON.parse(d.replace(/'/g,'"'))}return d||(d={}),d},a.fn.timer=function(b,c){var d,e=a(this),f=0,g=function(){e.triggerHandler("cancel"),clearInterval(d),f=0},h=function(){e.triggerHandler("pause"),clearInterval(d)},i=function(){d=setInterval(function(){f+=10,e.triggerHandler("update",[{counter:f}]),f>c&&(e.triggerHandler("timeout"),b.apply(arguments),clearInterval(d),f=0)},10)},j=function(){e.triggerHandler("resume"),i()};return i(),{event:this,cancel:g,pause:h,resume:j}},a.copyToClipboard=function(a){if(window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",a);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var b=document.createElement("textarea");b.textContent=a,b.style.position="fixed",document.body.appendChild(b),b.select();try{return document.execCommand("copy")}catch(a){return!1}finally{document.body.removeChild(b)}}},a.escapeHTML=function(a){var b=a;return"string"==typeof a&&(b=b.replace(/&/g,"&amp;"),b=b.replace(/</g,"&lt;").replace(/>/g,"&gt;")),b},a.unescapeHTML=function(a){var b=a;return"string"==typeof a&&(b=b.replace(/&lt;/g,"<").replace(/&gt;/g,">"),b=b.replace(/&amp;/g,"&")),b},a.sanitizeHTML=function(a){var b=a.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/g,"");return b=b.replace(/on\w+="[^"]*"/g,""),b=b.replace(/ on\w+='[^']*'/g,"")},a.fn.hideFocus=function(){var b=a(this),c=b.next(),d=!1,e=!1,f=!1;b.is(".checkbox, .radio, .switch")?(c.is('[type="hidden"]')&&(c=c.next()),b.addClass("hide-focus").on("focusin.hide-focus",function(){d||e||f||b.removeClass("hide-focus"),d=!1,e=!0,f=!1}).on("focusout.hide-focus",function(){b.addClass("hide-focus"),f=c.is(f),d=!1,e=!1}),c.on("mousedown.hide-focus",function(){f=this,d=!0,b.addClass("hide-focus")})):b.addClass("hide-focus").on("mousedown.hide-focus touchstart.hide-focus",function(){d=!0,b.addClass("hide-focus")}).on("focusin.hide-focus",function(){d||e||b.removeClass("hide-focus"),d=!1,e=!0}).on("focusout.hide-focus",function(){b.addClass("hide-focus"),d=!1,e=!1})},a.fn.clearable=function(){var b=this;this.element=a(this),this.xButton=a.createIconElement({classes:"close is-empty",icon:"close"}).icon(),this.checkContents=function(){var a=b.element.val();a&&a.length?this.xButton.removeClass("is-empty"):this.xButton.addClass("is-empty"),this.element.trigger("contents-checked")},b.element.parent().append(this.xButton),this.xButton.offTouchClick("clearable").off().onTouchClick("clearable",".clearable").on("click.clearable",function(){b.element.val("").trigger("change").focus().trigger("cleared"),b.checkContents()}),this.element.on("change.clearable, blur.clearable, keyup.clearable",function(){b.checkContents()}),this.checkContents()},a.actualChar=function(a){var b=a.which,c={188:"44",190:"46",191:"47",192:"96",220:"92",222:"39",221:"93",219:"91",173:"45",187:"61",186:"59",189:"45"},d={96:"~",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",48:")",45:"_",61:"+",91:"{",93:"}",92:"|",59:":",37:"%",38:"&",39:'"',44:"<",46:">",47:"?"};return c.hasOwnProperty(b)&&(b=c[b]),!a.shiftKey&&b>=65&&b<=90?String.fromCharCode(b+32):a.shiftKey&&d.hasOwnProperty(b)?d[b]:String.fromCharCode(b)},window.Soho.utils.equals=function(a,b){return JSON.stringify(a)===JSON.stringify(b)},window.Soho.DOM.getAttributes=function(a){if(a&&(a instanceof HTMLElement||a instanceof SVGElement))return a.attributes},window.Soho.DOM.classNameExists=function(a){var b=a.className;return b&&b.length>0},window.Soho.DOM.classNameHas=function(a,b){return a.indexOf(b)>-1},window.Soho.DOM.hasClass=function(a,b){return a.classList?a.classList.contains(b):new RegExp("\\b"+b+"\\b").test(a.className)},window.Soho.DOM.addClass=function(a,b){a.classList?a.classList.add(b):window.Soho.DOM.hasClass(a,b)||(a.className+=" "+b)},window.Soho.DOM.isElement=function(b){return!!(b instanceof HTMLElement||b instanceof SVGElement||b instanceof a&&b.length)},window.Soho.DOM.getDimensions=function(b){if(!Soho.DOM.isElement(b))return{};if(b instanceof a){if(!b.length)return{};b=b[0]}var c=b.getBoundingClientRect(),d={};for(var e in c)isNaN(c[e])||(d[e]=c[e]);return d},window.Soho.utils.debounce=function(a,b,c){var d;return function(){function e(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(e,b||100)}},function(a,b){a.fn[b]=function(a){return a?this.bind("resize",Soho.utils.debounce(a)):this.trigger(b)}}(a,"debouncedResize"),window.Soho.string={},window.Soho.string.splice=function(a,b,c,d){return a.slice(0,b)+d+a.slice(b+Math.abs(c))},window.Soho.utils.fixSVGIcons=function(b){if(("ie"===Soho.env.browser.name||"11"===Soho.env.browser.version)&&void 0!==b){if(b instanceof a){if(!b.length)return;b=b[0]}setTimeout(function(){for(var a=b.getElementsByTagName("use"),c=0;c<a.length;c++){var d=a[c].getAttribute("xlink:href");a[c].setAttribute("xlink:href","x"),a[c].setAttribute("xlink:href",d)}},1)}},window.Soho.utils.getViewportSize=function(){return{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}},window.Soho.utils.getContainerScrollDistance=function(b){if(!Soho.DOM.isElement(b))return[];var c=[],d=[".scrollable",".scrollable-x",".scrollable-y",".modal",".card-content",".widget-content",".tab-panel",".datagrid-content"];return a(b).parents(d.join(", ")).each(function(){var a=this;c.push({element:a,left:a.scrollLeft,top:a.scrollTop})}),document.body.classList.contains("no-scroll")||c.push({element:document.body,left:document.body.scrollLeft,top:document.body.scrollTop}),c},window.Soho.utils.getHiddenSize=function(b,c){var d={dims:{width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},parentElement:void 0,includeMargin:!1};if(!Soho.DOM.isElement(b))return d.dims;b=a(b),c=a.extend({},d,c);var e=Soho.DOM.isElement(c.parentElement);e&&(b=b.clone().appendTo(c.parentElement));var f=c.dims,g=b.parents().add(b),h={transition:"none",webkitTransition:"none",mozTransition:"none",msTransition:"none",visibility:"hidden",display:"block"},i=[];return g.each(function(){var a={};for(var b in h)this.style[b]&&(a[b]=this.style[b],this.style[b]=h[b]);i.push(a)}),f.padding={bottom:b.css("padding-bottom"),left:b.css("padding-left"),right:b.css("padding-right"),top:b.css("padding-top")},f.width=b.width(),f.outerWidth=b.outerWidth(c.includeMargin),f.innerWidth=b.innerWidth(),f.scrollWidth=b[0].scrollWidth,f.height=b.height(),f.innerHeight=b.innerHeight(),f.outerHeight=b.outerHeight(c.includeMargin),f.scrollHeight=b[0].scrollHeight,g.each(function(a){var b=i[a];for(var c in h)b[c]&&(this.style[c]=b[c])}),e&&b.remove(),f},a.fn.getHiddenSize=function(a){return window.Soho.utils.getHiddenSize(this,a)},window.Soho.behaviors={},window.Soho.behaviors.smoothScrollTo=function(b,c,d){function e(a,b,c){if(c<=a)return 0;if(c>=b)return 1;var d=(c-a)/(b-a);return d*d*(3-2*d)}function f(){if(b.scrollLeft!==l)return void g.reject();var a=Date.now(),c=e(h,i,a),d=Math.round(j+k*c);return b.scrollLeft=d,a>=i?void g.resolve():b.scrollLeft===l&&b.scrollLeft!==d?void g.resolve():(l=b.scrollLeft,void setTimeout(f,0))}var g=a.Deferred();if(!Soho.DOM.isElement(b))return g.reject();if(b instanceof a&&b.length&&(b=b[0]),void 0===c||null===c)return g.resolve();if(isNaN(d)&&(d=0),c=Math.round(c),(d=Math.round(d))<0)return g.fail();if(0===d)return b.scrollLeft=b.scrollLeft+c,g.resolve();var h=Date.now(),i=h+d,j=b.scrollLeft,k=c,l=b.scrollLeft;return setTimeout(f,0),g},a.fn.smoothScroll=function(a,b){return window.Soho.behaviors.smoothScrollTo(this,a,b)},window.Soho.breakpoints={phone:320,slim:400,phablet:610,"phone-to-tablet":767,"wide-tablet":968,"tablet-to-desktop":1280,"desktop-to-extralarge":1600},window.Soho.breakpoints.isAbove=function(b){var c=Soho.breakpoints[b];return!!c&&a(window).width()>c},window.Soho.breakpoints.isBelow=function(b){var c=Soho.breakpoints[b];return!!c&&a(window).width()<c},{addGlobalResize:function(){return a(window).debouncedResize(function(){a("body").triggerHandler("resize",[window])}),this},set:function(){this.makeSohoObject().addBrowserClasses().addGlobalResize()},addBrowserClasses:function(){var b=navigator.userAgent||navigator.vendor||window.opera,c=a("html"),d="";if(-1!==b.indexOf("Safari")&&-1===b.indexOf("Chrome")&&-1===b.indexOf("Android")&&(d+="is-safari ",Soho.env.browser.name="safari"),-1!==b.indexOf("Chrome")&&(d+="is-chrome ",Soho.env.browser.name="chrome"),-1!==b.indexOf("Mac OS X")&&(d+="is-mac ",Soho.env.os.name="Mac OS X"),b.indexOf("Firefox")>0&&(d+="is-firefox ",Soho.env.browser.name="firefox"),b.match(/Edge\//)&&(d+="ie ie-edge ",Soho.env.browser.name="edge"),b.match(/Trident/)&&(d+="ie ",Soho.env.browser.name="ie"),(navigator.appVersion.indexOf("MSIE 8.0")>-1||b.indexOf("MSIE 8.0")>-1||8===document.documentMode)&&(d+="ie8 ",Soho.env.browser.version="8"),navigator.appVersion.indexOf("MSIE 9.0")>-1&&(d+="ie9 ",Soho.env.browser.version="9"),navigator.appVersion.indexOf("MSIE 10.0")>-1?(d+="ie10 ",Soho.env.browser.version="10"):b.match(/Trident\/7\./)&&(d+="ie11 ",Soho.env.browser.version="11"),/iPhone|iPod|iPad/.test(b)){d+="ios ",Soho.env.os.name="ios";for(var e=["iPod","iPad","iPhone"],f=0;f<e.length;f++)new RegExp(e[f]).test(b)&&(d+=e[f].toLowerCase()+" ",Soho.env.device=e[f])}return/Android/.test(b)&&(d+="android ",Soho.env.os.name="android"),c.addClass(d),this},makeSohoObject:function(){return window.Soho=window.Soho||{},window.Soho.logTimeStart=function(a){window.Soho.logTime&&console.time(a)},window.Soho.logTimeEnd=function(a){window.Soho.logTime&&console.timeEnd(a)},window.Soho.env={browser:{},os:{}},window.Soho.env.pasteEvent=function(){var a=document.createElement("input");return a.setAttribute("onpaste",""),"function"==typeof a.onpaste?"paste":"input"}(),window.Soho.theme="light",this}}.set(),a.fn.animateOpen=function(b){"use strict";var c={direction:"vertical",distance:"auto",timing:300,transition:"cubic-bezier(.17, .04, .03, .94)"},d=a.extend({},c,b);return this.each(function(){function b(){c&&clearTimeout(c),f.data("ignore-animation-once")&&a.removeData(f[0],"ignore-animation-once"),f.data("is-animating")&&a.removeData(f[0],"is-animating"),f.off(g+".animateopen"),e.style.transition="",e.style[h]=j,f.trigger("animateopencomplete")}var c,e=this,f=a(this),g=a.fn.transitionEndName(),h="horizontal"===d.direction?"width":"height",i=h.charAt(0).toUpperCase()+h.slice(1),j=isNaN(d.distance)?"auto":parseInt(d.distance,10)+"px";f.one("animateopenstart.animation",function(a){a.stopPropagation(),f.off(g+".animateopen")}),f.trigger("animateopenstart"),g&&f.one(g+".animateopen",b),f.data("is-animating",!0);var k=this.style[h];this.style[h]=j;var l=getComputedStyle(this)[h];this.style[h]=k,this["offset"+i],this.style.transition=h+" "+d.timing+"ms "+d.transition,c=setTimeout(b,d.timing),this.style[h]=l,(f.is(":hidden")||f.is(".no-transition")||f.data("ignore-animation-once"))&&b()})},a.fn.animateClosed=function(b){var c={direction:"vertical",timing:300,transition:"cubic-bezier(.17, .04, .03, .94)"},d=a.extend({},c,b);return this.each(function(){function b(){c&&clearTimeout(c),f.data("ignore-animation-once")&&a.removeData(f[0],"ignore-animation-once"),f.data("is-animating")&&a.removeData(f[0],"is-animating"),f.off(g+".animatedclosed"),e.style.transition="",e.style[h]="0px",f.trigger("animateclosedcomplete")}var c,e=this,f=a(this),g=a.fn.transitionEndName(),h="horizontal"===d.direction?"width":"height",i=h.charAt(0).toUpperCase()+h.slice(1);f.one("animateclosedstart",function(a){a.stopPropagation(),f.off(g+".animatedclosed")}),f.trigger("animateclosedstart"),g&&f.one(g+".animatedclosed",b),f.data("is-animating",!0),this.style[h]=getComputedStyle(this)[h],this["offset"+i],this.style.transition=h+" "+d.timing+"ms "+d.transition,c=setTimeout(b,d.timing),this.style[h]="0px",(f.is(":hidden")||f.is(".no-transition")||f.data("ignore-animation-once"))&&b()})},a.fn.isAnimating=function(){return this.each(function(){return!0===a(this).data("is-animating")})};var C="";window.Locale&&window.Locale.hasOwnProperty("culturesPath")&&(C=window.Locale.culturesPath),window.Locale={currentLocale:{name:"",data:{}},cultures:{},culturesPath:C,updateLang:function(){var b=a("html");b.attr("lang",this.currentLocale.name),this.isRTL()?b.attr("dir","rtl"):b.removeAttr("dir")},getCulturesPath:function(){if(!this.culturesPath)for(var a=document.getElementsByTagName("script"),b=0;b<a.length;b++){var c=a[b].src,d=c.indexOf("?");if(""!==c&&d>-1&&(c=c.substr(0,d)),"sohoxi-script"===a[b].id)return c.substring(0,c.lastIndexOf("/"))+"/";c.indexOf("sohoxi.min.js")>-1&&(this.culturesPath=c.replace("sohoxi.min.js","")+"cultures/"),c.indexOf("sohoxi.js")>-1&&(this.culturesPath=c.replace("sohoxi.js","")+"cultures/")}return this.culturesPath},cultureInHead:function(){for(var a=!1,b=document.getElementsByTagName("script"),c=0;c<b.length;c++){b[c].src.indexOf("cultures")>-1&&(a=!0)}return a},addCulture:function(a,b){this.cultures[a]=b},set:function(b){var c=this;return this.dff=a.Deferred(),"in-ID"===b&&(b="id-ID"),b&&!this.cultures[b]&&this.currentLocale.name!==b&&(this.setCurrentLocale(b),a.ajax({url:this.getCulturesPath()+this.currentLocale.name+".js",dataType:"script",error:function(){c.dff.reject()}}).done(function(){c.setCurrentLocale(b,c.cultures[b]),c.addCulture(b,c.currentLocale.data),
c.dff.resolve(c.currentLocale.name)})),b&&"en-US"!==b&&!this.cultures["en-US"]&&a.ajax({url:this.getCulturesPath()+"en-US.js",dataType:"script",error:function(){c.dff.reject()}}).done(function(){c.addCulture(b,c.currentLocale.data)}),b&&c.currentLocale.data&&c.currentLocale.dataName===b&&c.dff.resolve(c.currentLocale.name),c.setCurrentLocale(b,c.cultures[b]),c.cultures[b]&&this.cultureInHead()&&c.dff.resolve(c.currentLocale.name),this.dff.promise()},setCurrentLocale:function(a,b){this.currentLocale.name=a,b&&(this.currentLocale.data=b,this.currentLocale.dataName=a),this.updateLang()},formatDate:function(a,b){if(b||(b={date:"short"}),a){if(!(a instanceof Date)){var c=new Date(a);isNaN(c)&&"datetime"===b.date&&"-"===a.substr(4,1)&&"-"===a.substr(7,1)&&(c=new Date(a.substr(0,4),a.substr(5,2)-1,a.substr(8,2),a.substr(11,2),a.substr(14,2),a.substr(17,2))),a=c}var d,e=this.currentLocale.data,f="",g=e.calendars?e.calendars[0]:null;b.pattern&&(d=b.pattern),b.date&&(d=g.dateFormat[b.date]);var h=a.getDate(),i=a.getMonth(),j=a.getFullYear(),k=a.getMinutes(),l=a.getHours(),m=a.getSeconds();d=d.replace("ngày","nnnn"),d=d.replace("tháng","t1áng"),d=d.replace("den","nnn"),f=d.replace("dd",this.pad(h,2)),f=f.replace("d",h),f=f.replace("yyyy",j),f=f.replace("yy",j.toString().substr(2)),f=f.replace("y",j);return f.indexOf(" a")>-1&&0===l&&(f=f.replace("hh",12),f=f.replace("h",12)),f=f.replace("hh",l>12?this.pad(l-12,2):this.pad(l,2)),f=f.replace("h",l>12?l-12:l),f=f.replace("HH",this.pad(l,2)),f=f.replace("H",l>12?l-12:l),f=f.replace("mm",this.pad(k,2)),f=f.replace("ss",this.pad(m,2)),f=f.replace("SSS",this.pad(a.getMilliseconds(),0)),f=f.replace("MMMM",g?g.months.wide[i]:null),f=f.replace("MMM",g?g.months.abbreviated[i]:null),-1===d.indexOf("MMM")&&(f=f.replace("MM",this.pad(i+1,2)),f=f.replace("M",i+1)),g&&(f=f.replace(" a"," "+(l>=12?g.dayPeriods[1]:g.dayPeriods[0])),f=f.replace("EEEE",g.days.wide[a.getDay()])),g&&(f=f.replace("EEEE",g.days.wide[a.getDay()])),f=f.replace("nnnn","ngày"),f=f.replace("t1áng","tháng"),f=f.replace("nnn","den"),f.trim()}},isValidDate:function(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())},parseDate:function(b,c,d){var e=this.calendar(),f=b;if(b){c||(c=this.calendar().dateFormat.short),c.pattern&&(c=c.pattern),"object"==typeof c&&c.date&&(c=this.calendar().dateFormat[c.date]);var g,h,i,j,k={},l=c.toLowerCase().indexOf("h")>-1,m=b.toLowerCase().indexOf("z")>-1;if(l&&(c=c.replace(/[T\s:.-]/g,"/").replace(/z/i,""),b=b.replace(/[T\s:.-]/g,"/").replace(/z/i,"")),"Mdyyyy"!==c&&"dMyyyy"!==c||(b=b.substr(0,b.length-4)+"/"+b.substr(b.length-4,b.length),b=b.substr(0,b.indexOf("/")/2)+"/"+b.substr(b.indexOf("/")/2)),"Mdyyyy"===c&&(c="M/d/yyyy"),"dMyyyy"===c&&(c="d/M/yyyy"),-1!==c.indexOf(" ")&&(c=c.replace(/[\s:.]/g,"/"),b=b.replace(/[\s:.]/g,"/")),-1===c.indexOf(" ")&&-1===c.indexOf(".")&&-1===c.indexOf("/")&&-1===c.indexOf("-")){var n=c[0],o="",p="";for(i=0,j=c.length;i<j;i++)o+=c[i]!==n?"/"+c[i]:c[i],p+=c[i]!==n?"/"+b[i]:b[i],i>1&&(n=c[i]);b=p,c=o}g=c.split("/"),h=b.split("/"),1===g.length&&(g=c.split(".")),1===h.length&&(h=b.split(".")),1===g.length&&(g=c.split("-")),1===h.length&&(h=b.split("-")),1===g.length&&(g=c.split(" ")),1===h.length&&(h=b.split(" "));var q=this.getDatePart(g,h,"M","MM","MMM"),r=this.getDatePart(g,h,"yy","yyyy"),s=!1;for(i=0,j=h.length;i<j;i++){var t=g[i]+"",u=h[i],v=parseInt(u);switch(s||(s=t.toLowerCase().indexOf("d")>-1),t){case"d":var w=new Date(r,q,0).getDate();if(v<1||v>31||v>w)return;k.day=u;break;case"dd":if(v<1||v>31||v<10&&"0"!==u.substr(0,1))return;k.day=u;break;case"M":if(v<1||v>12)return;k.month=u-1;break;case"MM":if(v<1||v>12||v<10&&"0"!==u.substr(0,1))return;k.month=u-1;break;case"MMM":for(var x=this.calendar().months.abbreviated,y=0;y<x.length;y++)f.indexOf(x[y])>-1&&(k.month=y);break;case"MMMM":for(var z=this.calendar().months.wide,A=0;A<z.length;A++)f.indexOf(z[A])>-1&&(k.month=A);break;case"yy":k.year=parseInt("20"+u,10);break;case"yyyy":k.year=u;break;case"h":if(v<0||v>12)return;k.h=u;break;case"HH":if(v<0||v>24)return;k.h=u;break;case"ss":if(v<0||v>60){k.ss=0;break}k.ss=u;break;case"SSS":k.ms=u;break;case"mm":if(v<0||v>60){k.mm=0;break}k.mm=u;break;case"a":u.toLowerCase()!==e.dayPeriods[0]&&u.toUpperCase()!==e.dayPeriods[0]||(k.a="AM",k.h&&(12!==k.h&&"12"!==k.h||(k.h=0))),u.toLowerCase()!==e.dayPeriods[1]&&u.toUpperCase()!==e.dayPeriods[1]||(k.a="PM",k.h&&k.h<12&&(k.h=parseInt(k.h)+12))}}if(k.return=void 0,k.leapYear=k.year%4==0&&k.year%100!=0||k.year%400==0,!l||k.h||k.mm){if(!k.year&&0!==k.year&&!d){for(k.isUndefindedYear=!0,i=0,j=g.length;i<j;i++)if(g[i].indexOf("y")>-1&&void 0!==h[i]){k.isUndefindedYear=!1;break}k.isUndefindedYear?k.year=(new Date).getFullYear():delete k.year}if(k.year&&2===k.year.length&&(k.year="20"+k.year),k.year=a.trim(k.year),k.day=a.trim(k.day),(""===k.year||k.year&&2!==(k.year+"").length&&4!==(k.year+"").length)&&delete k.year,!k.month&&0!==k.month&&!d){for(k.isUndefindedMonth=!0,i=0,j=g.length;i<j;i++)if(g[i].indexOf("M")>-1&&void 0!==h[i]){k.isUndefindedMonth=!1;break}k.isUndefindedMonth&&(k.month=(new Date).getMonth())}if(!(k.day||0===k.day||d&&s)){for(k.isUndefindedDay=!0,i=0,j=g.length;i<j;i++)if(g[i].indexOf("d")>-1&&void 0!==h[i]){k.isUndefindedDay=!1;break}k.isUndefindedDay?k.day=1:delete k.day}return l?m?(void 0!==k.h&&(k.return=new Date(Date.UTC(k.year,k.month,k.day,k.h,k.mm))),void 0!==k.ss&&(k.return=new Date(Date.UTC(k.year,k.month,k.day,k.h,k.mm,k.ss))),void 0!==k.ms&&(k.return=new Date(Date.UTC(k.year,k.month,k.day,k.h,k.mm,k.ss,k.ms)))):(void 0!==k.h&&(k.return=new Date(k.year,k.month,k.day,k.h,k.mm)),void 0!==k.ss&&(k.return=new Date(k.year,k.month,k.day,k.h,k.mm,k.ss)),void 0!==k.ms&&(k.return=new Date(k.year,k.month,k.day,k.h,k.mm,k.ss,k.ms))):k.return=new Date(k.year,k.month,k.day),this.isValidDate(k.return)?k.return:void 0}}},getDatePart:function(b,c,d,e,f){var g=0;return a.each(c,function(a){d!==b[a]&&e!==b[a]&&f!==b[a]||(g=c[a])}),g},formatNumber:function(a,b){var c,d,e,f=b&&b.decimal?b.decimal:this.numbers().decimal,g=b&&void 0!==b.group?b.group:this.numbers().group,h=b&&void 0!==b.minimumFractionDigits?b.minimumFractionDigits:b&&b.style&&"currency"===b.style?2:b&&b.style&&"percent"===b.style?0:2,i=b&&void 0!==b.maximumFractionDigits?b.maximumFractionDigits:b&&b.style&&("currency"===b.style||"percent"===b.style)?2:b&&b.minimumFractionDigits?b.minimumFractionDigits:3;if(void 0!==a&&null!==a&&""!==a){if(b&&"integer"===b.style&&(i=0,h=0),b&&"currency"===b.style){var j=this.currentLocale.data.currencySign;d=this.currentLocale.data.currencyFormat,d=d.replace("¤",j)}if(b&&"percent"===b.style){var k=this.currentLocale.data.numbers.percentSign;e=this.currentLocale.data.numbers.percentFormat,e=e.replace("¤",k)}"string"==typeof a&&("."!==f&&(a=a.replace(f,".")),a=Locale.parseNumber(a)),b&&"percent"===b.style&&(a=(100*a).toFixed(h));var l=this.truncateDecimals(a,h,i,b&&b.round).split(".");if(l[0]=l[0].replace(/\B(?=(\d{3})+(?!\d))/g,g),c=l.join(f),0===h&&(c=c.replace(/(\.[0-9]*?)0+$/,"$1"),c=c.replace(/\.$/,"")),0===h&&"."!==f&&(c=c.replace(/(\,[0-9]*?)0+$/,"$1"),c=c.replace(/\,$/,"")),h>0){var m=new RegExp("(\\..{"+h+"}[0-9]*?)0+$");c=c.replace(m,"$1"),c=c.replace(/\.$/,"")}return b&&"currency"===b.style&&(c=d.replace("#,##0.00",c)),b&&"percent"===b.style&&(c=e.replace("#,##0",c)),c}},decimalPlaces:function(a){var b=/^-?[0-9]+\.([0-9]+)$/.exec(a);return null===b?0:b[1].length},truncateDecimals:function(a,b,c,d){var e,f=Math.pow(10,c),g=a*f,h=this.decimalPlaces(a);return(a.toString().length-h-1>=10||h===b&&h===c||h<c)&&(f=Math.pow(100,c),g=a*f),e=Math[g<0?"ceil":"floor"](g),d&&h>=c&&g>0&&(e=Math.round(g)),d&&h<=c&&h>0&&(e=Math.round(g)),h<c&&h>0&&(e=Math.floor(g),c=Math.max(h,b)),(e/f).toFixed(c)},parseNumber:function(a){var b,c,d,e,f,g=this.currentLocale.data.numbers;return(b=a)?(c=g?g.group:",",d=g?g.decimal:".",e=g?g.percentSign:"%",f=f?this.currentLocale.data.currencySign:"$",b=b.replace(new RegExp("\\"+c,"g"),""),b=b.replace(d,"."),b=b.replace(e,""),b=b.replace(f,""),b=b.replace(" ",""),parseFloat(b)):NaN},translate:function(a){if(void 0===this.currentLocale.data||void 0===this.currentLocale.data.messages)return a;if(void 0===this.currentLocale.data.messages[a]){if(!this.cultures["en-US"]||void 0===this.cultures["en-US"].messages[a])return;return this.cultures["en-US"].messages[a].value}return this.currentLocale.data.messages[a].value},translateDayPeriod:function(a){return/am|pm|AM|PM/i.test(a)?Locale.calendar().dayPeriods[/AM|am/i.test(a)?0:1]:a},calendar:function(){return this.currentLocale.data.calendars?this.currentLocale.data.calendars[0]:{dateFormat:"yyyy-MM-dd",timeFormat:"HH:mm:ss"}},numbers:function(){return this.currentLocale.data.numbers?this.currentLocale.data.numbers:{percentSign:"%",percentFormat:"#,##0 %",minusSign:"-",decimal:".",group:","}},pad:function(a,b,c){return c=c||"0",a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a},isRTL:function(){return"right-to-left"===this.currentLocale.data.direction},toUpperCase:function(a){return"function"==typeof this.currentLocale.data.toUpperCase?this.currentLocale.data.toUpperCase(a):a.toLocaleUpperCase()},toLowerCase:function(a){return"function"==typeof this.currentLocale.data.toLowerCase?this.currentLocale.data.toLowerCase(a):a.toLocaleLowerCase()},capitalize:function(a){return this.toUpperCase(a.charAt(0))+a.slice(1)},capitalizeWords:function(a){for(var b=a.split(" "),c=0;c<b.length;c++)b[c]=this.capitalize(b[c]);return b.join(" ")},flipIconsHorizontally:function(){var b=["attach","bottom-aligned","bullet-list","cancel","cart","collapse-app-tray","cut","document","drilldown","duplicate","expand-app-tray","export","first-page","folder","import","last-page","launch","left-align","left-text-align","left-arrow","new-document","next-page","number-list","paste","previous-page","quote","redo","refresh","right-align","right-arrow","right-text-align","save","search-folder","search-list","search","send","tack","tree-collapse","tree-expand","undo","unlocked","add-grid-record","add-grid-row","additional-help","bubble","cascade","change-font","clear-screen","script","clockwise-90","close-cancel","close-save","contacts","copy-from","copy-mail","copy-url","counter-clockwise-90","create-report","delete-grid-record","delete-grid-row","display","employee-directory","export-2","export-to-pdf","generate-key","get-more-rows","group-selection","headphones","help","helper-list-select","history","invoice-released","language","logout","key","lasso","line-bar-chart","line-chart","new-expense-report","new-payment-request","new-time-sheet","new-travel-plan","no-attachment","no-comment","no-filter","overlay-line","pdf-file","phone","payment-request","pie-chart","queries","quick-access","refresh-current","restore-user","run-quick-access","save-close","save-new","search-results-history","select","send-submit","show-last-x-days","special-item","stacked","timesheet","unsubscribe","update-preview","zoom-100","zoom-in","zoom-out","caret-left","caret-right"];a("svg").each(function(){var c=a(this).getIconName();c&&-1!==a.inArray(c,b)&&a(this).addClass("icon-rtl-rotate")})}},a(function(){setTimeout(function(){window.Locale.cultureInHead()||window.Locale.currentLocale.name||window.Locale.set("en-US"),window.Locale.isRTL()&&window.Locale.flipIconsHorizontally()},50)});var D={caseSensitive:!1,filterMode:"startsWith",highlightMatchedText:!1,highlightCallback:null},E=["startsWith","contains"];e.prototype={init:function(){for(var b=[{setting:this.settings.filterMode,limits:E,preset:D.filterMode}],c=0;c<b.length;c++)!function(b,c,d){-1===a.inArray(b,c)&&(b=d)}(b[c].setting,b[c].limits,b[c].preset);return this},filter:function(b,c){function d(b){var d="string"==typeof b,g=d?b:a(b).text(),h=g.split(" "),i=!1;if("startsWith"===e.settings.filterMode){for(var j=0;j<h.length;j++)if(0===h[j].toLowerCase().indexOf(c)){i=!0;break}0===g.toLowerCase().indexOf(c)&&(i=!0),c.indexOf(" ")>0&&g.toLowerCase().indexOf(c)>0&&(i=!0)}"contains"===e.settings.filterMode&&g.toLowerCase().indexOf(c)>=0&&(i=!0),i&&f.push(b)}if(!b)return!1;if(!(a.isArray(b)||b instanceof jQuery))return!1;if(!c||"string"!=typeof c||!c.length)return!1;var e=this,f=[],g=!1;return this.settings.caseSensitive||(c=c.toLowerCase()),a.isArray(b)||(b instanceof jQuery||"object"==typeof b)&&(b=a.makeArray(b),g=!0),b.forEach(d),g&&(f=a(f)),f},updated:function(b){return this.settings=a.extend({},this.settings,b),this.teardown().init()},teardown:function(){return this},destroy:function(){return this.teardown()}},window.ListFilter=e,a.fn.about=function(b){function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="about",e={appName:"Infor Application Name",content:void 0,copyrightYear:(new Date).getFullYear(),deviceSpecs:!0,productName:void 0,useDefaultCopyright:!0,version:void 0},f=a.extend({},e,b);return c.prototype={init:function(){return this.setup().build().handleEvents()},setup:function(){this.isBody=a(this.element).is("body");var b=this.element.attr("data-appname");this.settings.appName=void 0!==b?b.toString():this.settings.appName;var c=this.element.attr("data-about-content");this.settings.content=void 0!==c?c.toString():this.settings.content;var d=this.element.attr("data-copyright-year");this.settings.copyrightYear=void 0!==d?d.toString():this.settings.copyrightYear;var e=this.element.attr("data-device-specs");e&&(this.settings.deviceSpecs="true"===e);var f=this.element.attr("data-product-name");this.settings.productName=void 0!==f?f.toString():this.settings.productName;var g=this.element.attr("data-use-default");void 0!==g&&(this.settings.useDefaultCopyright="true"===g);var h=this.element.attr("data-version");return this.settings.version=void 0!==h?h.toString():this.settings.version,this.defaultCopyright=Locale.translate("AboutText")+' <a class="hyperlink" href="http://www.infor.com" target="_blank">www.infor.com</a>.',this.defaultCopyright=this.defaultCopyright.replace("{0}",this.settings.copyrightYear),this},build:function(){this.modal=a('<div class="modal about" id="about-modal"></div>'),a('<div class="modal-content"></div>').appendTo(this.modal);var b=a('<div class="modal-header"></div>').appendTo(this.modal.find(".modal-content"));a('<div class="close-container"></div>').append(a('<button name="close" type="button" class="btn-icon hide-focus"></button>').append(a.createIconElement({icon:"close",classes:"icon-close"})).append("<span>"+Locale.translate("Close")+"</span>")).appendTo(b),a.createIconElement({icon:"logo-trademark",classes:["icon","about-logo"]}).attr({viewBox:"0 0 44 44"}).appendTo(b),this.title=a('<h1 class="title"></h1>').text(this.settings.appName).appendTo(this.modal.find(".modal-header"));var c=a('<div class="modal-body"></div>').appendTo(this.modal.find(".modal-content"));if(this.settings.version||this.settings.productName){var d=(this.settings.productName?this.settings.productName+" ":"")+(this.settings.version?this.settings.version:"");a("<p></p>").text(d).appendTo(c)}if(this.settings.content&&a('<div class="additional-content"></div>').html(this.settings.content).appendTo(c),!this.settings.useDefaultCopyright&&this.settings.content||a("<p></p>").html(this.defaultCopyright).appendTo(c),this.settings.deviceSpecs){var e=this.getDeviceSpecs(),f='<span class="browser">'+Locale.translate("Browser")+" : "+e.browser+'</span><br><span class="platform">'+Locale.translate("Platform")+" : "+e.os+'</span><br><span class="locale">'+Locale.translate("Locale")+" : "+e.locale+'</span><br><span class="cookiesEnabled">'+Locale.translate("CookiesEnabled")+" : "+e.cookiesEnabled+"</span><br>";a("<p></p>").html(f).appendTo(c)}return this.buttons=this.modal.find("button"),this.modal.find(".hide-focus").one("blur",function(){a(this).removeClass("hide-focus")}),this.element.attr("data-modal","about-modal"),a(".modal-body",this.modal)[0].tabIndex=0,this.modal.appendTo("body"),this.modal.modal({trigger:this.isBody?"immediate":"click"}),this},getDeviceSpecs:function(){var a="Microsoft Internet Explorer"===navigator.appName?navigator.userLanguage:navigator.language;return{browser:function(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&null!=(a=b.match(/\b(OPR|Edge)\/(\d+)/))?a.slice(1).join(" ").replace("OPR","Opera"):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),c.join(" "))}(),os:navigator.platform,cookiesEnabled:navigator.cookieEnabled,locale:a}},close:function(){var a=this.modal.data("modal");a&&a.close(),this.isBody&&this.destroy()},destroy:function(){var b=this.modal.data("modal");b&&(b.element.off("beforeopen.about"),b.destroy()),this.buttons.off(),this.element.off("open.about"),a.removeData(this.element[0],d)},handleEvents:function(){var b=this;return this.element.on("open.about",function(a){a.stopPropagation(),b.element.trigger("click")}),this.buttons.filter('[name="done"], [name="close"]').on("click.about",function(){b.close()}),this.modal.data("modal").element.on("beforeopen.about",function(){b.modal.find(".modal-body").scrollTop(0)}),a(document).on("keydown.about",function(a){0!==a.which&&27!==a.which||b.close()}),this}},this.each(function(){var e=a.data(this,d);e?e.settings=a.extend({},e.settings,b):e=a.data(this,d,new c(this,f))})},a.fn.accordion=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="accordion",e={allowOnePane:!0,displayChevron:!0,rerouteOnLinkClick:!0,source:null},f=a.extend({},e,b);return c.prototype={init:function(){return this.setup().build().handleEvents()},setup:function(){return this},build:function(){var b=this;this.headers=this.element.find(".accordion-header"),this.anchors=this.headers.children("a"),this.panes=this.headers.next(".accordion-pane");var c=!1;if(this.headers.each(function(){function d(){if(!h)return f?void g.addClass("has-icons"):void e.addClass("no-icon")}var e=a(this),f=!1,g=e.parent(),h=g.is(".accordion");e.attr("role","presentation").hideFocus(),e.children("a").find("svg").detach().insertBefore(e.children("a"));var i=e.children(".icon, svg");if(i.addClass("icon").attr({role:"presentation","aria-hidden":"true",focusable:"false"}),h&&i.length&&(c=!0),(e.is(".list-item")||!h&&e.find("button").length)&&(f=!0),e.hasClass("is-disabled")&&e.children("a, button").attr("tabindex","-1"),!e.next(".accordion-pane").length)return void d();f=!0;var j=e.children(".btn");if(!j.length){j=a('<button class="btn" type="button"></button>');var k="insertBefore";b.settings.displayChevron&&h&&(e.addClass("has-chevron"),k="insertAfter"),j[k](e.children("a")),e.data("addedExpander",j)}j.hideFocus(),i.length&&!b.settings.displayChevron&&i.appendTo(j);var l=j.children(".icon, .svg, .plus-minus");if(!l.length){if(b.settings.displayChevron&&h)l=a.createIconElement({icon:"caret-down",classes:["chevron"]});else{var m=b.isExpanded(e)?" active":"";l=a('<span class="icon plus-minus'+m+'" aria-hidden="true" role="presentation"></span>')}l.appendTo(j)}var n={role:"presentation","aria-hidden":"true"};l.is("span")||(n.focusable="false"),l.attr(n),l.is(".chevron")?(e.addClass("has-chevron"),j.insertAfter(e.children("a"))):(e.removeClass("has-chevron"),j.insertBefore(e.children("a"))),!b.settings.displayChevron&&h&&(c=!0),d();var o=j.children(".audible");o.length||(o=a('<span class="audible"></span>').appendTo(j)),o.text(Locale.translate("Expand"))}),c&&this.element.addClass("has-icons"),this.panes.each(function(){var c=a(this),d=c.prev(".accordion-header");d.children("a").attr({"aria-haspopup":"true",role:"button"}),b.isExpanded(d)||(c.data("ignore-animation-once",!0),b.collapse(d))}),!this.element.data("updating")){var d=this.headers.filter(".is-selected, .is-expanded");this.settings.allowOnePane&&(d=d.first()),this.expand(d),this.select(d.last())}return this},handleHeaderClick:function(b,c){if(!c||!c.length||this.isDisabled(c)||c.data("is-animating"))return void b.preventDefault();if(a(b.target).is('[class^="btn"]'))return void b.preventDefault();var d=c.children("a");return this.handleAnchorClick(b,d)},handleAnchorClick:function(a,b){var c=this,d=b.parent(".accordion-header"),e=d.next(".accordion-pane"),f=b.attr("ng-reflect-href");return a&&!f&&a.preventDefault(),!(!d.length||this.isDisabled(d))&&(!1!==this.element.triggerHandler("beforeselect",[b])?(this.element.trigger("selected",d),this.originalSelection=b,this.select(b),a&&a.stopPropagation(),function(){var a=b.attr("href");return!(!a||""===a||"#"===a||c.settings.rerouteOnLinkClick&&(window.location.href=a,0))}()?(this.element.trigger("followlink",[b]),!0):(function(){e.length&&c.toggle(d),b.focus()}(),!0)):void 0)},handleExpanderClick:function(a,b){var c=b.parent(".accordion-header");if(c.length&&!this.isDisabled(c)&&!c.data("is-animating")){this.originalSelection=b,a&&a.stopPropagation();return c.next(".accordion-pane").length?(this.toggle(c),this.select(c),void b.focus()):this.handleAnchorClick(null,c.children("a"))}},handleKeys:function(b){function c(a){a||(a=f),d.originalSelection||(d.originalSelection=a)}var d=this,e=b.which,f=a(b.target),g=f.parent(),h=g.children('[class^="btn"]').first(),i=g.children("a");if(9===e&&(this.headers.removeClass("is-selected"),c(f.is("a")&&h.length?h:i)),32===e){if(b.preventDefault(),f.is('[class^="btn"]')&&(b.stopPropagation(),b.stopImmediatePropagation(),a("html").hasClass("is-firefox")))return;return h.length?(c(h),this.handleExpanderClick(null,f)):(c(i),this.handleAnchorClick(null,f))}return 37===e||38===e?(b.preventDefault(),c(),b.shiftKey?this.ascend(g):this.prevHeader(g)):39===e||40===e?(b.preventDefault(),c(),b.shiftKey?this.descend(g):this.nextHeader(g)):void 0},select:function(a){if(a&&a.length){var b=a,c=b.parent();if(a.is(".accordion-header")&&(c=a,b=c.children("a")),b.is('[class^="btn"]')&&(b=a.next("a")),!this.isDisabled(c)){this.headers.removeClass("child-selected").removeClass("is-selected"),c.addClass("is-selected");c.parentsUntil(this.element,".accordion-pane").prev(".accordion-header").addClass("child-selected")}}},isDisabled:function(a){return!!this.element.hasClass("is-disabled")||!!a&&a.hasClass("is-disabled")},isExpanded:function(a){if(a&&a.length)return"true"===a.children("a").attr("aria-expanded")},toggle:function(a){if(a&&a.length&&!this.isDisabled(a))return this.isExpanded(a)?void this.collapse(a):void this.expand(a)},expand:function(b){function c(){var c=b.children(".btn");c.length&&(c.children(".plus-minus, .chevron").addClass("active"),c.children(".audible").text(Locale.translate("Collapse")));var g=b.parentsUntil(d.element).filter(".accordion-pane").prev(".accordion-header").add(b);d.settings.allowOnePane&&d.headers.not(g).each(function(){var b=a(this);d.isExpanded(b)&&d.collapse(b)}),g.not(b).each(function(){var b=a(this);d.isExpanded(b)||d.expand(b)}),e.addClass("is-expanded"),d.element.trigger("expand",[f]),e.one("animateopencomplete",function(a){a.stopPropagation(),b.children("a").attr("aria-expanded","true"),d.element.trigger("afterexpand",[f])}).css("display","block").animateOpen()}if(b&&b.length){var d=this,e=b.next(".accordion-pane"),f=b.children("a");!1!==this.element.triggerHandler("beforeexpand",[f])&&(this.callSource(f,c)||c.apply(this))}},expandAll:function(){if(!0!==this.settings.allowOnePane){var b=this;this.headers.each(function(){var c=a(this);b.isExpanded(c)||b.expand(c)})}},collapse:function(a){if(a&&a.length){var b=this,c=a.next(".accordion-pane"),d=a.children("a");if(!1!==this.element.triggerHandler("beforecollapse",[d])){var e=a.children(".btn");e.length&&(e.children(".plus-minus, .chevron").removeClass("active"),e.children(".audible").text(Locale.translate("Expand"))),c.removeClass("is-expanded").closeChildren(),d.attr("aria-expanded","false"),b.element.trigger("collapse",[d]),c.one("animateclosedcomplete",function(a){a.stopPropagation(),c[0].style.display="none",b.element.trigger("aftercollapse",[d])}).animateClosed()}}},collapseAll:function(){var b=this;this.headers.each(function(){var c=a(this);b.isExpanded(c)&&b.collapse(c)})},callSource:function(a,b){function c(){d.updated(),setTimeout(function(){b.apply(d)},1)}if(!this.settings.source||"function"!=typeof this.settings.source)return!1;var d=this,e=a.parent(),f=e.next(".accordion-pane"),g={anchor:a,header:e,pane:f};return this.settings.source(g,c)},getElements:function(b){var c,d,e,f,g=a(b);return g.is(".accordion-header")&&(c=g,e=g.children('[class^="btn"]'),d=g.children("a")),g.is(".btn")&&(e=g,c=e.parent(),d=c.children("a")),g.is("a")&&(d=g,c=d.parent(),e=c.children(".btn")),f=c.next(".accordion-pane"),{header:c,expander:e,anchor:d,pane:f}},prevHeader:function(b,c){var d=this.getElements(b),e=d.header.parent().children(),f=e.index(d.header),g=a(e.get(f-1));if(!e.length||0===f){if(d.header.parent(".accordion-pane").length)return this.ascend(d.header);g=e.last()}for(;g.is(".accordion-content")||this.isDisabled(g);){if(g.is(":only-child")||g.is(":first-child"))return this.ascend(d.header);g=g.prev()}if(g.is(".accordion-pane")){var h=g.prev(".accordion-header");if(this.isExpanded(h)){if(h.next(".accordion-pane").children(":not(.accordion-content)").length&&!c)return this.descend(h,-1)}if(g=h,!g.length){if(d.header.parent(".accordion-pane").length)return this.ascend(d.header);for(g=e.last();g.is(".accordion-content")||this.isDisabled(g);)g=g.prev()}}this.focusOriginalType(g)},nextHeader:function(b,c){var d=this.getElements(b),e=d.header.parent().children(),f=e.index(d.header),g=a(e.get(f+1));if(!e.length||f===e.length-1){if(d.header.parent(".accordion-pane").length)return this.ascend(d.header,-1);g=e.first()}for(;g.is(".accordion-content")||this.isDisabled(g);){if(g.is(":only-child")||g.is(":last-child"))return this.ascend(d.header);g=g.next()}if(g.is(".accordion-pane")){var h=g.prev(".accordion-header");if(this.isExpanded(h)){if(h.next(".accordion-pane").children(":not(.accordion-content)").length&&!c)return this.descend(h)}if(g=a(e.get(f+2)),!g.length){if(d.header.parent(".accordion-pane").length)return this.ascend(d.header,-1);for(g=e.first();g.is(".accordion-content")||this.isDisabled(g);)g=g.next()}}this.focusOriginalType(g)},ascend:function(a,b){b||(b=0);var c=a.parent(".accordion-pane"),d=c.prev();if(-1===b&&(d=c.next(".accordion-header"),!d.length))return c.parent(".accordion").length?this.nextHeader(c.prev().children("a"),!0):this.ascend(c.prev(),-1);this.focusOriginalType(d)},descend:function(a,b){b||(b=0);var c=a.next(".accordion-pane"),d=c.children(".accordion-header").first();return-1===b&&(d=c.children(".accordion-header").last()),d.length?this.isExpanded(d)?this.descend(d,-1):void this.focusOriginalType(d):this.focusOriginalType(a)},focusOriginalType:function(a){this.originalSelection.is(".btn")&&a.children(".btn").length?a.children(".btn").focus():a.children("a").focus()},disable:function(){this.element.addClass("is-disabled"),this.anchors.add(this.headers.children('[class^="btn"]')).attr("tabindex","-1")},enable:function(){this.element.removeClass("is-disabled"),this.anchors.add(this.headers.children('[class^="btn"]')).removeAttr("tabindex")},updated:function(){this.element.data("updating",!0);var b=a(document.activeElement);return a.contains(this.element[0],b[0])||(b=void 0),this.teardown().init(),b&&b.length&&b.focus(),a.removeData(this.element[0],"updating"),this},teardown:function(){return this.headers.off("touchend.accordion click.accordion focusin.accordion focusout.accordion keydown.accordion mousedown.accordion mouseup.accordion").each(function(){var b=a(this).data("addedExpander");b&&(b.remove(),a.removeData(this,"addedExpander"))}),this.anchors.off("touchend.accordion keydown.accordion click.accordion"),this.headers.children('[class^="btn"]').off("touchend.accordion click.accordion keydown.accordion"),this.element.off("updated.accordion selected.accordion"),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)},handleEvents:function(){function b(a){var b="Header";return a.is("a")&&(b="Anchor"),a.is("button")&&(b="Expander"),b}function c(a,c){var e=b(c);return d["handle"+e+"Click"](a,c)}var d=this,e=null;return this.headers.on("click.accordion",function(b){return c(b,a(this))}).on("focusin.accordion",function(b){var c=a(b.target);d.originalSelection||(d.originalSelection=c),c.is(":not(.btn)")&&a(this).addClass("is-focused")}).on("focusout.accordion",function(){a.contains(this,e)&&!a(this).is(a(e))||a(this).removeClass("is-focused")}).on("keydown.accordion",function(a){d.handleKeys(a)}).on("mousedown.accordion",function(b){a(this).addClass("is-focused"),e=b.target}).on("mouseup.accordion",function(){e=null}),this.anchors.on("click.accordion",function(b){return c(b,a(this))}),this.headers.children('[class^="btn"]').on("click.accordion",function(b){return c(b,a(this))}).on("keydown.accordion",function(a){d.handleKeys(a)}),this.element.on("selected.accordion",function(a){a.stopPropagation()}).on("updated.accordion",function(a){a.stopPropagation(),d.updated()}),this}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.applicationmenu=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="applicationmenu",e={breakpoint:"phone-to-tablet",openOnLarge:!1,triggers:[]},f=a.extend({},e,b);return c.prototype={init:function(){this.setup().handleEvents()},setup:function(){this.hasTrigger=!1,this.isAnimating=!1,this.hasTriggers()||(this.triggers=a()),this.menu=this.element;var b=this.element.attr("data-open-on-large");this.settings.openOnLarge=void 0!==b?"true"===b:this.settings.openOnLarge;var c=Soho.breakpoints,d=this.element.attr("data-breakpoint");this.settings.breakpoint=void 0!==c[d]?d:this.settings.breakpoint,this.modifyTriggers(this.settings.triggers,!1,!0),this.scrollTarget=this.menu.parents(".header");var e=this.menu.prevAll(".masthead"),f=this.menu.prevAll(".module-tabs");if(e.length>0&&(this.scrollTarget=e,this.menu.addClass("short")),f.length>0&&(this.scrollTarget=f),this.accordion=this.menu.find(".accordion"),this.accordion.addClass("panel").addClass("inverse"),!this.accordion.data("accordion")){var g=a.fn.parseOptions(this.accordion[0]);this.accordion.accordion(g)}return this.adjustHeight(),this},handleTriggerEvents:function(){function b(b){return!a(b.currentTarget).find(".icon.app-header").hasClass("go-back")&&(!c.isAnimating&&(c.menu.hasClass("is-open")?c.closeMenu(!0):c.openMenu(void 0,!0),!0))}var c=this;this.triggers.length&&this.triggers.off("click.applicationmenu").on("click.applicationmenu",b)},handleKeyDown:function(a){if(27===a.which)return a.preventDefault(),this.closeMenu(),this.triggers.length&&this.triggers.eq(0).focus(),!1},notify:function(b,c){if(b&&void 0!==b&&(b instanceof HTMLElement&&(b=a(b)),b.is("a"))){var d=b.find(".tag");return c&&void 0!==c&&0!==parseInt(c,10)?(d.length||(d=a('<span class="tag"></span>').appendTo(b)),d.text(c.toString()),d):void(d.length&&d.remove())}},adjustHeight:function(){var b=this.scrollTarget.is(".is-sticky"),c=this.scrollTarget.outerHeight(!0),d=c-(b?0:a(window).scrollTop());this.scrollTarget.prev().is(".masthead")&&(d+=this.scrollTarget.prev().outerHeight(!0)),this.menu[0].style.height=d>0?"calc(100% - "+d+"px)":"100%"},isLargerThanBreakpoint:function(){return Soho.breakpoints.isAbove(this.settings.breakpoint)},isOpen:function(){return this.menu[0].classList.contains("is-open")},testWidth:function(){if(this.isOpen()){if(Soho.breakpoints.isAbove(this.settings.breakpoint))return;if(this.element.find(document.activeElement).length||this.isAnimating)return;return void this.closeMenu()}Soho.breakpoints.isBelow(this.settings.breakpoint)||this.userClosed||!this.settings.openOnLarge||this.isAnimating||this.openMenu(!0)},
openMenu:function(b,c){function d(){null!==e.timeout&&(clearTimeout(e.timeout),e.timeout=null),e.isAnimating=!1,e.element.trigger("applicationmenuopen"),c&&(e.userOpened=!0,e.userClosed=void 0),e.menu.removeClass("no-transition"),a(".page-container").removeClass("no-transition")}if(!0!==this.isAnimating){var e=this,f=a.fn.transitonEndName;this.isAnimating=!0,this.adjustHeight(),this.triggers.each(function(){var b=a(this);if(b.parents(".header").length>0||b.parents(".masthead").length>0){if(b.parents(".header, .masthead").parents(".page-container").length)return;b.find(".icon.app-header").removeClass("go-back").addClass("close"),b.trigger("icon-change")}}),this.menu.off(f+".applicationmenu"),this.menu[0].style.display="",this.menu[0].offsetHeight,this.menu.addClass("is-open"),b&&!0===b||this.menu.find(".is-selected > a").focus(),this.menu.one(f+".applicationmenu",d),this.timeout=setTimeout(d,300),setTimeout(function(){a(document).on("click.applicationmenu",function(b){a(b.target).parents(".application-menu").length<1&&!e.isLargerThanBreakpoint()&&e.closeMenu(!0)}).on("keydown.applicationmenu",function(a){e.handleKeyDown(a)})},0)}},closeMenu:function(b){function c(){null!==d.timeout&&(clearTimeout(d.timeout),d.timeout=null),d.menu.off(e+".applicationmenu"),d.menu[0].style.display="none",d.isAnimating=!1,b&&(d.userOpened=void 0,d.userClosed=!0),d.element.trigger("applicationmenuclose")}if(!0!==this.isAnimating){var d=this,e=a.fn.transitionEndName();this.isAnimating=!0,this.triggers.each(function(){var b=a(this);(b.parents(".header").length>0||b.parents(".masthead").length>0)&&(b.find(".icon.app-header").removeClass("close"),b.trigger("icon-change"))}),this.menu.one(e+".applicationmenu",c),this.timeout=setTimeout(c,300),this.menu.removeClass("is-open").find("[tabindex]"),a(document).off("click.applicationmenu keydown.applicationmenu")}},hasTriggers:function(){return void 0!==this.triggers&&this.triggers instanceof a&&this.triggers.length},modifyTriggers:function(b,c,d){if(b&&b.length){var e=a();a.each(b,function(b,c){e=e.add(a(c))}),this.triggers=this.triggers[c?"not":"add"](e),this.handleTriggerEvents(),d&&!0===d||this.updated()}},teardown:function(){var b;return this.accordion.off("blur.applicationmenu"),this.menu.off("animateopencomplete animateclosedcomplete"),a(window).off("scroll.applicationmenu"),a("body").off("resize.applicationmenu"),a(document).off("click.applicationmenu open-applicationmenu close-applicationmenu"),b=this.accordion?this.accordion.data("accordion"):null,b&&b.destroy&&b.destroy(),this.hasTriggers()&&this.triggers.off("click.applicationmenu"),this},updated:function(){return this.teardown().init()},destroy:function(){this.teardown(),this.menu.detach().appendTo(this.originalParent).removeClass("short").removeAttr("style"),a.removeData(this.element[0],d)},handleEvents:function(){var b=this;return this.handleTriggerEvents(),this.menu.on("notify.applicationmenu",function(a,c,d){b.notify(c,d)}).on("updated.applicationmenu",function(){b.updated()}),this.accordion.on("blur.applicationmenu",function(){b.closeMenu()}),a(document).on("open-applicationmenu",function(){b.openMenu()}).on("close-applicationmenu",function(){b.closeMenu()}),a(window).on("scroll.applicationmenu",function(){b.adjustHeight()}),a("body").on("resize.applicationmenu",function(){b.testWidth()}),this.settings.openOnLarge&&this.isLargerThanBreakpoint()&&(this.menu.addClass("no-transition"),a(".page-container").addClass("no-transition")),this.testWidth(),setTimeout(function(){b.menu.removeClass("no-transition"),a(".page-container").removeClass("no-transition")},800),this}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.autocomplete=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="autocomplete",e={source:[],sourceArguments:{},template:void 0,filterMode:"startsWith",delay:300,width:null,offset:null,autoSelectFirstItem:!1},f=a.extend({},e,b);return c.prototype={init:function(){var a=this.element.attr("data-autocomplete");a&&"source"!==a&&(this.settings.source=a),this.addMarkup(),this.handleEvents()},addMarkup:function(){this.element.addClass("autocomplete").attr({role:"combobox",autocomplete:"off"})},isLoading:function(){return this.element.hasClass("is-loading")&&this.element.hasClass("is-blocked")},openList:function(b,c){function d(a){return"chrome"===Soho.env.browser.name&&a.setCoordinate("x",a.x+1),a}if(!this.element.is("[disabled], [readonly]")&&!this.isLoading()){var e=this,f=[];b=Locale.toLowerCase(b),this.list=a("#autocomplete-list"),0===this.list.length&&(this.list=a('<ul id="autocomplete-list" aria-expanded="true"></ul>').appendTo("body")),this.list[0].style.height="auto",this.list[0].style.width=this.element.outerWidth()+"px",this.list.addClass("autocomplete"),this.list.empty(),this.settings.width&&(this.list[0].style.width=this.settings.width+(/(px|%)/i.test(this.settings.width+"")?"":"px"));var g=a(this.element.attr("data-tmpl"));this.tmpl=a(g).length?a(g).text():"string"==typeof g?g:a(this.settings.template).length?a(this.settings.template).text():"string"==typeof this.settings.template?this.settings.template:'<li id="{{listItemId}}" data-index="{{index}}" {{#hasValue}}data-value="{{value}}"{{/hasValue}} role="listitem">\n\n<a href="#" tabindex="-1">\n\n<span>{{{label}}}</span>\n\n</a>\n\n</li>';for(var h=0;h<c.length;h++){var i="string"==typeof c[h],j=i?c[h]:c[h].label,k={label:j},l=i?k:a.extend(k,c[h]),m=j.split(" "),n=!this.settings.filterMode;if("startsWith"===this.settings.filterMode){for(var o=0;o<m.length;o++)0===Locale.toLowerCase(m[o]).indexOf(b)&&(n=!0);0===Locale.toLowerCase(j).indexOf(b)&&(n=!0),b.indexOf(" ")>0&&Locale.toLowerCase(j).indexOf(b)>0&&(n=!0)}if("contains"===this.settings.filterMode&&Locale.toLowerCase(j).indexOf(b)>=0&&(n=!0),n){if(f.push(j),l.listItemId="ac-list-option"+h,l.index=h,"contains"===this.settings.filterMode)l.label=l.label.replace(new RegExp("("+b+")","ig"),"<i>$1</i>");else{l.label=0===Locale.toLowerCase(j).indexOf(b)?"<i>"+j.substr(0,b.length)+"</i>"+j.substr(b.length):j;var p=Locale.toLowerCase(j).indexOf(b);p>0&&(l.label=j.substr(0,p)+"<i>"+j.substr(p,b.length)+"</i>"+j.substr(b.length+p))}if(l.hasValue=!i&&void 0!==c[h].value,l.hasValue&&(l.value=c[h].value),void 0!==H){var q=H.compile(this.tmpl),r=q.render(l);e.list.append(a.sanitizeHTML(r))}else{var s=a('<li role="listitem"></li>');s.attr("id",l.listItemId),s.attr("data-index",l.index),s.attr("data-value",l.value),s.append('<a href="#" tabindex="-1"><span>'+l.label+"</span></a>"),e.list.append(a.sanitizeHTML(s))}}}var t={menuId:"autocomplete-list",ariaListbox:!0,mouseFocus:!1,trigger:"immediate",attachToBody:!0,autoFocus:!1,placementOpts:{callback:d,parent:this.element}};this.element.addClass("is-open").popupmenu(t).on("close.autocomplete",function(){e.closeList(!0)}),e.settings.autoSelectFirstItem&&e.list.children().filter(":not(.separator):not(.hidden):not(.heading):not(.group):not(.is-disabled)").first().addClass("is-selected"),this.noSelect=!0,this.element.trigger("populated",[f]).focus(),e.list.off("click touchend").on("touchend.autocomplete click.autocomplete","a",function(a){e.select(a,c)}).off("focusout.autocomplete").on("focusout.autocomplete",function(){e.checkActiveElement()});var u=e.list.find("a").on("focus.autocomplete touchend.autocomplete",function(){e.highlight(a(this),u)});if(this.settings.offset){var v=this.list.parent()[0];this.settings.offset.left&&(v.style.left=parseInt(v.style.left,10)+this.settings.offset.left+"px"),this.settings.offset.top&&(v.style.top=parseInt(v.style.top,10)+this.settings.offset.top+"px")}e.list.parent(".popupmenu-wrapper").append('<span id="ac-is-arialive" aria-live="polite" class="audible">'+a.trim(this.list.find(">li:first-child").text())+"</span>"),this.noSelect=!0,this.element.trigger("listopen",[c])}},closeList:function(b){var c=this.element.data("popupmenu");c&&(b||c.close(),this.element.trigger("listclose"),a("#autocomplete-list").parent(".popupmenu-wrapper").remove(),a("#autocomplete-list").remove(),this.element.removeClass("is-open"))},listIsOpen:function(){return this.list instanceof a&&this.list.length&&this.list.is(":visible")},handleAutocompleteKeydown:function(a){function b(a){a.removeClass("is-selected is-focused")}function c(a){a.addClass("is-selected").find("a").focus()}var d=this;if(this.isLoading())return a.preventDefault(),!1;if(this.listIsOpen()){var e=this.list.find("li:not(.separator):not(.hidden):not(.heading):not(.group):not(.is-disabled)"),f=function(a){return a.filter(".is-selected")}(e);40===a.keyCode&&this.listIsOpen()&&f.length&&(d.noSelect=!0,b(f),c(e.eq(e.index(f)+1)),a.preventDefault(),a.stopPropagation()),38===a.keyCode&&this.listIsOpen()&&f.length&&(d.noSelect=!0,b(f),c(e.eq(e.index(f)-1)),a.preventDefault(),a.stopPropagation()),9!==a.keyCode&&13!==a.keyCode||!this.listIsOpen()||(f.length?(a.stopPropagation(),a.preventDefault(),d.noSelect=!0,d.select(f,this.currentDataSet)):d.closeList()),8===a.keyCode&&this.listIsOpen()&&d.element.trigger("input")}},handleAutocompleteInput:function(a){var b=this;if(b.isLoading())return a.preventDefault(),!1;this.getDataFromSource().done(function(a,c){b.currentDataSet=c,b.openList(a,c)})},checkActiveElement:function(){var b=this;setTimeout(function(){var c=document.activeElement;b.listIsOpen()&&a.contains(b.list[0],c)||b.element.is(c)||b.element.trigger("safe-blur")},0)},getDataFromSource:function(){function b(a,b,d){return c.element.triggerHandler("complete"),c.element.trigger("requestend",[a,b]),!1===d?f.reject(a):f.resolve(a,b)}var c=this;if(c.isLoading())return!1;var d,e=this.element,f=a.Deferred();return clearTimeout(this.loadingTimeout),this.loadingTimeout=setTimeout(function(){if(!c.isLoading()){if(""===(d=e.val()))return void(c.element.data("popupmenu")&&c.element.data("popupmenu").close());d=d;var g=typeof c.settings.source;if(c.element.triggerHandler("start"),c.element.trigger("requeststart",[d]),"function"===g)c.settings.source(d,b,c.settings.sourceArguments);else if("object"===g){var h=a.isArray(c.settings.source)?c.settings.source:[c.settings.source];b(d,h,!0)}else{if(!c.settings.source)return void f.reject(d);var i=c.settings.source.toString(),j=a.getJSON(i+d);j.done(function(a){b(d,a,!0)}).fail(function(){b(d,[],!1)})}}},c.settings.delay),f},handleAutocompleteFocus:function(){var a=this;if(this.noSelect)return void(this.noSelect=!1);setTimeout(function(){a.element.select()},10)},highlight:function(a,b){var c=a.text().trim();a.find(".display-value").length>0&&(c=a.find(".display-value").text().trim()),b&&b.length&&b.parent("li").removeClass("is-selected"),a.parent("li").addClass("is-selected"),this.noSelect=!0,this.element.val(c).focus()},select:function(b,c){var d,e,f,g,h,i=!1;if(b instanceof a.Event?(i=!0,d=a(b.currentTarget)):d=b,d.is("li")&&(e=d,d=d.children("a")),e=d.parent("li"),f=d.text().trim(),g=e.attr("data-index"),h=e.attr("data-value"),this.element.attr("aria-activedescendant",e.attr("id")),c&&c.length)if(g)f=c[parseInt(g,10)];else if(h)for(var j=0;j<c.length;j++)c[j].value.toString()===h&&(f=c[j]);return this.closeList(),this.highlight(d),this.noSelect=!0,this.element.trigger("selected",[d,f]).focus(),i&&b.preventDefault(),!1},updated:function(){return this.teardown().init(),this},enable:function(){this.element.prop("disabled",!1)},disable:function(){this.element.prop("disabled",!0)},teardown:function(){var a=this.element.data("popupmenu");return a&&a.destroy(),this.element.off("keypress.autocomplete focus.autocomplete requestend.autocomplete updated.autocomplete"),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)},handleEvents:function(){var a=this;this.element.off("updated.autocomplete").on("updated.autocomplete",function(){a.updated()}).off("keydown.autocomplete").on("keydown.autocomplete",function(b){a.handleAutocompleteKeydown(b)}).off("input.autocomplete").on("input.autocomplete",function(b){a.handleAutocompleteInput(b)}).off("focus.autocomplete").on("focus.autocomplete",function(){a.handleAutocompleteFocus()}).off("focusout.autocomplete").on("focusout.autocomplete",function(){a.checkActiveElement()})}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.busyindicator=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="busyindicator",e={blockUI:!0,text:null,displayDelay:1e3,timeToComplete:0,transparentOverlay:!1,overlayOnly:!1},f=a.extend({},e,b);return c.prototype={init:function(){this.inlineLabel=this.element.closest("label"),this.inlineLabelText=this.inlineLabel.find(".label-text"),this.isInlineLabel=this.element.parent().is(".inline"),this.setup().handleEvents()},setup:function(){var a=this.element.attr("data-block-ui"),b=this.element.attr("data-display-delay"),c=this.element.attr("data-completion-time");return this.blockUI=void 0!==a?a:this.settings.blockUI,this.settings.overlayOnly||(this.loadingText=this.settings.text?this.settings.text:Locale.translate("Loading")),this.delay=void 0!==b&&!isNaN(b)&&parseInt(b,10)>20?b:!isNaN(this.settings.displayDelay)&&this.settings.displayDelay>=20?this.settings.displayDelay:20,this.completionTime=void 0===c||isNaN(c)?this.settings.timeToComplete:parseInt(c,10),this},activate:function(){var b=this;if(this.container)return b.closeTimeout&&clearTimeout(b.closeTimeout),this.label.remove(),this.settings.overlayOnly||(this.label=a("<span>"+this.loadingText+"</span>").appendTo(this.container),this.element.is("input, .dropdown, .multiselect, .busy-xs, .busy-sm")&&this.label.addClass("audible")),void this.container.removeClass("is-hidden").trigger("afterstart");this.container=a('<div class="busy-indicator-container is-hidden"></div>').attr({"aria-live":"polite",role:"status"}),this.loader=a('<div class="busy-indicator active"></div>').appendTo(this.container),this.settings.overlayOnly||(a('<div class="bar one"></div><div class="bar two"></div><div class="bar three"></div><div class="bar four"></div><div class="bar five"></div>').appendTo(this.loader),this.label=a("<span>"+this.loadingText+"</span>").appendTo(this.container));var c="";if(this.blockUI&&(this.settings.transparentOverlay&&(c=" transparent"),this.originalPositionProp=this.element[0].style.position,this.element[0].style.position="relative",this.overlay=a('<div class="overlay busy is-hidden'+c+'"></div>').appendTo(this.element),this.container.addClass("blocked-ui")),this.label&&this.element.is(".busy-xs, .busy-sm")&&this.label.addClass("audible"),this.element.is("input, .dropdown, .multiselect")){this.element.addClass("is-loading"),this.blockUI&&this.element.addClass("is-blocked"),this.label&&this.label.addClass("audible");var d;if(this.element.is("input"))d=this.element,this.container.insertAfter(this.isInlineLabel?this.inlineLabel:this.element);else{d=this.element.data("dropdown").pseudoElem,this.container.appendTo(d.parent())}this.overlay&&this.overlay.insertAfter(this.container);for(var e=d.position(),f=d.outerHeight(),g=d.outerWidth(),h=this.container.add(this.overlay),i=function(a,b,c){a.style[b]=c+"px"},j=0,k=h.length;j<k;j++)i(h[j],"left",e.left),i(h[j],"top",e.top),i(h[j],"bottom",e.bottom),i(h[j],"right",e.right),i(h[j],"height",f),i(h[j],"width",g)}else this.container.appendTo(this.element);setTimeout(function(){b.container&&b.container.removeClass("is-hidden"),b.overlay&&b.overlay.removeClass("is-hidden")},b.delay),this.element.trigger("afterstart"),a.fn.cssPropSupport("animation")||(b.isAnimating=!0,b.animateWithJS()),this.completionTime>0&&setTimeout(function(){b.element.trigger("complete")},b.completionTime)},close:function(a){var b=this;a&&(this.element.removeClass("is-loading"),this.element.removeClass("is-blocked")),this.container&&this.container.addClass("is-hidden"),this.overlay&&this.overlay.addClass("is-hidden"),b.closeTimeout=setTimeout(function(){clearTimeout(b.closeTimeout),b.container&&b.container.remove(),b.container=void 0,b.loader=void 0,b.label=void 0,b.overlay&&(b.overlay.remove(),b.element[0].style.position=b.originalPositionProp,b.originalPositionProp=void 0),b.overlay=void 0,b.element.trigger("aftercomplete.busyindicator"),b.element.off("complete.busyindicator")},600)},animateWithJS:function(){function a(){if(!c.isAnimating)return void clearInterval(b);i+=1,1===i&&d.addClass("half"),13===i&&(d.removeClass("half").addClass("full"),e.addClass("half")),26===i&&(d.removeClass("full").addClass("half"),e.removeClass("half").addClass("full"),f.addClass("half")),39===i&&(d.removeClass("half"),e.removeClass("full").addClass("half"),f.removeClass("half").addClass("full"),g.addClass("half")),51===i&&(e.removeClass("half"),f.removeClass("full").addClass("half"),g.removeClass("half").addClass("full"),h.addClass("half")),64===i&&(f.removeClass("half"),g.removeClass("full").addClass("half"),h.removeClass("half").addClass("full")),77===i&&(g.removeClass("half"),h.removeClass("full").addClass("half")),90===i&&h.removeClass("half"),103===i&&(i=0)}var b,c=this,d=this.container.find(".bar.one"),e=this.container.find(".bar.two"),f=this.container.find(".bar.three"),g=this.container.find(".bar.four"),h=this.container.find(".bar.five"),i=0;setInterval(a,10)},updated:function(){return this.setup()},destroy:function(){this.element.off("start.busyindicator complete.busyindicator afterstart.busyindicator aftercomplete.busyindicator updated.busyindicator"),a.removeData(this.element[0],d)},handleEvents:function(){var a=this;return a.element.on("start.busyindicator",function(b){b.stopPropagation(),a.activate()}).on("afterstart.busyindicator",function(){a.element.on("complete.busyindicator",function(b){b.stopPropagation(),a.close(!0)})}).on("updated.busyindicator",function(){a.close(!0),a.updated()}),this}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.button=function(b){"use strict";function c(b){this.element=a(b),this.settings=a.extend({},f),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="button",e={toggleOnIcon:null,toggleOffIcon:null},f=a.extend({},e,b);return c.prototype={init:function(){var b=this;if(this.isTouch=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.isSafari=a("html").is(".is-safari"),this.isFirefox=a("html").is(".is-firefox"),!this.element.hasClass("no-ripple")){if(this.element.hasClass("btn-menu")&&!this.element.hasClass("btn-icon")&&!this.element.hasClass("btn-actions")){var c=this.element.children("svg.icon"),d=c.find("use"),e=!1;c.length>0&&1===d.length&&(e=d.attr("xlink:href").indexOf("#icon-dropdown")>-1),e||(c=a.createIconElement({icon:"dropdown",classes:["icon-dropdown"]}),this.element.append(c)),c.hasClass("icon-dropdown")||c.addClass("icon-dropdown")}(this.element.hasClass("btn-toggle")||this.element.hasClass("icon-favorite"))&&(this.element.on("click.favorite",function(){var c=a(this),d=c.find("svg:not(.ripple-effect)"),e="true"===c.attr("aria-pressed");c.attr("aria-pressed",e?"false":"true"),b.settings.toggleOffIcon&&b.settings.toggleOnIcon?d.changeIcon(e?b.settings.toggleOffIcon:b.settings.toggleOnIcon):c.toggleClass("is-pressed"),c.hasClass("icon-favorite")&&!c.hasClass("btn-toggle")&&"#icon-star-filled"===d.find("use").attr("xlink:href")?d.changeIcon("star-outlined"):c.hasClass("icon-favorite")&&!c.hasClass("btn-toggle")&&d.changeIcon("star-filled")}),this.element.attr("aria-pressed")||this.element.attr("aria-pressed","false")),this.element.parent().is(".field")||!this.element.hasClass("btn-actions")||this.element.data("tooltip")||this.element.attr("title",Locale.translate("More")).tooltip({content:Locale.translate("More")}),this.element.hideFocus(),this.element.on("touchstart.button click.button",function(c){if(!(b.element.attr("disabled")||b.element.is(".is-disabled")||!b.isTouch&&1!==c.which||a(".ripple-effect",this).length||b.isTouch&&"touchstart"!==c.type)){var d=a(this),e=d.offset(),f=c.pageX-e.left,g=c.pageY-e.top,h=a('<svg class="ripple-effect" focusable="false" aria-hidden="true" role="presentation"><circle r="0" class="ripple-circle"></circle></svg>');if(b.isTouch&&(c=c.originalEvent)&&c.touches&&1===c.touches.length&&(f=c.touches[0].pageX-e.left,g=c.touches[0].pageY-e.top),f=f<0?b.element.outerWidth()/2:f,g=g<0?b.element.outerHeight()/2:g,a("svg.ripple-effect",d).remove(),h[0].style.left=f+"px",h[0].style.top=g+"px",d.prepend(h),!a.fn.cssPropSupport("animation")||b.isSafari||b.isFirefox)h.removeClass("is-animation"),b.animateWithJS(h);else{var i=a("svg.ripple-effect",d);i.attr("class",i.attr("class")+" is-animation")}setTimeout(function(){h.remove()},1e3)}})}},animateWithJS:function(a){var b=a[0].style,c=parseFloat(b.left)-100+"px",d=parseFloat(b.top)-100+"px";a[0].style.opacity="0.4",a.animate({opacity:0,left:c,top:d,width:200,height:200},1e3)},destroy:function(){this.element.off("click.button touchstart.button focusin.hide-focus focusout.hide-focus mousedown.hide-focus touchstart.hide-focus");var b=this.element.data("tooltip");this.element.hasClass("btn-actions")&&b&&b.destroy(),a.removeData(this.element[0],d)},handleEvents:function(){}},this.each(function(){var b=a.data(this,d);b||(b=a.data(this,d,new c(this)))})},window.Chart=function(b){"use strict";var c=this;if("undefined"==typeof d3)return a(b).append('<p class="chart-message"></p>'),null;var d=["#1D5F8A","#8ED1C6","#9279A6","#5C5C5C","#F2BC41","#66A140","#AD4242","#8DC9E6","#EFA836","#317C73","#EB9D9D","#999999","#488421","#C7B4DB","#54A1D3","#6e5282","#AFDC91","#69ADA3","#DB7726","#D8D8D8"];this.isTouch=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.pieColors=d3.scale.ordinal().range(d),this.colorRange=d,this.greyColors=d3.scale.ordinal().range(["#737373","#999999","#bdbdbd","#d8d8d8"]),this.sparklineColors=d3.scale.ordinal().range(["#1D5F8A","#999999","#bdbdbd","#d8d8d8"]),this.colors=d3.scale.ordinal().range(d),this.chartColor=function(a,b,c){var d=c&&c.color?c.color:null;if(d){if("error"===d)return"#e84f4f";if("alert"===d)return"#ff9426";if("alertYellow"===d)return"#ffd726";if("good"===d)return"#80ce4d";if("neutral"===d)return"#bdbdbd";if(d&&0===d.indexOf("#"))return c.color}return"pie"===b||"donut"===b?this.colorRange[a]:"bar-single"===b||"column-single"===b?"#1D5F8A":"bar"===b||"line"===b?this.colors(a):void 0},this.selectElem=function(b,d){var e,f=a(b).index(),g=d[f],h=c.settings;if("Pie"===h.chartType)e=d3.select(h.svg.selectAll(".arc")[0][f]);else if("column-positive-negative"===h.type){if(!g.option||g.option&&"target"===g.option)return;e=h.svg.select(".bar."+g.option)}else if(-1!==["Column","HorizontalBar"].indexOf(h.chartType))if(h.isGrouped||h.isSingular)e=h.svg.select(".series-"+f);else if(h.isStacked&&!h.isSingular){var i=d3.select(h.svg.selectAll("HorizontalBar"===h.chartType?".series-group":".g")[0][f]);e=i.select(".bar")}-1!==["Pie","Column","HorizontalBar"].indexOf(h.chartType)&&(h.isByLegends=!0,e.on("click").call(e.node(),e.datum(),f)),g.selectionObj&&c.selectElement(d3.select(g.selectionObj[0][f]),g.selectionInverse,g.data)},this.addLegend=function(d,e){var f,g=c.settings;if(0!==d.length){var h,i,j=d[0].display&&"twocolumn"===d[0].display,k=a(j?'<div class="chart-legend" style="margin: 2em auto auto; border-top: 1px solid #ccc;  padding-bottom: 1em; padding-top: 1em;"></div>':'<div class="chart-legend"></div>'),l=0;for(f=0;f<d.length;f++)h=6*d[f].name.length,l=d[f].name&&h>l?h:l;for(l+=55,i=l/a(b).width()*100,f=0;f<d.length;f++)if(d[f].name){var m="";(j||d[f].display&&"block"===d[f].display)&&(m+=" lg"),"column-positive-negative"===g.type&&d[f].option&&(m+=" "+d[f].option);var n='<span class="chart-legend-item'+m+'" tabindex="0"></span>',o=c.chartColor(f,e||(1===d.length?"bar-single":"bar"),d[f]),p=a('<span class="chart-legend-color" style="background-color: '+(d[f].pattern?"transparent":o)+'"></span>'),q=a('<span class="chart-legend-item-text">'+d[f].name+"</span>");if(d[f].pattern&&p.append('<svg width="12" height="12"><rect style="fill: '+o+'" mask="url(#'+d[f].pattern+')" height="12" width="12" /></svg>'),d[f].percent){var r=a('<span class="chart-legend-percent"></span>').text(d[f].percent);q.append(r)}d[f].display&&"block"===d[f].display&&(n='<span class="chart-legend-item'+m+'" tabindex="0" style="float: none; display: block; margin: 0 auto; width: '+l+'px;"></span>'),j&&(n=i>45?'<span class="chart-legend-item'+m+'" tabindex="0" style="float: none; display: block; margin: 0 auto; width: '+l+'px;"></span>':'<span class="chart-legend-item'+m+'" tabindex="0" style="float: none; display: inline-block; width: 45%;"></span>'),n=a(n),n.append(p,q),k.append(n)}k instanceof a&&(k.on("click.chart",".chart-legend-item",function(){c.selectElem(this,d)}).on("keypress.chart",".chart-legend-item",function(a){13!==a.which&&32!==a.which||c.selectElem(this,d)}),a(b).append(k))}},this.renderLegend=function(){if(c.legendformatter&&"function"==typeof c.legendformatter)var d="",e=!0,f=setInterval(function(){e&&(e=!1,c.legendformatter(function(a){d=a})),""!==d&&(clearInterval(f),a(b).append(d))},10)},this.appendTooltip=function(){this.tooltip=a("#svg-tooltip"),0===this.tooltip.length&&(this.tooltip=a('<div id="svg-tooltip" class="tooltip right is-hidden"><div class="arrow"></div><div class="tooltip-content"><p><b>32</b> Element</p></div></div>').appendTo("body"),this.isTouch&&(this.tooltip[0].style.pointerEvents="auto",this.tooltip.on("touchend.svgtooltip",function(){c.hideTooltip()})))},this.triggerContextMenu=function(c,d){d3.event.preventDefault(),d3.event.stopPropagation(),d3.event.stopImmediatePropagation();var e=a.Event("contextmenu");e.target=c,e.pageX=d3.event.pageX,e.pageY=d3.event.pageY,a(b).trigger(e,[c,d])},this.showTooltip=function(a,b,c,d){a<0&&(a=2),this.tooltip[0].style.left=a+"px",this.tooltip[0].style.top=b+"px",this.tooltip.find(".tooltip-content").html(c),this.tooltip.removeClass("bottom top left right").addClass(d),this.tooltip.removeClass("is-hidden")},this.getTooltipSize=function(a){return this.tooltip.find(".tooltip-content").html(a),{height:this.tooltip.outerHeight(),width:this.tooltip.outerWidth()}},this.hideTooltip=function(){d3.select("#svg-tooltip").classed("is-hidden",!0).style("left","-999px")},this.formatCurrency=function(a){var b=Locale.currentLocale.data?Locale.currentLocale.data.currencySign:"$";return a=isNaN(1*a)?0:a,b+(1*a).toFixed(2)},this.HorizontalBar=function(d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E={formatterString:null},F=a.extend(!0,E,c.options),G=!!F.formatterString,H=function(a){return G?d3.format(F.formatterString)(a):a},I=[],J=c.options.tooltip,K=30;f=void 0===f||f;var L=a(b).parent().width()<450,M={top:f?30:20,left:30,right:30,bottom:30};g=d,a(b).addClass("chart-vertical-bar"),parseInt(a(b).parent().width()),i=parseInt(a(b).parent().height())-M.top-M.bottom-40,j=g.map(function(a){return{name:a.name,color:a.color,pattern:a.pattern}}),g=g.map(function(b){return b.data.map(function(b){return a.extend({},b,{y:b.value,x:b.name,color:b.color,pattern:b.pattern})})}),l=d3.layout.stack(),l(g),h=0,g=g.map(function(b,c){return f||j[c]&&(h=j[c].name.length>h?j[c].name.length:h),b.map(function(b){return f&&(h=b.x.length>h?b.x.length:h),a.extend({},b,{x:b.y,y:b.x,x0:b.y0,color:b.color,pattern:b.pattern})})});var N=parseInt(a(b).parent().height())-M.bottom-(f?0:20),O=parseInt(a(b).parent().width())-M.left,P=M.left+6*h;if(k=d3.select(b).append("svg").attr("width",O).attr("height",N).append("g").attr("class","group").attr("transform","translate("+P+","+M.top+")"),m=d3.min(g,function(a){return d3.min(a,function(a){return f?a.x+a.x0:a.x})}),n=d3.max(g,function(a){return d3.max(a,function(a){return f?a.x+a.x0:a.x})}),f&&e){var Q=[];g.forEach(function(a){a.forEach(function(a,b){Q[b]=(void 0===Q[b]?0:Q[b])+a.x})}),g.forEach(function(a){a.forEach(function(a,b){var c=Q[b]/100;a.x=a.x/c,a.x0=a.x0/c})}),n=100}var R=O-P-M.left;if(o=F.useLogScale?d3.scale.log().domain([m>0?m:1,n]).nice().range([1,R]).nice():d3.scale.linear().domain([m<0?m:0,n]).nice().range([0,R]).nice(),f?(r=g[0].map(function(a){return a.y}),C=.32):(r=j.map(function(a){return a.name}),function(){var b,c,d;for(b=g.length-1,c=-1;b>c;b--)d=g[b].map(function(a){return a}),a.extend(!0,w,d),w=a.map(w,function(a){return a})}(),x=0,y=w.length,z=i/r.length,C=z/y,A=y>1?z-.5*C:K,B=z-A,K=A/y,C=0),p=d3.scale.ordinal().domain(r).rangeRoundBands([0,i],C,C),s=d3.svg.axis().scale(o).tickSize(-i).orient("middle"),L&&s.ticks(P<100?5:3),f&&e&&s.tickFormat(function(a){return a+"%"}),F.useLogScale&&(s.ticks(10,",.1s"),!1===F.showLines&&s.tickSize(0)),F.ticks&&s.ticks(F.ticks.number,F.ticks.format),q=d3.svg.axis().scale(p).tickSize(0).orient("left"),k.append("g").attr("class","axis x").attr("transform","translate(0,"+i+")").call(s),k.append("g").attr("class","axis y").call(q),t=k.selectAll("g.group").data(g).enter().append("g").attr("class","series-group").attr("data-group-id",function(a,b){return b}),u=k.selectAll(".series-group")[0].length>1&&!f,v=1===k.selectAll(".series-group")[0].length&&f,a.extend(c.settings,{svg:k,chartType:"HorizontalBar",isSingle:v,isGrouped:u,isStacked:f}),t.selectAll("rect").data(function(a,b){return a.forEach(function(a){a.index=b,f||(a.gindex=x++)}),a}).enter().append("rect").attr("class",function(a,b){return"bar series-"+b}).style("fill",function(a,b){return f?1===j.length?c.chartColor(b,"bar-single",a):c.chartColor(a.index,"bar",j[a.index]):c.chartColor(b,"bar",w[b])}).attr("mask",function(a,b){return 1===g.length&&g[0][b].pattern?"url(#"+g[0][b].pattern+")":f&&j[a.index].pattern?"url(#"+j[a.index].pattern+")":!f&&w[b].pattern?"url(#"+w[b].pattern+")":void 0}).attr("x",function(a){return F.useLogScale?0:o(f&&!v?a.x0:0)}).attr("y",function(a){return f?p(a.y):(z-A)/2+a.gindex*K+a.index*B}).attr("height",function(){return f?p.rangeBand():K}).attr("width",0).on("mouseenter",function(b,d){var e,h,i,k=0,l=[],m="",n=d3.select(this.parentNode).datum(),o=Math.round(n.length/2),p=d3.select(this),q=function(a,b){return a&&b?'<svg width="12" height="12"><rect style="fill: '+b+'" mask="url(#'+a+')" height="12" width="12" /></svg>':""},r=function(a,b,d){var e=c.getTooltipSize(m),f=a+parseFloat(p.attr("width"))/2-e.width/2,g=d?b:b-e.height-13;""!==m&&c.showTooltip(f,g,m,d?"bottom":"top")};if(1===g.length)m="<p><b>"+b.y+" </b>"+b.x+"</p>";else{if(m='<div class="chart-swatch">',f)for(e=0,h=g.length;e<h;e++){k=0,i=c.chartColor(e,"bar",j[e]);for(var s=0,t=g.length;s<t;s++)k+=g[s][d].x,l[s]=g[s][d].x;m+='<div class="swatch-row"><div style="background-color:'+(j[e].pattern?"transparent":i)+';">'+q(j[e].pattern,i)+"</div><span>"+j[e].name+"</span><b> "+(G?H(l[e]):Math.round(l[e]/k*100)+"%")+" </b></div>"}else for(o>1&&(p=d3.select(this.parentNode).select(".series-"+o)),e=0,h=n.length;e<h;e++)i=c.chartColor(e,"bar",w[e]),m+='<div class="swatch-row"><div style="background-color:'+(w[e].pattern?"transparent":i)+';">'+q(w[e].pattern,i)+"</div><span>"+n[e].name+"</span><b>"+H(n[e].value)+"</b></div>";m+="</div>"}k>0&&(m='<span class="chart-tooltip-total"><b>'+k+"</b> "+Locale.translate("Total")+"</span>"+m);var u=p[0][0].getBoundingClientRect().top+a(window).scrollTop(),v=p[0][0].getBoundingClientRect().left+a(window).scrollLeft(),x=!f&&n.length>6;if(J&&"function"==typeof J&&!I[d]){m="";var y=!0;D=setInterval(function(){y&&(y=!1,J(function(a){m=I[d]=a})),""!==m&&(clearInterval(D),r(v,u,x))},10)}else m=I[d]||J||b.tooltip||m||"",r(v,u,x)}).on("mouseleave",function(){clearInterval(D),c.hideTooltip()}).on("click",function(d,e){var f=this&&d3.select(this).classed("is-selected"),g=parseInt(d3.select(this.parentNode).attr("data-group-id"),10);c.setSelectedElement({task:f?"unselected":"selected",container:b,selector:this,isTrigger:!f,triggerGroup:u,d:d,i:e}),
f&&a(b).triggerHandler("selected",[d3.select(this)[0],{},u?g:e])}),k.selectAll(".axis.y text").attr({x:c.isRTL?15:-15}),k.selectAll(".axis.x text").attr("class",function(a){return a<0?"negative-value":"positive-value"}),c.isRTL&&c.isIE&&(k.selectAll("text").attr("transform","scale(-1, 1)"),k.selectAll(".y.axis text").style("text-anchor","start")),L&&F.useLogScale){var S=d3.selectAll(".x .tick text"),T=!1;S.attr("class",function(a,b){var c=Math.round(S.size()/2);b>=c&&!T&&a.toString().startsWith("1")&&(T=!0,c=a),0!==b&&b!==S.size()-1&&(F.useLogScale?a!==c:b!==c)&&d3.select(this).remove()})}return k.selectAll(".bar").transition().duration(1e3).attr("width",function(a){var b=o(a.x),c=o(0);return isNaN(b)&&(b=0),isNaN(c)&&(c=0),Math.abs(b-c)}).attr("x",function(a){return F.useLogScale?0:o(f&&!v?a.x0:a.x<0?a.x:0)}),c.showLegend&&c.addLegend(f?j:w),c.appendTooltip(),function(){var b,c,e,g=0,h=k.node().parentNode.nextSibling,i=d3.select(h),j=i.node()&&i.classed("chart-legend"),l=function(a){a=a?d3.select(a):k,a.selectAll(".bar").each(function(a,d){a&&a.selected&&g<1&&(g++,c=d3.select(this),b=d)})};u||f&&!v?(d.forEach(function(a,d){a.selected&&g<1&&(g++,c=k.select('[data-group-id="'+d+'"]').select(".bar"),b=d,f&&!u&&(e=!0))}),g<1&&function(){var a=k.selectAll(".series-group");a[0].length&&a.each(function(){l(this)})}()):l(),g>0&&(e?j&&a(i.selectAll(".chart-legend-item")[0][b]).trigger("click.chart"):c.on("click").call(c.node(),c.datum(),b))}(),a(b).trigger("rendered"),a(b)},this.Pie=function(d,e,f){var g={labels:{hideLabels:!0,isTwoline:!0,contentsTop:"percentage",contentsBottom:"name",formatterTop:null,formatterBottom:null,colorTop:"color-as-arc",colorBottom:"default",lineColor:"default",lineWidth:2,linehideWhenMoreThanPercentage:10}},h=a.extend(!0,g,f),i=h.labels;i.isTwoline||!f||f.labels.colorTop||(i.colorTop=i.colorBottom);var j,k=this,l=a(b).parent(),m=c.isRTL,n=[],o=c.options.tooltip;c.appendTooltip();var p=c.showLegend||!1,q=d[0].data;q=q.sort(function(a,b){return m?+b.value-+a.value:+a.value-+b.value});var r=d3.sum(q,function(a){return a.value});q=q.map(function(a){return{data:a,elm:a,name:a.name,color:a.color,value:a.value,percent:d3.round(a.value/r*100)}}),0===r&&q.push({data:{},color:"#BDBDBD",name:"Empty-Pie",value:100,percent:100});var s=d3.select(b).append("svg"),t=s.append("g").attr("class","arcs"),u=s.append("g").attr("class","lines"),v=d[0].centerLabel;a(b).addClass("chart-pie");var w=d3.layout.pie().value(function(a){return a.value}).sort(null),x={height:parseInt(l.height()),width:parseInt(l.width()),widgetheight:318},y=x.width<405;x.height=x.height>x.widgetheight?x.widgetheight:x.height,x.height=y&&!i.hideLabels?x.width:x.height;x.outerRadius=Math.min(x.width,x.height)/2-40,x.innerRadius=e?x.outerRadius-35:0,x.labelRadius=x.outerRadius+20,x.center={x:x.width/2+7,y:x.height/2},s.attr({width:"100%",height:y&&!i.hideLabels||x.height===x.widgetheight?x.height-50:"100%",viewBox:"0 0 "+x.width+" "+x.height}),t.attr("transform","translate("+x.center.x+","+x.center.y+")"),u.attr("transform","translate("+x.center.x+","+x.center.y+")");var z=w(q),A=d3.svg.arc().innerRadius(x.innerRadius).outerRadius(x.outerRadius),B=d3.svg.arc().innerRadius(x.outerRadius).outerRadius(x.outerRadius),C=d3.svg.arc().innerRadius(x.labelRadius).outerRadius(x.labelRadius);a.extend(c.settings,{svg:s,chartType:"Pie"}),t.selectAll(".arc").data(z).enter().append("path").attr("class","arc").on("contextmenu",function(a){k.triggerContextMenu(d3.select(this).select("path")[0][0],a)}).on("click",function(d,e){this&&d3.select(this).classed("is-selected")?(c.setSelectedElement({task:"unselected",container:b,selector:".chart-container .is-selected",isTrigger:!1,d:d.data,i:e}),a(b).triggerHandler("selected",[d3.select(this)[0],{},e])):c.setSelectedElement({task:"selected",container:b,selector:this,isTrigger:!0,d:d.data,i:e})}).on("mouseenter",function(a,b){var d,e,f,g,h,i,k=l.offset(),m="",p=function(){d=c.getTooltipSize(m),e-=d.width/2,f-=d.height/2,""!==m&&c.showTooltip(e,f,m,"top")},q=s.selectAll(".pie-circle");if(g=d3.transform(d3.select(q[0][b]).attr("transform")),h=g.translate[0]+(g.translate[0]>0?-10:10),i=g.translate[1]+(g.translate[1]>0?-10:10),i+=g.translate[0]>0&&g.translate[1]>0?-32:0,h+=g.translate[1]>0&&g.translate[0]<0?17:0,i+=g.translate[1]<0&&g.translate[0]<0?-17:0,i+=g.translate[0]<0&&g.translate[1]>0?-24:0,e=h+k.left+x.center.x,f=i+k.top+x.center.y,o&&"function"==typeof o&&!n[b]){var r=!0;j=setInterval(function(){r&&(r=!1,o(function(a){m=n[b]=a})),""!==m&&(clearInterval(j),p())},10)}else o="object"==typeof o?"":o,m=n[b]||o||a.data.tooltip||a.data.data.tooltip||"",m=m.replace("{{percent}}",a.data.percent+"%"),m=m.replace("{{value}}",a.value),m=m.replace("%percent%",a.data.percent+"%"),m=m.replace("%value%",a.value),p()}).on("mouseleave",function(){clearInterval(j),c.hideTooltip()}).style("fill",function(a,b){return c.chartColor(k.isRTL?q.length-b-1:b,"pie",a.data)}).transition().duration(!1===h.animate?0:350).attrTween("d",function(a){var b=d3.interpolate(a.startAngle+.1,a.endAngle);return function(c){return a.endAngle=b(c),A(a)}});var D,E=[],F=[],G=0,H=[],I=[],J=0,K=function(a,b){for(var c,d,e,f=a.length,g=0,h=0,i=[],j=a.length,k=[],l=function(a,b){return Math.abs(a-b)/a};f--;)h+=i[f]=Math.round(a[f]);for(c=h<b?1:-1;h!==b;){for(f=0;f<j;f++)d=f===j-1?0:f+1,e=l(a[d],i[d]+c),l(a[f],i[f]+c)>e&&(g=d);i[g]+=c,h+=c}for(f=0;f<j;f++)k[f]=i[f]&&Math.abs(a[f]-i[f])/a[f];for(f=0;f<j;f++)for(g=0;g<j;g++)if(g!==f){var m=l(a[f],i[f]+1)+l(a[g],i[g]-1),n=l(a[f],i[f]-1)+l(a[g],i[g]+1),o=k[f]+k[g];m<o&&(i[f]=i[f]+1,i[g]=i[g]-1,k[f]=i[f]&&Math.abs(a[f]-i[f])/a[f],k[g]=i[g]&&Math.abs(a[g]-i[g])/a[g]),n<o&&(i[f]=i[f]-1,i[g]=i[g]+1,k[f]=i[f]&&Math.abs(a[f]-i[f])/a[f],k[g]=i[g]&&Math.abs(a[g]-i[g])/a[g])}return i},L=function(){for(var a=[],b=0,c=q.length;b<c;b++){var d=q[b],e=0===r?0:d.value/r,f=d3.format("0.0%"),g=d3.format("0.3%"),h=f(e),i=g(e);I.push(+h.replace("%","")),a.push(+i.replace("%",""))}H=K(a,100),J=I.reduce(function(a,b){return a+b})},M=function(a,b,c,d,e){c=/percentage/i.test(b)?"0.0%":c;var f,g=d3.format(c||""),h=g(a.value/r),i=d?a.data.shortName||a.data.name.substring(0,9)+(a.data.name.length>9?"...":""):a.data.name,j=c&&"0.0%"!==c?g(a.value):a.value;switch(/percentage/i.test(b)&&100!==J&&(h=H[e]+"%"),b){case"name":f=i;break;case"value":f=j;break;case"percentage":f=h;break;case"name, value":f=i+", "+j;break;case"name (value)":f=i+" ("+j+")";break;case"name (percentage)":f=i+" ("+h+")";break;default:f=i+", "+j+" ("+h+")"}return f||""},N=function(a,b,d){return"color-as-arc"===d?c.chartColor(k.isRTL?q.length-b-1:b,"pie",a.data):"default"===d?"":d},O=function(a){s.selectAll(".lb-top").each(function(b,c){var d=+d3.select(this.parentNode).attr("x");(x.center.x+d-5*b.data.name.length<25||d>0&&x.center.x-(5*b.data.name.length+d)<25)&&(a=!0),d3.select(this).text(function(){return M(b,i.contentsTop,i.formatterTop,a,c)}).style({"font-weight":(i.isTwoline,"normal"),"font-size":i.isTwoline?x.width>450?"1.8em":"1.1em":"1em",fill:function(){var a=N(b,c,i.colorTop);return a="#bdbdbd"===a?"#868686":a}})}),i.isTwoline&&s.selectAll(".lb-bottom").each(function(b,c){var d=+d3.select(this.parentNode).attr("x");(x.center.x+d-5*b.data.name.length<25||d>0&&x.center.x-(5*b.data.name.length+d)<25)&&(a=!0),d3.select(this).text(function(){return M(b,i.contentsBottom,i.formatterBottom,a)}).style({"font-size":"1em",fill:function(){return N(b,c,i.colorBottom)}}),a=null})};if(function(){s.selectAll(".labels").remove();var a=s.append("g").attr("class","labels"),b=a.selectAll(".label").data(z).enter(),d=b.append("g").attr("class","label");if(a.attr("transform","translate("+x.center.x+","+x.center.y+")"),d.append("circle").style("fill","none").attr({class:"pie-circle",x:0,y:0,r:1,transform:function(a){return"translate("+B.centroid(a)[0]+","+B.centroid(a)[1]+")"}}),d.append("circle").style("fill","none").attr({class:"label-circle",x:0,y:0,r:1,transform:function(a){return"translate("+C.centroid(a)[0]+","+C.centroid(a)[1]+")"}}),D=d.append("text").attr({class:"label-text",x:function(a){var b=A.centroid(a),c=Math.atan2(b[1],b[0]),d=Math.cos(c)*x.labelRadius,e=d>0?1:-1,f=d+1*e;return G++,E.push(d),f},y:function(a){var b=A.centroid(a),c=Math.atan2(b[1],b[0]),d=Math.sin(c)*x.labelRadius;return F.push(d),d},"text-anchor":function(a){var b=A.centroid(a),d=Math.atan2(b[1],b[0]),e=Math.cos(d)*x.labelRadius;return m&&c.isIE?e>0?"start":"end":m?e>0?"end":"start":e>0?"start":"end"}}),D.append("tspan").attr("class","lb-top"),i.isTwoline&&D.append("tspan").attr({class:"lb-bottom",x:function(a,b){return E[b]},dy:"17"}),L(),i.hideLabels&&(O(),e&&(t.append("text").attr("dy",".35em").style("text-anchor","middle").attr("class","chart-donut-text").html(v),c.isIE)))if(c.isHTML(v)){var f=t.select(".chart-donut-text"),g=document.createElement("text");g.innerHTML=v;var h=Array.prototype.slice.call(g.childNodes);h.forEach(function(a){f.append("tspan").attr("style",a.getAttribute&&a.getAttribute("style")).attr("x",a.getAttribute&&a.getAttribute("x")).attr("dy",a.getAttribute&&a.getAttribute("dy")).text(a.textContent)})}else t.select(".chart-donut-text").text(v)}(),i.hideLabels){var P,Q=!0,R=15*G,S=35;P=D[0].map(function(a){return a=d3.select(a),{x:+a.attr("x"),y:+a.attr("y")}});var T=function(){var a=!1;R--,D.each(function(b,c){var d=this,e=d3.select(d),f=+e.attr("y");D.each(function(b,g){if(g>c){var h,i=this,j=d3.select(i),k=+j.attr("y");if(e.attr("text-anchor")===j.attr("text-anchor")&&d===D[0][g-1]&&(h=Math.round(Math.abs(f-k)))<S){h+=1;var l=k>0?k-h/2:k+h/2+1;a=!0,j.attr("y",l),Math.round(Math.abs(l))<2&&(a=!1,l=k>0?k-S:k+S/2,j.attr("y",l))}}})}),a&&R>0?T():Q=!1};T();var U=s.selectAll(".label-circle");S*=-1,D.each(function(a,b){var c,d=d3.select(this),e=+d.attr("x"),f=+d.attr("y"),g=e>0?1:-1;if(c=m?(x.labelRadius-Math.abs(f)+Math.abs(P[b].x-1.5*S))*g:(x.labelRadius-Math.abs(f)+Math.abs(P[b].x+1.5*S))*g,P[b].y!==f||0===b&&q[b].percent<10){c+=q[b].percent<=10?Math.ceil(e/2):Math.ceil(e-c)-S/2,d.attr("x",c),i.isTwoline&&d.select(".lb-bottom").attr("x",c);var h=d3.transform(d3.select(U[0][b]).attr("transform")),j=h.translate[0]+(h.translate[0]>0?10:-10);(c<j||Math.abs(c)>x.center.x)&&(d.attr("x",j),i.isTwoline&&d.select(".lb-bottom").attr("x",j))}});var V=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis"),W=s.selectAll(".label");s.selectAll(".label-text tspan").each(function(){"..."===d3.select(this).text().substring(5)&&(p=!0)}),W.each(function(a,b){var c=d3.select(this),d=c.select(".pie-circle"),e=c.select(".label-circle"),f=c.select(".label-text"),g=d3.transform(d.attr("transform")),h=d3.transform(e.attr("transform")),j=[{x:Number(g.translate[0]),y:Number(g.translate[1])},{x:Number(h.translate[0]),y:Number(h.translate[1])},{x:Number(f.attr("x")),y:Number(f.attr("y"))+(i.isTwoline?5:0)}];i.linehideWhenMoreThanPercentage>q[b].percent&&u.append("path").attr({class:"label-line",d:V(j)}).style({"stroke-width":i.lineWidth,stroke:function(){return N(a,b,i.lineColor)}})})}else p=!0;var X=q.map(function(a){var b=a.name+" ("+(isNaN(a.percent)?0:a.percent)+"%)";return"Empty-Pie"===a.name&&(b=""),{name:b,display:"twocolumn",color:a.color}});return(p||c.legendformatter)&&c[c.legendformatter?"renderLegend":"addLegend"](X,"donut"),function(){var a,b=0;t.selectAll(".arc").each(function(c,d){c&&c.data&&c.data.data&&c.data.data.selected&&b<1&&(b++,a=d3.select(this),a.on("click").call(a.node(),a.datum(),d))})}(),m&&i.isTwoline&&setTimeout(function(){s.selectAll(".label-text").each(function(){var a=d3.select(this),b=d3.select(a.node().parentNode),c=d3.select(b.node().appendChild(a.node().cloneNode(!0)));a.select(".lb-bottom").remove(),c.select(".lb-top").remove()})},100),a(b).trigger("rendered"),a(b)},this.elementTransform=function(a){a.element.attr("transform",function(){var b=a.sameAs||this,c=d3.transform(d3.select(b).attr("transform")),d=c.translate[0],e=c.translate[1];return d=a.addtoX?d>0?d+a.addtoX:d-a.addtoX:d,e=a.addtoY?e>0?e+a.addtoY:e-a.addtoY:e,"translate("+d+","+e+")"})},this.moveLabels=function(a){var b=a.textLabels[0];a.addtoX?(a.textLabels.attr("x",function(){var b=d3.select(this).attr("x");return b>0?b+a.addtoX:b-a.addtoX}),a.textLines.attr("x2",function(a,c){return d3.select(b[c]).attr("x")})):a.addtoY&&(a.textLabels.attr("y",function(){var b=Number(d3.select(this).attr("y"));return b>0?b+a.addtoY:b-a.addtoY}),a.textLines.attr("y2",function(a,c){return d3.select(b[c]).attr("y")}))},this.handleResize=function(){function c(){clearTimeout(d),d=setTimeout(function(){var c=a(b).data("chart"),d=a(b);if(e!==d.width()){if(e=d.width(),!d.is(":visible"))return!0;d.empty(),c.initChartType(c.settings)}},100)}var d=null,e=0;this.redrawOnResize&&(a(window).on("resize.charts",c),a(b).off("resize").on("resize",c))},this.Ring=function(a){return c.Pie(a,!0)},this.calculateAspectRatioFit=function(a){var b=Math.min(a.maxWidth/a.srcWidth,a.maxHeight/a.srcHeight);return{width:a.srcWidth*b,height:a.srcHeight*b}},this.Sparkline=function(d,e){var f,g,h,i=[],j=[],k=c.options.tooltip,l=0,m=0,n=0,o=this.calculateAspectRatioFit({srcWidth:385,srcHeight:65,maxWidth:a(b).width(),maxHeight:600}),p=o.width>300?4:3;for(h=0;h<d.length;h++)m=d3.min([d3.min(d[h].data),m]),l=d3.max([d3.max(d[h].data),l]),n=d3.max([d[h].data.length,n]);var q=o.width,r=o.height,s=d3.scale.linear().domain([0,n]).range([10,q-10]),t=d3.scale.linear().domain([m,l]).range([r-10,10]),u=d3.svg.line().x(function(a,b){return s(b)}).y(function(a){return t(a)});c.appendTooltip();var v=d3.select(b).append("svg").attr("height",r).attr("width",q);if(e.isMedianRange){l=d3.max(d[0].data),m=d3.min(d[0].data);var w=q-45,x=d3.median(d[0].data),y=l-m,z=d3.scale.linear().domain([m,l]).range([0,r]),A=r-z(x>y?x:y),B=r-z(x<y?x:y);v.append("g").attr("class","medianrange").attr("transform",function(){return"translate(10,"+A+")"}).append("rect").attr("width",w).attr("height",B).style("fill","#d8d8d8").on("mouseenter",function(a,b){var g=this.getBoundingClientRect(),h="<p>"+(d[0].name?d[0].name+"<br> ":"")+Locale.translate("Median")+": <b>"+x+"</b><br>"+Locale.translate("Range")+": <b>"+y+"</b>"+(e.isPeakDot?"<br>"+Locale.translate("Peak")+": <b>"+l+"</b>":"")+"</p>",j=function(){var a=c.getTooltipSize(h),b=g.left+(g.width-a.width)/2,d=g.top-a.height-5;""!==h&&c.showTooltip(b,d,h,"top")};if(k&&"function"==typeof k&&!i[b]){h="";var m=!0;f=setInterval(function(){m&&(m=!1,k(function(a){h=i[b]=a})),""!==h&&(clearInterval(f),j())},10)}else k="object"==typeof k?"":k,h=i[b]||k||d[0].tooltip||h||"",j()}).on("mouseleave",function(){clearInterval(f),c.hideTooltip()})}for(h=0;h<d.length;h++){var C=d[h];v.append("g").append("path").attr("d",u(C.data)).attr("stroke",e.isMinMax?"#999999":c.sparklineColors(h)).attr("class","team")}return m=d3.min(d[0].data),v.selectAll(".point").data(d[0].data).enter().append("circle").attr("r",function(a){return e.isMinMax&&l===a||e.isMinMax&&m===a?p+1:e.isDots||e.isPeakDot&&l===a?p:0}).attr("class",function(a){return e.isPeakDot&&l===a&&!e.isMinMax?"point peak":e.isMinMax&&l===a?"point max":e.isMinMax&&m===a?"point min":"point"}).style("fill",function(a){return e.isPeakDot&&l===a&&!e.isMinMax?"#ffffff":e.isMinMax&&l===a?"#56932E":e.isMinMax&&m===a?"#941E1E":c.sparklineColors(0)}).style("stroke",function(a){return e.isPeakDot&&l===a&&!e.isMinMax?c.sparklineColors(0):e.isMinMax&&l===a?"none":e.isMinMax&&m===a?"none":"#ffffff"}).style("cursor","pointer").attr("cx",function(a,b){return s(b)}).attr("cy",function(a){return t(a)}).on("mouseenter",function(a){var b=this.getBoundingClientRect(),f="<p>"+(d[0].name?d[0].name+"<br> "+(e.isMinMax&&l===a?Locale.translate("Highest")+": ":e.isMinMax&&m===a?Locale.translate("Lowest")+": ":e.isPeakDot&&l===a?Locale.translate("Peak")+": ":""):"")+"<b>"+a+"</b></p>",i=function(){var a=c.getTooltipSize(f),d=b.left-a.width/2+6,e=b.top-a.height-8;""!==f&&c.showTooltip(d,e,f,"top")};if(k&&"function"==typeof k&&!j[h]){f="";var n=!0;g=setInterval(function(){n&&(n=!1,k(function(a){f=j[h]=a})),""!==f&&(clearInterval(g),i())},10)}else k="object"==typeof k?"":k,f=j[h]||k||d[0].tooltip||f||"",i();d3.select(this).attr("r",e.isMinMax&&l===a||e.isMinMax&&m===a?p+2:p+1)}).on("mouseleave",function(a){clearInterval(g),c.hideTooltip(),d3.select(this).attr("r",e.isMinMax&&l===a||e.isMinMax&&m===a?p+1:p)}),a(b).trigger("rendered"),a(b)},this.Column=function(d,e){function f(a){var b;if(a=z&&a,A||z){if(b=Q.selectAll("rect"+(a?".target-bar":".bar")).data(e?g:V).enter().append("rect").attr("class",function(b,c){var d="bar series-"+c;return z&&(d=(a?"target-bar series-"+c:d)+(b.value>0?" positive":" negative")),d}).attr("width",Math.min.apply(null,[I.rangeBand()-2,Z])).attr("x",function(a){return e?K(0):I(a.name)+(I.rangeBand()-Z)/2}).attr("y",function(){return J(0)>D?D:J(0)}).attr("height",function(){return 0}).attr("mask",function(b){return z?a?o.target?"url(#"+o.target+")":null:b.value<0?o.negative?"url(#"+o.negative+")":null:o.positive?"url(#"+o.positive+")":null:null}).style("fill",function(b){return z?$(a?n.target:b.value<0?n.negative:n.positive):null}),z){Q.selectAll(a?".target-bartext":".bartext").data(V).enter().append("text").attr("class",function(b){return(a?"target-bartext":"bartext")+(b.value>0?" positive":" negative")}).attr("text-anchor","middle").attr("x",function(a){return(I(a.name)+I.rangeBand()/2)*(y?-1:1)}).attr("y",function(b){return a?J(b.target)-6:J(b.value>0?0:b.value)+12}).style("opacity",0).style("fill",function(b){return a?"":$(b.value<0?n.negative:n.positive)}).style("font-weight","bold").text(function(b){return u(a?b.target:b.value)})}b.transition().duration(1e3).call(_,function(){Q.selectAll(".target-bartext, .bartext").transition().duration(300).style("opacity",1)}).attr("y",function(b){var c=e?D-L(b[0].y)-L(b[0].y0):J(b.value<0?0:b.value);return a?J(b.target):b.value<0?c:c>D-3?D-2:c}).attr("height",function(b){var c;return c=e?L(b[0].y):b.value<0?D-J(0)-(D-J(b.value)):D-J(b.value)-(D-J(0)),c=b.value<0?c:c<3?2:c>D?D-J(b.value):c,a?D-J(b.target)-(D-J(0)):c})}else{b=Q.selectAll(".x-value").data(e?g:V).enter().append("g").attr("class","series-group g").attr("data-group-id",function(a,b){return b}).attr("transform",function(a){return"translate("+H(e?N[0]:a.name)+",0)"}).selectAll("rect").data(function(a){return e?a:a.values}).enter().append("rect").attr("class",function(a,b){return"series-"+b+" bar"}).attr("width",Math.min.apply(null,[I.rangeBand()-2,Z])).attr("x",function(a,b){var c=Math.min.apply(null,[I.rangeBand()-2,Z]);return e?K(b):I.rangeBand()/2+(c+2)*b-(1===V[0].values.length||5===V[0].values.length||4===V[0].values.length?c/2:0)}).attr("y",function(){return J(0)>D?D:J(0)}).attr("height",function(){return 0}),b.transition().duration(1e3).attr("y",function(a){var b=e?D-L(a.y)-L(a.y0):J(a.value<0?0:a.value);return a.value<0?b:b>D-3?D-2:b}).attr("height",function(a){var b;return b=e?L(a.y):a.value<0?D-J(0)-(D-J(a.value)):D-J(a.value)-(D-J(0)),a.value<0?b:b<3?2:b>D?D-J(a.value):b})}return b}var g,h,i,j,k,l,m,n,o,p,q,r={formatterString:null},s=a.extend(!0,r,c.options),t=!!s.formatterString,u=function(a){return t?d3.format(s.formatterString)(a):a},v=d,w=this,x=a(b).parent(),y=c.isRTL,z="column-positive-negative"===c.settings.type,A=1===v.length,B={top:40,right:40,bottom:A&&void 0===d[0].name?e?20:50:35,left:45},C=x.width()-B.left-B.right-10,D=x.height()-B.top-B.bottom-(A&&void 0===d[0].name?e||z?30:0:40);h=d3.min(v,function(a){return d3.min(a.data,function(a){return a.value})}),i=d3.max(v,function(a){return d3.max(a.data,function(a){return a.value})}),z&&(j=d3.min(v,function(a){return d3.min(a.data,function(a){return a.target})}),k=d3.max(v,function(a){return d3.max(a.data,function(a){return a.target})}),h=d3.min([h,j]),i=d3.max([i,k]),p={target:"Target",positive:"Positive",negative:"Negative"},n={target:"neutral",positive:"good",negative:"error"},o={},v[0]&&(v[0].colors&&a.extend(!0,n,v[0].colors),v[0].legends&&a.extend(!0,p,v[0].legends),v[0].patterns&&a.extend(!0,o,v[0].patterns)),q=[],a.each(p,function(a,b){q.push({name:b,color:n[a],pattern:o[a],option:a})})),a(b).addClass("column-chart");var E,F=[],G=c.options.tooltip,H=d3.scale.ordinal().rangeRoundBands([0,C],.1),I=d3.scale.ordinal(),J=d3.scale.linear().range([D,0]);if(e){g=A?v[0].data.map(function(b){return[a.extend({},b,{y:b.value,x:b.name,color:b.color,pattern:b.pattern,parentName:b.name,tooltip:b.tooltip})]}):v.map(function(b){return b.data.map(function(c){return a.extend({},c,{y:c.value,x:c.name,color:c.color,pattern:c.pattern,parentName:b.name,tooltip:b.tooltip})})});d3.layout.stack()(g);var K=d3.scale.ordinal().domain(d3.range(g[0].length)).rangeRoundBands([0,C],.05),L=d3.scale.linear().domain([0,d3.max(g,function(a){return d3.max(a,function(a){return a.y0+a.y})})]).range([0,D])}var M,N=v[0].data.map(function(a){return a.name}),O=d3.svg.axis().scale(H).tickSize(0).tickPadding(12).orient("bottom"),P=d3.svg.axis().scale(J).tickSize(-C).tickPadding(y?-12:12).tickFormat(d3.format(c.format||"s")).orient("left"),Q=d3.select(b).append("svg").attr("width",C+B.left+B.right).attr("height",D+B.top+B.bottom).append("g").attr("transform","translate("+B.left+","+B.top+")"),R=v.map(function(a){return a.name}),S=v.map(function(a){return d3.max(a.data,function(a){return z?a.target:a.value})});if(e&&(M=g.map(function(a){return d3.max(a,function(a){return a.y+a.y0})})),A&&(R=v[0].data.map(function(a){return a.name})),z&&(h+=h/J.ticks().length,S[0]+=S[0]/J.ticks().length),function(){if(e&&A)l=v[0].data;else{var b,c,d;for(b=v.length-1,c=-1;b>c;b--)d=v[b].data.map(function(a){return a}),a.extend(!0,l,d),l=a.map(l,function(a){return a})}}(),e&&!A&&(m=R.map(function(a,b){return v[b]})),H.domain(e?N:R),I.domain(N).rangeRoundBands([0,A||e?C:H.rangeBand()]),J.domain([h<0?h:c.settings.minValue||0,d3.max(e?M:S)]).nice(),(!A||A&&!e)&&Q.append("g").attr("class","x axis").attr("transform","translate(0,"+(D+(z?10:0))+")").call(O),Q.append("g").attr("class","y axis").call(P),y&&h<0){var T,U=0;Q.selectAll(".axis.y text").attr("class",function(a){return T=d3.select(this).text().length,U=T>U?T:U,a<0?"negative-value":"positive-value"}).attr("x",function(a){return a<0?9*U:5*U})}var V=[];d.forEach(function(b){V.push(a.extend({},b,{values:b.data}))}),A&&(V=[],R=v[0].data.forEach(function(a){V.push(a)}));var W,X,Y,Z=35,$=function(a){return c.chartColor(0,"",{color:a})},_=function(a,b){var c;a.empty()?b():(c=a.size(),a.each("end",function(){0===--c&&b()}))};z&&(X=f(!0)),W=f(),z&&(Y=d3.selectAll(".empty-bars"),c.mergeArrays(Y[0],X[0],W[0])),z||(e?e&&!A?W.style("fill",function(){var a=d3.select(this.parentNode).attr("data-group-id");return c.chartColor(a,"bar",v[a])}).attr("mask",function(){var a=d3.select(this.parentNode).attr("data-group-id");return v[a].pattern?"url(#"+v[a].pattern+")":null}):e&&A&&W.style("fill",function(a,b){return c.chartColor(b,"bar",a[0])}).attr("mask",function(a){return a[0].pattern?"url(#"+a[0].pattern+")":null}):W.style("fill",function(a,b){return A?c.chartColor(b,"column-single",d[0].data[b]):c.chartColor(b,"bar",l[b])}).attr("mask",function(a,b){return A?d[0].data[b].pattern?"url(#"+d[0].data[b].pattern+")":null:l[b].pattern?"url(#"+l[b].pattern+")":null}));var aa=A||!A&&e,ba=!aa;return a.extend(c.settings,{svg:Q,chartType:"Column",isSingle:aa,isGrouped:ba,isStacked:e,isSingular:A}),(z?Y:W).on("mouseenter",function(b,d){var f,h,i,j,k,m,q,r=this,s=a(this),t="",w=d3.event.pageY,x=function(a,b){return a&&b?'<svg width="12" height="12"><rect style="fill: '+b+'" mask="url(#'+a+')" height="12" width="12" /></svg>':""},y=function(a){m=c.getTooltipSize(t),f=s[0].getBoundingClientRect().left-m.width/2+s.attr("width")/2,e?h=s[0].getBoundingClientRect().top-m.height-10:(h=w-c.tooltip.outerHeight()-25,v.length>1&&(f=r.parentNode.getBoundingClientRect().left-m.width/2+r.parentNode.getBoundingClientRect().width/2,a?(h+=c.tooltip.outerHeight()+50)>r.parentNode.getBoundingClientRect().bottom+10&&(h=r.parentNode.getBoundingClientRect().bottom+10):h=r.parentNode.getBoundingClientRect().top-c.tooltip.outerHeight()+25)),""!==t&&c.showTooltip(f,h,t,a?"bottom":"top")};if(e){if(A)t="<p><b>"+u(b[0].value)+"</b> "+b[0].name+"</p>";else{for(t='<div class="chart-swatch"><div class="swatch-caption"><b>'+g[0][d].name+"</b></div>",i=g.length-1,j=0;i>=j;i--)k=c.chartColor(i,"bar",v[i]),t+='<div class="swatch-row"><div style="background-color:'+(v[i].pattern?"transparent":k)+';">'+x(v[i].pattern,k)+"</div><span>"+g[i][d].parentName+"</span><b>"+u(g[i][d].value)+"</b></div>";t+="</div>"}m=c.getTooltipSize(t),f=s[0].getBoundingClientRect().left-m.width/2+s.attr("width")/2,h=s[0].getBoundingClientRect().top-m.height-10}else{if(z)t='<div class="chart-swatch"><div class="swatch-caption"><b>'+b.name+'</b></div><div class="swatch-row"><div style="background-color:'+(o.target?"transparent":$(n.target))+';">'+x(o.target,$(n.target))+"</div><span>"+p.target+"</span><b>"+u(b.target)+'</b></div><div class="swatch-row"><div style="background-color:'+(b.value<0?o.negative?"transparent":$(n.negative):o.positive?"transparent":$(n.positive))+';">'+(b.value<0?x(o.negative,$(n.negative)):x(o.positive,$(n.positive)))+"</div><span>"+p[b.value<0?"negative":"positive"]+"</span><b>"+u(b.value)+"</b></div></div>";else if(1===v.length)t="<p><b>"+u(b.value)+"</b> "+b.name+"</p>";else{var B=d3.select(this.parentNode).datum().values;for(t='<div class="chart-swatch">',i=0,j=B.length;i<j;i++)k=c.chartColor(i,"bar",l[i]),t+='<div class="swatch-row"><div style="background-color:'+(l[i].pattern?"transparent":k)+';">'+x(l[i].pattern,k)+"</div><span>"+B[i].name+"</span><b>"+u(B[i].value)+"</b></div>";t+="</div>",q=B.length>6}m=c.getTooltipSize(t),f=s[0].getBoundingClientRect().left-m.width/2+s.attr("width")/2,h=w-c.tooltip.outerHeight()-25,v.length>1&&(f=this.parentNode.getBoundingClientRect().left-m.width/2+this.parentNode.getBoundingClientRect().width/2,h=this.parentNode.getBoundingClientRect().top-c.tooltip.outerHeight()+25)}if(G&&"function"==typeof G&&!F[d]){t="";var C=!0;E=setInterval(function(){C&&(C=!1,G(function(a){t=F[d]=a})),""!==t&&(clearInterval(E),y())},10)}else{if(t=F[d]||G||t||"",b.tooltip){var D=b.tooltip.replace("{{value}}",u(b.value));t="<p>"+D+"</p>"}y(q)}}).on("mouseleave",function(){clearInterval(E),c.hideTooltip()}).on("click",function(d,e){var f;if(this&&d3.select(this).classed("target-bar"))return f=Q.select(".bar.series-"+e),void f.on("click").call(f.node(),f.datum(),e);var g=this&&d3.select(this).classed("is-selected"),h=parseInt(d3.select(this.parentNode).attr("data-group-id"),10);c.setSelectedElement({task:g?"unselected":"selected",container:b,selector:this,isTrigger:!g,triggerGroup:ba,d:d,i:e}),g&&a(b).triggerHandler("selected",[d3.select(this)[0],{},ba?h:e])}).on("contextmenu",function(a){w.triggerContextMenu(d3.select(this)[0][0],a)}),A&&d[0].name?c.addLegend([{name:d[0].name}]):z?c.addLegend(q):e&&A?c.addLegend(l):A||c.addLegend(e?m:l),c.isRTL&&c.isIE&&(Q.selectAll("text").attr("transform","scale(-1, 1)"),Q.selectAll(".y.axis text").style("text-anchor","start"),z&&Q.selectAll(".negative-value").style("text-anchor","end")),c.appendTooltip(),c.labelsColide(Q)&&c.applyAltLabels(Q,V,"shortName"),c.labelsColide(Q)&&c.applyAltLabels(Q,V,"abbrName"),c.labelsColide(Q)&&(c.applyAltLabels(Q,V,null,null,!0),z&&Q.selectAll(".target-bartext, .bartext").attr("x",function(){return+d3.select(this).attr("x")-(y?-6:6)})),function(){var b,c,f,g=0,h=Q.node().parentNode.nextSibling,i=d3.select(h),j=i.node()&&i.classed("chart-legend"),k=function(a){a=a?d3.select(a):Q,a.selectAll(".bar").each(function(a,d){a&&(A&&e?a[0].selected:a.selected)&&g<1&&(g++,c=d3.select(this),b=d)})};ba||e&&!A&&!ba?(d.forEach(function(a,d){a.selected&&g<1&&(g++,c=Q.select('[data-group-id="'+d+'"]').select(".bar"),b=d,!e||A||ba||(f=!0))}),g<1&&function(){var a=Q.selectAll(".series-group");a[0].length&&a.each(function(){k(this)})}()):k(),g>0&&(f?j&&a(i.selectAll(".chart-legend-item")[0][b]).trigger("click.chart"):c.on("click").call(c.node(),c.datum(),b))}(),a(b).trigger("rendered"),a(b)},this.mergeArrays=function(){var a,b=arguments.length;if(b>1)for(a=1;a<b;a++)arguments[a].forEach(function(a){this.push(a)},arguments[0])},this.labelsColide=function(a){var b=a.selectAll(".x text"),c=!1;return b.each(function(a,d){var e,f=this.getBoundingClientRect();b.each(function(a,b){if(d!==b){e=this.getBoundingClientRect();!(f.right<e.left||f.left>e.right||f.bottom<e.top||f.top>e.bottom)&&(c=!0)}})}),c},this.applyAltLabels=function(a,b,c,d,e){(d?a.selectAll(d):a.selectAll(".x text")).each(function(a,d){var f=b[d][c];f=f||(e?d3.select(this).text().substring(0,1):d3.select(this).text().substring(0,6)+"..."),d3.select(this).text(f)})},this.Line=function(d,e,f,g){var h={formatterString:null},i=a.extend(!0,h,c.options),j=!!i.formatterString,k=function(a){return j?d3.format(i.formatterString)(a):a};a(b).addClass("line-chart"+(g?" bubble":""));var l={radius:5,radiusOnHover:7,strokeWidth:2,class:"dot"};g&&(l.radius=0,l.radiusOnHover=0,l.strokeWidth=0),a.extend(!0,l,i.dots);var m,n,o,p=c.isRTL,q=[],r=c.options.tooltip,s={},t={atLeastOne:!1},u=["left","top","right","bottom"];if(c.options.axisLabels&&a.extend(!0,s,c.options.axisLabels),!a.isEmptyObject(s))for(n=0,o=u.length;n<o;n++){var v=s[u[n]];v&&"string"==typeof v&&""!==a.trim(v)&&(t[u[n]]=!0,t.atLeastOne=!0)}var w="",x=0,y=d,z=i.xAxis&&void 0!==i.xAxis.rotate,A=function(a,b){return d3.max(a.data,function(a){return b?a.value[b]:a.value})};z&&(y[0].data.map(function(a){a.name.length>w.length&&(w=a.name)}),x=w.length);var B=e.hideDots,C=a(b).parent(),D=!!a(".widget-chart-action",C).length,E=C.width()<450,F={top:t.top?D?15:40:D?5:30,right:t.right?E?45:65:E?45:55,bottom:t.bottom?z?60:50:z?5*x+35:35,left:t.right?E?55:75:E?45:65},G=C.width()-F.left-F.right,H=C.height()-F.top-F.bottom-30;D&&(H-=40);var I,J=d3.select(b).append("svg").attr("width",G+F.left+F.right).attr("height",H+F.top+F.bottom).append("g").attr("transform","translate("+F.left+","+F.top+")"),K=y[0].data.map(function(a){return a.name}),L={};y[0]&&y[0].valueFormatterString&&a.extend(!0,L,y[0].valueFormatterString),I=function(b,c){return!a.isEmptyObject(L)&&b?d3.format(b)("0.0%"===b?c/100:c):c};var M={name:"Name",value:{x:"Value.x",y:"Value.y",z:"Value.z"}};y[0]&&y[0].labels&&a.extend(!0,M,y[0].labels);var N,O=(i.xAxis&&i.xAxis.scale?i.xAxis.scale:d3.scale.linear()).range([0,G]),P=d3.scale.linear().range([H,0]),Q=d3.scale.linear().range([1,25]);N=g?{x:y.map(function(a){return A(a,"x")}),y:y.map(function(a){return A(a,"y")}),z:y.map(function(a){return A(a,"z")})}:y.map(function(a){return A(a)});var R=d3.max(y.map(function(a){return a.data.length}))-1,S=O.domain(i.xAxis&&i.xAxis.domain?i.xAxis.domain:[0,g?d3.max(N.x):R]).nice(),T=P.domain([0,d3.max(g?N.y:N)]).nice(),U=Q.domain([0,d3.max(g?N.z:N)]).nice(),V=d3.svg.axis().scale(S).orient("bottom").ticks(i.xAxis&&i.xAxis.ticks?i.xAxis.ticks:g&&E?Math.round(R/2):R).tickPadding(10).tickSize(g?-(H+10):0).tickFormat(function(a,b){return i.xAxis&&i.xAxis.formatter?i.xAxis.formatter(a,b):g?a:K[b]}),W=d3.svg.axis().scale(T).tickSize(-(G+20)).tickPadding(p?-18:20).orient("left");if(i.yAxis&&i.yAxis.formatter&&W.tickFormat(function(a,b){return"function"==typeof i.yAxis.formatter?i.yAxis.formatter(a,b):a}),i.yAxis&&i.yAxis.ticks&&W.ticks(i.yAxis.ticks.number,i.yAxis.ticks.format),t.atLeastOne){var X=J.append("g").attr("class","axis-labels"),Y={top:"translate("+G/2+","+-10+")",right:"translate("+(G+28)+","+H/2+")rotate(90)",bottom:"translate("+G/2+","+(H+40)+")",left:"translate(-40,"+H/2+")rotate(-90)"},Z={top:"rotate(0deg) scaleX(-1) translate(-"+G/2+"px, "+-10+"px)",right:"rotate(90deg) scaleX(-1) translate(-"+H/2+"px, -"+(G+28)+"px)",bottom:"rotate(0deg) scaleX(-1) translate(-"+G/2+"px, "+(H+40)+"px)",left:"rotate(90deg) scaleX(-1) translate(-"+H/2+"px, 55px)"};for(n=0,o=u.length;n<o;n++)!function(a){t[a]&&X.append("text").attr({class:"axis-label-"+a,"text-anchor":"middle",transform:p?"":Y[a]}).style({"font-size":"1.3em",transform:p?Z[a]:""}).text(s[a])}(u[n])}
J.append("g").attr("class","x axis").attr("transform","translate(0,"+H+")").call(V),J.append("g").attr("class","y axis").call(W),J.selectAll(".tick line").attr("x1","-10"),g&&(J.selectAll(".x.axis .tick line, .y.axis .tick line").style("opacity",0),J.select(".x.axis .tick line").attr("x2","-10").style("opacity",1),J.select(".y.axis .tick line").style("opacity",1)),c.isRTL&&(J.selectAll("text").attr("transform","scale(-1, 1)"),J.selectAll(".y.axis text").style("text-anchor","start")),z&&J.selectAll(".x.axis .tick text").attr("y",0).attr("x",function(){return-(this.getBBox().width+10)}).attr("dy","1em").attr("transform","rotate("+i.xAxis.rotate+")").style("text-anchor","start");var $=d3.svg.line().x(function(a,b){return S(i.xAxis&&i.xAxis.parser?i.xAxis.parser(a,b):g?a.value.x:b)}).y(function(a){return T(g?a.value.y:a.value)});y.forEach(function(a,b){var d=J.append("g").attr({"data-group-id":b,class:"line-group"});if(f){var e=d3.svg.area().x(function(a,b){return S(b)}).y0(H).y1(function(a){return T(g?a.value.y:a.value)});d.append("path").datum(a.data).attr("fill",function(){return c.chartColor(b,"line",a)}).style("opacity",".2").attr("class","area").attr("d",e)}var h=d.append("path").datum(a.data).attr("d",$(a.data)).attr("stroke",function(){return g?"":c.chartColor(b,"line",a)}).attr("stroke-width",2).attr("fill","none").attr("class","line").on("click.chart",function(){c.selectElement(d3.select(this.parentNode),J.selectAll(".line-group"),a)}),j=h.node().getTotalLength();h.attr("stroke-dasharray",j+" "+j).attr("stroke-dashoffset",j).transition().duration(750).ease("cubic").attr("stroke-dashoffset",0),B||(d.selectAll("circle").data(a.data).enter().append("circle").attr("class",l.class).attr("cx",function(a,b){return S(i.xAxis&&i.xAxis.parser?i.xAxis.parser(a,b):g?a.value.x:b)}).attr("cy",function(a){return T(g?0:a.value)}).attr("r",l.radius).style("stroke-width",l.strokeWidth).style("fill",function(){return c.chartColor(b,"line",a)}).style("opacity",g?".7":"1").on("mouseenter.chart",function(d){var e=this.getBoundingClientRect(),f="<p><b>"+d.name+" </b> "+k(d.value)+"</p>",h=function(){var a=c.getTooltipSize(f),b=e.left-a.width/2+6,d=e.top-a.height-18;b=g?e.left+e.width/2-a.width/2:b,""!==f&&c.showTooltip(b,d,f,"top")};if(g){f='<div class="chart-swatch" style="min-width: 95px;"><div class="swatch-caption"><span style="background-color:'+c.chartColor(b,"line",a)+';" class="indicator-box"></span><b>'+a.name+"</b></div>";var i=d;for(var j in i)if(i.hasOwnProperty(j))if("object"!=typeof i[j])f+='<div class="swatch-row"><span>'+M[j]+"</span><b>"+i[j]+"</b></div>";else{var n=i[j];for(var o in n)n.hasOwnProperty(o)&&(f+='<div class="swatch-row"><span style="text-transform: capitalize;">'+M[j][o]+"</span><b>"+I(L[o],n[o])+"</b></div>")}f+="</div>"}if(r&&"function"==typeof r&&!q[b]){f="";var p=!0;m=setInterval(function(){p&&(p=!1,r(function(a){f=q[b]=a})),""!==f&&(clearInterval(m),h())},10)}else r="object"==typeof r?"":r,f=q[b]||r||d.tooltip||a.tooltip||f||"",h();d3.select(this).attr("r",function(a){return g?2+U(a.value.z):l.radiusOnHover})}).on("mouseleave.chart",function(){clearInterval(m),c.hideTooltip(),d3.select(this).attr("r",function(a){return g?U(a.value.z):l.radius})}).on("click.chart",function(a){c.selectElement(d3.select(this.parentNode),J.selectAll(".line-group"),a)}),g&&d.selectAll("circle").attr("cy",function(a){return T(a.value.y)}).transition().duration(750).ease("cubic").attr("r",function(a){return U(a.value.z)}))});var _=y.map(function(a){return{color:a.color,name:a.name,selectionObj:J.selectAll(".line-group"),selectionInverse:J.selectAll(".line-group"),data:a}});return c.showLegend&&c.addLegend(_),c.appendTooltip(),function(){var a,b,d=0,e=function(c,e,f){c.selected&&d<1&&(d++,a=d3.select(J.selectAll(".line-group")[0][f]),b=e)};y.forEach(function(a,b){a&&e(a,a,b)}),y.forEach(function(a,b){(a||a.data)&&a.data.forEach(function(c){e(c,a,b)})}),d>0&&c.selectElement(a,J.selectAll(".line-group"),b)}(),a(b).trigger("rendered"),a(b)},this.Bullet=function(d){a(b).addClass("bullet-chart");var e,f=[],g=c.options.tooltip,h=d,i=!1,j=a(b).parent(),k={top:30,right:55,bottom:35,left:55},l=j.width()-k.left-k.right,m=j.height()-k.top-k.bottom-30;m=m<0?50:m;for(var n=d3.select(b).append("svg").attr("width",l+k.left+k.right).attr("height",m+k.top+k.bottom).append("g").attr("transform","translate("+k.left+","+k.top+")"),o=0;o<h[0].data.length;o++){var p=h[0].data[o],q=p.ranges.slice().sort(d3.descending),r=p.markers?p.markers.slice().sort(d3.descending):[],s=p.measures?p.measures.slice().sort(d3.descending):[],t=p.ranges.slice().sort(d3.ascending),u=p.markers?p.markers.slice().sort(d3.ascending):[],v=p.measures?p.measures.slice().sort(d3.ascending):[];0===r.length&&(r=s,u=v,i=!0);var w=n.append("g").attr("class","bullet").attr("transform","translate(0, "+70*o+")");w.append("g").append("text").attr("class","title").attr("dy","-10px").text(function(){return p.title}).append("tspan").attr("class","subtitle").attr("dx","15px").text(function(){return p.subtitle});var x=Math.max(q[0],r[0],s[0]),y=Math.min(t[0],u[0],v[0]);y=y<0?y:0;var z=d3.scale.linear().domain([y,x]).range([0,l]).nice(),A=function(a){var b=a(0);return function(c){return Math.abs(a(c)-b)}}(z),B=w.selectAll("rect.range").data(q);B.enter().append("rect").attr("class",function(a,b){return"range s"+b}).attr("data-idx",o).attr("width",0).attr("x",function(a){return z(a<0?a:0)}).style("fill",function(a,b){if(d[0].barColors)return d[0].barColors[b]}).attr("height",20).on("click",function(){var c=d3.select(this);a(b).trigger("selected",[c,d[0].data[c.attr("data-idx")]])}).on("mouseenter",function(b,h){var i=d3.select(this),j=d[0].data[i.attr("data-idx")],k=this.getBoundingClientRect(),l="<p>"+b+"</p>",m=function(){var b=c.getTooltipSize(l),d=k.left+k.width-b.width/2,e=k.top-b.height+a(window).scrollTop()-5;""!==l&&c.showTooltip(d,e,l,"top")};if(j.tooltip&&j.tooltip[h]&&(l=j.tooltip[j.tooltip.length-h-1]),g&&"function"==typeof g&&!f[h]){l="";var n=!0;e=setInterval(function(){n&&(n=!1,g(function(a){l=f[h]=a})),""!==l&&(clearInterval(e),m())},10)}else g="object"==typeof g?"":g,l=f[h]||g||l||"",m()}).on("mouseleave",function(){clearInterval(e),c.hideTooltip()}),B.transition().duration(600).attr("width",A);var C=w.selectAll("rect.measure").data(s);C.enter().append("rect").attr("class",function(a,b){return"measure s"+b}).attr("width",0).attr("height",3).attr("x",function(a){return z(a<0?a:0)}).style("fill",function(a,b){if(d[0].lineColors)return d[0].lineColors[b]}).attr("y",8.5),C.transition().duration(600).attr("width",A);var D=w.selectAll("line.marker").data(r);D.enter().append("line").attr("class",i?"hidden":"marker").attr("x1",0).attr("x2",0).style("stroke",function(a,b){if(d[0].markerColors)return d[0].markerColors[b]}).attr("y1",20/6).attr("y2",100/6),D.transition().duration(600).attr("x1",z).attr("x2",z).attr("y1",20/6).attr("y2",100/6);var E=(r[0]>s[0]?"-":"+")+Math.abs(r[0]-s[0]);0!==Math.abs(r[0]-s[0])&&(D.enter().append("text").attr("class","inverse").attr("text-anchor","middle").attr("y",14).attr("dx",c.isRTL?"-20px":"20px").attr("x",0).text(E),D.transition().duration(600).attr("x",function(){var a=0;return w.selectAll(".measure").each(function(b){var c=A(b),d=z(b);c>a&&(a=c),d>a&&(a=d)}),c.isRTL?-a:a}).style("opacity",1));var F=w.selectAll("g.tick").data(z.ticks(8)),G=F.enter().append("g").attr("class","tick").attr("transform","translate(0,0)").style("opacity",0);G.append("line").attr("y1",20).attr("y2",Math.round(140/4.7)),G.append("text").attr("text-anchor","middle").attr("dy","1.1em").attr("y",Math.round(140/4.7)).attr("class",function(a){return a<0?"negative-value":"positive-value"}).text(function(a){return a}),G.transition().duration(600).attr("transform",function(a){return"translate("+z(a)+",0)"}).style("opacity",1),c.isRTL&&c.isIE&&n.selectAll("text").attr("transform","scale(-1, 1)")}c.appendTooltip(),a(b).trigger("rendered")},this.Completion=function(d){var e=d[0].data[0],f="completion-target"===c.settings.type,g="targeted-achievement"===c.settings.type;a(b).addClass("completion-chart"+("targeted-achievement"===c.settings.type?" chart-targeted-achievement":"")),e.total=a.extend({},{value:100},e.total);var h=function(a){return void 0===a},i=function(a,b){return h(a)?b?0:"":a},j=function(a){return a/100*i(e.total.value,!0)},k=function(a){return d3.round(a/i(e.total.value,!0)*100)},l=function(a,b){return".0%"===b?k(a)+"%":d3.format(b||"")(a)},m=function(a){var b=a.toString();return-1!==b.indexOf("%")?j(b.replace(/%/g,"")):a},n=function(a,b){var c=k(b)>100?100:k(b)<0?0:k(b);a[0].style.width=c+"%"},o=function(a,b){var c=b>100?100:b<0?0:b;a[0].style.left=c+"%"},p=function(a){return a&&!h(a.value)&&a.format?l(m(a.value),a.format):a?m(a.value):0},q=function(){f&&!g&&setTimeout(function(){var c=a(".remaining",b),d=a(".total",b),e=a(".completed .value",b)[0].getBoundingClientRect(),f=c.find(".value")[0].getBoundingClientRect();c.add(d)[e.right>f.left-20?"addClass":"removeClass"]("overlap")},500)};this.update=function(c){var d,f,g,j;if(c.data){if(c.type){if(d=c.type,!e[d])return;g="name"===d?a(".name",b):"total"===d?a(".total.value",b):a("."+d+" .value, ."+d+" .text",b)}else g=c.node;j=(1===g.length?g:g.first()).data("jsonData"),d=j?Object.keys(j)[0]:"name",f=a("."+d+".bar",b),a.extend(!0,e[d],c.data),g.each(function(){var g=a(this);if(c.data.text&&g.is(".name, .text")&&g.html(i(e[d].text)),c.data.color&&g.is(".name, .info, .text, .value")&&(-1===c.data.color.indexOf("#")?("completed"===d&&(!e.info||e.info&&h(e.info.value))?g.add(a(".info .value",b)):g).add(f).removeClass("error dark good primary amethyst07").addClass(c.data.color):g.is(".name, .total")?g[0].style.color=e[d].color:(("completed"===d&&(!e.info||e.info&&h(e.info.value))?a("."+d+" .value, ."+d+" .text, .info .value",b):a("."+d+" .value, ."+d+" .text",b))[0].style.color=e[d].color,f[0].style.backgroundColor=e[d].color)),c.data.value&&g.is(".value")){var j,l=a(".completed",b),r=a(".remaining",b);"completed"===d?((!e.info||e.info&&h(e.info.value)?g.add(a(".info .value",b)):g).html(p(e[d])),k(m(e[d].value))>=100&&(r.hide(),l[0].style.marginTop="inherit")):g.html(p(e[d])),g.is(".name, .total")||"targetline"===d?g.is(".name, .total, .remaining")||"targetline"!==d||(j=m(e[d].value),o(f,j)):"completed"===d?(j=m(e[d].value),n(f,j),j+=m(e.remaining.value),n(a(".remaining.bar",b),j)):"remaining"===d&&(j=m(e[d].value)+m(e.completed.value),n(f,j)),q()}})}};var r={body:a('<div class="total bar" />')};if(f||g){var s={};r.body.addClass("chart-completion-target"+(g?" chart-targeted-achievement":"")),e.total.difference&&(s.value=e.total.value-e.completed.value,s.format=e.total.format);var t=p(e.total.difference?s:e.total)+(e.total.text?e.total.text:"");t=g&&e.remaining?p(e.remaining)+(e.remaining.text?e.remaining.text:""):t,r.label='<span class="label"><span class="name">'+(e.completed.color&&"error"===e.completed.color?'<svg class="icon icon-error" focusable="false" aria-hidden="true" role="presentation"><use xlink:href="#icon-error"></use></svg>':"")+i(e.name.text)+'</span><span class="l-pull-right total value">'+t+"</span></span>"}else r.body.addClass("chart-completion"),r.label='<b class="label name ">'+i(e.name.text)+'</b><b class="label info '+(e.info.color?i(e.info.color):i(e.completed.color)+" colored")+'"><span class="value">'+(e.info&&!h(e.info.value)?i(e.info.value):p(e.completed))+'</span> <span class="text">'+i(e.info.text)+"</span></b>";e.remaining?r.remaining='<div class="target remaining bar '+i(e.remaining.color)+'">'+(g?"":'<span aria-hidden="true"'+(f||g?"":' class="audible"')+'><span class="value">'+p(e.remaining)+'</span><br /><span class="text">'+i(e.remaining.text)+"</span></span>")+"</div>":r.remaining='<div class="target remaining bar" style="opacity: 0"></div>',e.completed&&g&&(r.completed='<div class="completed bar '+i(e.completed.color)+'"></div><span class="completed-label" aria-hidden="true"'+(f||g?"":' class="audible"')+'><span class="text">'+i(e.completed.text)+"</span></span>"),e.completed&&!g&&(r.completed='<div class="completed bar '+i(e.completed.color)+'"><span aria-hidden="true"'+(f||g?"":' class="audible"')+'><span class="value">'+p(e.completed)+'</span><br /><span class="text">'+i(e.completed.text)+"</span></span></div>"),e.targetline&&(r.targetline='<div class="target-line targetline bar"><span aria-hidden="true"'+(f||g?"":' class="audible"')+'><span class="value">'+p(e.targetline)+'</span><br /><span class="text">'+i(e.targetline.text)+"</span></span></div>"),r.body.append(r.remaining,r.completed,r.targetline),a(b).append(r.label,r.body);var u={name:a(".name",b),info:{value:a(".info .value",b),text:a(".info .text",b)},completed:{bar:a(".completed.bar",b),value:a(".completed .value",b),text:a(".completed .text",b)},remaining:{bar:a(".remaining.bar",b),value:a(".remaining .value",b),text:a(".remaining .text",b)},targetline:{bar:a(".targetline",b),value:a(".targetline .value",b),text:a(".targetline .text",b)},total:{bar:a(".total.bar",b),value:a(".total.value",b)}};u.name.data("jsonData",{name:e.name}),u.info.value.add(u.info.text).data("jsonData",{info:e.info}),u.completed.bar.add(u.completed.value).add(u.completed.text).data("jsonData",{completed:e.completed}),u.remaining.bar.add(u.remaining.value).add(u.remaining.text).data("jsonData",{remaining:e.remaining}),u.targetline.bar.add(u.targetline.value).add(u.targetline.text).data("jsonData",{targetline:e.targetline}),u.total.bar.add(u.total.value).data("jsonData",{total:e.total});var v;e.completed&&(v=m(e.completed.value),n(u.completed.bar,v)),e.remaining&&(v=m(e.completed.value)+m(e.remaining.value),n(u.remaining.bar,v),q()),e.targetline&&(v=m(e.targetline.value),o(u.targetline.bar,v))},this.selectElement=function(c,d,e){var f=c.node()&&c.classed("is-selected");d.classed("is-not-selected",!1).classed("is-selected",!1).classed("is-not-selected",!f),c.classed("is-not-selected",!1).classed("is-selected",!f),a(b).triggerHandler("selected",[c,f?{}:e])},this.setSelectedElement=function(b){var d,e=c.settings,f=e.dataset,g="column-positive-negative"===e.type,h="HorizontalBar"===e.chartType,i="Column"===e.chartType,j="Pie"===e.chartType,k=e.svg,l=e.isSingle,m=e.isGrouped,n=e.isStacked,o=e.isSingular,p="selected"===b.task,q=d3.select(b.selector),r=q.classed("positive"),s=k.selectAll(".axis.x .tick"),t=k.selectAll(".axis.y .tick"),u=k.selectAll(".bartext.positive, .target-bartext.positive"),v=k.selectAll(".bartext.negative, .target-bartext.negative"),w=d3.select(b.selector.parentNode),x=parseInt(w.node()?w.attr("data-group-id"):0,10),y=[],z=[];if(f=n||j?f||null:f&&f[x]?f[x].data:null,s.style("font-weight","normal"),t.style("font-weight","normal"),u.style("font-weight","normal"),v.style("font-weight","normal"),k.selectAll(".is-selected").classed("is-selected",!1),p)if(k.selectAll(".bar, .target-bar").style("opacity",.6),e.isByLegends&&!j)g?(e.svg.selectAll(r?".bar.positive, .target-bar.positive":".bar.negative, .target-bar.negative").classed("is-selected",!0).style("opacity",1),(r?u:v).style("font-weight","bolder"),k.selectAll(".bar").each(function(a,b){var c=d3.select(this);c.classed("is-selected")&&z.push({elem:c[0],data:f?f[b]:a})}),y=z):(i||h)&&(m||o?e.svg.selectAll(".series-"+b.i).classed("is-selected",!0).style("opacity",1):w.classed("is-selected",!0).selectAll(".bar").classed("is-selected",!0).style("opacity",1),k.selectAll(".bar.is-selected").each(function(a,c){var f=d3.select(this);d=e.dataset,d=d?n?o?d[0].data[b.i]:d[b.i].data[c]:d[c].data[b.i]:a,z.push({elem:f[0],data:d})}),y=z);else if(o&&n&&i)d=f[0]&&f[0].data?f[0].data:b.d,q.classed("is-selected",!0).style("opacity",1),y.push({elem:q[0],data:d[b.i]});else if(!l&&!m||n||!i&&!h){if(i||h)k.selectAll((i?".axis.x":".axis.y")+" .tick:nth-child("+(b.i+1)+")").style("font-weight","bolder"),k.selectAll(".bar:nth-child("+(b.i+1)+")").classed("is-selected",!0).style("opacity",1),k.selectAll(".bar.is-selected").each(function(a,c){var d=d3.select(this);z.push({elem:d[0],data:f?f[c].data[b.i]:a})}),y=z;else if(j){k.selectAll(".arc").style({stroke:"","stroke-width":""}).attr("transform","");var A=c.chartColor(b.i,"pie",b.d.data),B=f&&f[0]&&f[0].data?f[0].data[b.i]:b.d?b.d.data:b.d;q.classed("is-selected",!0).style({stroke:A,"stroke-width":0}).attr("transform","scale(1.025, 1.025)"),y.push({elem:q[0],data:B,index:b.i})}}else k.selectAll((i?".axis.x":".axis.y")+" .tick:nth-child("+((m?x:b.i)+1)+")").style("font-weight","bolder"),q.classed("is-selected",!0).style("opacity",1),k.select(".target-bar.series-"+b.i).style("opacity",1),d3.select(k.selectAll(".bartext")[0][b.i]).style("font-weight","bolder"),d3.select(k.selectAll(".target-bartext")[0][b.i]).style("font-weight","bolder"),(m||g||i)&&((!g&&!i||i&&m)&&w.classed("is-selected",!0).selectAll(".bar").classed("is-selected",!0).style("opacity",1),w.selectAll(".bar").each(function(a,b){var c=d3.select(this);c.classed("is-selected")&&z.push({elem:c[0],data:f?f[b]:a})}),m?y.push({groupIndex:x,groupElem:w[0],groupItems:z}):y=z);else k.selectAll(".bar, .target-bar").style("opacity",1),u.style("font-weight","bolder"),v.style("font-weight","bolder"),j&&q.classed("is-selected",!1).style("stroke","#fff").style("stroke-width","1px").attr("transform","");e.isByLegends&&(e.isByLegends=!1),this._selected=y,b.isTrigger&&a(b.container).triggerHandler(p?"selected":"unselected",[y])},this.isHTML=function(a){return/(<([^>]+)>)/i.test(a)},this.initChartType=function(b){this.options=b,this.redrawOnResize=!0,this.isRTL=Locale.isRTL(),this.isIE=a("html").hasClass("ie"),void 0!==b.redrawOnResize&&(this.redrawOnResize=b.redrawOnResize),b.format&&(this.format=b.format),b.tooltip&&(this.tooltip=b.tooltip),b.showLegend&&(this.showLegend=b.showLegend),b.legendformatter&&(this.legendformatter=b.legendformatter),b.dataset&&b.dataset.length||a.extend(!0,b,{dataset:[{data:[]}]}),"pie"===b.type&&this.Pie(b.dataset,!1,b),"bar"!==b.type&&"bar-stacked"!==b.type||(this.showLegend=void 0===b.showLegend||b.showLegend,this.HorizontalBar(b.dataset)),"bar-normalized"===b.type&&(this.showLegend=void 0===b.showLegend||b.showLegend,this.HorizontalBar(b.dataset,!0)),"bar-grouped"===b.type&&(this.showLegend=void 0===b.showLegend||b.showLegend,this.HorizontalBar(b.dataset,!0,!1)),"column-stacked"===b.type&&this.Column(b.dataset,!0),["column","column-grouped","column-positive-negative"].indexOf(b.type)>-1&&this.Column(b.dataset),"donut"===b.type&&this.Pie(b.dataset,!0,b),"sparkline"===b.type&&this.Sparkline(b.dataset,b),"sparkline-dots"===b.type&&this.Sparkline(b.dataset,{isDots:!0}),"sparkline-peak"===b.type&&this.Sparkline(b.dataset,{isPeakDot:!0}),"sparkline-dots-n-peak"===b.type&&this.Sparkline(b.dataset,{isDots:!0,isPeakDot:!0}),"sparkline-minmax"===b.type&&this.Sparkline(b.dataset,{isMinMax:!0}),"sparkline-medianrange"===b.type&&this.Sparkline(b.dataset,{isMedianRange:!0}),"sparkline-medianrange-n-peak"===b.type&&this.Sparkline(b.dataset,{isMedianRange:!0,isPeakDot:!0}),"line"===b.type&&(this.showLegend=void 0===b.showLegend||b.showLegend,this.Line(b.dataset,b)),"area"===b.type&&(this.showLegend=void 0===b.showLegend||b.showLegend,this.Line(b.dataset,b,!0)),"bubble"===b.type&&(this.showLegend=void 0===b.showLegend||b.showLegend,this.Line(b.dataset,b,!1,!0)),"bullet"===b.type&&this.Bullet(b.dataset),"completion"!==b.type&&"completion-target"!==b.type&&"targeted-achievement"!==b.type||(this.redrawOnResize=!1,this.Completion(b.dataset))}},a.fn.chart=function(b){return this.each(function(){var c,d=a.data(this,"chart");d&&(a(window).off("resize.line"),a(window).off("resize.pie"),a(window).off("resize.charts load.charts"),a(this).empty()),c=new Chart(this,b),d=a.data(this,"chart",c),d.settings=b,d._selected=[],d.getSelected=function(){return this._selected},a.isEmptyObject(c)||setTimeout(function(){c.initChartType(b),c.handleResize()},d?0:300)})},a.fn.colorpicker=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="colorpicker",e={themes:{light:{border:"matched-only",checkmark:{one:[1,2],two:[3,10]}},dark:{border:"matched-only",checkmark:{one:[1,2],two:[3,10]}},"high-contrast":{border:"all",checkmark:{one:[1,3],two:[4,10]}}},colors:[{label:"Slate",number:"10",value:"1a1a1a"},{label:"Slate",number:"09",value:"292929"},{label:"Slate",number:"08",value:"383838",border:"dark"},{label:"Slate",number:"07",value:"454545",border:"dark"},{label:"Slate",number:"06",value:"5C5C5C"},{label:"Slate",number:"05",value:"737373"},{label:"Slate",number:"04",value:"999999"},{label:"Slate",number:"03",value:"BDBDBD"},{label:"Slate",number:"02",value:"D8D8D8"},{label:"Slate",number:"01",value:"F0F0F0",border:"light, high-contrast"},{label:"Amber",number:"10",value:"D66221"},{label:"Amber",number:"09",value:"DE7223"},{label:"Amber",number:"08",value:"E68425"},{label:"Amber",number:"07",value:"EB9728"},{label:"Amber",number:"06",value:"EFAA30"},{label:"Amber",number:"05",value:"F2BC41"},{label:"Amber",number:"04",value:"F4C951"},{label:"Amber",number:"03",value:"F7D475"},{label:"Amber",number:"02",value:"F8E09C"},{label:"Amber",number:"01",value:"FBE9BF"},{label:"Ruby",number:"10",value:"880E0E"},{label:"Ruby",number:"09",value:"941E1E"},{label:"Ruby",number:"08",value:"A13030"},{label:"Ruby",number:"07",value:"AD4242"},{label:"Ruby",number:"06",value:"B94E4E"},{label:"Ruby",number:"05",value:"C65F5F"},{label:"Ruby",number:"04",value:"D26D6D"},{label:"Ruby",number:"03",value:"DE8181"},{label:"Ruby",number:"02",value:"EB9D9D"},{label:"Ruby",number:"01",value:"F4BCBC"},{label:"Turquoise",number:"10",value:"0E5B52"},{label:"Turquoise",number:"09",value:"206B62"},{label:"Turquoise",number:"08",value:"317C73"},{label:"Turquoise",number:"07",value:"448D83"},{label:"Turquoise",number:"06",value:"579E95"},{label:"Turquoise",number:"05",value:"69ADA3"},{label:"Turquoise",number:"04",value:"7BBFB5"},{label:"Turquoise",number:"03",value:"8ED1C6"},{label:"Turquoise",number:"02",value:"A9E1D6"},{label:"Turquoise",number:"01",value:"C0EDE3"},{label:"Emerald",number:"10",value:"397514"},{label:"Emerald",number:"09",value:"44831F"},{label:"Emerald",number:"08",value:"56932E"},{label:"Emerald",number:"07",value:"66A140"},{label:"Emerald",number:"06",value:"76B051"},{label:"Emerald",number:"05",value:"89BF65"},{label:"Emerald",number:"04",value:"9CCE7C"},{label:"Emerald",number:"03",value:"AFDC91"},{label:"Emerald",number:"02",value:"C3E8AC"},{label:"Emerald",number:"01",value:"D5F6C0"},{label:"Amethyst",number:"10",value:"4B2A5E"},{label:"Amethyst",number:"09",value:"5A3A6F"},{label:"Amethyst",number:"08",value:"6C4B81"},{label:"Amethyst",number:"07",value:"7D5F92"},{label:"Amethyst",number:"06",value:"8E72A4"},{label:"Amethyst",number:"05",value:"A189B8"},{label:"Amethyst",number:"04",value:"B59ECA"},{label:"Amethyst",number:"03",value:"C7B4DB"},{label:"Amethyst",number:"02",value:"DACCEC"},{label:"Amethyst",number:"01",value:"EDE3FC"},{label:"Azure",number:"10",value:"133C59"},{label:"Azure",number:"09",value:"134D71"},{label:"Azure",number:"08",value:"1D5F8A"},{label:"Azure",number:"07",value:"2876A8"},{label:"Azure",number:"06",value:"368AC0"},{label:"Azure",number:"05",value:"4EA0D1"},{label:"Azure",number:"04",value:"69B5DD"},{label:"Azure",number:"03",value:"8DC9E6"},{label:"Azure",number:"02",value:"ADD8EB"},{label:"Azure",number:"01",value:"CBEBF4"}],placeIn:null,showLabel:!1},f=a.extend({},e,b);return c.prototype={init:function(){this.inlineLabel=this.element.closest("label"),this.inlineLabelText=this.inlineLabel.find(".label-text"),this.isInlineLabel=this.element.parent().is(".inline"),this.build(),this.handleEvents()},build:function(){this.isEditor="editor"===this.settings.placeIn;var b=this.element,c=this.isEditor?this.element.attr("data-value"):this.element.val();if(this.isEditor||(this.isInlineLabel?this.inlineLabel.addClass("colorpicker-container"):(this.container=a('<span class="colorpicker-container"></span>'),b.wrap(this.container)),this.container=b.parent(),this.swatch=a('<span class="swatch"></span>').prependTo(this.container),b.attr("data-mask","*******").mask()),this.icon=a.createIconElement("dropdown").appendTo(this.isEditor?this.element:this.container),this.icon.wrap('<span class="trigger"></span>'),c&&"#"!==c.substr(0,1)&&!this.settings.showLabel&&(c="#"+c,this.element.attr(this.isEditor?"data-value":"value",c)),c&&this.settings.showLabel){var d=this.getHexFromLabel(c);this.setColor(d),this.element.attr(this.isEditor?"data-value":"value",d)}c&&7===c.length&&!this.settings.showLabel&&(this.setColor(c),this.element.attr(this.isEditor?"data-value":"value",c)),this.element.is(":disabled")&&this.disable(),this.addAria()},getHexFromLabel:function(a){for(var b=0;b<this.settings.colors.length;b++){var c=this.settings.colors[b];if(a===c.label+c.number)return c.value}},addAria:function(){this.element.attr("role","combobox").attr("aria-autocomplete","list"),a('label[for="'+this.element.attr("id")+'"]').append('<span class="audible">'+Locale.translate("UseArrow")+"</span>")},toggleList:function(){var b=this,c=a("#colorpicker-menu");if(!b.element.is(":disabled")){if(c.length){var d=b.isPickerOpen;if(a(document).trigger(a.Event("keydown",{keyCode:27,which:27})),d)return}c=b.updateColorMenu();var e={ariaListbox:!0,menuId:"colorpicker-menu",trigger:"immediate",placementOpts:{containerOffsetX:10,containerOffsetY:10,parentXAlignment:Locale.isRTL()?"right":"left",strategies:["flip","nudge","shrink"]},offset:{x:0,y:10}};b.element.popupmenu(e).on("open.colorpicker",function(){b.element.parent().addClass("is-open"),b.isPickerOpen=!0}).on("close.colorpicker",function(){c.on("destroy.colorpicker",function(){a(this).off("destroy.colorpicker").remove()}),b.element.parent().removeClass("is-open"),b.isPickerOpen=!1}).on("selected.colorpicker",function(a,c){b.isEditor||(b.element.val(b.settings.showLabel?c.data("label"):"#"+c.data("value")),b.swatch[0].style.backgroundColor="#"+c.data("value")),b.element.focus()}),this.menu=a("#colorpicker-menu"),setTimeout(function(){b.menu.find(".is-selected").focus()},1)}},setColor:function(a,b){"#"!==a.substr(0,1)&&(a="#"+a,this.element.attr(this.isEditor?"data-value":"value",a)),7===a.length&&(this.isEditor||(this.swatch[0].style.backgroundColor=a),this.element.attr("aria-describedby",b))},updateColorMenu:function(){for(var b=!!a("#colorpicker-menu").length,c=this,d=a('<ul id="colorpicker-menu" class="popupmenu colorpicker"></ul>'),e=Soho.theme,g="all"===f.themes[e].border,h=f.themes[e].checkmark,i="",j=0,k=f.colors.length;j<k;j++){var l=a("<li></li>"),m=a('<a href="#"><span class="swatch"></span></a>').appendTo(l),n=f.colors[j].number,o=parseInt(n,10),p=(Locale.translate(f.colors[j].label)||f.colors[j].label)+(f.colors[j].number||""),q=f.colors[j].value,r=!1,s=new RegExp("\\b"+e+"\\b"),t=this.isEditor?this.element.attr("data-value"):this.element.val();c.settings.showLabel&&!this.isEditor&&(t=this.getHexFromLabel(t)),(g||s.test(f.colors[j].border))&&(r=!0),t&&(t+"").toLowerCase().replace("#","")===(q+"").toLowerCase()&&(h&&a.each(h,function(a,b){o>=b[0]&&o<=b[1]&&(i=" checkmark-"+a)}),m.addClass("is-selected"+i));var u=m.find(".swatch");u[0]&&(u[0].style.backgroundColor="#"+q),u.addClass(r?"is-border":""),m.data("label",p).data("value",q).attr("title",p+" #"+q).tooltip(),b||d.append(l)}return b||a("body").append(d),d},enable:function(){this.element.prop("disabled",!1),this.element.parent().removeClass("is-disabled")},disable:function(){this.element.prop("disabled",!0),this.element.parent().addClass("is-disabled")},isDisabled:function(){return this.element.prop("disabled")},decimal2rgb:function(a){return"number"!=typeof a?a:"rgb("+(255&a)+", "+((65280&a)>>8)+", "+((16711680&a)>>16)+")"},rgb2hex:function(a){if(-1===a.search("rgb"))return a;if("rgba(0, 0, 0, 0)"===a)return"transparent";var b=function(a){return("0"+parseInt(a).toString(16)).slice(-2)};return a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+b(a[1])+b(a[2])+b(a[3])},destroy:function(){this.swatch.remove(),this.element.off("keypress.colorpicker"),this.swatch.off("click.colorpicker"),a.removeData(this.element[0],d)},handleEvents:function(){var b=this;this.icon.parent().onTouchClick().on("click.colorpicker",function(){b.toggleList()}),this.element.on("focus.colorpicker",function(){a(this).parent().addClass("is-focused")}).on("blur.colorpicker",function(){a(this).parent().removeClass("is-focused")}),this.element.on("keypress.colorpicker",function(){b.setColor(a(this).val())}).on("change.colorpicker",function(){b.setColor(a(this).val())}),this.element.on("keydown.colorpicker",function(a){38!==a.keyCode&&40!==a.keyCode||b.toggleList()})}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},a.fn.compositeform=function(b){"use strict";function c(b,c){this.settings=a.extend({},c),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="compositeform",e={trigger:null,expandedText:Locale.translate("ShowLess"),collapsedText:Locale.translate("ShowMore")},f=a.extend({},e,b);return c.prototype={init:function(){return this.build().handleEvents()},build:function(){var a=this.element[0].classList;a.contains("composite-form")||a.add("composite-form");var b=this.element.find(".expandable-area");return b.length?(this.hasSummary=!0,this.expandableArea=b,this.expandableAreaAPI=this.expandableArea.data("expandablearea"),this.expandableAreaAPI||(this.expandableArea.expandablearea({trigger:this.settings.trigger}),this.expandableAreaAPI=this.expandableArea.data("expandablearea")),this.expander=this.expandableAreaAPI.expander,this.setExpanderText(this.settings.expandedText)):this.hasSummary=!1,this.checkResponsive(),this},handleEvents:function(){function b(){var a=c.expandableAreaAPI.isExpanded();c.setExpanderText(c.settings[a?"expandedText":"collapsedText"])}var c=this;return a("body").on("resize."+d,function(a){c.checkResponsive(a)}),this.element.on("updated."+d,function(){c.updated()}),this.hasSummary&&this.expandableArea.on("expand."+d,b).on("collapse."+d,b),this},checkResponsive:function(){var a=this.element[0].classList;Soho.breakpoints.isBelow("phone-to-tablet")?a.add("is-in-responsive-mode"):a.remove("is-in-responsive-mode")},setExpanderText:function(a){if(this.hasSummary&&a instanceof String&&a.length){var b=this.expander.find("span");b||(b=this.expander),b.text(a)}},updated:function(){return this.teardown().init()},teardown:function(){return a("body").off("resize."+d),this.element.off("updated."+d),this.hasSummary&&this.expandableArea.off("expand."+d+" collapse."+d),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.contextualactionpanel=function(b){function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="contextualactionpanel",e={id:"contextual-action-modal-"+(parseInt(a(".modal").length,10)+1),buttons:null,title:"Contextual Action Panel",content:null,initializeContent:!0,trigger:"click"},f=a.extend({},e,b);return c.prototype={init:function(){this.setup().build().handleEvents()},setup:function(){return this.panel=this.element.next(".contextual-action-panel"),this.panel[0]&&(this.panel[0].style.display="none"),this.panel.addClass("is-animating"),this},build:function(){var b=this;if(0===this.panel.length)if(this.settings.content instanceof jQuery){if(this.settings.content.is(".contextual-action-panel")?this.panel=this.settings.content:(this.settings.content.wrap('<div class="contextual-action-panel"></div>'),this.panel=this.settings.content.parent()),this.panel.addClass("modal").appendTo("body"),this.settings.content.is("iframe"))return this.settings.content.ready(function(){b.completeBuild(),b.settings.content.show()}),b;this.settings.content.show()
}else this.panel=a('<div class="contextual-action-panel">'+this.settings.content+"</div>").appendTo("body"),this.panel.addClass("modal").attr("id",this.settings.id);return this.completeBuild(),this},completeBuild:function(){var b,c,d=this,e=!1;if(this.panel.find("svg").icon(),0===this.panel.find(".modal-content").length&&(b=this.panel.children(),b.is("iframe")&&(c=b.contents(),this.toolbar=c.find(".toolbar"),e=!0),e||(b.wrapAll('<div class="modal-content"></div>').wrapAll('<div class="modal-body"></div>'),this.panel.addClass("modal"))),0===this.panel.find(".modal-header").length){this.header=a('<div class="modal-header"></div>'),this.header.insertBefore(this.panel.find(".modal-body")),this.toolbar||(this.toolbar=this.panel.find(".toolbar")),this.toolbar.length||(this.toolbar=a('<div class="toolbar"></div>')),this.toolbar.appendTo(this.header);var f=this.toolbar.find(".title");f.length||(f=a('<div class="title">'+this.settings.title+"</div>"),this.toolbar.prepend(f));var g=this.toolbar.find(".buttonset");g.length||(g=a('<div class="buttonset"></div>'),g.insertAfter(f))}return e||this.panel.detach().appendTo("body"),this.element.attr("data-modal",this.settings.id),this.panel.attr("id")||this.panel.attr("id",this.settings.id),this.panel.modal({buttons:d.settings.buttons,trigger:d.settings.trigger?d.settings.trigger:"click"}),this.buttons=this.panel.find(".buttonset").children("button"),this.closeButton=this.buttons.filter('.btn-close, [name="close"], .icon-close'),this.toolbar||(this.toolbar=this.panel.find(".toolbar")),this.toolbar.length&&this.toolbar.toolbar(),Soho.utils.fixSVGIcons(this.element),this},handleEvents:function(){function b(a){c.element.triggerHandler(a.type)}var c=this;return this.panel.addClass("is-animating").on("open.contextualactionpanel",function(a){b(a),c.panel.removeClass("is-animating")}).on("beforeclose.contextualactionpanel",function(){c.panel.addClass("is-animating")}).on("close.contextualactionpanel",function(a){b(a)}).on("beforeopen.contextualactionpanel",function(d){c.settings.initializeContent&&a(this).initialize(),b(d)}).on("afteropen.contextualactionpanel",function(){if(c.toolbar&&c.toolbar.trigger("recalculate-buttons"),c.toolbar.length){var a=c.toolbar.find(".buttonset > .is-selected");a.length||(a=c.toolbar.find(".buttonset > *:first-child"),a.is(".searchfield-wrapper")&&(a=a.children(".searchfield"))),c.toolbar.data("toolbar").setActiveButton(a,!0)}c.panel.find(".modal-body-wrapper").find(":focusable").first().focus(),Soho.utils.fixSVGIcons(c.panel)}).on("beforedestroy.contextualactionpanel",function(){c.teardown()}),this.toolbar&&this.toolbar.children(".buttonset").children('.btn-close, [name="close"], .icon-close').onTouchClick("contextualactionpanel").on("click.contextualactionpanel",function(){c.handleToolbarSelected()}),this},handleToolbarSelected:function(){this.close()},teardown:function(){var b=this,c=b.toolbar.children(".buttonset");this.panel.off("open.contextualactionpanel close.contextualactionpanel beforeopen.contextualactionpanel afterclose.contextualactionpanel"),c.children("*:not(.searchfield)").offTouchClick("contextualactionpanel").off("click.contextualactionpanel"),c.children(".btn-menu").each(function(){var b=a(this).data("popupmenu");b&&b.destroy()});var d=b.toolbar.data("toolbar");d&&d.destroy(),b.header&&b.header.remove(),b.panel.find(".modal-body").children().first().unwrap().unwrap(),b.element.removeAttr("data-modal"),b.element.trigger("afterteardown")},close:function(){var a;"immediate"===this.settings.trigger&&(a=!0),this.panel.data("modal")&&this.panel.data("modal").close(a)},disable:function(){this.element.prop("disabled",!0),this.panel.hasClass("is-visible")&&this.close()},enable:function(){this.element.prop("disabled",!1)},destroy:function(){this.teardown(),this.panel.data("modal").destroy(),a.removeData(this.element[0],d)}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),"immediate"===f.trigger&&(e=a.data(this,d,new c(this,f)))):e=a.data(this,d,new c(this,f))})},a.fn.datepicker=function(b){"use strict";function c(b){this.element=a(b),this.settings=f,Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="datepicker",e={showTime:!1,timeFormat:void 0,minuteInterval:void 0,secondInterval:void 0,mode:void 0,roundToInterval:void 0,dateFormat:"locale",placeholder:!1,disable:{dates:[],minDate:"",maxDate:"",dayOfWeek:[],isEnable:!1},showLegend:!1,legend:[{name:"Public Holiday",color:"#76B051",dates:[]},{name:"Weekends",color:"#EFA836",dayOfWeek:[]}]},f=a.extend({},e,b);return c.prototype={init:function(){this.build(),this.handleEvents()},build:function(){this.element.is(":disabled")&&this.element.closest(".field").addClass("is-disabled"),this.trigger=a.createIconElement("calendar").insertAfter(this.element),this.addAria(),this.isIslamic="islamic-umalqura"===Locale.calendar().name,this.conversions=Locale.calendar().conversions},addAria:function(){this.label=a('label[for="'+this.element.attr("id")+'"]'),this.label.append('<span class="audible">'+Locale.translate("PressDown")+"</span>")},handleKeys:function(b){var c=this;b.is("#calendar-popup")?b.off("keydown.datepicker").on("keydown.datepicker",".calendar-table",function(a){var b=!1,d=a.keyCode||a.charCode||0;if(40===d&&(b=!0,c.currentDate.setDate(c.currentDate.getDate()+7),c.insertDate(c.currentDate)),38===d&&(b=!0,c.currentDate.setDate(c.currentDate.getDate()-7),c.insertDate(c.currentDate)),37===d&&(b=!0,c.currentDate.setDate(c.currentDate.getDate()-1),c.insertDate(c.currentDate)),39===d&&(b=!0,c.currentDate.setDate(c.currentDate.getDate()+1),c.insertDate(c.currentDate)),33!==d||a.altKey||(b=!0,c.currentDate.setMonth(c.currentDate.getMonth()+1),c.insertDate(c.currentDate)),34!==d||a.altKey||(b=!0,c.currentDate.setMonth(c.currentDate.getMonth()-1),c.insertDate(c.currentDate)),33===d&&a.ctrlKey&&(b=!0,c.currentDate.setFullYear(c.currentDate.getFullYear()+1),c.insertDate(c.currentDate)),34===d&&a.ctrlKey&&(b=!0,c.currentDate.setFullYear(c.currentDate.getFullYear()-1),c.insertDate(c.currentDate)),35===d){b=!0;var e=new Date(c.currentDate.getFullYear(),c.currentDate.getMonth()+1,0);c.currentDate=e,c.insertDate(c.currentDate)}if(36===d){var f=new Date(c.currentDate.getFullYear(),c.currentDate.getMonth(),1);c.currentDate=f,c.insertDate(c.currentDate)}if(84===d&&(b=!0,c.setToday()),32!==d&&13!==d||(c.closeCalendar(),c.element.focus(),b=!0),9===d&&(c.settings.showTime||(c.element.focus(),c.closeCalendar())),27===d&&(c.closeCalendar(),c.element.focus()),b)return a.stopPropagation(),a.preventDefault(),!1}):b.off("keydown.datepicker").on("keydown.datepicker",function(b){var d=!1,e=b.keyCode||b.charCode||0,f=a(":focus"),g=f.attr("aria-label");if(9===e&&c.element.is("[readonly]"))return void c.setFocusOnFocusableElement(c.element,b.shiftKey?"prev":"next");if(g){var h=new Date(g);c.currentDate=new Date(h.getTime())}else if(f.hasClass("alternate")){var i=parseInt(c.header.find(".year").text()),j=parseInt(c.header.find(".month").attr("data-month")),k=parseInt(f.text());f.hasClass("prev-month")?0===j?(j=11,i--):j--:f.hasClass("next-month")&&(11===j?(j=0,i++):j++),c.currentDate=new Date(i,j,k)}return 40!==e||c.isOpen()||(d=!0,c.openCalendar(),setTimeout(function(){c.setFocusAfterOpen()},200)),84===e&&(d=!0,c.setToday()),d?(b.stopPropagation(),b.preventDefault(),!1):void 0})},setFormat:function(){var a="object"==typeof Locale&&Locale.calendar().dateFormat?Locale.calendar().dateFormat:null,b="object"==typeof Locale&&Locale.calendar().timeFormat?Locale.calendar().timeFormat:null;"locale"===this.settings.dateFormat?this.pattern=a.short+(this.settings.showTime?" "+(this.settings.timeFormat||b):""):this.pattern=this.settings.dateFormat+(this.settings.showTime&&this.settings.timeFormat?" "+this.settings.timeFormat:""),this.show24Hours=(this.pattern.match("HH")||[]).length>0,this.isSeconds=(this.pattern.match("ss")||[]).length>0},mask:function(){this.setFormat();var b="date availableDate",c={date:"blur",availableDate:"blur"},d=this.element.attr("data-validate"),e=this.element.attr("data-validation-events"),f=this.pattern.toLowerCase().replace(/yyyy/g,"####").replace(/mmmm/g,"*********").replace(/mmm/g,"***").replace(/mm/g,"##").replace(/dd/g,"##").replace(/hh/g,"##").replace(/ss/g,"##").replace(/[mdh]/g,"##").replace(/[a]/g,"am");f=this.settings.showTime&&this.show24Hours?f.substr(0,this.isSeconds?19:16):f,"required"!==d||e?d&&e&&(d.indexOf("no-default-validation")>-1?(b=d.replace(/no-default-validation/g,""),c=a.fn.parseOptions(this.element,"data-validation-events")):(b=d+" "+b,a.extend(c,a.fn.parseOptions(this.element,"data-validation-events")))):(b=d+" "+b,a.extend(c,{required:"change blur"})),this.element.attr({"data-mask":f,"data-validate":b,"data-validation-events":JSON.stringify(c),"data-mask-mode":"date"}).mask().validate(),!this.settings.placeholder||this.element.attr("placeholder")&&"M / D / YYYY"!==this.element.attr("placeholder")||this.element.attr("placeholder",this.pattern)},isOpen:function(){return this.popup&&this.popup.is(":visible")&&!this.popup.hasClass("is-hidden")},open:function(){return this.openCalendar()},activeTabindex:function(b,c){return a("td",this.days).removeAttr("tabindex"),b.attr("tabindex",0),c&&b.focus(),b},openCalendar:function(){var b=this,c={};if(!this.element.is(":disabled")&&!this.element.attr("readonly")){a("#validation-tooltip").addClass("is-hidden"),this.element.addClass("is-active").trigger("listopened");var d='<button type="button" class="btn-icon prev">'+a.createIcon("caret-left")+"<span>"+Locale.translate("PreviousMonth")+"</span></button>",e='<button type="button" class="btn-icon next">'+a.createIcon("caret-right")+"<span>"+Locale.translate("NextMonth")+"</span></button>";this.table=a('<table class="calendar-table" aria-label="'+Locale.translate("Calendar")+'" role="application"></table>'),this.header=a('<div class="calendar-header"><span class="month">november</span><span class="year">2015</span>'+(Locale.isRTL(),d+e)+"</div>"),this.dayNames=a("<thead><tr><th>SU</th> <th>MO</th> <th>TU</th> <th>WE</th> <th>TH</th> <th>FR</th> <th>SA</th> </tr> </thead>").appendTo(this.table),this.days=a('<tbody> <tr> <td class="alternate">26</td> <td class="alternate">27</td> <td class="alternate">28</td> <td class="alternate">29</td> <td class="alternate" >30</td> <td class="alternate">31</td> <td>1</td> </tr> <tr> <td>2</td> <td>3</td> <td>4</td> <td>5</td> <td>6</td> <td>7</td> <td>8</td> </tr> <tr> <td>9</td> <td>10</td> <td>11</td> <td>12</td> <td>13</td> <td>14</td> <td>15</td> </tr> <tr> <td>16</td> <td>17</td> <td>18</td> <td>19</td> <td class="is-today">20</td> <td>21</td> <td>22</td> </tr> <tr> <td>23</td> <td>24</td> <td>25</td> <td>26</td> <td>27</td> <td>28</td> <td class="alternate">1</td> </tr> <tr> <td class="alternate">2</td> <td class="alternate">3</td> <td class="alternate">4</td> <td class="alternate">5</td> <td class="alternate">6</td> <td class="alternate">7</td> <td class="alternate">8</td> </tr> </tbody>').appendTo(this.table),this.timepickerContainer=a('<div class="datepicker-time-container"></div>'),this.footer=a('<div class="popup-footer"> <button type="button" class="cancel btn-tertiary">'+Locale.translate("Clear")+'</button> <button type="button" class="is-today btn-tertiary">'+Locale.translate("Today")+"</button> </div>"),this.settings.showTime&&(void 0===this.settings.timeFormat?c.timeFormat=this.pattern.slice(this.pattern.indexOf(" ")):c.timeFormat=this.settings.timeFormat,void 0!==this.settings.minuteInterval&&(c.minuteInterval=this.settings.minuteInterval),void 0!==this.settings.secondInterval&&(c.secondInterval=this.settings.minuteInterval),void 0!==this.settings.mode&&(c.mode=this.settings.mode),void 0!==this.settings.roundToInterval&&(c.roundToInterval=this.settings.roundToInterval)),this.calendar=a('<div class="calendar'+(this.settings.showTime?" is-timepicker":"")+'"></div').append(this.header,this.table,this.settings.showTime?this.timepickerContainer:"",this.footer);var f=this.element,g=Locale.isRTL()?"right":"left";this.element.parent().is(".datagrid-cell-wrapper")&&(g="center",f=this.element.next(".icon"));var h={content:this.calendar,placementOpts:{parent:f,parentXAlignment:g,strategies:["flip","nudge","shrink"]},placement:"bottom",popover:!0,trigger:"immediate",tooltipElement:"#calendar-popup"};this.trigger.popover(h).off("show.datepicker").on("show.datepicker",function(){"ios"===Soho.env.os.name&&a("head").triggerHandler("disable-zoom"),window.innerHeight<400&&(b.popup.find(".arrow").hide(),b.popup.css("min-height",b.popupClosestScrollable[0].scrollHeight+2+"px"),b.popupClosestScrollable.css("min-height","375px"))}).off("hide.datepicker").on("hide.datepicker",function(){"ios"===Soho.env.os.name&&b.trigger.one("hide",function(){a("head").triggerHandler("enable-zoom")}),b.popupClosestScrollable.add(b.popup).css("min-height","inherit"),b.closeCalendar()}),this.handleKeys(a("#calendar-popup")),a(".calendar-footer a",this.calendar).button(),this.setValueFromField(),this.settings.showTime&&(""===this.element.val()&&(this.currentDate.setHours(0),this.currentDate.setMinutes(0),this.currentDate.setSeconds(0)),c.parentElement=this.timepickerContainer,this.time=b.getTimeString(this.currentDate,b.show24Hours),this.timepicker=this.timepickerContainer.timepicker(c).data("timepicker"),this.timepickerContainer.find("dropdown").dropdown(),setTimeout(function(){b.timepicker.initValues=b.timepicker.getTimeFromField(b.time),b.timepicker.afterShow(b.timepickerContainer)},1)),this.todayDate=new Date,this.todayMonth=this.todayDate.getMonth(),this.todayYear=this.todayDate.getFullYear(),this.todayDay=this.todayDate.getDate(),this.isIslamic&&(this.todayDateIslamic=this.conversions.fromGregorian(this.todayDate),this.todayYear=this.todayDateIslamic[0],this.todayMonth=this.todayDateIslamic[1],this.todayDay=this.todayDateIslamic[2]),this.showMonth(this.currentMonth,this.currentYear),this.popup=a("#calendar-popup"),this.popupClosestScrollable=this.popup.closest(".scrollable"),this.popup.attr("role","dialog"),this.originalDate=this.element.val(),this.days.off("click.datepicker").on("click.datepicker","td",function(){var c=a(this);if(c.hasClass("is-disabled"))b.activeTabindex(c,!0);else{b.days.find(".is-selected").removeClass("is-selected").removeAttr("aria-selected");var d=a(this),e=parseInt(b.header.find(".year").text()),f=parseInt(b.header.find(".month").attr("data-month")),g=parseInt(d.addClass("is-selected").attr("aria-selected","true").text());d.hasClass("prev-month")?0===f?(f=11,e--):f--:d.hasClass("next-month")&&(11===f?(f=0,e++):f++),b.currentDate=new Date(e,f,g),b.isIslamic&&(b.currentDateIslamic[0]=e,b.currentDateIslamic[1]=f,b.currentDateIslamic[2]=g,b.currentYear=b.currentDateIslamic[0],b.currentMonth=b.currentDateIslamic[1],b.currentDay=b.currentDateIslamic[2],b.currentDate=b.conversions.toGregorian(b.currentDateIslamic[0],b.currentDateIslamic[1],b.currentDateIslamic[2])),b.insertDate(b.isIslamic?b.currentDateIslamic:b.currentDate),b.closeCalendar(),b.element.focus()}}),this.footer.off("click.datepicker").on("click.datepicker","button",function(c){var d=a(this);d.hasClass("cancel")&&(b.element.val("").trigger("change").trigger("input"),b.currentDate=null,b.closeCalendar()),d.hasClass("is-today")&&(b.setToday(),b.closeCalendar()),b.element.focus(),c.preventDefault()}),this.header.off("click.datepicker").on("click.datepicker","button",function(){b.showMonth(b.currentMonth+(a(this).hasClass("next")?1:-1),b.currentYear)}),setTimeout(function(){b.setFocusAfterOpen()},200)}},close:function(){return this.closeCalendar()},closeCalendar:function(){this.settings.showTime&&this.timepickerControl&&this.timepickerControl.isOpen()&&this.timepickerControl.closeTimePopup(),this.popup&&this.popup.length&&this.popup.hide().remove();var a=this.trigger.data("tooltip");a&&a.destroy(),this.element.hasClass("is-active")&&(this.element.trigger("listclosed"),this.element.removeClass("is-active"))},isDateDisabled:function(a,b,c){var d,e,f,g=this,h=new Date(a,b,c),i=new Date(this.settings.disable.minDate).setHours(0,0,0,0),j=new Date(this.settings.disable.maxDate).setHours(0,0,0,0);if(-1!==this.settings.disable.dayOfWeek.indexOf(h.getDay()))return!0;if((h=h.setHours(0,0,0,0))<=i||h>=j)return!0;for(this.settings.disable.dates.length&&"string"==typeof this.settings.disable.dates&&(this.settings.disable.dates=[this.settings.disable.dates]),e=0,f=this.settings.disable.dates.length;e<f;e++)if(d=new Date(g.settings.disable.dates[e]),h===d.setHours(0,0,0,0))return!0;return!1},setDisabled:function(a,b,c,d){var e=this.isDateDisabled(b,c,d);a.removeClass("is-disabled").removeAttr("aria-disabled"),(e&&!this.settings.disable.isEnable||!e&&this.settings.disable.isEnable)&&a.addClass("is-disabled").attr("aria-disabled","true").removeClass("is-selected").removeAttr("aria-selected")},addLegend:function(){if(this.settings.showLegend){this.legend&&this.legend.length&&this.legend.remove(),this.legend=a('<div class="calendar-legend"></div>');for(var b=0;b<this.settings.legend.length;b++){var c=this.settings.legend[b],d='<div class="calendar-legend-item"><span class="calendar-legend-swatch" style="background-color:'+this.hexToRgba(c.color,.3)+'"></span><span class="calendar-legend-text">'+c.name+"</span></div>";this.legend.append(d)}this.table.after(this.legend)}},setLegendColor:function(b,c,d,e){if(this.settings.showLegend&&b[0]){var f=this.getLegendColor(c,d,e),g=this;if(b[0].style.backgroundColor="",f){b.addClass("is-colored"),b[0].style.backgroundColor=this.hexToRgba(f,.3);var h=g.hexToRgba(f,.3),i=g.hexToRgba(f,.7);b.on("mouseenter",function(){var b=a(this);b[0].style.backgroundColor=i,b.find("span")[0].style.backgroundColor="transparent"}).on("mouseleave",function(){var b=a(this);b[0].style.backgroundColor=h,b.find("span")[0].style.backgroundColor=""})}}},hexToRgba:function(a,b){var c;return/^#([A-Fa-f0-9]{3}){1,2}$/.test(a)?(c=a.substring(1).split(""),3===c.length&&(c=[c[0],c[0],c[1],c[1],c[2],c[2]]),c="0x"+c.join(""),"rgba("+[c>>16&255,c>>8&255,255&c].join(",")+","+b.toString()+")"):""},getLegendColor:function(a,b,c){if(this.settings.showLegend){for(var d=new Date(a,b,c),e=d.setHours(0,0,0,0),f=0;f<this.settings.legend.length;f++){var g=this.settings.legend[f];if(g.dayOfWeek&&-1!==g.dayOfWeek.indexOf(d.getDay()))return g.color;if(g.dates)for(var h=0;h<g.dates.length;h++){var i=new Date(g.dates[h]);if(e===i.setHours(0,0,0,0))return g.color}}return""}},setFocusAfterOpen:function(){this.calendar&&this.activeTabindex(this.calendar.find(".is-selected"),!0)},showMonth:function(b,c){var d=this,e=this.currentDate.getDate()?this.currentDate:(new Date).setHours(0,0,0,0);this.isIslamic&&(e=this.currentDateIslamic),c.toString().length<4&&(c=(new Date).getFullYear()),12===b&&(c++,this.currentMonth=b=0,this.currentYear=c,this.header.find(".year").text(" "+c)),b<0&&(c--,this.currentMonth=b=11,this.currentYear=c,this.header.find(".year").text(" "+c));var f=Locale.calendar().days.narrow||Locale.calendar().days.narrow||Locale.calendar().days.abbreviated,g=Locale.calendar().months.wide[b];this.currentMonth=b,this.currentYear=c;var h=Locale.calendar().firstDayofWeek||0;if(this.dayNames.find("th").each(function(b){a(this).text(f[(b+h)%7])}),this.yearFist=Locale.calendar().dateFormat.year&&"y"===Locale.calendar().dateFormat.year.substr(1,1),this.header.find(".month").attr("data-month",b).text(g+" "),this.header.find(".year").text(" "+c),this.yearFist){var i=Locale.formatDate(e,{date:"year"}),j=i.split(" ")[0];this.header.find(".year").text(j+" "),this.header.find(".year").insertBefore(this.header.find(".month"))}var k,l,m,n=this.firstDayOfMonth(c,b),o=(n-(Locale.calendar().firstDayofWeek||0)+7)%7,p=this.daysInMonth(c,b+(this.isIslamic?1:0)),q=this.daysInMonth(c,b+(this.isIslamic?0:1)),r=1,s=1;this.days.find("td").each(function(f){var g=a(this).removeClass("alternate prev-month next-month is-selected is-today");if(g.removeAttr("aria-selected"),f<o&&(m=p-o+1+f,l=0===b?11:b-1,k=0===b?c-1:c,d.setDisabled(g,k,l,m),d.setLegendColor(g,k,l,m),g.addClass("alternate prev-month").html('<span aria-hidden="true">'+m+"</span>")),f>=o&&r<=q){if(g.html('<span aria-hidden="true">'+r+"</span>"),d.isIslamic)c===e[0]&&b===e[1]&&r===e[2]&&g.addClass("is-selected").attr("aria-selected","true");else{var h=e.getHours(),i=e.getMinutes(),j=d.isSeconds?e.getSeconds():0;new Date(c,b,r).setHours(h,i,j,0)===e.setHours(h,i,j,0)&&g.addClass("is-selected").attr("aria-selected","true")}return r===d.todayDay&&d.currentMonth===d.todayMonth&&d.currentYear===d.todayYear&&g.addClass("is-today"),g.attr("aria-label",Locale.formatDate(new Date(d.currentYear,d.currentMonth,r),{date:"full"})),d.setDisabled(g,c,b,r),d.setLegendColor(g,c,b,r),g.attr("role","link"),void r++}r>=q+1&&(m=s,l=11===b?0:b+1,k=11===b?c+1:c,d.setDisabled(g,k,l,m),d.setLegendColor(g,k,l,m),g.addClass("alternate next-month").html('<span aria-hidden="true">'+s+"</span>"),s++)});var t=this.days.find("tr").eq(5);7===t.find("td.alternate").length?t.hide():t.show(),d.addLegend()},insertDate:function(b,c){var d=b instanceof Array?b[1]:b.getMonth(),e=b instanceof Array?b[0]:b.getFullYear(),f=(b instanceof Array?b[2]:b.getDate()).toString();if(this.currentMonth===d&&this.currentYear===e||this.showMonth(d,e),this.isOpen()){var g=this.days.find("td:not(.alternate)").filter(function(){return a(this).text().toLowerCase()===f});g.hasClass("is-disabled")?this.activeTabindex(g,!0):(this.settings.showTime&&(c?(this.time=this.getTimeString(b,this.show24Hours),this.settings.roundToInterval&&(a("#timepicker-minutes").val(""),b=this.setTime(b))):b=this.setTime(b)),this.setValue(b,!0),this.days.find(".is-selected").removeClass("is-selected").removeAttr("aria-selected").removeAttr("tabindex"),g.addClass("is-selected").attr({"aria-selected":!0}),this.activeTabindex(g,!0))}},getBoolean:function(a){var b=+a;return isNaN(b)?!!String(a).toLowerCase().replace(!1,""):!!b},firstDayOfMonth:function(a,b){if(this.isIslamic){var c=this.conversions.toGregorian(a,b,1);return null===c?1:c.getDay()}return new Date(a,b,1).getDay()},islamicYearIndex:function(a){var b=a-1318;return b<0||b>=this.conversions.yearInfo.length?0:b},daysInMonth:function(a,b){if(this.isIslamic){for(var c=this.conversions.yearInfo[this.islamicYearIndex(a)][0],d=0,e=0;e<=b;e++){if(d=29+(1&c),e===b)return d;c>>=1}return 0}return new Date(a,b,0).getDate()},setValue:function(a,b){this.currentDate=a,a instanceof Array&&(this.currentIslamicDate=a,this.currentDate=this.conversions.toGregorian(a[0],a[1],a[2]),a=new Date(a[0],a[1],a[2])),this.element.val(Locale.formatDate(a,{pattern:this.pattern})),b&&this.element.trigger("change").trigger("input")},setValueFromField:function(){var a=this.element.val(),b=a;if(this.isIslamic&&a){var c=Locale.parseDate(this.element.val(),this.pattern);b=this.conversions.toGregorian(c.getFullYear(),c.getMonth(),c.getDate())}this.currentDate=b||new Date,"string"==typeof this.currentDate&&(this.currentDate=Locale.parseDate(this.currentDate,this.pattern,!1)),void 0===this.currentDate&&(this.currentDate=Locale.parseDate(b,this.pattern,!1)),this.currentDate=this.currentDate||new Date,this.currentMonth=this.currentDate.getMonth(),this.currentYear=this.currentDate.getFullYear(),this.currentDay=this.currentDate.getDate(),this.isIslamic&&(this.currentDateIslamic=this.conversions.fromGregorian(this.currentDate),this.currentYear=this.currentDateIslamic[0],this.currentMonth=this.currentDateIslamic[1],this.currentDay=this.currentDateIslamic[2])},enable:function(){this.element.removeAttr("disabled readonly").closest(".field").removeClass("is-disabled")},disable:function(){this.enable(),this.element.attr("disabled","disabled").closest(".field").addClass("is-disabled")},readonly:function(){this.enable(),this.element.attr("readonly","readonly")},setToday:function(){this.currentDate=new Date,""===this.element.val()?(this.currentDate.setHours(0),this.currentDate.setMinutes(0),this.currentDate.setSeconds(0)):(this.timepicker&&this.timepicker.hourSelect&&this.currentDate.setHours(this.timepicker.hourSelect.val()),this.timepicker&&this.timepicker.minuteSelect&&this.currentDate.setMinutes(this.timepicker.minuteSelect.val()),this.timepicker&&this.timepicker.secondSelect&&this.currentDate.setSeconds(this.timepicker.secondSelect.val())),this.isIslamic&&(this.currentDateIslamic=this.conversions.fromGregorian(this.currentDate)),this.isOpen()?this.insertDate(this.isIslamic?this.currentDateIslamic:this.currentDate,!0):this.element.val(Locale.formatDate(this.currentDate,{pattern:this.pattern})).trigger("change").trigger("input")},setTime:function(b){var c=a("#timepicker-hours").val(),d=a("#timepicker-minutes").val(),e=this.isSeconds?a("#timepicker-seconds").val():0,f=a("#timepicker-period");return c=f.length&&"PM"===f.val()&&c<12?parseInt(c,10)+12:c,c=f.length&&"AM"===f.val()&&12===parseInt(c,10)?0:c,b.setHours(c,d,e),b},getTimeString:function(a,b){var c=function(a){return(a<10?"0":"")+a},d=a||new Date,e=d.getHours(),f=c(d.getMinutes()),g=c(d.getSeconds()),h=(e%12||12)+":"+f+(this.isSeconds?":"+g:"")+" "+(e<12?"AM":"PM"),i=e+":"+f+(this.isSeconds?":"+g:"");return b?i:h},changeEventOrder:function(b,c,d){a.each(c.split(" "),function(c,e){b.each(function(){var b=a._data(this,"events")[e.split(".")[0]];d=Math.min(d,b.length-1),b.splice(d,0,b.pop())})})},setFocusOnFocusableElement:function(b,c){var d=a(":focusable"),e=d.index(b);e="next"===c?e+1>=d.length?0:e+1:e-1<0?d.length:e-1,d.eq(e).focus()},updated:function(){return this.teardown().init()},teardown:function(){this.isOpen()&&this.closeCalendar(),this.trigger.remove(),this.element.attr("data-mask",""),this.calendar&&this.calendar.length&&this.calendar.remove(),this.popup&&this.popup.length&&this.popup.remove();var a=this.element.data("mask");return a&&a.destroy(),this.element.off("keydown.datepicker blur.validate change.validate keyup.validate focus.validate"),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)},handleEvents:function(){var a=this;this.trigger.on("click.datepicker",function(){a.isOpen()?a.closeCalendar():a.openCalendar()}),a.mask(),this.handleKeys(this.element)}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},window.Formatters={Text:function(a,b,c){return null===c||void 0===c||""===c?"":c.toString()},Input:function(a,b,c,d){if(d.inlineEditor){return'<label for="datagrid-inline-input-'+a+"-"+b+'" class="audible">'+d.name+'</label><input id="datagrid-inline-input-'+a+"-"+b+'" class="'+("right"===d.align?"is-number-mask":"")+'" value="'+c+'">'}return null===c||void 0===c||""===c?"":c.toString()},Ellipsis:function(a,b,c,d){var e=null===c||void 0===c||""===c?"":c.toString();return d.textOverflow="ellipsis",e},Password:function(a,b,c){return(null===c||void 0===c||""===c?"":c.toString()).replace(/./g,"*")},Readonly:function(a,b,c){return'<span class="is-readonly">'+(null===c||void 0===c?"":c)+"</span>"},Date:function(b,c,d,e,f){var g,h=null===d||void 0===d?"":d;if("string"==typeof d&&d){if("0000"===d||"000000"===d||"00000000"===d)return"";g=e.sourceFormat?Locale.parseDate(d,"string"==typeof e.sourceFormat?{pattern:e.sourceFormat}:e.sourceFormat):Locale.parseDate(d,"string"==typeof e.dateFormat?{pattern:e.dateFormat}:e.dateFormat),g?h=Locale.formatDate(g,"string"==typeof e.dateFormat?{pattern:e.dateFormat}:e.dateFormat):"NaN/NaN/NaN"===(h=Locale.formatDate(d,"string"==typeof e.dateFormat?{pattern:e.dateFormat}:e.dateFormat))&&(h=d)}else d&&(h=Locale.formatDate(d,"string"==typeof e.dateFormat?{pattern:e.dateFormat}:e.dateFormat));return e.editor&&!0!==f?'<span class="trigger">'+h+"</span>"+a.createIcon({icon:"calendar",classes:["icon-calendar"]}):h},Time:function(b,c,d,e){var f,g=null===d||void 0===d?"":d,h="object"==typeof Locale&&Locale.calendar().dateFormat?Locale.calendar().dateFormat.short:null,i="object"==typeof Locale&&Locale.calendar().timeFormat?Locale.calendar().timeFormat:null;return"string"==typeof d&&d&&(f=Locale.formatDate(function(a){if(""===a)return null;var b=a.match(/(\d+)(?::(\d\d))(?::(\d\d))?\s*([pP]?)/i);if(null===b)return null;var c=new Date;return c.setHours(parseInt(b[1])+(b[4]?12:0)),c.setMinutes(parseInt(b[2])||0),c.setSeconds(parseInt(b[3])||0),c}(d),{pattern:h+" "+(e.sourceFormat||e.timeFormat||i)}))&&(g=f.slice(f.indexOf(" "))),g=g.replace(/^\s/,""),e.editor?'<span class="trigger">'+g+"</span>"+a.createIcon({icon:"clock",classes:["icon-clock"]}):g},Autocomplete:function(a,b,c){return null===c||void 0===c?"":c},Lookup:function(b,c,d,e,f){var g=null===d||void 0===d?"":d;return e.editor?(e.editorOptions&&"function"==typeof e.editorOptions.field&&(g=e.editorOptions.field(f,null,null)),'<span class="trigger">'+g+"</span>"+a.createIcon({icon:"search-list",classes:["icon-search-list"]})):g},Decimal:function(a,b,c,d){var e=c;return void 0!==typeof Locale&&null!==e&&void 0!==e&&""!==e&&(e=Locale.formatNumber(+c,d.numberFormat)),null===e||void 0===e?"":e},Integer:function(a,b,c,d){var e=c;return void 0!==typeof Locale&&null!==e&&void 0!==e&&""!==e&&(e=Locale.formatNumber(+c,d.numberFormat||{style:"integer"})),null===e||void 0===e?"":e},Hyperlink:function(b,c,d,e,f,g){var h,i=e.href||"#";if(e.href&&"function"==typeof e.href){if(null==(i=e.href(b,c,f,e)))return e.text||d}else i=i.replace("{{value}}",d);return h=e.text||d,h||e.icon?e.icon?'<a href="'+i+'" class="btn-icon row-btn '+(e.cssClass||"")+'" '+(g.settings.rowNavigation?'tabindex="-1"':"")+(e.hyperlinkTooltip?' title="'+e.hyperlinkTooltip+'"':"")+">"+a.createIcon({icon:e.icon,file:e.iconFile})+'<span class="audible">'+h+"</span></a>":'<a href="'+i+'" '+(g.settings.rowNavigation?'tabindex="-1"':"")+' role="presentation" class="hyperlink '+(e.cssClass||"")+'"'+(e.target?' target="'+e.target+'"':"")+(e.hyperlinkTooltip?' title="'+e.hyperlinkTooltip+'"':"")+">"+h+"</a>":""},Template:function(a,b,c,d,e){var f=d.template,g="";if(H&&e&&f){g=H.compile("{{#dataset}}"+f+"{{/dataset}}").render({dataset:e})}return g},Drilldown:function(){var b=Locale.translate("Drilldown");return void 0===b&&(b=""),'<button type="button" tabindex="-1" class="btn-icon small datagrid-drilldown">'+a.createIcon({icon:"drilldown"})+"<span>"+b+"</span></button>"},RowReorder:function(){var b=Locale.translate("ReorderRows");return void 0===b&&(b="Reorder Rows"),'<div class="datagrid-reorder-icon">'+a.createIcon({icon:"drag"})+'<span class="audible">'+b+"</span></div>"},Checkbox:function(a,b,c,d,e,f){var g;g=d.isChecked?d.isChecked(c):void 0!=c&&1==c;var h='<span class="hidden" aria-hidden="true" role="presentation">'+Locale.translate(g?"Yes":"No")+"</span>",i=f.wasJustUpdated;return f.wasJustUpdated=!1,'<div class="datagrid-checkbox-wrapper"><span role="checkbox" aria-label="'+d.name+'" class="datagrid-checkbox '+(g?"is-checked "+(i?" ":" no-animation"):"")+'" aria-checked="'+g+'"></span>'+h+"</div>"},SelectionCheckbox:function(a,b,c,d){var e=void 0!=c&&1==c;return'<div class="datagrid-checkbox-wrapper"><span role="checkbox" aria-label="'+d.name+'" class="datagrid-checkbox datagrid-selection-checkbox'+(e?"is-checked":"")+'" aria-checked="'+e+'"></span></div>'},Actions:function(b,c,d,e){return'<button type="button" class="btn-actions" aria-haspopup="true" aria-expanded="false" aria-owns="'+e.menuId+'"><span class="audible">'+e.title+"</span>"+a.createIcon({icon:"more"})+"</button>"},Textarea:function(a,b,c){return'<span class="datagrid-multiline-text">'+(null===c||void 0===c?"":c)+"</span>"},Editor:function(b,c,d,e){var f=null===d||void 0===d?"":d,g="is-editor";return g+=e.singleline?"":" datagrid-multiline-text",'<div class="'+(g+=e.contentTooltip?" content-tooltip":"")+'">'+a.unescapeHTML(f)+"</div>"},Expander:function(a,b,c){return'<button type="button" aria-label="'+Locale.translate("ExpandCollapse")+'" class="btn-icon datagrid-expand-btn" tabindex="-1"><span class="icon plus-minus"></span></button>'+(c?"<span> "+c+"</span>":"")},GroupRow:function(a,b,c,d,e,f){
var g=f.settings.groupable,h="",i=void 0===g.expanded||g.expanded;g.expanded&&"function"==typeof g.expanded&&(i=g.expanded(a,b,c,d,e,f));for(var j=0;j<g.fields.length;j++)h+=e[g.fields[j]]+(0===j?"":",");return g.groupRowFormatter&&(h=g.groupRowFormatter(a,b,c,d,e,f)),'<button type="button" class="btn-icon datagrid-expand-btn'+(i?" is-expanded":"")+'" tabindex="-1"><span class="icon plus-minus'+(i?" active":"")+'"></span><span class="audible">'+Locale.translate("ExpandCollapse")+"</span></button><span> "+h+"</span>"},GroupFooterRow:function(a,b,c,d,e,f){var g=f.settings.groupable;void 0===g.expanded||g.expanded;g.expanded&&"function"==typeof g.expanded&&g.expanded(a,b,c,d,e,f);var h=f.columnIdxById(g.aggregate),i='<td role="gridcell" colspan='+h+'><div class="datagrid-cell-wrapper"></div></td><td role="gridcell"><div class="datagrid-cell-wrapper"> '+e.sum+"</div></td>";return g.groupFooterRowFormatter&&(i=g.groupFooterRowFormatter(h,a,b,c,d,e,f)),i},SummaryRow:function(a,b,c,d){var e="",f=d.summaryText||'<b class="datagrid-summary-totals">'+Locale.translate("Total")+" </b>";return"after"===d.summaryTextPlacement&&(e=f,f=""),void 0!==typeof Locale&&d.numberFormat&&null!==c&&void 0!==c&&""!==c&&(c=Locale.formatNumber(+c,d.numberFormat)),f+(null===c||void 0===c||""===c?"":c.toString())+e},Tree:function(a,b,c,d,e,f){var g=e.expanded,h=f.settings.treeDepth[a].depth,i='<button type="button" class="btn-icon datagrid-expand-btn'+(g?" is-expanded":"")+'" tabindex="-1"'+(h?' style="margin-left: '+(h?30*(h-1)+"px":"")+'"':"")+'><span class="icon plus-minus'+(g?" active":"")+'"></span><span class="audible">'+Locale.translate("ExpandCollapse")+"</span></button>"+(c?"<span> "+c+"</span>":""),j='<span class="datagrid-tree-node"'+(h?' style="margin-left: '+(h?30*(h-1)+"px":"")+'"':"")+"> "+c+"</span>";return e[d.children?d.children:"children"]?i:j},ClassRange:function(a,b,c,d){var e=d.ranges,f="",g="";if(!e)return{};for(var h=0;h<e.length;h++)c>=e[h].min&&c<=e[h].max&&(f=e[h].classes,g=e[h].text?e[h].text:f.split(" ")[0]),c===e[h].value&&(f=e[h].classes,g=e[h].text?e[h].text:c);return{classes:f,text:g}},Badge:function(a,b,c,d){var e=d.color,f=d.name;if(d.ranges){var g=Formatters.ClassRange(a,b,c,d);e=g.classes,f=g.text}return'<span class="badge '+e+'">'+c+' <span class="audible">'+f+"</span></span>"},Tag:function(a,b,c,d){return'<span class="tag '+Formatters.ClassRange(a,b,c,d).classes+'">'+c+"</span>"},Alert:function(b,c,d,e){var f=Formatters.ClassRange(b,c,d,e);return a.createIcon({icon:f.classes,classes:["icon","datagrid-alert-icon","icon-"+f.classes]})+'<span class="datagrid-alert-text">'+("value"===f.text?d:f.text)+"</span>"},Image:function(a,b,c,d){return'<img class="datagrid-img" src="'+c+'" alt= "'+(d.alt?d.alt:Locale.translate("Image"))+'"'+(d.dimensions?' style="height:'+d.dimensions.height+";width:"+d.dimensions.height+'"':"")+"/>"},Color:function(a,b,c,d){var e=Formatters.ClassRange(a,b,c,d),f=null===c||void 0===c||""===c?"":c.toString();return'<span class="'+e.classes+'">'+f+"</span>"},Button:function(b,c,d,e,f,g){var h=e.text?e.text:null===d||void 0===d||""===d?"":d.toString(),i='<button type="button" class="'+(e.icon?"btn-icon":"btn-secondary")+" row-btn "+(e.cssClass?e.cssClass:"")+'"'+(g.settings.rowNavigation?' tabindex="-1"':"")+" >";return e.icon&&(i+=a.createIcon({icon:e.icon,file:e.iconFile})),i+="<span>"+h+"</span></button>"},Dropdown:function(b,c,d,e){var f,g,h,i=d;if(e.options&&void 0!==d)for(f=e.caseInsensitive&&"string"==typeof d?d.toLowerCase():d,g=0;g<e.options.length;g++)if(h=e.options[g],(e.caseInsensitive&&"string"==typeof h.value?h.value.toLowerCase():h.value)===f){i=h.label;break}var j='<span class="trigger dropdown-trigger">'+i+"</span>"+a.createIcon({icon:"dropdown"});if(e.inlineEditor){for(j='<label for="full-dropdown" class="audible">'+e.name+'</label><select id="datagrid-dropdown'+b+'" class="dropdown">',g=0;g<e.options.length;g++){var k=e.options[g];j+="<option"+(void 0===k.id?"":' id="'+k.id+'"')+' value="'+k.value+'"'+(k.selected||k.value===f?" selected ":"")+">"+(void 0!==k.label?k.label:void 0!==k.value?k.value:"")+"</option>"}j+='</select><div class="dropdown-wrapper is-inline"><div class="dropdown"><span>'+i+'</span></div><svg class="icon" focusable="false" aria-hidden="true" role="presentation"><use xlink:href="#icon-dropdown"></use></svg></div>'}return j},Spinbox:function(a,b,c,d){var e=null===c||void 0===c||""===c?"":c.toString();return d.inlineEditor&&(e='<label for="spinbox-'+b+'" class="audible">Quantity</label><span class="spinbox-wrapper"><span class="spinbox-control down">-</span><input id="spinbox-'+b+'" name="spinbox-'+b+'" type="text" class="spinbox" value="'+c+'"><span class="spinbox-control up">+</span></span>'),e},Favorite:function(b,c,d,e,f,g){var h;h=e.isChecked?e.isChecked(d):void 0!=d&&1==d;var i=e.editor&&g.settings.editable;return h?'<span aria-label="'+Locale.translate("Favorite")+'" class="icon-favorite'+(i?" is-editable":"")+'">'+a.createIcon({icon:"star-filled"})+"</span>":e.showEmpty?'<span aria-label="'+Locale.translate("Favorite")+'" class="icon-favorite'+(i?" is-editable":"")+'">'+a.createIcon({icon:"star-outlined"})+"</span>":""},Status:function(b,c,d,e,f){return f.rowStatus?a.createIcon({icon:f.rowStatus.icon,classes:["icon","icon-"+f.rowStatus.icon,"datagrid-alert-icon"]})+'<span class="audible">'+f.rowStatus.text+"</span>":"<span></span>"},TargetedAchievement:function(a,b,c,d){var e=100*c,f=Formatters.ClassRange(a,b,e,d),g=d.target,h=e>55;return'<div class="total bar chart-completion-target chart-targeted-achievement"><div class="target remaining bar" style="width: '+(g||0)+'%;"></div><div class="completed bar '+(d.ranges&&f.classes?f.classes:"primary")+'" style="width: '+e+'%;"></div>'+(d.showPercentText?'<div class="chart-targeted-text" '+(h?'style="color: white"':"")+">"+e+"%</div></div>":"")}},window.Editors={Input:function(b,c,d,e,f,g,h,i){this.name="input",this.originalValue=d,this.useValue=!!f.inlineEditor,this.init=function(){if(f.inlineEditor?this.input=e.find("input"):this.input=a('<input type="'+(f.inputType||"text")+'"/>').appendTo(e),f.align&&this.input.addClass("l-"+f.align+"-text"),f.maxLength&&this.input.attr("maxlength",f.maxLength),f.mask&&"function"==typeof f.mask){var g=f.mask(b,c,d,f,i);this.input.mask({pattern:g,mode:f.maskMode})}else f.mask&&this.input.mask({pattern:f.mask,mode:f.maskMode})},this.val=function(a){var b;return a&&this.input.val(a),f&&f.numberFormat&&"percent"===f.numberFormat.style?(b=this.input.val().trim().replace(/(\s%?|%)$/g,""),Locale.parseNumber(b)/100):this.input.val()},this.focus=function(){this.input.focus().select()},this.destroy=function(){if(!f.inlineEditor){var a=this;setTimeout(function(){a.input.remove()},0)}},this.init()},Textarea:function(b,c,d,e,f){this.name="textarea",this.originalValue=d,this.init=function(){this.input=a('<textarea class="textarea"></textarea>').appendTo(e),f.maxLength&&this.input.attr("maxlength",f.maxLength)},this.val=function(a){return a&&this.input.focus().val(a),this.input.val()},this.focus=function(){this.input.focus()},this.destroy=function(){var a=this;setTimeout(function(){a.input.remove()},0)},this.init()},Editor:function(b,c,d,e,f,g,h){this.name="editor",this.originalValue=d,this.init=function(){var b=this,c=a.extend({},{buttons:{editor:["bold","italic","underline","strikethrough","separator","foreColor"],source:[]},excludeButtons:{editor:[]}},f.editorOptions);this.editorWidth=h.setUnit(c.width||e.outerWidth()),delete c.width,e.append('<div class="editor-wrapper" style="width:'+this.editorWidth+';"><div class="editor" data-init="false">'+a.unescapeHTML(d)+"</div></div>"),this.td=e.closest("td"),this.input=a(".editor",e),this.input.popover({content:a(".editor-wrapper",e),placementOpts:{x:0,y:"-"+(parseInt(e[0].style.height,10)+35),parent:this.td,parentXAlignment:Locale.isRTL()?"right":"left",strategies:["flip","nudge","shrink"]},placement:"bottom",popover:!0,trigger:"immediate",tooltipElement:"#editor-popup",extraClass:"editor-popup"}).editor(c).on("hide.editor",function(){h.commitCellEdit(b.input)}).on("keydown.editor",function(a){var c=a.which||a.keyCode||a.charCode||0;if((a.ctrlKey||a.metaKey)&&(13===c||10===c)){var d=b.input.data("tooltip");d&&(d.hide(),h.setNextActiveCell(a))}}),Soho.utils.fixSVGIcons(a("#editor-popup"))},this.val=function(){return this.input.html()},this.focus=function(){var a=this;setTimeout(function(){a.input.focus()},0)},this.destroy=function(){var a=this;e.removeAttr("style"),h.quickEditMode=!1,a.input.off("hide.editor keydown.editor"),setTimeout(function(){a.input.remove();var b=a.td.find(".is-editor.content-tooltip");h.setupContentTooltip(b,a.editorWidth)},0)},this.init()},Checkbox:function(b,c,d,e,f,g,h){this.name="checkbox",this.originalValue=d,this.useValue=!0,this.init=function(){this.input=a('<input type="checkbox" class="checkbox"/>').appendTo(e),this.input.after('<label class="checkbox-label"></label>'),f.align&&this.input.addClass("l-"+f.align+"-text")},this.val=function(b){var c;if(void 0===b)return this.input.prop("checked");c=f.isChecked?f.isChecked(b):b,"click"!==g.type&&("keydown"!==g.type||32!==g.keyCode)||a(g.target).is(".datagrid-checkbox-wrapper, .datagrid-cell-wrapper")||(c=!c,h.setNextActiveCell(g)),this.input.prop("checked",c)},this.focus=function(){this.input.trigger("focusout")},this.destroy=function(){var a=this;setTimeout(function(){a.input.next(".checkbox-label").remove(),a.input.remove()},0)},this.init()},Dropdown:function(b,c,d,e,f,g,h,i){this.name="dropdown",this.originalValue=d,this.useValue=!0,this.cell=h.activeCell,this.init=function(){if(f.inlineEditor)return void(this.input=e.find("select"));if(this.input=a('<select class="dropdown"></select>').appendTo(e),f.options){var j,k,l;d=h.fieldValue(i,f.field);for(var m=f.caseInsensitive&&"string"==typeof d?d.toLowerCase():d,n=0;n<f.options.length;n++)j=a("<option></<option>"),k=f.options[n],l=f.caseInsensitive&&"string"==typeof k.value?k.value.toLowerCase():k.value,(k.selected||m===l)&&(j.attr("selected","true"),this.originalValue=l),j.attr("value",k.value).attr("id",k.id).attr("data-type",typeof k.value),j.text(k.label),this.input.append(j)}var o=f.editorOptions||{};(function(){return o.cssClass&&/is-editing/g.test(o.cssClass)})()||(o.cssClass=o.cssClass||"",o.cssClass+=" is-editing"),o.sourceArguments=a.extend({},o.sourceArguments,{column:f,container:e,grid:h,cell:c,event:g,row:b,rowData:i,value:d}),this.input.dropdown(o)},this.val=function(b){if(void 0!==b){var c=f.caseInsensitive&&"string"==typeof b?b.toLowerCase():b;this.input.val(b),this.input.find("option").each(function(){var b=a(this),d=b.attr("value"),e=b.attr("data-type"),g=d;"number"===e?g=parseFloat(d):"boolean"===e?g="true"===d:"string"===e&&f.caseInsensitive&&(g=d.toLowerCase()),g===c&&b.attr("selected","true")})}var d=this.input.find(":selected"),e=d.attr("value"),g=d.attr("data-type");return"number"===g?e=parseFloat(e):"boolean"===g&&(e="true"===e),void 0===e&&(e=d.text()),e},this.focus=function(){var a=this;this.input.trigger("openlist"),this.input.parent().find("div.dropdown").focus(),this.input.off("listclosed").on("listclosed",function(b,c){if(h.commitCellEdit(a.input),"select"===c)return void e.parent("td").focus();"tab"===c&&setTimeout(function(){e.parent("td").focus()},100)})},this.destroy=function(){},this.init()},Date:function(b,c,d,e,f,g,h){this.name="date",this.originalValue=d,this.init=function(){this.input=a('<input class="datepicker"/>').appendTo(e),this.input.datepicker(f.editorOptions||{dateFormat:f.dateFormat})},this.val=function(a){return a&&this.input.val(a),window.Formatters.Date(b,c,this.input.val(),f,!0)},this.focus=function(){var b=this;this.input.select().focus(),"click"===g.type&&a(g.target).is(".icon")&&(this.input.parent().find(".icon").trigger("click"),this.input.closest("td").addClass("is-focused")),this.input.on("listclosed",function(){b.input.closest("td").removeClass("is-focused"),setTimeout(function(){b.input.trigger("focusout"),e.parent().focus(),h.setNextActiveCell(g)},1)})},this.destroy=function(){var a=this;setTimeout(function(){h.quickEditMode=!1,a.input.remove()},0)},this.init()},Time:function(b,c,d,e,f,g,h){this.name="time",this.originalValue=d,this.init=function(){this.input=a('<input class="timepicker"/>').appendTo(e),this.api=this.input.timepicker(f.editorOptions||"").data("timepicker")},this.val=function(a){return a&&this.input.val(a),this.input.val()},this.focus=function(){var b=this;this.input.select().focus(),"click"===g.type&&a(g.target).is(".icon")&&(this.input.parent().find(".icon").trigger("click"),this.input.closest("td").addClass("is-focused")),this.api.trigger.on("hide.editortime",function(){b.input.closest("td").removeClass("is-focused"),setTimeout(function(){b.input.trigger("focusout"),e.parent().focus(),h.setNextActiveCell(g)},1)})},this.destroy=function(){var a=this;a.api&&a.api.trigger&&a.api.trigger.off("hide.editortime"),setTimeout(function(){h.quickEditMode=!1,a.input.remove()},0)},this.init()},Lookup:function(b,c,d,e,f,g,h){this.name="lookup",this.originalValue=d,this.init=function(){this.input=a('<input class="lookup" data-init="false" />').appendTo(e),f.maxLength&&this.input.attr("maxlength",f.maxLength),this.input.lookup(f.editorOptions)},this.val=function(a){var b=this.input.val();return b&&b.indexOf("|")>-1&&(b=b.substr(0,b.indexOf("|"))),a?this.input.val(a):b},this.focus=function(){var b=this,c=b.input.data("lookup"),d=b.input.closest("td");"keydown"===g.type&&(b.input.select().focus(),d.on("keydown.editorlookup",function(a){40===a.keyCode&&h.quickEditMode&&(a.preventDefault(),a.stopPropagation())})),"click"===g.type&&(a(g.target).is("svg")?c.openDialog(g):(b.input.select().focus(),d.on("touchcancel.editorlookup touchend.editorlookup",".trigger",function(){c.openDialog()}))),b.input.on("change",function(){setTimeout(function(){e.parent().focus(),h.setNextActiveCell(g),h.quickEditMode=!1},1)})},this.destroy=function(){var a=this,b=this.input.closest("td");setTimeout(function(){h.quickEditMode=!1,b.off("keydown.editorlookup").find(".trigger").off("touchcancel.editorlookup touchend.editorlookup"),a.input.remove()},0)},this.init()},Autocomplete:function(b,c,d,e,f,g,h){this.name="autocomplete",this.originalValue=d,this.init=function(){this.input=a('<input class="autocomplete datagrid-autocomplete" data-autocomplete="source" />').appendTo(e),f.editorOptions||(f.editorOptions={}),f.editorOptions.width=e.parent().width(),f.editorOptions.offset={left:-1,top:"medium"===h.settings.rowHeight?1:5},f.maxLength&&this.input.attr("maxlength",f.maxLength),this.input.autocomplete(f.editorOptions)},this.val=function(a){return a?this.input.val(a):this.input.val()},this.focus=function(){h.quickEditMode=!0,this.input.select().focus()},this.destroy=function(){var a=this;setTimeout(function(){h.quickEditMode=!1,a.input.remove()},0)},this.init()},Spinbox:function(a,b,c,d,e,f,g){this.name="spinbox",this.originalValue=c,this.useValue=!0,this.init=function(){if(e.inlineEditor)return void(this.input=d.find("input"));var a='<label for="spinbox-'+b+'" class="audible">Quantity</label><span class="spinbox-wrapper"><span class="spinbox-control down">-</span><input id="spinbox-'+b+'" name="spinbox-'+b+'" type="text" class="spinbox" value="'+c+'"><span class="spinbox-control up">+</span></span>';d.append(a),this.input=d.find("input"),e.editorOptions||(e.editorOptions={}),this.input.spinbox(e.editorOptions)},this.val=function(a){return a?parseInt(this.input.val(a)):parseInt(this.input.val())},this.focus=function(){g.quickEditMode=!0,this.input.select().focus()},this.destroy=function(){if(!e.inlineEditor){var a=this;setTimeout(function(){g.quickEditMode=!1,a.input.remove()},0)}},this.init()},Favorite:function(b,c,d,e,f,g,h){this.name="favorite",this.useValue=!0,this.originalValue=d,this.init=function(){this.input=a('<span class="icon-favorite">'+a.createIcon({icon:d?"star-filled":"star-outlined"})+'<input type="checkbox"></span>').appendTo(e),this.input=this.input.find("input")},this.val=function(b){var c;if(void 0===b)return this.input.prop("checked");c=f.isChecked?f.isChecked(b):b,"click"!==g.type&&("keydown"!==g.type||32!==g.keyCode)||a(g.target).is(".datagrid-cell-wrapper")||(c=!c,h.setNextActiveCell(g)),this.input.prop("checked",c),this.input.find("use").attr("xlink:href",c?"#icon-star-filled":"#icon-star-outlined")},this.focus=function(){this.input.trigger("focusout").focus()},this.destroy=function(){var a=this;setTimeout(function(){a.input.parent().remove()},0)},this.init()}},window.GroupBy=function(){var a=window.Soho.utils.equals,b=function(b,c){return b.some(function(b){return a(b,c)})},c=function(a,b){for(var c={},d=0;d<b.length;d++)c[b[d]]=a[b[d]];return c},d=function(a,d){return a.reduce(function(a,e){var f=c(e,d);return b(a,f)||a.push(f),a},[])},e=function(a,b){var c=[];return a.map(function(a){for(var d in b)if(b[d]!==a[d])return void!1;c.push(a)}),c},f=function(a,b){return d(a,b).map(function(b){return{key:b,values:e(a,b).map(function(a){return a})}})};return f.register=function(a,b){return f[a]=function(a,c,d){var e=this;return e.extra=d,f(a,c).map(b,e)}},f}(),GroupBy.register("sum",function(b){var c=this.extra;return a.extend({},b.key,{values:b.values},{sum:b.values.reduce(function(a,b){return a+Number(b[c])},0)})}),GroupBy.register("max",function(b){var c=this.extra;return a.extend({},b.key,{values:b.values},{max:b.values.reduce(function(a,b){return Math.max(a,Number(b[c]))},Number.NEGATIVE_INFINITY)})}),GroupBy.register("list",function(b){var c=this.extra;return a.extend({},b.key,{values:b.values},{list:b.values.map(function(a){for(var b=[],d=0;d<c.list.length;d++){var e=!!c.exclude&&a[c.exclude];a[c.list[d]]&&!e&&b.push({value:a[c.list[d]],key:c.list[d]})}return b})})}),window.Aggregators={},window.Aggregators.aggregate=function(a,b){for(var c={},d=this,e=0;e<b.length;e++)if(b[e].aggregator){var f=b[e].field;d.sum=function(a,b){var c;return c=f.indexOf(".")>-1?f.split(".").reduce(function(a,b){return a?a[b]:""},b):b[f],a+Number(c)};var g=a.reduce(d[b[e].aggregator],0);if(f.indexOf(".")>-1)for(var h=c,i=0;i<f.split(".").length;i++)i===f.split(".").length-1?h[f.split(".")[i]]=g:(f.split(".")[i]in h||(h[f.split(".")[i]]={}),h=h[f.split(".")[i]]);else c[f]=g}return c},a.fn.datagrid=function(b){function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="datagrid",e={actionableMode:!1,cellNavigation:!0,rowNavigation:!0,alternateRowShading:!1,columns:[],dataset:[],columnReorder:!1,saveColumns:!1,saveUserSettings:{},editable:!1,isList:!1,menuId:null,uniqueId:null,rowHeight:"normal",selectable:!1,groupable:null,clickToSelect:!0,toolbar:!1,initializeToolbar:!0,paging:!1,pagesize:25,pagesizes:[10,25,50,75],showPageSizeSelector:!0,indeterminate:!1,source:null,hidePagerOnOnePage:!1,filterable:!1,disableClientFilter:!1,disableClientSort:!1,resultsText:null,virtualized:!1,virtualRowBuffer:10,rowReorder:!1,showDirty:!1,allowOneExpandedRow:!0,enableTooltips:!1,disableRowDeactivation:!1,sizeColumnsEqually:!1,expandableRow:!1,redrawOnResize:!0},f=a.extend({},e,b);return c.prototype={init:function(){var b=this,c=a("html");this.isTouch=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.isFirefoxMac=-1!==navigator.platform.indexOf("Mac")&&-1!==navigator.userAgent.indexOf(") Gecko"),this.isIe=c.is(".ie"),this.isIe9=c.is(".ie9"),this.isSafari=c.is(".is-safari"),this.isWindows=-1!==navigator.userAgent.indexOf("Windows"),this.settings=f,this.initSettings(),this.originalColumns=b.columnsFromString(JSON.stringify(this.settings.columns)),this.removeToolbarOnDestroy=!1,this.nonVisibleCellErrors=[],this.restoreColumns(),this.restoreUserSettings(),this.appendToolbar(),this.setTreeDepth(),this.setRowGrouping(),this.setTreeRootNodes(),this.firstRender(),this.handlePaging(),this.handleEvents(),this.handleKeys(),setTimeout(function(){b.element.trigger("rendered",[b.element,b.headerRow,b.pagerBar])},0)},initSettings:function(){this.sortColumn={sortField:null,sortAsc:!0},this.gridCount=a(".datagrid").length+1,this.lastSelectedRow=0,this.contextualToolbar=this.element.prev(".contextual-toolbar"),this.contextualToolbar.addClass("datagrid-contextual-toolbar")},render:function(){this.loadData(this.settings.dataset)},firstRender:function(){var b=this;if(b.contentContainer=a('<div class="datagrid-body"></div>'),"table"===this.settings.dataset){b.table=a(this.element).addClass("datagrid");0===a(this.element).closest(".datagrid-container").length&&(b.table.wrap('<div class="datagrid-container"></div>'),this.element=b.table.closest(".datagrid-container")),b.settings.dataset=b.htmlToDataset(),b.table.remove(),b.table=a("<table></table>").addClass("datagrid").attr("role","grid").appendTo(b.contentContainer)}else b.table=a("<table></table>").addClass("datagrid").attr("role",this.settings.treeGrid?"treegrid":"grid").appendTo(b.contentContainer),this.element.addClass("datagrid-container");this.isWindows&&this.element.addClass("is-windows"),"normal"!==f.rowHeight&&(b.table.addClass(f.rowHeight+"-rowheight"),this.element.addClass(f.rowHeight+"-rowheight")),this.settings.treeGrid&&!this.settings.editable&&b.table.attr("aria-readonly","true"),this.settings.isList?a(this.element).addClass("is-gridlist"):a(this.element).removeClass("is-gridlist"),b.table.empty(),b.renderRows(),b.element.append(b.contentContainer),b.clearHeaderCache(),b.renderHeader(),b.container=b.element.closest(".datagrid-container"),b.settings.buttonSelector=".btn, .btn-secondary, .btn-primary, .btn-modal-primary, .btn-tertiary, .btn-icon, .btn-actions, .btn-menu, .btn-split",a(b.settings.buttonSelector,b.table).button()},htmlToDataset:function(){var b=a(this.element).find("tbody tr"),c=this,d=c.settings.columns.length>0,e=[];if(!d){var f=a(this.element).find("thead th"),g=c.element.find("tbody tr:first()");f.each(function(b,d){var e={},f=a(d),h="column"+b;e.id=f.text().toLowerCase(),e.name=f.text(),e.field=h;var i=g.find("td").eq(b).find("a");i.length>0&&(e.formatter=Formatters.Hyperlink,e.href=i.attr("href")),c.settings.columns.push(e)})}return b.each(function(){var b=a(this).find("td"),f={};b.each(function(b,e){var g=a(e),h="column"+b;c.settings.columns[b].formatter?f[h]=g.text():f[h]=g.html(),d&&(c.settings.columns[b].field=h)}),e.push(f)}),e},addRow:function(a,b){var c,d,e=this,f=!1,g=0;b&&"top"!==b||(b="top",f=!0),a.rowStatus={icon:"new",text:"New",tooltip:"New"},"string"==typeof b?e.settings.dataset[f?"unshift":"push"](a):e.settings.dataset.splice(b,0,a),e.renderRows(),e.syncSelectedUI(),e.updateSelected(),setTimeout(function(){g=f?g:e.settings.dataset.length-1,e.setActiveCell(g,0),d=e.tableBody.find('tr[aria-rowindex="'+(g+1)+'"]'),c={row:g,cell:0,target:d,value:a,oldValue:[]},e.pagerRefresh(b),e.element.triggerHandler("addrow",c)},10)},pagerRefresh:function(b){if(this.pager){var c=this.pager.activePage;"string"==typeof b?c="top"===b?1:this.pager._pageCount:"number"==typeof b&&(c=Math.floor(b/this.pager.settings.pagesize+1)),this.pager.pagingInfo=a.extend({},this.pager.pagingInfo,{activePage:c,total:this.settings.dataset.length,pagesize:this.settings.pagesize}),this.renderPager(this.pager.pagingInfo)}},removeRow:function(a,b){var c=this.tableBody.find('tr[aria-rowindex="'+(a+1)+'"]'),d=this.settings.dataset[a];this.unselectRow(a,b),this.settings.dataset.splice(a,1),this.renderRows(),this.element.trigger("rowremove",{row:a,cell:null,target:c,value:[],oldValue:d})},removeSelected:function(){for(var a=this,b=this.selectedRows(),c=b.length-1;c>=0;c--)a.removeRow(b[c].idx,!0),this.updateSelected();this.pagerRefresh(),this.syncSelectedUI()},updateDataset:function(a,b){this.loadData(a,b)},triggerSource:function(a){this.pager.pagerInfo=this.pager.pagerInfo||{},this.pager.pagerInfo.type=a,"refresh"!==a&&(this.pager.pagerInfo.activePage=1),this.renderPager(this.pager.pagerInfo)},loadData:function(a,b,c){this.settings.dataset=a,b||(b={}),b.activePage||(b.activePage=1,b.pagesize=this.settings.pagesize,b.total=-1,b.type="initial"),this.pager&&(b.activePage>-1&&(this.pager.activePage=b.activePage),this.pager.settings.dataset=a),this.setTreeDepth(),this.setRowGrouping(),this.setTreeRootNodes(),"initial"===b.type?(this.clearHeaderCache(),this.renderRows(),this.renderHeader()):this.renderRows(),this.renderPager(b,c),b&&b.preserveSelected?(this.updateSelected(),this.syncSelectedUI()):this.unSelectAllRows()},uniqueId:function(a){return(this.settings.uniqueId?this.settings.uniqueId+"-"+a:window.location.pathname.split("/").pop().replace(/\.xhtml|\.shtml|\.html|\.htm|\.aspx|\.asp|\.jspx|\.jsp|\.php/g,"").replace(/[^-\w]+/g,"").replace(/\./g,"-").replace(/ /g,"-").replace(/%20/g,"-")+"-"+(this.element.attr("id")||"datagrid")+"-"+this.gridCount+a).replace(/--/g,"-")},visibleColumns:function(a){for(var b=[],c=0;c<this.settings.columns.length;c++){var d=f.columns[c];d.hidden||(a&&"selectionCheckbox"===d.id||b.push(d))}return b},lastColumnIdx:function(){for(var a=0,b=0;b<this.settings.columns.length;b++){f.columns[b].hidden||(a=b)}return a},getColumnGroup:function(a){for(var b=0,c=this.settings.columnGroups,d=0;d<c.length;d++)if((b+=c[d].colspan)>=a)return this.uniqueId("-header-group-"+d)},headerText:function(a){var b=a.name?a.name:"";return b||"drilldown"!==a.id?b:'<span class="audible">'+(b=Locale.translate("Drilldown"))+"</span>"},renderHeader:function(){var b,c=this,d="",e="<colgroup>",g="",h=this.settings.columnGroups;if(h){var i=0;d+='<tr role="row" class="datagrid-header-groups">';for(var j=0;j<h.length;j++)i+=parseInt(h[j].colspan),b=c.uniqueId("-header-group-"+j),d+='<th colspan="'+h[j].colspan+'" id="'+b+'"><div class="datagrid-column-wrapper "><span class="datagrid-header-text">'+h[j].name+"</span></div></th>";i<this.visibleColumns().length&&(d+='<th colspan="'+(this.visibleColumns().length-i)+'"></th>'),d+="</tr><tr>"}else d+='<tr role="row">';for(var k=0;k<this.settings.columns.length;k++){var l=f.columns[k],m=c.uniqueId("-header-"+k),n=void 0===l.sortable||l.sortable,o=void 0===l.resizable||l.resizable,p="selectionCheckbox"===l.id,q="center"===l.align?" l-"+l.align+"-text":"";d+='<th scope="col" role="columnheader" class="'+(n?"is-sortable":"")+(o?" is-resizable":"")+(l.hidden?" is-hidden":"")+(l.filterType?" is-filterable":"")+(q||"")+'" id="'+m+'" data-column-id="'+l.id+'"'+(l.field?' data-field="'+l.field+'"':"")+(l.headerTooltip?'title="'+l.headerTooltip+'"':"")+(!1===l.reorderable?' data-reorder="false"':"")+(h?' headers="'+c.getColumnGroup(k)+'"':"")+">",d+='<div class="'+(p?"datagrid-checkbox-wrapper ":"datagrid-column-wrapper")+(void 0===l.align?"":" l-"+l.align+"-text")+'"><span class="datagrid-header-text'+(l.required?" required":"")+'">'+c.headerText(f.columns[k])+"</span>",g+="<col"+this.calculateColumnWidth(l,k)+(l.hidden?' class="is-hidden"':"")+">",p&&(d+='<span aria-checked="false" class="datagrid-checkbox" aria-label="Selection" role="checkbox"></span>'),n&&(d+='<div class="sort-indicator"><span class="sort-asc">'+a.createIcon({icon:"dropdown"})+'</span><span class="sort-desc">'+a.createIcon({icon:"dropdown"})+"</div>"),d+="</div></th>"}d+="</tr>",e+=g+"</colgroup>",void 0===c.headerRow?(c.headerContainer=a('<div class="datagrid-header"><table role="grid" '+this.headerTableWidth()+"></table></div>"),c.headerTable=c.headerContainer.find("table"),c.headerColGroup=a(e).appendTo(c.headerTable),c.headerRow=a("<thead>"+d+"</thead>").appendTo(c.headerContainer.find("table")),c.element.prepend(c.headerContainer)):(c.headerContainer.find("table").css("width",this.totalWidth),c.headerRow.html(d),c.headerColGroup.html(g)),this.settings.enableTooltips&&c.headerRow.find("th[title]").tooltip(),c.settings.columnReorder&&c.createDraggableColumns(),this.renderFilterRow(),this.restoreSortOrder&&(this.setSortIndicator(this.sortColumn.sortId,this.sortColumn.sortAsc),this.restoreSortOrder=!1),this.restoreFilter&&(this.applyFilter(this.savedFilter),this.restoreFilter=!1,this.savedFilter=null)},filterRowRendered:!1,renderFilterRow:function(){var b=this;if(this.settings.filterable){this.element.addClass("has-filterable-columns"),this.headerRow.find(".datagrid-filter-wrapper").remove();for(var c=0;c<this.settings.columns.length;c++)if(this.settings.columns[c].filterType){var d=this.settings.columns[c],e=b.uniqueId("-header-"+c),f=this.headerRow.find("#"+e),g=b.uniqueId("-header-filter-"+c),h='<div class="datagrid-filter-wrapper">'+this.renderFilterButton(d)+'<label class="audible" for="'+g+'">'+d.name+"</label>";switch(d.filterType){case"checkbox":break;case"date":h+="<input "+(d.filterDisabled?" disabled":"")+' type="text" class="datepicker" id="'+g+'"/>';break;case"decimal":h+="<input "+(d.filterDisabled?" disabled":"")+' type="text" id="'+g+'" data-mask-mode="number" data-mask="'+(d.mask?d.mask:"####.00")+'">';break;case"percent":d.maskOptions={showSymbol:"percent",pattern:d.mask||("decimal"===(d.name+"").toLowerCase()?"####.00":"")},h+="<input"+(d.filterDisabled?" disabled":"")+' type="text" id="'+g+'" data-mask-mode="number" data-mask="'+d.maskOptions.pattern+'"/>';break;case"contents":case"select":if(h+="<select "+(d.filterDisabled?" disabled":"")+("select"===d.filterType?' class="dropdown"':' multiple class="multiselect"')+'id="'+g+'">',d.options){"select"===d.filterType&&(h+="<option></option>");for(var i=0;i<d.options.length;i++){var j=d.options[i],k=d.caseInsensitive&&"string"==typeof j.value?j.value.toLowerCase():j.value;h+='<option value = "'+k+'">'+j.label+"</option>"}}h+="</select>";break;case"time":h+="<input "+(d.filterDisabled?" disabled":"")+' type="text" class="timepicker" id="'+g+'"/>';break;default:h+="<input"+(d.filterDisabled?" disabled":"")+' type="text" id="'+g+'"/>'}h+="</div>",f.find(".datagrid-column-wrapper").after(h),f.find(".datepicker").datepicker(d.editorOptions?d.editorOptions:{dateFormat:d.dateFormat}),f.find("select.dropdown").dropdown(d.editorOptions),f.find(".multiselect").multiselect(d.editorOptions),f.find("[data-mask]").mask(d.maskOptions),f.find(".timepicker").timepicker(d.editorOptions?d.editorOptions:{timeFormat:d.timeFormat})}var l={attachToBody:a("html").hasClass("ios"),offset:{y:15},placementOpts:{strategies:["flip","nudge"]}};this.headerRow.addClass("is-filterable"),this.headerRow.find(".btn-filter").popupmenu(l).on("selected.datagrid",function(){b.applyFilter()}),this.headerRow.off("keydown.datagrid").on("keydown.datagrid",".datagrid-filter-wrapper input",function(b){b.stopPropagation(),13===b.which&&(b.preventDefault(),a(this).trigger("change"))}).off("change.datagrid").on("change.datagrid",".datagrid-filter-wrapper input",function(){b.applyFilter()}),this.headerRow.find(".dropdown, .multiselect").on("selected.datagrid",function(){b.applyFilter()}),b.filterRowRendered=!0}},renderFilterItem:function(b,c,d){var e=a.createIcon({classes:"icon icon-filter",icon:"filter-"+b});return"<li "+(d?'class="is-checked"':"")+'><a href="#">'+e+"<span>"+Locale.translate(c)+"</span></a></li>"},renderFilterButton:function(b){var c=this,d=b.filterType,e=b.filterDisabled,f=a.isArray(b.filterConditions)?b.filterConditions:[],g=function(b,c){return c=c||f,a.inArray(b,c)>-1},h=function(a,b,d){return f.length&&!g(a)?"":c.renderFilterItem(a,b,d)},i='<button type="button" class="btn-menu btn-filter" data-init="false" '+(e?" disabled":"")+' type="button"><span class="audible">Filter</span>'+a.createIcon({icon:"dropdown",classes:"icon-dropdown"})+'</button><ul class="popupmenu has-icons is-translatable is-selectable">';return"contents"===d||"select"===d?"":("text"===d&&(i+=""+h("contains","Contains",!0)+h("does-not-contain","DoesNotContain",!1)),"checkbox"===d&&(i+=""+h("selected-notselected","All",!0)+h("selected","Selected")+h("not-selected","NotSelected")),"checkbox"!==d&&(i+=""+h("equals","Equals","integer"===d||"date"===d||"time"===d)+h("does-not-equal","DoesNotEqual")+h("is-empty","IsEmpty")+h("is-not-empty","IsNotEmpty")),
/\b(integer|decimal|date|time|percent)\b/g.test(d)&&(i+=""+h("less-than","LessThan")+h("less-equals","LessOrEquals")+h("greater-than","GreaterThan")+h("greater-equals","GreaterOrEquals")),"text"===d&&(i+=""+h("end-with","EndsWith")+h("does-not-end-with","DoesNotEndWith")+h("start-with","StartsWith")+h("does-not-start-with","DoesNotStartWith")),i+="</ul>")},toggleFilterRow:function(){this.settings.filterable?(this.headerRow.removeClass("is-filterable"),this.headerRow.find(".is-filterable").removeClass("is-filterable"),this.headerRow.find(".datagrid-filter-wrapper").hide(),this.settings.filterable=!1,this.filterRowRendered=!1,this.element.removeClass("has-filterable-columns")):(this.settings.filterable=!0,this.filterRowRendered||this.renderFilterRow(),this.element.addClass("has-filterable-columns"),this.headerRow.addClass("is-filterable"),this.headerRow.find(".is-filterable").addClass("is-filterable"),this.headerRow.find(".datagrid-filter-wrapper").show())},applyFilter:function(a){var b=this;this.filteredDataset=null,a?this.setFilterConditions(a):a=this.filterConditions();var c=function(c){for(var d=!0,e=0;e<a.length;e++){var f=b.columnById(a[e].columnId)[0],g=f.field,h=b.fieldValue(c,g),i=h.toString().toLowerCase(),j=a[e].value.toString().toLowerCase();if("percent"===f.filterType&&(j=(j/100).toString(),"decimal"===(f.name+"").toLowerCase()?(h=window.Formatters.Decimal(!1,!1,h,f),j=window.Formatters.Decimal(!1,!1,j,f)):"integer"===(f.name+"").toLowerCase()&&(h=window.Formatters.Integer(!1,!1,h,f),j=window.Formatters.Integer(!1,!1,j,f))),"text"===f.filterType){h=b.formatValue(f.formatter,e,a[e].columnId,h,f,c,b);var k=/(<([^>]+)>)|(&lt;([^>]+)&gt;)/gi;h=h.replace(k,"").toLowerCase(),i=h.toString().toLowerCase()}switch("contents"!==f.filterType&&"select"!==f.filterType||(h=h.toLowerCase()),"date"!==f.filterType&&"time"!==f.filterType||(j=Locale.parseDate(a[e].value,a[e].format),j&&("time"===f.filterType&&(j.setDate(1),j.setMonth(0),j.setYear(0)),j=j.getTime()),h instanceof Date?h=h.getTime():"string"==typeof h&&h&&(h=f.sourceFormat?Locale.parseDate(h,"string"==typeof f.sourceFormat?{pattern:f.sourceFormat}:f.sourceFormat):Locale.parseDate(h,{pattern:a[e].format}))&&("time"===f.filterType&&(h.setDate(1),h.setMonth(0),h.setYear(0)),h=h.getTime())),"number"==typeof h&&(h=parseFloat(h),j=parseFloat(j)),a[e].operator){case"equals":if(a[e].value instanceof Array){d=!1;for(var l=0;l<a[e].value.length;l++){a[e].value[l].toLowerCase().indexOf(h)>=0&&""!==h.toString()&&(d=!0)}}else d=h===j&&""!==h;break;case"does-not-equal":d=h!==j;break;case"contains":d=i.indexOf(j)>-1&&""!==h.toString();break;case"does-not-contain":d=-1===i.indexOf(j);break;case"end-with":d=i.lastIndexOf(j)===i.length-j.toString().length&&""!==i&&i.length>=j.toString().length;break;case"start-with":d=0===i.indexOf(j)&&""!==i;break;case"does-not-end-with":d=i.lastIndexOf(j)===i.length-j.toString().length&&""!==i&&i.length>=j.toString().length,d=!d;break;case"does-not-start-with":d=!(0===i.indexOf(j)&&""!==i);break;case"is-empty":d=""===h;break;case"is-not-empty":d=""!==h;break;case"less-than":d=h<j&&""!==h;break;case"less-equals":d=h<=j&&""!==h;break;case"greater-than":d=h>j&&""!==h;break;case"greater-equals":d=h>=j&&""!==h;break;case"selected":if(f&&f.isChecked){d=f.isChecked(h);break}d=("1"===i||"true"===i||!0===h||1===h)&&""!==i;break;case"not-selected":if(f&&f.isChecked){d=!f.isChecked(h);break}d=("0"===i||"false"===i||!1===h||0===h)&&""!==i;break;case"selected-notselected":d=!0}if(!d)return!1}return d};if(!this.settings.disableClientFilter){var d,e,f,g;if(this.settings.treeGrid)for(d=this.settings.treeDepth,f=0,g=d.length;f<g;f++)e=!c(d[f].node),d[f].node.isFiltered=e;else for(d=this.settings.dataset,f=0,g=d.length;f<g;f++)e=!c(d[f]),d[f].isFiltered=e}this.renderRows(),this.resetPager("filtered"),this.setSearchActivePage(),this.element.trigger("filtered",{op:"apply",conditions:a}),this.saveUserSettings()},clearFilter:function(){this.renderFilterRow(),this.applyFilter(),this.element.trigger("filtered",{op:"clear",conditions:[]})},setFilterConditions:function(a){for(var b=0;b<a.length;b++){var c=this.headerRow.find('th[data-column-id="'+a[b].columnId+'"]'),d=c.find("input, select"),e=c.find(".btn-filter");if(void 0===a[b].value&&(a[b].value=""),d.val(a[b].value),d.is("select")&&a[b].value instanceof Array){for(var f=0;f<a[b].value.length;f++)d.find('option[value="'+a[b].value[f]+'"]').prop("selected",!0);d.trigger("updated")}e.find("svg:first > use").attr("xlink:href","#icon-filter-"+a[b].operator)}},filterConditions:function(){if(this.filterExpr&&1===this.filterExpr.length&&this.filterExpr[0].keywordSearch)return delete this.filterExpr[0].keywordSearch,this.filterExpr;var b=this;return this.filterExpr=[],this.headerRow.find("th").each(function(){var c,d,e=a(this),f=e.find(".btn-filter"),g=e.find("input, select"),h=g.is("select"),i=f.find(".icon-dropdown:first");if((f.length||h)&&"selected-notselected"!==(c=h?"equals":i.getIconName().replace("filter-",""))&&!(""===g.val()&&-1===["is-not-empty","is-empty","selected","not-selected"].indexOf(c)||g.val()instanceof Array&&0===g.val().length)){var j={columnId:e.attr("data-column-id"),operator:c,value:g.val()?g.val():""};g.data("datepicker")&&(d=g.data("datepicker").settings.dateFormat,"locale"===d&&(d=Locale.calendar().dateFormat.short),j.format=d),g.data("timepicker")&&(d=g.data("timepicker").settings.timeFormat,j.format=d),b.filterExpr.push(j)}}),b.filterExpr},createDraggableColumns:function(){var b=this,c=b.headerNodes().not('[data-column-id="selectionCheckbox"]'),d=a(".drag-target-arrows",b.element);d.length||(b.element.prepend('<span class="drag-target-arrows"></span>'),d=a(".drag-target-arrows",b.element)),c.not('[data-reorder="false"]').prepend('</span><span class="handle">&#8286;</span>'),c.prepend('<span class="is-draggable-target"></span>'),c.last().append('<span class="is-draggable-target last"></span>'),b.element.addClass("has-draggable-columns"),a(".handle",c).each(function(){var e,f,g,h=a(this),i=h.parent();h.on("mousedown.datagrid",function(h){h.preventDefault(),i.drag({clone:!0,cloneAppendTo:c.first().parent().parent(),clonePosIsFixed:!0}).on("dragstart.datagrid",function(c,d,h){var j;e=h,e.removeAttr("id").addClass("is-dragging-clone").css({left:d.left,top:d.top}),a(".is-draggable-target",e).remove(),b.setDraggableColumnTargets(),f=i.position(),g={top:d.top-f.top,left:d.left-f.left},j=b.targetColumn(f),b.draggableStatus.startIndex=j,c.stopImmediatePropagation()}).on("drag.datagrid",function(h,i){e[0].style.left=parseInt(i.left)+"px",e[0].style.top=parseInt(i.top)+"px",f={top:i.top-g.top,left:i.left-g.left};var j,k,l,m,n,o=b.targetColumn(f);if(a(".is-draggable-target",c).add(d).removeClass("is-over"),-1!==o)for(j=0,k=b.draggableColumnTargets.length;j<k;j++)m=b.draggableColumnTargets[j],l=j+1,m.index===o&&m.index!==b.draggableStatus.startIndex&&(m.index>b.draggableStatus.startIndex&&l<k&&(m=b.draggableColumnTargets[l]),m.el.addClass("is-over"),d.addClass("is-over"),n=m.el[0].getBoundingClientRect(),d[0].style.left=parseInt(n.left)+"px",d[0].style.top=parseInt(n.top)+1+"px");h.stopImmediatePropagation()}).on("dragend.datagrid",function(h,j){e[0].style.left=parseInt(j.left)+"px",e[0].style.top=parseInt(j.top)+"px",f={top:j.top-g.top,left:j.left-g.left};var k,l,m,n,o=b.targetColumn(f),p=i.data("drag"),q=[];if(p&&p.destroy&&p.destroy(),b.draggableStatus.endIndex=o,a(".is-draggable-target",c).add(d).removeClass("is-over"),-1!==b.draggableStatus.endIndex&&b.draggableStatus.startIndex!==b.draggableStatus.endIndex){for(b.draggableColumnTargets[o],k=0,l=b.settings.columns.length;k<l;k++)b.settings.columns[k].hidden||"selectionCheckbox"===b.settings.columns[k].id||q.push(k);m=q[b.draggableStatus.startIndex]||0,n=q[b.draggableStatus.endIndex]||0,b.arrayIndexMove(b.settings.columns,m,n),b.updateColumns(b.settings.columns)}})})})},setDraggableColumnTargets:function(){var b,c,d,e=this,f=e.headerNodes().not(".is-hidden").not('[data-column-id="selectionCheckbox"]');e.draggableColumnTargets=[],e.draggableStatus={},a(".is-draggable-target.last",f.last()).length||f.last().append(a(".is-draggable-target.last",e.headerNodes())),a(".is-draggable-target",f).each(function(g){var h=a(this).is(".last")?g-1:g;b=f.eq(h),c=b.position(),d=20,e.draggableColumnTargets.push({el:a(this),index:h,pos:c,width:b.outerWidth(),height:b.outerHeight(),dropArea:{x1:c.left-d,x2:c.left+b.outerWidth()+d,y1:c.top-d,y2:c.top+b.outerHeight()+d}})})},targetColumn:function(a){var b,c,d,e=this,f=-1;for(c=0,d=e.draggableColumnTargets.length-1;c<d;c++)b=e.draggableColumnTargets[c],a.left>b.dropArea.x1&&a.left<b.dropArea.x2&&a.top>b.dropArea.y1&&a.top<b.dropArea.y2&&(f=b.index);return f},arrayIndexMove:function(a,b,c){a.splice(c,0,a.splice(b,1)[0])},createDraggableRows:function(){var a=this;this.settings.rowReorder&&this.tableBody.arrange({placeholder:'<tr class="datagrid-reorder-placeholder"><td colspan="'+this.visibleColumns().length+'"></td></tr>',handle:".datagrid-reorder-icon"}).on("beforearrange.datagrid",function(b,c){a.isSafari&&c.start.css({display:"inline-block"})}).on("arrangeupdate.datagrid",function(b,c){a.isSafari&&c.end.css({display:""}),a.settings.dataset.splice(c.endIndex,0,a.settings.dataset.splice(c.startIndex,1)[0]),a.element.trigger("rowreorder",[c])})},fieldValue:function(b,c){if(!c||!b)return"";if(c.indexOf(".")>-1)return c.split(".").reduce(function(a,b){return a?a[b]:""},b);var d=b[c],e=d||0===d||!1===d?d:"";return e=a.escapeHTML(e)},setTreeRootNodes:function(){this.settings.treeRootNodes=this.settings.treeDepth.filter(function(a){return 1===a.depth})},setTreeDepth:function(a){var b=this,c=0,d=function(a,e){c++,b.settings.treeDepth.push({idx:c,depth:e,node:a});for(var f=a.children||[],g=0,h=f.length;g<h;g++)d(f[g],e+1)};a=a||this.settings.dataset,b.settings.treeDepth=[];for(var e=0,f=a.length;e<f;e++)d(a[e],1)},setRowGrouping:function(){var a=this.settings.groupable;if(a)return this.originalDataset=this.settings.dataset.slice(),"sum"===a.aggregator?void(this.settings.dataset=GroupBy.sum(this.settings.dataset,a.fields,a.aggregate)):"max"===a.aggregator?void(this.settings.dataset=GroupBy.max(this.settings.dataset,a.fields,a.aggregate)):"list"===a.aggregator?void(this.settings.dataset=GroupBy.list(this.settings.dataset,a.fields,a.aggregatorOptions)):void(this.settings.dataset=window.GroupBy(this.settings.dataset,a.fields))},renderRows:function(){var b,c="",d=this,e=d.settings,f=d.pager?d.pager.activePage:1,g=e.pagesize,h=e.dataset,i=d.table.find("tbody");for(d.bodyColGroupHtml="<colgroup>",0===i.length&&(d.tableBody=a("<tbody></tbody>"),d.table.append(d.tableBody)),d.recordCount=0,d.filteredCount=0,e.treeGrid&&e.paging&&!e.source&&f>1&&(d.recordCount=e.treeRootNodes[g*f-g].idx-1),this.restoreSortOrder&&this.sortDataset(),b=0;b<h.length;b++){if(e.paging&&!e.source){if(1===f&&b-this.filteredCount>=g){h[b].isFiltered||this.recordCount++;continue}if(f>1&&!(b-this.filteredCount>=g*(f-1)&&b-this.filteredCount<g*f)){h[b].isFiltered?this.filteredCount++:this.filteredCount&&this.recordCount++;continue}}if(!e.virtualized||this.isRowVisible(this.recordCount))if((e.treeGrid?e.treeRootNodes[b].node:h[b]).isFiltered)this.filteredCount++;else if(this.settings.groupable){if(this.settings.groupable.suppressGroupRow||(c+=d.rowHtml(h[b],this.recordCount,b,!0)),this.settings.groupable.showOnlyGroupRow&&h[b].values[0]){var j=h[b].values[0];h[b].list&&(j.list=h[b].list),j.values=h[b].values,c+=d.rowHtml(j,this.recordCount,b),this.recordCount++;continue}for(var k=0;k<h[b].values.length;k++)c+=d.rowHtml(h[b].values[k],this.recordCount,b),this.recordCount++;this.settings.groupable.groupFooterRow&&(c+=d.rowHtml(h[b],this.recordCount,b,!0,!0))}else c+=d.rowHtml(h[b],e.treeGrid?this.recordCount:b,b),this.recordCount++;else this.recordCount++}this.settings.summaryRow&&(c+=d.rowHtml(d.calculateTotals(),this.recordCount,null,!1,!0)),"<colgroup>"!==d.bodyColGroupHtml&&(d.bodyColGroupHtml+="</colgroup>",d.bodyColGroup&&d.bodyColGroup.remove(),d.bodyColGroup=a(d.bodyColGroupHtml),d.tableBody.before(d.bodyColGroup)),d.tableBody.html(c),d.setVirtualHeight(),d.setScrollClass(),d.setupTooltips(),d.afterRender()},afterRender:function(){var b=this;b.tableBody.find("select.dropdown").dropdown(),b.tableBody.find(".dropdown-wrapper.is-inline").prev("select").on("listclosed",function(){var c=a(this),d=c.val(),e=c.closest("tr");b.updateCellNode(e.attr("aria-rowindex"),c.closest("td").index(),d,!1,!0)}),b.tableBody.find(".spinbox").spinbox(),setTimeout(function(){b.settings.source||b.displayCounts(),b.setAlternateRowShading(),b.createDraggableRows(),b.activeCell&&b.activeCell.node||(b.activeCell={node:b.cellNode(0,0,!0).attr("tabindex","0"),isFocused:!1,cell:0,row:0}),b.activeCell.isFocused&&b.setActiveCell(b.activeCell.row,b.activeCell.cell),b.settings.paging&&b.settings.source&&(b.updateSelected(),b.syncSelectedUI()),b.element.trigger("afterrender",{body:b.tableBody,header:b.headerRow,pager:b.pagerBar})},0)},cacheVirtualStats:function(){var a=this.element[0].offsetHeight,b=this.contentContainer[0].scrollTop,c="normal"===this.settings.rowHeight?40:"medium"===this.settings.rowHeight?30:25,d=a-c,e="normal"===this.settings.rowHeight?50:"medium"===this.settings.rowHeight?40:30;this.virtualRange={rowHeight:e,top:Math.max(b-(this.settings.virtualRowBuffer-1)*e,0),bottom:b+d+(this.settings.virtualRowBuffer-1)*e,totalHeight:e*this.settings.dataset.length,bodyHeight:d}},isRowVisible:function(a){if(!this.settings.virtualized)return!0;0===a&&this.cacheVirtualStats();var b=a*this.virtualRange.rowHeight;return b>=this.virtualRange.top&&b<this.virtualRange.bottom},setVirtualHeight:function(){if(this.settings.virtualized&&this.virtualRange){var b=this.virtualRange.totalHeight-this.virtualRange.bottom,c=this.virtualRange.top;this.topSpacer=this.tableBody.find(".datagrid-virtual-row-top"),this.bottomSpacer=this.tableBody.find(".datagrid-virtual-row-bottom"),c>0&&!this.topSpacer.length&&(this.topSpacer=a('<tr class="datagrid-virtual-row-top" style="height: '+c+'px"><td colspan="'+this.visibleColumns().length+'"></td></tr>'),this.tableBody.prepend(this.topSpacer)),c>0&&this.topSpacer.length&&this.topSpacer.css("height",c+"px"),(0===c&&this.topSpacer.length||this.virtualRange.topRow<=1)&&this.topSpacer.remove(),b>0&&!this.bottomSpacer.length&&(this.bottomSpacer=a('<tr class="datagrid-virtual-row-bottom" style="height: '+b+'px"><td colspan="'+this.visibleColumns().length+'"></td></tr>'),this.tableBody.append(this.bottomSpacer)),b>0&&this.bottomSpacer.length&&this.bottomSpacer.css("height",b+"px"),(b<=0&&this.bottomSpacer.length||this.virtualRange.bottomRow>=this.settings.dataset.length)&&this.bottomSpacer.remove()}},setAlternateRowShading:function(){this.settings.alternateRowShading&&this.settings.treeGrid&&a('tr[role="row"]:visible',this.tableBody).removeClass("alt-shading").filter(":odd").addClass("alt-shading")},formatValue:function(a,b,c,d,e,f,g){return g=g||this,void 0===a&&(a=this.defaultFormatter),"string"==typeof a?window.Formatters[a](b,c,d,e,f,g).toString():a(b,c,d,e,f,g).toString()},recordCount:0,rowHtml:function(a,b,c,d,e){var f,g,h,i,j,k=!1,l=this,m=this.settings.summaryRow&&!d&&e,n=l.pager?l.pager.activePage:1,o=l.settings.pagesize,p="",q=l.settings.treeDepth[b];if(!a)return"";for(q=q?q.depth:0,f=q,h=b;h>=0&&q>1&&!j;h--)g=l.settings.treeDepth[h],q!==g.depth&&q>g.depth&&(q=g.depth,j=!g.node.expanded);if(this.settings.groupable){var r=this.settings.groupable;j=void 0!==r.expanded&&!r.expanded,r.expanded&&"function"==typeof r.expanded&&(j=!r.expanded(b,0,null,null,a,this))}if(this.settings.groupable&&d&&!e)return p='<tr class="datagrid-rowgroup-header '+(j?"":"is-expanded")+'" role="rowgroup"><td role="gridcell" colspan="'+this.visibleColumns().length+'">'+Formatters.GroupRow(b,0,null,null,a,this)+"</td></tr>";if(this.settings.groupable&&d&&e)return p='<tr class="datagrid-row datagrid-rowgroup-footer '+(j?"":"is-expanded")+'" role="rowgroup">'+Formatters.GroupFooterRow(b,0,null,null,a,this)+"</tr>";var s=b+1+(l.settings.source?(n-1)*o:0);k=this.recordCount%2==0,p='<tr role="row" aria-rowindex="'+s+'" data-index="'+c+'"'+(l.settings.treeGrid&&a.children?' aria-expanded="'+(a.expanded?'true"':'false"'):"")+(l.settings.treeGrid?' aria-level= "'+f+'"':"")+' class="datagrid-row'+(j?" is-hidden":"")+(l.settings.alternateRowShading&&!k?" alt-shading":"")+(m?" datagrid-summary-row":"")+(l.settings.cellNavigation?"":" is-clickable")+(l.settings.treeGrid?a.children?" datagrid-tree-parent":f>1?" datagrid-tree-child":"":"")+'">';for(var t=0;t<l.settings.columns.length;t++){var u=l.settings.columns[t],v="",w=m?u.summaryRowFormatter||u.formatter||l.defaultFormatter:u.formatter||l.defaultFormatter,x=l.formatValue(w,b,t,l.fieldValue(a,l.settings.columns[t].field),l.settings.columns[t],a,l);if(0===x.indexOf('<span class="is-readonly">')&&(u.readonly=!0),(x.indexOf("datagrid-checkbox")>-1||x.indexOf("btn-actions")>-1)&&(v+=" l-center-text"),x.indexOf("trigger")>-1&&(v+=" datagrid-trigger-cell"),u.expanded&&(l.treeExpansionField=u.expanded),u.align&&(v+=" l-"+u.align+"-text"),"ellipsis"===u.textOverflow&&(v+=" text-ellipsis"),v+=u.readonly?" is-readonly":"",v+=u.hidden?" is-hidden":"",u.isEditable&&!u.readonly){u.isEditable(s-1,t,l.fieldValue(a,l.settings.columns[t].field),u,a)||(v+=" is-readonly")}var y="selectionCheckbox"===u.id||!u.readonly&&void 0!==u.editor?"":'aria-readonly="true"';if(u.isReadonly&&!u.readonly&&"selectionCheckbox"!==u.id){u.isReadonly(this.recordCount,t,l.fieldValue(a,l.settings.columns[t].field),u,a)&&(v+=" is-cell-readonly",y='aria-readonly="true"')}var z=l.fieldValue(a,l.settings.columns[t].field);u.cssClass&&"function"==typeof u.cssClass&&(v+=" "+u.cssClass(this.recordCount,t,z,u,a)),u.cssClass&&"string"==typeof u.cssClass&&(v+=" "+u.cssClass),v+=u.focusable?" is-focusable":"";var A=this.calculateRowspan(z,b,u);if(""!==A){var B="";if(0!==this.recordCount&&this.recordCount-(n-1)*o!=0||(B=this.calculateColumnWidth(u,t),l.bodyColGroupHtml+="<col"+B+(u.hidden?' class="is-hidden"':"")+"></col>"),p+='<td role="gridcell" '+y+' aria-colindex="'+(t+1)+'"  aria-describedby="'+l.uniqueId("-header-"+t)+'"'+(v?' class="'+v+'"':"")+(u.tooltip&&"string"==typeof u.tooltip?' title="'+u.tooltip.replace("{{value}}",z)+'"':"")+("rowStatus"===u.id&&a.rowStatus&&a.rowStatus.tooltip?' title="'+a.rowStatus.tooltip+'"':"")+(l.settings.columnGroups?'headers = "'+l.uniqueId("-header-"+t)+" "+l.getColumnGroup(t)+'"':"")+(A||"")+'><div class="datagrid-cell-wrapper">',u.contentVisible){u.contentVisible(b+1,t,z,u,a)||(x="")}p+=x+"</div></td>"}}if(p+="</tr>",l.settings.rowTemplate){var C=l.settings.rowTemplate,D=a,E="";if(H&&D){E=H.compile("{{#dataset}}"+C+"{{/dataset}}").render({dataset:D})}p+='<tr class="datagrid-expandable-row"><td colspan="'+this.visibleColumns().length+'"><div class="datagrid-row-detail"><div class="datagrid-row-detail-padding">'+E+"</div></div></td></tr>"}if(l.settings.expandableRow&&(p+='<tr class="datagrid-expandable-row"><td colspan="'+this.visibleColumns().length+'"><div class="datagrid-row-detail"><div class="datagrid-row-detail-padding"></div></div></td></tr>'),a.children)for(h=0,i=a.children.length;h<i;h++)this.recordCount++,p+=l.rowHtml(a.children[h],this.recordCount,h);return p},canvas:null,totalWidth:0,calculateTextWidth:function(a){for(var b=0,c=this,d=a.field,e="",f=a.name||"",g=!1,h=0;h<this.settings.dataset.length;h++){var i=this.fieldValue(this.settings.dataset[h],d),j=0;i=c.formatValue(a.formatter,h,null,i,a,this.settings.dataset[h],c),i=i.replace(/<\/?[^>]+(>|$)/g,""),j=i.toString().length,j>b&&(b=j,e=i)}f.length>b&&(b=f.length,e=f,g=!0),""!==e&&0!==this.settings.dataset.length||(e=a.name||" Default ",g=!0),this.canvas=this.canvas||(this.canvas=document.createElement("canvas"));var k=this.canvas.getContext("2d");k.font="14px arial";var l=k.measureText(e);return Math.round(l.width+(g?60:52))},headerWidths:[],headerTableWidth:function(){var a=this.headerWidths[this.settings.columns.length-1];return a?(this.setScrollClass(),a.widthPercent?'style = "width: 100%"':isNaN(this.totalWidth)?"":'style = "width: '+parseFloat(this.totalWidth)+'px"'):""},setScrollClass:function(){var a=parseInt(this.contentContainer[0].offsetHeight),b=parseInt(this.contentContainer[0].scrollHeight)>a+2;this.element.removeClass("has-vertical-scroll has-less-rows"),b&&this.element.addClass("has-vertical-scroll"),!b&&this.tableBody[0].offsetHeight<a&&this.element.addClass("has-less-rows")},clearHeaderCache:function(){this.headerWidths=[],this.totalWidth=0,this.elemWidth=0},calculateColumnWidth:function(a,b){var c,d;c=this.visibleColumns(!0);var e=b===this.lastColumnIdx();if(e&&a.isStretched&&(a.width=null),this.elemWidth||(this.elemWidth=this.element.outerWidth(),0===this.elemWidth&&(this.elemWidth=this.element.closest(".tab-container").outerWidth()),this.elemWidth&&0!==this.elemWidth||(this.elemWidth=this.element.closest(".modal-contents").outerWidth()),this.widthSpecified=!1,this.widthPixel=!1),this.headerWidths[b]){var f=this.headerWidths[b];return"default"===f.width?"":this.widthSpecified&&!f.width?"":' style="width: '+f.width+(f.widthPercent?"%":"px")+'"'}a.width&&(this.widthSpecified=!0,this.widthPercent=!1),!this.widthPixel&&a.width&&(this.widthPixel="string"!=typeof a.width);var g=a.width;"string"==typeof a.width&&-1===a.width.indexOf("px")&&(this.widthPercent=!0,d=a.width.replace("%",""));var h=this.calculateTextWidth(a);if(this.widthSpecified&&g||(g=Math.max(h,g||0)),e=b===this.lastColumnIdx()&&this.totalWidth!==g,(!this.widthSpecified||void 0===a.width)&&this.settings.sizeColumnsEqually&&-1===["selectionCheckbox","expander","drilldown","rowStatus","favorite"].indexOf(a.id)){var i=Math.round(this.elemWidth/c.length);g=i-(e?2:0),i<h&&(g=h)}if("selectionCheckbox"!==a.id&&"favorite"!==a.id||(g=43,a.width=g),"expander"===a.id&&(g=55,a.width=g),"rowStatus"===a.id&&(g=62,a.width=g),"drilldown"===a.id&&(g=78,a.width=g),this.headerWidths[b]={id:a.id,width:this.widthPercent?d:g,widthPercent:this.widthPercent},this.totalWidth+=a.hidden||e?0:g,e){var j=this.elemWidth-this.totalWidth;j>0&&j>g&&!this.widthPercent&&(g=j-(this.isIe?19:2),this.headerWidths[b]={id:a.id,width:g,widthPercent:this.widthPercent},a.width=g,a.isStretched=!0,this.totalWidth=this.elemWidth-(this.isIe?19:2)),this.widthPercent?this.table.css("width","100%"):isNaN(this.totalWidth)||this.table.css("width",this.totalWidth)}return this.widthPercent||g?' style="width: '+(this.widthPercent?d+"%":g+"px")+'"':""},widthPercent:!1,rowSpans:[],calculateRowspan:function(a,b,c){var d=0,e=null;if(c.rowspan){for(var f=0;f<this.settings.dataset.length;f++)a===this.settings.dataset[f][c.field]&&(d++,null===e&&(e=f));return b===e?' rowspan ="'+d+'"':""}},calculateTotals:function(){return this.settings.totals=Aggregators.aggregate(this.settings.dataset,this.settings.columns),this.settings.totals},setUnit:function(a){return a+(/(px|%)/i.test(a+"")?"":"px")},setupContentTooltip:function(a,b,c){if(a.text().length>0){var d=a.clone();a.tooltip({content:d,extraClass:"alternate content-tooltip",placementOpts:{parent:a,parentXAlignment:"center",strategies:["flip","nudge","shrink"]}}),b?d[0].style.width=b:a.on("beforeshow.datagrid",function(){a.off("beforeshow.datagrid"),d[0].style.width=c[0].offsetWidth+"px"})}},setupTooltips:function(){if(this.settings.enableTooltips){var b=this;this.tableBody.find("td[title]").tooltip({placement:"left",offset:{left:-5,top:0}}),this.tableBody.find("a[title]").tooltip(),this.table.find("td.text-ellipsis").tooltip({content:function(){var b=a(this),c=b.text(),d=b.children(".datagrid-cell-wrapper");if(b[0]&&d[0]&&d[0].offsetWidth<d[0].scrollWidth&&b.data("tooltip")){var e=d.width();return b.data("tooltip").settings.maxWidth=e,c}return""}}),this.table.find("td .is-editor.content-tooltip").each(function(){var c=a(this),d=c.closest("td"),e=d.attr("aria-colindex")-1,f=b.columnSettings(e),g=!(!f.editorOptions||!f.editorOptions.width)&&b.setUnit(f.editorOptions.width);b.setupContentTooltip(c,g,d)})}},headerNodes:function(){return this.headerRow.find("tr:not(.datagrid-header-groups) th")},updateRow:function(a,b){for(var c=b||this.settings.dataset[a],d=0;d<this.settings.columns.length;d++){var e=this.settings.columns[d];e.hidden||(e.id&&["selectionCheckbox","expander"].indexOf(e.id)>-1||this.updateCellNode(a,d,this.fieldValue(c,e.field),!0))}},updateColumns:function(a,b){this.settings.columns=a,b&&(this.settings.columnGroups=b),this.clearHeaderCache(),this.renderRows(),this.renderHeader(),this.resetPager("updatecolumns"),this.element.trigger("columnchange",[{type:"updatecolumns",columns:this.settings.columns}]),this.saveColumns(),this.saveUserSettings()},saveColumns:function(){this.settings.saveColumns&&this.canUseLocalStorage()&&(localStorage[this.uniqueId("columns")]=JSON.stringify(this.settings.columns))},saveUserSettings:function(){this.element.trigger("settingschanged",[{rowHeight:this.settings.rowHeight,columns:this.settings.columns,sortOrder:this.sortColumn,pagesize:this.settings.pagesize,showPageSizeSelector:this.settings.showPageSizeSelector,activePage:this.pager?this.pager.activePage:1,filter:this.filterConditions()}]);var b=this.settings.saveUserSettings;!a.isEmptyObject(b)&&this.canUseLocalStorage()&&(b.columns&&(localStorage[this.uniqueId("usersettings-columns")]=JSON.stringify(this.settings.columns)),b.rowHeight&&(localStorage[this.uniqueId("usersettings-row-height")]=this.settings.rowHeight),b.sortOrder&&(localStorage[this.uniqueId("usersettings-sort-order")]=JSON.stringify(this.sortColumn)),b.pagesize&&(localStorage[this.uniqueId("usersettings-pagesize")]=this.settings.pagesize),b.showPageSizeSelector&&(localStorage[this.uniqueId("usersettings-show-pagesize-selector")]=this.settings.showPageSizeSelector),b.activePage&&this.pager&&(localStorage[this.uniqueId("usersettings-active-page")]=this.pager.activePage),b.filter&&(localStorage[this.uniqueId("usersettings-filter")]=JSON.stringify(this.filterConditions())))},canUseLocalStorage:function(){try{if(localStorage.getItem)return!0}catch(a){return!1}},columnsFromString:function(b){if(b){var c=this,d=JSON.parse(b);if(!d)return[];for(var e=0;e<d.length;e++){var f,g=c.columnById(d[e].id);g&&(g=g[0],f=d[e].hidden,a.extend(d[e],g),void 0!==f&&(d[e].hidden=f))}return d}},restoreColumns:function(a){if(this.settings.saveColumns&&this.canUseLocalStorage()){if(a)return void this.updateColumns(a);var b=localStorage[this.uniqueId("columns")];return!a&&b?(this.originalColumns=this.settings.columns,void(this.settings.columns=this.columnsFromString(b))):void 0}},restoreUserSettings:function(b){var c=this.settings.saveUserSettings;if(b||!a.isEmptyObject(c)&&this.canUseLocalStorage()){if(b)return b.columns&&this.updateColumns(b.columns),b.rowHeight&&this.rowHeight(b.rowHeight),b.sortOrder&&this.setSortColumn(b.sortOrder.sortId,b.sortOrder.sortAsc),b.pagesize&&(this.settings.pagesize=parseInt(b.pagesize),this.pager.settings.pagesize=parseInt(b.pagesize),this.pager.setActivePage(1,!0)),b.showPageSizeSelector&&(this.settings.showPageSizeSelector=b.showPageSizeSelector,this.pager.showPageSizeSelector(b.showPageSizeSelector)),b.activePage&&this.pager.setActivePage(parseInt(b.activePage),!0),void(b.filter&&this.applyFilter(b.filter));if(c.columns){var d=localStorage[this.uniqueId("usersettings-columns")];this.originalColumns=this.settings.columns,d&&(this.settings.columns=this.columnsFromString(d))}if(c.rowHeight){var e=localStorage[this.uniqueId("usersettings-row-height")];e&&(this.settings.rowHeight=e)}if(c.sortOrder){var f=localStorage[this.uniqueId("usersettings-sort-order")];f&&(this.sortColumn=JSON.parse(f),this.restoreSortOrder=!0)}if(c.pagesize){var g=localStorage[this.uniqueId("usersettings-pagesize")];g&&(this.settings.pagesize=parseInt(g))}if(c.showPageSizeSelector){var h=localStorage[this.uniqueId("usersettings-show-pagesize-selector")];h="true"===(h+"").toLowerCase(),h&&(this.settings.showPageSizeSelector=h)}if(c.activePage){var i=localStorage[this.uniqueId("usersettings-active-page")];i&&(this.savedActivePage=parseInt(i),this.restoreActivePage=!0)}if(c.filter){var j=localStorage[this.uniqueId("usersettings-filter")];j&&(this.savedFilter=JSON.parse(j),this.restoreFilter=!0)}}},resetColumns:function(){this.canUseLocalStorage()&&(localStorage.removeItem(this.uniqueId("columns")),localStorage[this.uniqueId("columns")]=""),this.originalColumns&&(this.updateColumns(this.originalColumns),this.originalColumns=this.columnsFromString(JSON.stringify(this.settings.columns)))},hideColumn:function(a){var b=this.columnIdxById(a);-1!==b&&(this.settings.columns[b].hidden=!0,this.headerRow.find("th").eq(b).addClass("is-hidden"),this.tableBody.find("td:nth-child("+(b+1)+")").addClass("is-hidden"),this.headerColGroup.find("col").eq(b).addClass("is-hidden"),this.bodyColGroup&&this.bodyColGroup.find("col").eq(b).addClass("is-hidden"),this.element.trigger("columnchange",[{type:"hidecolumn",index:b,columns:this.settings.columns}]),this.saveColumns(),this.saveUserSettings())},showColumn:function(a){var b=this.columnIdxById(a);-1!==b&&(this.settings.columns[b].hidden=!1,this.headerRow.find("th").eq(b).removeClass("is-hidden"),this.tableBody.find("td:nth-child("+(b+1)+")").removeClass("is-hidden"),this.headerColGroup.find("col").eq(b).removeClass("is-hidden"),this.bodyColGroup&&this.bodyColGroup.find("col").eq(b).removeClass("is-hidden"),this.element.trigger("columnchange",[{type:"showcolumn",index:b,columns:this.settings.columns}]),this.saveColumns(),this.saveUserSettings())},exportToExcel:function(b,c,d){var e=this,f='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:Panes></x:Panes><x:DisplayGridlines></x:DisplayGridlines></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table border="1px solid #999999">{table}</table></body></html>',g=function(a,b){return a.replace(/{(\w+)}/g,function(a,c){return b[c]})},h=e.table.clone();h=function(a,b){for(var c,d=b.find("tbody").empty(),f=0;f<a.length;f++)a[f].isFiltered||(c+=e.rowHtml(a[f],f,f));return d.append(c),b}(d||this.settings.dataset,h),h.find("thead").length||e.headerRow.clone().insertBefore(h.find("tbody")),h=function(b){return a("tr, th, td, div, span",b).each(function(){var b=this,c=a(this);if(c.is(".is-hidden"))return void c.remove();for(a(".is-hidden, .is-draggable-target, .handle, .sort-indicator, .datagrid-filter-wrapper",b).remove();b.attributes.length>0;)b.removeAttribute(b.attributes[0].name);var d=c.text();"="===d.substr(0,1)&&""!==d.substr(1,1)&&c.text("'"+c.text())}),b}(h);var i={worksheet:c||"Worksheet",table:h.html()};if(b=(b||e.element.closest(".datagrid-container").attr("id")||"datagrid")+".xls",this.isIe){if(this.isIe9){var j=window.open();j.document.write("sep=,\r\n"+g(f,i)),j.document.close(),j.document.execCommand("SaveAs",!0,b),j.close()}else if(window.navigator.msSaveBlob){var k=new Blob([g(f,i)],{type:"application/csv;charset=utf-8;"});navigator.msSaveBlob(k,b)}}else{var l=document.createElement("a");l.href=function(a){return window.btoa?"data:application/vnd.ms-excel;base64,"+window.btoa(unescape(encodeURIComponent(a))):"data:application/vnd.ms-excel;,"+unescape(encodeURIComponent(a))}(g(f,i)),l.download=b,document.body.appendChild(l),l.click(),document.body.removeChild(l)}},personalizeColumns:function(){var b=this,c='<div class="listview-search alternate-bg"><label class="audible" for="gridfilter">Search</label><input class="searchfield" placeholder="'+Locale.translate("SearchColumnName")+'" name="searchfield" id="gridfilter"></div>';c+='<div class="listview alternate-bg" id="search-listview"><ul>'
;for(var d=0;d<this.settings.columns.length;d++){var e=this.settings.columns[d],f=e.name;f&&(f=f.replace("<br>"," ").replace("<br/>"," ").replace("<br />"," "),c+='<li><a href="#" target="_self" tabindex="-1"> <label class="inline"><input tabindex="-1" '+(!1===e.hideable?"disabled":"")+' type="checkbox" class="checkbox" '+(e.hidden?"":" checked")+' data-column-id="'+(e.id||d)+'"><span class="label-text">'+f+"</span></label></a></li>")}c+="</ul></div>",a("body").modal({title:Locale.translate("PersonalizeColumns"),content:c,cssClass:"full-width datagrid-columns-dialog",buttons:[{text:Locale.translate("Close"),click:function(b,c){c.close(),a("body").off("open.datagrid")}}]}).on("beforeopen.datagrid",function(){b.isColumnsChanged=!1}).on("open.datagrid",function(a,c){c.element.find(".searchfield").searchfield({clearable:!0}),c.element.find(".listview").listview({searchable:!0,selectOnFocus:!1}).on("selected",function(a,c){var d=c.elem.find(".checkbox"),e=d.attr("data-column-id"),f=d.prop("checked");c.elem.removeClass("is-selected hide-selected-color"),d.is(":disabled")||(b.isColumnsChanged=!0,f?(b.hideColumn(e),d.prop("checked",!1)):(b.showColumn(e),d.prop("checked",!0)))}),c.element.on("close.datagrid",function(){b.isColumnsChanged=!1})})},setColumnWidth:function(b,c,d){var e=this,f=parseFloat(c),g=b,h=this.columnById("string"==typeof b?b:b.attr("data-column-id"));if(f&&("string"==typeof b&&e.headerNodes().each(function(){var c=a(this);c.attr("data-column-id")===b&&(g=c)}),!(h.minWidth&&c>parseInt(h.minWidth)||("number"!=typeof c&&(c=f/100*e.element.width()),Math.abs(c-h[0].width)<2)))){h[0]&&(h[0].width=c);var i=g.index();e.headerColGroup.find("col").eq(i)[0].style.width=c+"px",e.settings.dataset.length>0&&(e.bodyColGroup.find("col").eq(i)[0].style.width=c+"px"),e.tableWidth&&d&&(e.headerTable.css("width",parseInt(e.tableWidth)+d),e.table.css("width",parseInt(e.tableWidth)+d)),this.element.trigger("columnchange",[{type:"resizecolumn",index:i,columns:this.settings.columns}]),this.saveColumns(),this.saveUserSettings(),this.clearHeaderCache()}},createResizeHandle:function(){var b=this;if(!this.resizeHandle){this.resizeHandle=a('<div class="resize-handle" aria-hidden="true"></div>'),this.settings.columnGroups&&(this.resizeHandle[0].style.height="80px"),this.settings.filterable&&(this.resizeHandle[0].style.height="62px"),this.headerContainer.find("table").before(this.resizeHandle);var c,d,e,f;this.resizeHandle.drag({axis:"x",containment:"parent"}).on("dragstart.datagrid",function(){b.currentHeader&&(b.dragging=!0,c=b.currentHeader.attr("data-column-id"),f=b.columnById(c)[0],d=b.currentHeader.position().left+b.table.scrollLeft()-10,b.tableWidth=b.table[0].offsetWidth,e=b.currentHeader[0].offsetWidth)}).on("drag.datagrid",function(a,c){if(b.currentHeader){var g=c.left-d-1,h=f.minWidth||12,i=f.maxWidth||1e3;if(g<h||g>i)return void b.resizeHandle.css("cursor","inherit");g=Math.round(g),b.setColumnWidth(b.currentHeader,g,g-e)}}).on("dragend.datagrid",function(){b.dragging=!1})}},displayCounts:function(a){var b=this,c=b.tableBody.find("tr:visible").length;if((b.settings.paging&&!b.settings.source||!a&&!b.settings.paging)&&(c=b.recordCount),b.contextualToolbar&&b.contextualToolbar.length&&b.contextualToolbar.find(".selection-count").text(b._selectedRows.length+" "+Locale.translate("Selected")),!b.settings.source||a){a&&-1!==a&&(c=a);var d="("+c+" "+Locale.translate(1===c?"Result":"Results")+")";b.settings.resultsText&&(d="function"==typeof b.settings.resultsText?b.settings.resultsText(b,c):b.settings.resultsText),b.toolbar&&(b.toolbar.find(".datagrid-result-count").html(d),b.toolbar.attr("aria-label",b.toolbar.find(".title").text()),b.toolbar.find(".datagrid-row-count").text(c)),b.element.closest(".modal").find(".datagrid-result-count").html(d)}},triggerRowEvent:function(b,c,d){var e=this,f=a(c.target).closest("td").index(),g=a(c.target).closest("tr").index(),h=e.settings.dataset[g];return a(c.target).is("a")&&(d=!1),d&&(c.stopPropagation(),c.preventDefault()),e.element.trigger(b,[{row:g,cell:f,item:h,originalEvent:c}]),!1},cellNode:function(b,c,d){var e,f=this.tableBody.find('tr:not(.datagrid-expandable-row)[aria-rowindex="'+(b+1)+'"]');return b instanceof jQuery&&(f=b),d&&this.settings.groupable&&(f=this.tableBody.prevAll(".datagrid-rowgroup-header").eq(b))&&(f=this.tableBody.find(".datagrid-rowgroup-header").eq(b)),-1===c?a():(e=f.find("td"),e.eq(c>=e.length?e.length-1:c))},scrollLeft:0,scrollTop:0,handleScroll:function(){var a=this.contentContainer[0].scrollLeft;a!==this.scrollLeft&&this.headerContainer&&(this.scrollLeft=a,this.headerContainer[0].scrollLeft=this.scrollLeft)},handleResize:function(){var a=this;a.clearHeaderCache(),a.renderRows(),a.renderHeader()},handleEvents:function(){var b=this,c="multiple"===this.settings.selectable,d="mixed"===this.settings.selectable;if(!b.settings.cellNavigation&&b.settings.rowNavigation&&b.table.on("focus.datagrid","tbody > tr",function(){a(this).addClass("is-active-row")}).on("blur.datagrid","tbody > tr",function(){a("tbody > tr",b.table).removeClass("is-active-row")}),b.contentContainer.on("scroll.table",function(){b.handleScroll()}),this.settings.virtualized){var e=0,f=0;b.contentContainer.on("scroll.vtable",Soho.utils.debounce(function(){var a=this.scrollTop,c=a>b.virtualRange.bottom-b.virtualRange.bodyHeight-25,d=a<b.virtualRange.top+25;if(a!==e&&(d||c))return e=this.scrollTop,void b.renderRows()},0)),a("body").on("resize.vtable",function(){this.offsetHeight!==f&&(f=this.scrollTop,b.renderRows())})}if(b.settings.redrawOnResize){var g=0;a("body").on("resize.datagrid",function(){var a=this.offsetWidth;a!==g&&(g=a,b.handleResize())})}this.element.off("click.datagrid").on("click.datagrid","th.is-sortable",function(c){a(c.target).parent().is(".datagrid-filter-wrapper")||b.setSortColumn(a(this).attr("data-column-id"))}),this.table.off("mouseup.datagrid touchstart.datagrid").on("mouseup.datagrid touchstart.datagrid","a",function(a){a.preventDefault()});var h=this.table.find("tbody");h.off("click.datagrid").on("click.datagrid","td",function(e){var f,g,h=a(e.target);if(1!==h.closest(".datagrid-row-detail").length){if(b.triggerRowEvent("click",e,!0),b.setActiveCell(h.closest("td")),h.is(".datagrid-expand-btn")||h.is(".datagrid-cell-wrapper")&&h.find(".datagrid-expand-btn").length)return f=a(this).closest("tr"),g=b.dataRowIndex(f),b.toggleRowDetail(g),b.toggleGroupChildren(f),b.toggleChildren(e,g),!1;var i=h.is(".datagrid-selection-checkbox")||1===h.find(".datagrid-selection-checkbox").length,j=!!b.settings.clickToSelect||i;h.is(".datagrid-drilldown")&&(j=!1),d&&((j=i)||b.toggleRowActivation(h.closest("tr"))),j&&c&&e.shiftKey?(b.selectRowsBetweenIndexes([b.lastSelectedRow,h.closest("tr").index()]),e.preventDefault()):j&&b.toggleRowSelection(h.closest("tr")),b.lastClicked=h;var k=b.makeCellEditable(b.activeCell.dataRow,b.activeCell.cell,e),l=a(this).closest("td"),m=l.parent().children(":visible").index(l),n=b.columnSettings(m,!0);if(n.click&&"function"==typeof n.click&&(h.is("button, input[checkbox], a")||h.parent().is("button"))){var o=a(this).closest("tr"),p=b.dataRowIndex(o),q=b.settings.treeGrid?b.settings.treeDepth[p].node:b.settings.dataset[b.pager&&b.settings.source?o.index():p];if(l.hasClass("is-focusable")&&!h.is(b.settings.buttonSelector)&&!h.parent("button").is(b.settings.buttonSelector))return;l.hasClass("is-cell-readonly")||!h.is("button, input[checkbox], a")&&!h.parent().is("button")||n.click(e,[{row:p,cell:b.activeCell.cell,item:q,originalEvent:e}])}if(n.menuId){var r=a(this).find("button");r.popupmenu({attachToBody:!0,autoFocus:!1,mouseFocus:!0,menuId:n.menuId,trigger:"immediate",offset:{y:5}}),n.selected&&r.on("selected.datagrid",n.selected)}k&&setTimeout(function(){a("textarea, input",l).length&&!a(".dropdown,[type=image],[type=button],[type=submit],[type=reset],[type=checkbox],[type=radio]",l).length&&(b.quickEditMode=!0)},0)}}),h.off("dblclick.datagrid").on("dblclick.datagrid","tr",function(a){b.triggerRowEvent("dblclick",a,!0)}),h.off("contextmenu.datagrid").on("contextmenu.datagrid","tr",function(c){if(b.isSubscribedTo(c,"contextmenu"))return b.triggerRowEvent("contextmenu",c,!!b.settings.menuId),c.preventDefault(),b.settings.menuId&&a(c.currentTarget).popupmenu({menuId:b.settings.menuId,eventObj:c,trigger:"immediate"}),!1}),this.headerRow.off("mousemove.datagrid").on("mousemove.datagrid","th",function(c){if(!b.dragging&&(b.currentHeader=a(c.target).closest("th"),b.currentHeader.hasClass("is-resizable"))){var d=b.currentHeader.closest(".header-detail"),e=d.length?parseInt(d.css("margin-left"),10):0,f=parseInt(b.currentHeader.position().left)-(e||0)+b.element.scrollLeft(),g=f+b.currentHeader.outerWidth(),h=c.pageX-f>g-c.pageX,i=0;i=h?g-6:f-6,0!==b.currentHeader.index()||h||(i="-999"),h||(b.currentHeader=b.currentHeader.prevAll().not(".is-hidden").first()),b.currentHeader.hasClass("is-resizable")&&(b.createResizeHandle(),b.resizeHandle[0].style.left=i+"px",b.resizeHandle[0].style.cursor="")}}),this.headerRow.off("click.datagrid").on("click.datagrid","th .datagrid-checkbox",function(){var c=a(this);c.hasClass("is-checked")?(c.removeClass("is-checked").attr("aria-checked","true"),b.unSelectAllRows()):(c.addClass("is-checked").attr("aria-checked","true"),b.selectAllRows())}),h.off("focusout.datagrid").on("focusout.datagrid","td input, td textarea, div.dropdown",function(c){var d=c.target;if(a(d).is("input.lookup, input.timepicker, input.datepicker, input.spinbox"))return void setTimeout(function(){if(!a(".lookup-modal.is-visible, #timepicker-popup, #calendar-popup").length&&b.editor&&b.editor.input.is(d)){if(a("*:focus").is(".spinbox"))return;b.commitCellEdit(b.editor.input)}},150);a("#dropdown-list, .autocomplete.popupmenu.is-open, #timepicker-popup").is(":visible")||b.editor&&b.editor.input&&(b.lastClicked=null,b.commitCellEdit(b.editor.input))})},isSubscribedTo:function(b,c){var d=this;for(var e in a._data(d.element[0]).events)if(e===c)return!0;return!1},refreshSelectedRowHeight:function(){var a=this.element.parent().find(".toolbar:not(.contextual-toolbar)"),b=a.find('[data-option="row-short"]'),c=a.find('[data-option="row-medium"]'),d=a.find('[data-option="row-normal"]');"short"===this.settings.rowHeight&&(b.parent().addClass("is-checked"),c.parent().removeClass("is-checked"),d.parent().removeClass("is-checked")),"medium"===this.settings.rowHeight&&(b.parent().removeClass("is-checked"),c.parent().addClass("is-checked"),d.parent().removeClass("is-checked")),"normal"===this.settings.rowHeight&&(b.parent().removeClass("is-checked"),c.parent().removeClass("is-checked"),d.parent().addClass("is-checked"))},appendToolbar:function(){var b,c,d="",e=this;if(f.toolbar){if(1===this.element.parent().find(".toolbar:not(.contextual-toolbar)").length)b=this.element.parent().find(".toolbar:not(.contextual-toolbar)"),this.refreshSelectedRowHeight();else{b=a('<div class="toolbar" role="toolbar"></div>'),this.removeToolbarOnDestroy=!0,f.toolbar.title&&(d=a('<div class="title">'+f.toolbar.title+"  </div>")),d||(d=b.find(".title")),b.append(d),f.toolbar.results&&d.append('<span class="datagrid-result-count"></span>');var g=a('<div class="buttonset"></div>').appendTo(b);if(f.toolbar.keywordFilter){var h=a('<label class="audible" for="gridfilter">'+Locale.translate("Keyword")+"</label>"),i=a('<input class="searchfield" name="searchfield" placeholder="'+Locale.translate("Keyword")+'" id="gridfilter">');g.append(h),f.toolbar.collapsibleFilter||i.attr("data-options","{ collapsible: false }"),g.append(i)}f.toolbar.dateFilter&&g.append('<button class="btn" type="button">'+a.createIcon({icon:"calendar"})+"<span>"+Locale.translate("Date")+"</span></button>"),f.toolbar.actions&&(c=a('<div class="more"></div>').insertAfter(g),c.append('<button class="btn-actions" title="More" type="button">'+a.createIcon({icon:"more"})+'<span class="audible">Grid Features</span></button>'),b.addClass("has-more-button"));var j=a('<ul class="popupmenu"></ul>');f.toolbar.personalize&&j.append('<li><a href="#" data-option="personalize-columns">'+Locale.translate("PersonalizeColumns")+"</a></li>"),f.toolbar.resetLayout&&j.append('<li><a href="#" data-option="reset-layout">'+Locale.translate("ResetDefault")+"</a></li>"),f.toolbar.exportToExcel&&j.append('<li><a href="#" data-option="export-to-excel">'+Locale.translate("ExportToExcel")+"</a></li>"),f.toolbar.advancedFilter&&j.append('<li><a href="#">'+Locale.translate("AdvancedFilter")+"</a></li>"),f.toolbar.views&&j.append('<li><a href="#">'+Locale.translate("SaveCurrentView")+'</a></li> <li class="separator"></li> <li class="heading">'+Locale.translate("SavedViews")+'</li><li><a href="#">View One</a></li>'),f.toolbar.rowHeight&&j.append('<li class="separator single-selectable-section"></li><li class="heading">'+Locale.translate("RowHeight")+'</li><li class="is-selectable'+("short"===this.settings.rowHeight?" is-checked":"")+'"><a data-option="row-short">'+Locale.translate("Short")+'</a></li><li class="is-selectable'+("medium"===this.settings.rowHeight?" is-checked":"")+'"><a data-option="row-medium">'+Locale.translate("Medium")+'</a></li><li class="is-selectable'+("normal"===this.settings.rowHeight?" is-checked":"")+'"><a data-option="row-normal">'+Locale.translate("Normal")+"</a></li>"),f.toolbar.filterRow&&j.append('<li class="separator"></li><li class="heading">'+Locale.translate("Filter")+'</li><li class="'+(f.filterable?"is-checked ":"")+'is-toggleable"><a data-option="show-filter-row">'+Locale.translate("ShowFilterRow")+'</a></li><li class="is-indented"><a data-option="run-filter">'+Locale.translate("RunFilter")+'</a></li><li class="is-indented"><a data-option="clear-filter">'+Locale.translate("ClearFilter")+"</a></li>"),f.toolbar.actions&&c.append(j),this.element.prev().is(".contextual-toolbar")?this.element.prev().before(b):this.element.before(b)}if(b.find(".btn-actions").popupmenu().on("selected",function(a,b){var c=b.attr("data-option");"row-short"!==c&&"row-medium"!==c&&"row-normal"!==c||e.rowHeight(c.substr(4)),"personalize-columns"===c&&e.personalizeColumns(),"reset-layout"===c&&e.resetColumns(),"export-to-excel"===c&&e.exportToExcel(),"show-filter-row"===c&&e.toggleFilterRow(),"run-filter"===c&&e.applyFilter(),"clear-filter"===c&&e.clearFilter()}),f.initializeToolbar&&!b.data("toolbar")){var k=a.fn.parseOptions(b);f.toolbar.fullWidth&&(k.rightAligned=!0),b.toolbar(k)}if(f.toolbar&&f.toolbar.keywordFilter){var l=b.find(".searchfield"),m=l.parent().find(".close.icon");l.off("keypress.datagrid").on("keypress.datagrid",function(a){13!==a.keyCode&&"change"!==a.type||(a.preventDefault(),e.keywordSearch(l.val()))}),m.off("click.datagrid").on("click.datagrid",function(){e.keywordSearch(l.val())})}this.toolbar=b,this.element.addClass("has-toolbar")}},rowHeight:function(a){return a&&(f.rowHeight=a),this.element.add(this.table).removeClass("short-rowheight medium-rowheight normal-rowheight").addClass(f.rowHeight+"-rowheight"),this.virtualRange&&this.virtualRange.rowHeight&&(this.virtualRange.rowHeight="normal"===a?40:"medium"===a?30:25),this.saveUserSettings(),this.refreshSelectedRowHeight(),f.rowHeight},keywordSearch:function(b){this.tableBody.find('tr[role="row"]').removeClass("is-filtered").show(),this.filterExpr=[],this.tableBody.find(".datagrid-expandable-row").each(function(){var b=a(this);b.prev().find(".datagrid-expand-btn").removeClass("is-expanded"),b.prev().find(".plus-minus").removeClass("active"),b.removeClass("is-expanded").css("display",""),b.find(".datagrid-row-detail").css("height","")}),this.tableBody.find(".search-mode").each(function(){var b=a(this),c=b.text();b.text(c.replace("<i>","").replace("</i>",""))}),b=(b||"").toLowerCase(),this.filterExpr.push({column:"all",operator:"contains",value:b,keywordSearch:!0}),this.filterKeywordSearch(),this.renderRows(),this.resetPager("searched"),this.setSearchActivePage(),this.settings.paging||this.highlightSearchRows(b)},setSearchActivePage:function(){this.pager&&1===this.filterExpr.length?""!==this.filterExpr[0].value?(void 0===this.pager.searchActivePage&&(this.pager.searchActivePage=this.pager.activePage),this.pager.setActivePage(1,!0)):""===this.filterExpr[0].value&&this.pager.searchActivePage>-1&&(this.pager.setActivePage(this.pager.searchActivePage,!0),delete this.pager.searchActivePage):this.pager&&this.pager.searchActivePage>-1&&(this.pager.setActivePage(this.pager.searchActivePage,!0),delete this.pager.searchActivePage)},filterKeywordSearch:function(){var b,c,d,e,f=this,g=f.filterExpr,h=function(b,c){var d=!1,e=function(a){var d,e=f.columnById(a)[0],h=f.fieldValue(b,e.field),i=f.settings.columns.indexOf(e);return d=f.formatValue(e.formatter,c,i,h,e,b,f).toLowerCase(),d=d.replace(/(<([^>]+)>)|(&lt;([^>]+)&gt;)/gi,""),d.indexOf(g.value)>-1};return"all"===g.column?f.headerRow.find("th:visible").each(function(){var b=a(this),c=b.attr("data-column-id");if(d=e(c))return!1}):g.columnId&&(d=e(g.columnId)),d};if(g&&1===g.length)if(g=g[0],f.settings.treeGrid)for(b=f.settings.treeDepth,d=0,e=b.length;d<e;d++)c=""!==g.value&&!h(b[d].node,d),b[d].node.isFiltered=c;else for(b=f.settings.dataset,d=0,e=b.length;d<e;d++)c=""!==g.value&&!h(b[d],d),b[d].isFiltered=c},highlightSearchRows:function(b){this.tableBody.find("tr").each(function(){var c=!1,d=a(this);d.find("td").each(function(){var d=a(this);d.text().toLowerCase().indexOf(b)>-1&&(c=!0,d.find("*").each(function(){if(this.innerHTML===this.textContent){var c=this.textContent,d=a(this),e=new RegExp("("+b+")","i");d.addClass("search-mode").html(c.replace(e,"<i>$1</i>"))}}))}),c?c&&d.is(".datagrid-expandable-row")&&(d.prev().show(),d.prev().find(".datagrid-expand-btn").addClass("is-expanded"),d.prev().find(".plus-minus").addClass("active"),d.addClass("is-expanded").css("display","table-row"),d.find(".datagrid-row-detail").css("height","auto")):d.addClass("is-filtered").hide()})},_selectedRows:[],selectAllRows:function(){for(var a=[],b=this,c=this.settings.treeGrid?this.settings.treeDepth:this.settings.dataset,d=0,e=c.length;d<e;d++)this.filterRowRendered?c[d].isFiltered||a.push((b.settings.paging&&b.settings.source,d)):a.push(d);this.dontSyncUi=!0,this.selectedRows(a,!0,!0),this.dontSyncUi=!1,this.syncSelectedUI(),this.element.triggerHandler("selected",[this._selectedRows,"selectall"])},unSelectAllRows:function(){this.dontSyncUi=!0,this.selectedRows([],!0,!0),this.dontSyncUi=!1,this.syncSelectedUI(),this.element.triggerHandler("selected",[this._selectedRows,"deselectall"])},inArrayObjects:function(a,b){for(var c=0,d=a.length;c<d;c++)if(b(a[c]))return c;return-1},isNodeSelected:function(a){return-1!==this.inArrayObjects(this._selectedRows,function(b){return b.idx===a})},selectRow:function(b,c){var d,e,f=this,g=null,h=this.settings;if(void 0!==b&&-1!==b&&h.selectable&&(d=this.visualRowNode(b),e=this.dataRowIndex(d),isNaN(e)&&(e=b),d)){if("single"===h.selectable&&this._selectedRows.length>0&&this.unselectRow(this._selectedRows[0].idx),!d.hasClass("is-selected")){var i,j=function(a,b,c){f.isNodeSelected(b)||(g=f.cellNode(a,f.columnIdxById("selectionCheckbox")),a.addClass("is-selected"+("mixed"===f.settings.selectable?" hide-selected-color":"")).attr("aria-selected","true").find("td").attr("aria-selected","true"),g.find(".datagrid-cell-wrapper .datagrid-checkbox").addClass("is-checked").attr("aria-checked","true"),f._selectedRows.push({idx:b,data:c,elem:a}))};h.treeGrid?(d.is(".datagrid-tree-parent")&&"multiple"===h.selectable?d.add(d.nextUntil('[aria-level="1"]')).each(function(){var b=a(this),c=b.attr("aria-rowindex")-1,d=h.treeDepth[c].node;j(b,c,d)}):(i=h.treeDepth[f.pager&&h.source?d.index():e].node,j(d,e,i)),f.setNodeStatus(d)):(e=f.pager&&h.source?d.index():e,i=h.dataset[e],j(d,e,i),f.lastSelectedRow=b)}this.syncSelectedUI(),c||this.element.triggerHandler("selected",[this._selectedRows,"select"])}},dontSyncUi:!1,selectRowsBetweenIndexes:function(a){a.sort(function(a,b){return a-b});for(var b=a[0];b<=a[1];b++)this.selectRow(b)},syncSelectedUI:function(){var b=this.settings,c=b.treeGrid?b.treeDepth:b.dataset,d=this.headerRow.find(".datagrid-checkbox"),e=c;if(this.filterRowRendered){e=[];for(var f=0,g=c.length;f<g;f++)c[f].isFiltered||e.push(f)}this._selectedRows.length>0&&d.addClass("is-checked is-partial"),this._selectedRows.length===e.length&&d.addClass("is-checked").removeClass("is-partial"),0===this._selectedRows.length&&d.removeClass("is-checked is-partial"),1!==this.contextualToolbar.length||this.dontSyncUi||(0===this._selectedRows.length&&this.contextualToolbar.animateClosed(),this._selectedRows.length>0&&0===this.contextualToolbar.height()&&this.contextualToolbar.css("display","block").one("animateopencomplete.datagrid",function(){a(this).triggerHandler("recalculate-buttons")}).animateOpen())},activateRow:function(a){0!==this.activatedRow().length&&this.activatedRow()[0].row===a||this.toggleRowActivation(a)},deactivateRow:function(){this.toggleRowActivation(this.activatedRow()[0].row)},activatedRow:function(){var a=this.tableBody.find("tr.is-rowactivated");if(a.length){var b=this.dataRowIndex(a);return[{row:b,item:this.settings.dataset[b],elem:a}]}return[{row:-1,item:void 0,elem:a}]},toggleRowActivation:function(a){var b="number"==typeof a?this.tableBody.find('tr[aria-rowindex="'+(a+1)+'"]'):a,c="number"==typeof a?a:this.pager&&this.settings.source?this.actualArrayIndex(b):this.dataRowIndex(b);if(b.hasClass("is-rowactivated"))this.settings.disableRowDeactivation||(b.removeClass("is-rowactivated"),this.element.triggerHandler("rowdeactivated",[{row:c,item:this.settings.dataset[c]}]));else{var d=this.tableBody.find("tr.is-rowactivated");if(d.length){d.removeClass("is-rowactivated");var e=this.dataRowIndex(d);this.element.triggerHandler("rowdeactivated",[{row:e,item:this.settings.dataset[e]}])}b.addClass("is-rowactivated"),this.element.triggerHandler("rowactivated",[{row:c,item:this.settings.dataset[c]}])}},toggleRowSelection:function(a){var b="number"==typeof a?this.tableBody.find('tr[aria-rowindex="'+(a+1)+'"]'):a,c="single"===this.settings.selectable,d="number"==typeof a?a:this.settings.treeGrid?this.dataRowIndex(b):this.actualArrayIndex(b);if(!(!1===this.settings.selectable||this.editor&&b.hasClass("is-selected")))return c&&b.hasClass("is-selected")?(this.unselectRow(d),this._selectedRows=[],this.displayCounts(),this._selectedRows):(b.hasClass("is-selected")?this.unselectRow(d):this.selectRow(d),this.displayCounts(),this._selectedRows)},unselectRow:function(b,c,d){var e,f=this,g=f.settings,h=f.visualRowNode(b),i=null;if(h&&void 0!==b){e=void 0;for(var j=0;j<f._selectedRows.length;j++)f._selectedRows[j].idx===b&&(e=b);var k=function(a,b){i=f.cellNode(a,f.columnIdxById("selectionCheckbox")),a.removeClass("is-selected hide-selected-color").removeAttr("aria-selected").find("td").removeAttr("aria-selected"),i.find(".datagrid-cell-wrapper .datagrid-checkbox").removeClass("is-checked").attr("aria-checked","false");for(var c,d=0;d<f._selectedRows.length;d++)f._selectedRows[d].idx===b&&(c=d);void 0!==c&&f._selectedRows.splice(c,1)};g.treeGrid?(h.is(".datagrid-tree-parent")&&"multiple"===g.selectable?h.add(h.nextUntil('[aria-level="1"]')).each(function(){var b=a(this),c=b.attr("aria-rowindex")-1;k(b,c)}):k(h,e),f.setNodeStatus(h)):k(h,e),c||f.syncSelectedUI(),d||f.element.triggerHandler("selected",[f._selectedRows,"deselect"])}},setNodeStatus:function(b){var c,d=this,e="multiple"===d.settings.selectable,f=d.cellNode(b,d.columnIdxById("selectionCheckbox"));if(!e)return f.find(".datagrid-cell-wrapper .datagrid-checkbox").removeClass("is-checked is-partial").attr("aria-checked","false"),void(b.is(".is-selected")&&f.find(".datagrid-cell-wrapper .datagrid-checkbox").addClass("is-checked").attr("aria-checked","true"));var g=function(b,c){b.each(function(){var b=a(this),e=d.cellNode(b,d.columnIdxById("selectionCheckbox")),f=d.getSelectedStatus(b,c);e.find(".datagrid-cell-wrapper .datagrid-checkbox").removeClass("is-checked is-partial").attr("aria-checked","false"),"mixed"===f?e.find(".datagrid-cell-wrapper .datagrid-checkbox").addClass("is-checked is-partial").attr("aria-checked","mixed"):f&&e.find(".datagrid-cell-wrapper .datagrid-checkbox").addClass("is-checked").attr("aria-checked","true")})};c=b.add(b.nextUntil('[aria-level="1"]')).filter(".datagrid-tree-parent"),g(c),c=b,+b.attr("aria-level")>1&&(c=c.add(b.prevUntil('[aria-level="1"]')).add(b.prevAll('[aria-level="1"]:first'))),c=c.filter(".datagrid-tree-parent"),g(c)},getSelectedStatus:function(b){var c=0,d=0,e=0;return b.add(b.nextUntil('[aria-level="1"]')).each(function(){c++,a(this).is(".is-selected")?d++:e++}),c===d||c!==e&&"mixed"},selectedRows:function(a,b,c){var d=-1,e="single"===this.settings.selectable,f="multiple"===this.settings.selectable||"mixed"===this.settings.selectable,g=this.settings.treeGrid?this.settings.treeDepth:this.settings.dataset;if(!a)return this._selectedRows;if(0!==a.length||0!==this._selectedRows.length){if(e&&(this._selectedRows[0]&&this.unselectRow(this._selectedRows[0].idx,b,c),d="[object Array]"===Object.prototype.toString.call(a)?a[0]:a.index(),this.selectRow(d,c)),f)if("[object Array]"===Object.prototype.toString.call(a)){for(var h=0;h<a.length;h++)this.selectRow(a[h],c);if(0===a.length){for(var i=0,j=g.length;i<j;i++)this.unselectRow(i,b,c);this._selectedRows=[]}}else this.selectRow(a.index(),c);return this.displayCounts(),this._selectedRows}},rowStatus:function(a,b,c){var d;if(!b)return delete this.settings.dataset[a].rowStatus,void this.updateRow(a);this.settings.dataset[a]&&(this.settings.dataset[a].rowStatus={},d=this.settings.dataset[a].rowStatus,d.icon=b,b=b.charAt(0).toUpperCase()+b.slice(1),b=b.replace("-progress","Progress"),d.text=Locale.translate(b),c=c?c.charAt(0).toUpperCase()+c.slice(1):d.text,d.tooltip=c,this.updateRow(a))},columnById:function(b){return a.grep(this.settings.columns,function(a){return a.id===b})},columnIdxById:function(a){for(var b=this.settings.columns,c=-1,d=0;d<b.length;d++)b[d].id===a&&(c=d);return c},activeCell:{node:null,cell:null,row:null},handleKeys:function(){var b=this,c="multiple"===b.settings.selectable,d=a("th .datagrid-checkbox",b.headerRow);b.headerTable.on("keydown.datagrid","th",function(d){var e,f,g=d.which||d.keyCode||d.charCode||0,h=a(this),i=h.siblings(":visible").addBack().index(h),j=b.visibleColumns().length-1;a(d.target).closest(".popupmenu").length>0||(13!==g&&32!==g||(e=c&&0===i?a(".datagrid-checkbox",h):h,e.trigger("click.datagrid").focus(),32===g&&d.preventDefault()),-1!==[35,36,37,39].indexOf(g)&&(f=i,f=/35|36/i.test(g)||(d.ctrlKey||d.metaKey)&&/37|39/i.test(g)?Locale.isRTL()?36===g||(d.ctrlKey||d.metaKey)&&37===g?j:0:35===g||(d.ctrlKey||d.metaKey)&&39===g?j:0:Locale.isRTL()?39===g?i>0?i-1:i:i<j?i+1:j:37===g?i>0?i-1:i:i<j?i+1:j,b.activeCell.cell=f,h.removeAttr("tabindex").removeClass("is-active"),a("th:not(.is-hidden)",this.header).eq(f).attr("tabindex","0").addClass("is-active").focus(),d.preventDefault()),40===g&&(h.removeAttr("tabindex"),b.activeCell.node=b.cellNode(0,b.settings.groupable?0:b.activeCell.cell,!0).attr("tabindex","0").focus(),d.preventDefault()))}),b.table.on("keydown.datagrid","td, input",function(a){var c=a.which||a.keyCode||a.charCode||0,d=!1;if(113===c&&(b.settings.actionableMode=!b.settings.actionableMode,d=!0),d)return a.preventDefault(),a.stopPropagation(),!1}),b.table.on("keydown.datagrid","td",function(e){var f,g,h=e.which||e.keyCode||e.charCode||0,i=!1,j=Locale.isRTL(),k=b.activeCell.node,l=a(this).parent(),m=l.prevAll(":not(.is-hidden, .datagrid-expandable-row)").first(),n=l.nextAll(":not(.is-hidden, .datagrid-expandable-row)").first(),o=b.activeCell.row,p=b.activeCell.cell,q=b.columnSettings(p),r=l.is(".datagrid-rowgroup-header, .datagrid-rowgroup-footer"),s=b.settings.dataset[b.dataRowIndex(k)],t=b.tableBody.find("tr:visible"),u=function(a){var c=t.filter('[aria-rowindex="'+(a+1)+'"]');return c.is(".datagrid-rowgroup-header")?c.index():b.dataRowIndex(c)},v=function(a,c,d){var e=b.activeCell.groupNode||k,f=a+(d?-1:1);return f=f>c?d?e.prevAll(":visible").last():e.nextAll(":visible").last():d?e.prevAll(":visible").first():e.nextAll(":visible").first()},w=function(a,c,d){if(r)return v(a,c,d);var e=a+(d?-1:1);if(e>c)return c;for(;b.settings.columns[e]&&b.settings.columns[e].hidden;)e=d?e-1:e+1;return e},x=!!a(".datagrid-selection-checkbox",k).length;if(g=b.settings.columns.length-1,f=t.last(),-1!==[9,37,39].indexOf(h)){if(9===h&&!b.settings.actionableMode)return;9!==h&&e.altKey?(p=37===h&&!j||39===h&&j?0:g,b.setActiveCell(o,p)):b.quickEditMode&&9!==h||(p=!j&&(37===h||9===h&&e.shiftKey)||j&&(39===h||9===h)?w(p,g,!0):w(p,g),p instanceof jQuery?b.setActiveCell(p):b.setActiveCell(o,p),b.quickEditMode=!1,i=!0)}if(38===h&&!b.quickEditMode)if(e.altKey||e.metaKey)b.setActiveCell(u(0),p),i=!0;else{if(0===o&&!m.is(".datagrid-rowgroup-header"))return k.removeAttr("tabindex"),void b.headerRow.find("th").eq(p).attr("tabindex","0").focus();b.setActiveCell(m,p),i=!0}if(40!==h||b.quickEditMode||(e.altKey||e.metaKey?(b.setActiveCell(f,p),i=!0):(b.setActiveCell(n,p),i=!0)),32===h&&e.ctrlKey&&k){var y="";o=k.closest("tr"),o.children().each(function(){var b=a(this);y+=b.text()+" "}),a("body").toast({title:"",audibleOnly:!0,message:y}),i=!0}if(36===h&&(b.setActiveCell(o,0),i=!0),35===h&&(b.setActiveCell(o,g),i=!0),34===h&&(b.setActiveCell(f,p),i=!0),33===h&&(b.setActiveCell(u(0),p),i=!0),32===h&&(!b.settings.editable||x)){if(o=k.closest("tr"),1===a(e.target).closest(".datagrid-row-detail").length)return;e.preventDefault();var z=a(e.target).find(".datagrid-expand-btn, .datagrid-drilldown");if(z&&z.length)return z.trigger("click.datagrid"),void e.preventDefault();c&&e.shiftKey?b.selectRowsBetweenIndexes([b.lastSelectedRow,o.index()]):b.toggleRowSelection(o)}if(b.settings.editable&&32===h&&(b.editor||b.makeCellEditable(o,p,e)),13===h&&q.click&&"function"==typeof q.click&&(k.hasClass("is-cell-readonly")||q.click(e,[{row:o,cell:p,item:s,originalEvent:e}])),b.settings.editable&&13===h){if(a(e.target).is("textarea")&&e.shiftKey)return;b.editor?(b.quickEditMode=!1,b.commitCellEdit(b.editor.input),b.setNextActiveCell(e)):(b.makeCellEditable(o,p,e),b.isContainTextfield(k)&&b.notContainTextfield(k)&&(b.quickEditMode=!0)),i=!0}if(-1!==[9,13,32,35,36,37,38,39,40,113].indexOf(h)||e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||!b.settings.editable||b.editor||b.makeCellEditable(o,p,e),c&&!b.editor&&(e.ctrlKey||e.metaKey)&&65===h&&(d.addClass("is-checked").removeClass("is-partial").attr("aria-checked","true"),b.selectAllRows(),i=!0),i)return e.preventDefault(),e.stopPropagation(),!1})},isContainTextfield:function(b){var c,d=["image","button","submit","reset","checkbox","radio"],e="textarea, input",f=d.length;for(e+=f?":not(":"",c=0;c<f;c++)e+="[type="+d[c]+"],";return e=f?e.slice(0,-1)+")":"",!!a(e,b).length},notContainTextfield:function(b){return!a(".dropdown, .datepicker",b).length},editor:null,isCellEditable:function(a,b){if(!this.settings.editable)return!1;var c=this.columnSettings(b);if(c.readonly)return!1;var d=this.activeCell.node.find(".datagrid-cell-wrapper"),e=d.text()?d.text():this.fieldValue(this.settings.dataset[a],c.field);if(c.isEditable){if(!c.isEditable(a,b,e,c,this.settings.dataset[a]))return!1}return!!c.editor},makeCellEditable:function(b,c,d){this.editor&&this.editor.input&&this.editor.input.is(".timepicker, .datepicker, .lookup, .spinbox")&&!a(d.target).prev().is(this.editor.input)&&this.commitCellEdit(this.editor.input);var e=this.columnSettings(c);if(!e.editor)return 32!==d.keyCode||a(d.currentTarget).find(".datagrid-selection-checkbox").length||this.toggleRowSelection(this.activeCell.node.closest("tr")),!1;var f=this.dataRowIndex(this.dataRowNode(b)),g=this.settings.treeGrid?this.settings.treeDepth[f].node:this.settings.dataset[f],h=this.activeCell.node.find(".datagrid-cell-wrapper"),i=h.parent("td"),j=i.outerWidth(),k=a(".is-editor",i).length>0,l=h.text()?h.text():this.fieldValue(g,e.field);return k&&(l=this.fieldValue(g,e.field)),
!!this.isCellEditable(f,c)&&(i.hasClass("is-editing")||i.hasClass("is-editing-inline")?(h.find("input").focus(),!1):(e.inlineEditor?i.addClass("is-editing-inline"):(k&&h.css({position:"static",height:h.outerHeight()}),i.addClass("is-editing").css({"max-width":j,"min-width":j,width:j}),h.empty()),this.editor=new e.editor(f,c,l,h,e,d,this,g),this.editor.useValue&&(l=this.fieldValue(g,e.field)),this.editor.val(l),this.editor.focus(),this.element.triggerHandler("entereditmode",[{row:f,cell:c,item:g,target:h,value:l,column:e,editor:this.editor}]),!0))},commitCellEdit:function(b){var c,d,e=b.is(".editor"),f=!b.is(".timepicker, .datepicker, .lookup, .spinbox");if(this.editor){c=this.editor.val(),e?d=this.editor.td:(d=b.closest("td"),c=a.escapeHTML(c));var g=d.hasClass("is-editing-inline");d.removeClass("is-editing is-editing-inline"),this.editor.destroy(),this.editor=null;var h;h=null!==this.settings.source&&f?this.activeCell.row:this.dataRowIndex(d.parent());var i=d.index(),j=this.columnSettings(i),k=this.settings.treeGrid?this.settings.treeDepth[h].node:this.settings.dataset[h],l=this.fieldValue(k,j.field);this.updateCellNode(h,i,c,!1,g);var m=this.fieldValue(k,j.field);this.element.triggerHandler("exiteditmode",[{row:h,cell:i,item:k,target:d,value:m,oldValue:l,column:j,editor:this.editor}])}},validateCell:function(b,c){var d=this,e=this.columnSettings(c);if(e.validate){for(var f=e.validate.split(" "),g=a.fn.validation,h=this.fieldValue(this.settings.dataset[b],e.field),i=!0,j="",k=0;k<f.length;k++){var l=g.rules[f[k]],m={row:b,cell:c,item:this.settings.dataset[b],column:e,grid:d};l.check(h,a("<input>").val(h),m)||(j?(j=(/^\u2022/.test(j)?"":"• ")+j,j+="<br>• "+l.message):j=l.message,i=!1)}i?d.clearCellError(b,c):(d.showCellError(b,c,j),d.element.trigger("cellerror",{row:b,cell:c,message:j,target:this.cellNode(b,c),value:h,column:e}))}},showCellError:function(b,c,d){var e=this.cellNode(b,c);if(this.clearNonVisibleCellErrors(b,c),!e.length)return this.nonVisibleCellErrors.push({row:b,cell:c,errorMessage:d}),void this.showNonVisibleCellErrors();e.addClass("error").attr("data-errormessage",d);var f=a(a.createIcon({classes:["icon-error"],icon:"error"}));0===e.find(".icon-error").length&&(e.find(".datagrid-cell-wrapper").append(f),f.tooltip({placement:"bottom",isErrorColor:!0,content:d}),f.data("tooltip").show())},showNonVisibleCellErrors:function(){var b,c,d;if(this.toolbar||(f.toolbar={title:""},this.appendToolbar()),1===this.toolbar.parent().find(".tableerrors").length&&(c=this.element.parent().find(".tableerrors")),this.nonVisibleCellErrors.length){for(var e=0;e<this.nonVisibleCellErrors.length;e++)b=(b?b+"<br>":"")+this.nonVisibleCellErrors[e].errorMessage;0===this.element.parent().find(".tableerrors").length&&(c=a('<div class="tableerrors"></div>')),d=c.find(".icon-error"),d.length||(d=a(a.createIcon({classes:["icon-error"],icon:"error"})),c.append(d)),this.element.hasClass("has-toolbar")&&this.toolbar.append(c),d.tooltip({placement:"bottom",isErrorColor:!0,content:b}),d.data("tooltip").show()}else if(c&&c.length){d=c.find(".icon-error");var g=d.data("tooltip");g&&g.hide(),c.find(".icon-error").remove()}},clearCellError:function(a,b){this.clearNonVisibleCellErrors(a,b);var c=this.cellNode(a,b);c.length&&this.clearNodeErrors(c)},clearNonVisibleCellErrors:function(b,c){this.nonVisibleCellErrors.length&&(this.nonVisibleCellErrors=a.grep(this.nonVisibleCellErrors,function(a){if(a.row!==b||a.cell!==c)return a}),this.nonVisibleCellErrors.length||this.showNonVisibleCellErrors())},clearRowError:function(a){this.dataRowNode(a).removeClass("error alert"),this.rowStatus(a,"","")},clearAllErrors:function(){var b=this;this.tableBody.find("td.error").each(function(){var c=a(this);b.clearNodeErrors(c)})},clearNodeErrors:function(a){a.removeClass("error").removeAttr("data-errormessage");var b=a.find(".icon-error"),c=b.data("tooltip");c&&c.hide(),a.find(".icon-error").remove()},resetRowStatus:function(){for(var a=0;a<this.settings.dataset.length;a++)this.rowStatus(a,"")},dirtyRows:function(){for(var a=[],b=this.settings.dataset,c=0;c<b.length;c++)b[c].rowStatus&&"dirty"===b[c].rowStatus.icon&&a.push(b[c]);return a},showRowError:function(a,b,c){var d=c||"error";this.dataRowNode(a).addClass("error"),this.rowStatus(a,d,b)},validateRow:function(a){for(var b=0;b<this.settings.columns.length;b++)this.validateCell(a,b)},validateAll:function(){for(var a=0;a<this.settings.dataset.length;a++)for(var b=0;b<this.settings.columns.length;b++)this.validateCell(a,b)},columnSettings:function(a,b){var c=f.columns[a];return b&&(c=this.visibleColumns()[a]),c||{}},coerceValue:function(a,b,c,d,e){var f;return c.serialize?f=c.serialize(a,b,c,d,e,this.settings.dataset[d]):f},updateCell:function(a,b,c){var d=this.columnSettings(b);void 0===c&&(c=this.fieldValue(this.settings.dataset[a],d.field)),this.updateCellNode(a,b,c,!0)},updateCellNode:function(b,c,d,e,f){var g,h,i=this.visualRowNode(b),j=i.find("td").eq(c),k=this.settings.columns[c]||{},l="",m=k.formatter?k.formatter:this.defaultFormatter,n=a(".editor",j).length>0,o=this.settings.treeGrid,p=o?this.settings.treeDepth[b].node:this.settings.dataset[b],q=k.field?p[k.field]:"";if(e?g=d:void 0===(g=this.coerceValue(d,q,k,b,c))&&(g=d),j.data("tooltip")&&j.data("tooltip").destroy(),"rowStatus"===k.id&&p.rowStatus&&p.rowStatus.tooltip&&(j.attr("title",p.rowStatus.tooltip),j.tooltip({placement:"right",isErrorColor:"error"===p.rowStatus.icon})),g=a.unescapeHTML(g),k.field&&g!==q)if(k.field.indexOf(".")>-1){var r=k.field.split(".");2===r.length&&(p[r[0]][r[1]]=g),3===r.length&&(p[r[0]][r[1]][r[2]]=g)}else p[k.field]=g;if(h=a.escapeHTML(g),l=this.formatValue(m,o?b+1:b,c,n?g:h,k,p),k.contentVisible){k.contentVisible(b,c,h,k,p)||(l="")}if(f||j.find(".datagrid-cell-wrapper").html(l),e||this.validateCell(b,c),g!==q&&!e){var s={row:b,cell:c,target:j,value:g,oldValue:q,column:k};s.rowData=o&&this.settings.treeDepth[b]?this.settings.treeDepth[b].node:p,this.element.trigger("cellchange",s),this.wasJustUpdated=!0,this.settings.showDirty&&this.rowStatus(b,"dirty")}},visualRowIndex:function(a){return this.tableBody.find("tr:visible").index(a)},visualRowNode:function(a){var b=a;return this.settings.paging&&this.settings.source&&(b+=(this.pager.activePage-1)*this.settings.pagesize),this.tableBody.find('tr[aria-rowindex="'+(b+1)+'"]')},dataRowNode:function(a){return this.tableBody.find('tr[aria-rowindex="'+(a+1)+'"]')},dataRowIndex:function(a){return a.attr("aria-rowindex")-1},actualArrayIndex:function(a){return parseInt(a.attr("data-index"))},setActiveCell:function(b,c){var d,e,f=this,g=f.activeCell,h=b,i=b instanceof jQuery&&b.is(".datagrid-rowgroup-header, .datagrid-rowgroup-footer");if(!(b instanceof jQuery&&0===b.length||("number"==typeof b&&(d=b,h=this.tableBody.find("tr:visible").eq(b),e=this.dataRowIndex(h)),b instanceof jQuery&&b.is("td")&&(i=b.parent().is(".datagrid-rowgroup-header, .datagrid-rowgroup-footer"),i&&(h=b.parent()),c=b.index(),d=this.visualRowIndex(b.parent()),e=this.dataRowIndex(b.parent()),h=b.parent()),b instanceof jQuery&&b.is("tr")&&(d=this.visualRowIndex(b),e=this.dataRowIndex(b),h=b),d<0||c<0))){g.node&&1===g.node.length&&f.activeCell.node.removeAttr("tabindex"),g.cell===c&&g.row===b||a("#tooltip").hide(),f.activeCell.node=f.cellNode(i?h:e>-1?e:d,c).attr("tabindex","0"),f.activeCell.node&&1===g.node.length?(f.activeCell.row=d,f.activeCell.cell=c,e=this.dataRowIndex(f.activeCell.node.parent())):f.activeCell=g,a("input, button:not(.btn-secondary, .row-btn, .datagrid-expand-btn, .datagrid-drilldown, .btn-icon)",f.activeCell.node).length||(f.activeCell.node.focus(),i&&(f.activeCell.groupNode=f.activeCell.node)),f.activeCell.node.hasClass("is-focusable")&&f.activeCell.node.find("button").focus(),void 0!==e&&(f.activeCell.dataRow=e);var j=+h.find("td[colspan]").attr("colspan");if(i&&f.activeCell.node&&g.node&&!(b instanceof jQuery&&b.is("td"))&&(c<j?(h.find("td[colspan]").attr("tabindex","0").focus(),f.activeCell.groupNode=h.find("td[colspan]")):c>=j?(h.find("td").eq(c-j+1).attr("tabindex","0").focus(),f.activeCell.groupNode=h.find("td").eq(c-j+1)):(h.find("td").eq(c).attr("tabindex","0").focus(),f.activeCell.groupNode=h.find("td").eq(c))),i&&b instanceof jQuery&&b.is("td")&&(f.activeCell.cell=j-1+c,b.is("[colspan]")&&(f.activeCell.cell=c)),this.settings.cellNavigation){var k=f.headerNodes();k.removeClass("is-active"),k.eq(c).addClass("is-active")}this.activeCell.isFocused=!0,f.element.trigger("activecellchange",[{node:this.activeCell.node,row:this.activeCell.row,cell:this.activeCell.cell}])}},setNextActiveCell:function(b){if("keydown"===b.type)if(this.settings.actionableMode){var c=a.Event("keydown.datagrid");c.keyCode=40,this.activeCell.node.trigger(c)}else this.setActiveCell(this.activeCell.row,this.activeCell.cell)},addChildren:function(a,b){if(!(!b||b&&!b.length||a<0)){var c=this.settings.treeDepth[a].node;c.children=c.children||[],b=JSON.parse(JSON.stringify(b));for(var d=0,e=b.length;d<e;d++)c.children.push(b[d]);this.updateDataset(this.settings.dataset)}},setExpandedInDataset:function(a,b){this.settings.treeDepth[a].node.expanded=b},toggleChildren:function(b,c){var d=this,e=this.visualRowNode(c),f=e.find(".datagrid-expand-btn"),g=parseInt(e.attr("aria-level"),10),h=e.nextUntil('[aria-level="'+g+'"]'),i=f.hasClass("is-expanded"),j=[{grid:d,row:c,item:e,children:h}];if(d.settings.treeDepth[c]&&(j[0].rowData=d.settings.treeDepth[c].node),e.hasClass("datagrid-tree-parent")&&(a(b.target).is(f)||!d.settings.editable&&!d.settings.selectable)){var k=function(){e=d.visualRowNode(c),f=e.find(".datagrid-expand-btn"),h=e.nextUntil('[aria-level="'+g+'"]'),i?(e.attr("aria-expanded",!1),f.removeClass("is-expanded").find(".plus-minus").removeClass("active")):(e.attr("aria-expanded",!0),f.addClass("is-expanded").find(".plus-minus").addClass("active")),d.setExpandedInDataset(c,!i);var b=function(c,d,e){var f=c.nextUntil('[aria-level="'+d+'"]');e?f.each(function(){var b=a(this);parseInt(b.attr("aria-level"),10)>d&&b.addClass("is-hidden")}):f.each(function(){var c=a(this),e=parseInt(c.attr("aria-level"),10);if(e===d+1&&(c.removeClass("is-hidden"),c.is(".datagrid-tree-parent"))){var f=c.find(".datagrid-expand-btn.is-expanded").length>0;f&&b(c,e,!f)}})};b(e,g,i),d.setAlternateRowShading()};a.when(d.element.triggerHandler(i?"collapserow":"expandrow",j)).done(function(){k()})}},toggleRowDetail:function(a){var b=this,c=b.visualRowNode(a),d=c.next(),e=c.find(".datagrid-expand-btn"),f=d.find(".datagrid-row-detail"),g=b.settings.dataset[b.actualArrayIndex(c)];if(!c.hasClass("datagrid-tree-parent")){if(b.settings.allowOneExpandedRow&&null===b.settings.groupable){var h=b.tableBody.find("tr.is-expanded"),i=h.prev(),j=i.attr("aria-rowindex");if(h.length&&d.index()!==h.index()){var k=h.find(".datagrid-row-detail");h.removeClass("is-expanded"),i.removeClass("is-rowactivated"),i.find(".plus-minus").removeClass("active"),k.animateClosed().on("animateclosedcomplete",function(){h.css("display","none").removeClass("is-expanded"),b.element.triggerHandler("collapserow",[{grid:b,row:j,detail:k,item:b.settings.dataset[j]}])});var l=h.prev().find(".btn-primary");l.length&&l.attr("class",l.attr("class").replace("btn-primary","btn-secondary"))}var m=!d.hasClass("is-expanded"),n=d.prev().find(m?".btn-secondary":".btn-primary");if(n.length>0&&i&&n){var o=n.attr("class")||"";n.attr("class",o.replace(m?"btn-secondary":"btn-primary",m?"btn-primary":"btn-secondary"))}}d.hasClass("is-expanded")?(d.removeClass("is-expanded"),e.removeClass("is-expanded").find(".plus-minus").removeClass("active"),b.settings.allowOneExpandedRow&&c.removeClass("is-rowactivated"),f.animateClosed().on("animateclosedcomplete",function(){d.css("display","none"),b.element.triggerHandler("collapserow",[{grid:b,row:a,detail:f,item:g}])})):(d.addClass("is-expanded"),e.addClass("is-expanded").find(".plus-minus").addClass("active"),d.css("display","table-row"),d.find(".constrained-width").css("max-width",this.element.outerWidth()),b.settings.allowOneExpandedRow&&c.addClass("is-rowactivated"),f.animateOpen(),b.element.triggerHandler("expandrow",[{grid:b,row:a,detail:f,item:g}]))}},toggleGroupChildren:function(a){if(this.settings.groupable){var b=this,c=a.nextUntil(".datagrid-rowgroup-header"),d=a.find(".datagrid-expand-btn");a.hasClass("is-expanded")?(d.removeClass("is-expanded").find(".plus-minus").removeClass("active"),c.hide(),c.addClass("is-hidden"),b.element.triggerHandler("collapserow",[{grid:b,row:a.index(),detail:c,item:{}}]),a.removeClass("is-expanded")):(d.addClass("is-expanded").find(".plus-minus").addClass("active"),c.show(),c.removeClass("is-hidden"),b.element.triggerHandler("expandrow",[{grid:b,row:a.index(),detail:c,item:{}}]),a.addClass("is-expanded"))}},setSortColumn:function(a,b){void 0!==b?this.sortColumn.sortAsc=b:(this.sortColumn.sortId===a?this.sortColumn.sortAsc=!this.sortColumn.sortAsc:this.sortColumn.sortAsc=!0,b=this.sortColumn.sortAsc),this.sortColumn.sortId=a,this.sortColumn.sortField=this.columnById(a)[0]?this.columnById(a)[0].field:a,this.sortColumn.sortAsc=b,this.setSortIndicator(a,b),this.sortDataset();var c=this.activeCell.isFocused;this.setTreeDepth(),this.setRowGrouping(),this.setTreeRootNodes(),this.renderRows(),this.updateSelected(),this.syncSelectedUI(),c&&1===this.activeCell.node.length&&this.setActiveCell(this.activeCell.row,this.activeCell.cell),this.resetPager("sorted"),this.tableBody.removeClass("is-loading"),this.saveUserSettings(),this.element.trigger("sorted",[this.sortColumn])},sortDataset:function(){this.originalDataset&&(this.settings.dataset=this.originalDataset);var a=this.sortFunction(this.sortColumn.sortId,this.sortColumn.sortAsc);this.settings.disableClientSort||f.dataset.sort(a)},setSortIndicator:function(a,b){this.headerRow&&(this.headerRow.find(".is-sorted-asc, .is-sorted-desc").removeClass("is-sorted-asc is-sorted-desc").attr("aria-sort","none"),this.headerRow.find('[data-column-id="'+a+'"]').addClass(b?"is-sorted-asc":"is-sorted-desc").attr("aria-sort",b?"ascending":"descending"))},sortFunction:function(b,c){var d,e=this.columnById(b),f=0===e.length?b:e[0].field,g=this,h=function(b){return b=void 0===b||null===b?"":b,"string"==typeof b&&(b=b.toUpperCase(),a.isNumeric(b)&&(b=parseFloat(b))),b};return d=function(a){return h(g.fieldValue(a,f))},c=c?1:-1,function(a,b){return a=d(a),b=d(b),typeof a!=typeof b&&(a=a.toString().toLowerCase(),b=b.toString().toLowerCase()),c*((a>b)-(b>a))}},updateSelected:function(){var b=this,c=b.settings;a('tr[role="row"]',b.tableBody).each(function(){var d=a(this),e=b.dataRowIndex(d),f=b.cellNode(d,b.columnIdxById("selectionCheckbox"));c.paging&&c.source&&b.pager&&(e-=(b.pager.activePage-1)*c.pagesize),a.each(b._selectedRows,function(a,g){if(b.isEquals(g.data,c.dataset[e]))return g.idx=e,g.elem=d,f.find(".datagrid-cell-wrapper .datagrid-checkbox").addClass("is-checked").attr("aria-checked","true"),d.addClass("is-selected"+("mixed"===c.selectable?" hide-selected-color":"")).attr("aria-selected","true").find("td").attr("aria-selected","true"),!1})})},isEquals:function(b,c){function d(b,c){return JSON.stringify(b)===JSON.stringify(a.extend(!0,{},b,c))}return d(b,c)&&d(c,b)},defaultFormatter:function(a,b,c){return null===c||void 0===c||""===c?"":c.toString()},handlePaging:function(){var a=this;if(this.settings.paging){var b=this.tableBody;this.element.addClass("paginated"),b.pager({componentAPI:this,dataset:this.settings.dataset,hideOnOnePage:this.settings.hidePagerOnOnePage,source:this.settings.source,pagesize:this.settings.pagesize,indeterminate:this.settings.indeterminate,rowTemplate:this.settings.rowTemplate,pagesizes:this.settings.pagesizes,showPageSizeSelector:this.settings.showPageSizeSelector,activePage:this.restoreActivePage?parseInt(this.savedActivePage):1}),this.restoreActivePage&&(this.savedActivePage=null,this.restoreActivePage=!1),this.pager=b.data("pager"),b.on("beforepaging",function(){a.pager&&a.settings.source&&(a._selectedRows=[])}).on("afterpaging",function(b,c){a.displayCounts(c.total),a.updateSelected(),a.syncSelectedUI(),a.filterExpr&&a.filterExpr[0]&&"all"===a.filterExpr[0].column&&a.highlightSearchRows(a.filterExpr[0].value)})}},renderPager:function(a,b){var c=this.pager;c&&(c.updatePagingInfo(a),b||c.renderPages(a.type),this.updateSelected(),this.syncSelectedUI())},resetPager:function(a){this.pager&&(this.pager.pagingInfo||(this.pager.pagingInfo={}),this.pager.pagingInfo.type=a,this.pager.pagingInfo.activePage=1,this.renderPager(this.pager.pagingInfo))},destroy:function(){this.element.off().empty().removeClass("datagrid-container");var b=this.element.prev(".toolbar");if(this.removeToolbarOnDestroy&&f.toolbar&&f.toolbar.keywordFilter){var c=b.find(".searchfield");c.data("searchfield")&&c.data("searchfield").destroy(),c.data("toolbarsearchfield")&&c.data("toolbarsearchfield").destroy(),c.removeData("options")}this.removeToolbarOnDestroy&&(b.data("toolbar")&&b.data("toolbar").destroy(),b.remove()),this.element.next(".pager-toolbar").remove(),a.removeData(this.element[0],d),a(document).off("touchstart.datagrid touchend.datagrid touchcancel.datagrid click.datagrid touchmove.datagrid"),this.contentContainer.off().remove(),a("body").off("resize.vtable resize.datagrid")}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},a.fn.dropdown=function(b){"use strict";function c(b){this.settings=a.extend({},h),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="dropdown",f={closeOnSelect:!0,cssClass:null,filterMode:"contains",maxSelected:void 0,moveSelected:"none",moveSelectedToTop:void 0,multiple:!1,noSearch:!1,showEmptyGroupHeaders:!1,showSelectAll:!1,source:void 0,sourceArguments:{},reloadSourceOnOpen:!1,empty:!1,delay:300},g=["none","all","group"],h=a.extend({},f,b);return c.prototype={init:function(){function b(a,b){switch(a){case!b||"true":return"all";case!!b&&"false":return"none";default:return g.indexOf(a)>-1?a:"none"}}var c=this.element.attr("id");this.isIe10="ie"===Soho.env.browser.name&&"10"===Soho.env.browser.version,this.isIe11="ie"===Soho.env.browser.name&&"11"===Soho.env.browser.version,this.inlineLabel=this.element.closest("label"),this.inlineLabelText=this.inlineLabel.find(".label-text"),this.isInlineLabel=this.element.parent().is(".inline"),void 0===c&&(c=this.element.uniqueId("dropdown"),this.element.attr("id",c),this.element.parent().find("label").first().attr("for",c));var d=this.element[0].classList;0===d.length&&(this.element[0].classList="dropdown");var f=d.contains("dropdown-xs")?"dropdown input-xs":d.contains("dropdown-sm")?"dropdown input-sm":d.contains("dropdown-lg")?"dropdown input-lg":"dropdown",h=this.element.attr("style");this.isHidden=h&&h.indexOf("display: none")>=0;var i=this.isInlineLabel?this.inlineLabel:this.element;this.wrapper=i.next(".dropdown-wrapper"),this.isWrapped=this.wrapper.length>0,this.isWrapped||(this.wrapper=a('<div class="dropdown-wrapper"></div>').insertAfter(i)),this.isWrapped?(this.pseudoElem=this.wrapper.find("."+f),this.trigger=this.wrapper.find(".trigger")):this.pseudoElem=a("div#"+c+"-shdo"),d.contains("text-align-reverse")?f+=" text-align-reverse":d.contains("text-align-center")&&(f+=" text-align-center"),this.label=a('label[for="'+c+'"]'),this.pseudoElem.length?this.pseudoElem[0].setAttribute("class",f):this.pseudoElem=a('<div class="'+f+'">'),this.isWrapped||this.pseudoElem.append(a("<span></span>")),this.pseudoElem.attr({role:"combobox","aria-autocomplete":"list","aria-controls":"dropdown-list","aria-readonly":"true","aria-expanded":"false","aria-label":this.label.text()}),function(a){var b=a.element.prop("disabled"),c=a.element.prop("readonly");b?a.disable():c?a.readonly():a.enable()}(this),this.isWrapped||this.wrapper.append(this.pseudoElem,this.trigger),this.icon=this.wrapper.find(".icon"),this.icon.length||(this.icon=a.createIconElement("dropdown"),this.wrapper.append(this.icon)),this.element.prop("multiple")&&!this.settings.multiple&&(this.settings.multiple=!0);var j=this.element.attr("data-source");j&&"source"!==j&&(this.settings.source=j);var k=this.element.attr("data-maxselected");k&&!isNaN(k)&&(this.settings.maxSelected=parseInt(k,10)),void 0!==this.settings.moveSelectedToTop&&(this.settings.moveSelected=this.settings.moveSelectedToTop);var l=this.element.attr("data-move-selected");this.settings.moveSelected=l?b(l,!0):b(this.settings.moveSelected);var m=this.element.attr("data-close-on-select");m&&!this.settings.closeOnSelect&&(this.settings.closeOnSelect="true"===m);var n=this.element.attr("data-no-search");n&&!this.settings.noSearch&&(this.settings.noSearch="true"===n);for(var o,p=["-xs","-sm","-md","-lg"],q=this.element.attr("class"),r=0;r<p.length;r++)o=p[r],q.match(o)&&this.pseudoElem.addClass("dropdown"+o);return this.dataset=[],this.listfilter=new e({filterMode:this.settings.filterMode}),this.setValue(),this.setInitial(),this.setWidth(),this.element.triggerHandler("rendered"),this.handleEvents()},inputTimer:function(){if(this.inputTimeout)return!1;var a=this;return this.inputTimeout=setTimeout(function(){clearTimeout(a.inputTimeout),a.inputTimeout=null},100),!0},setWidth:function(){var a=this.element[0].style;a.width&&(this.pseudoElem[0].style.width=a.width),"absolute"===a.position&&(this.pseudoElem[0].style.position="absolute",this.pseudoElem[0].style.left=a.left,this.pseudoElem[0].style.top=a.top,this.pseudoElem[0].style.bottom=a.bottom,this.pseudoElem[0].style.right=a.right)},updateList:function(){function b(a){return'<li role="presentation" class="group-label" focusable="false">'+a+"</li>"}function c(b,c){var d="",e=Soho.DOM.getAttributes(b),f=b.innerHTML,g=e.getNamedItem("value"),h=e.getNamedItem("title"),i=e.getNamedItem("data-badge"),j=e.getNamedItem("data-badge-color"),k=b.selected,l=b.disabled,m=b.className,n=g&&g.value?g.value:f;m.indexOf("clear")>-1&&""===f&&(f=Locale.translate("ClearSelection"));var o={str:"",isExclude:function(b){var c=["data-badge","data-badge-color","data-val"];return a.inArray(b,c)>-1}};for(var p in e)e.hasOwnProperty(p)&&(o.name=e[p].name+"",o.isData="data-"===o.name.substr(0,5),o.isData&&!o.isExclude(o.name)&&(o.str+=" "+o.name+'="'+e[p].value+'"'));return d+='<li role="presentation" class="dropdown-option'+(k?" is-selected":"")+(l?" is-disabled":"")+(m?" "+m.value:"")+'"'+o.str+' data-val="'+n.replace('"',"/quot/")+'" tabindex="'+(c&&0===c?0:-1)+'">'+(h?'" title="'+h.value+'"':"")+'<a role="option" href="#" class="'+(m.indexOf("clear")>-1?" clear-selection":"")+'"id="list-option'+c+'">'+f+"</a>"+(i?'<span class="badge "'+(j?j.value:"azure07")+'"> '+i.value+"</span>":"")+"</li>"}var d=this,e=d.isMobile(),f=void 0!==d.list&&null!==d.list&&d.list.length>0,g="",h="",i=0,j=this.element.find("optgroup").length,k="",l=!0===this.settings.multiple,m=""+this.settings.moveSelected,n=!0===this.settings.showSelectAll;this.element[0].classList.contains("text-align-reverse")?k=" text-align-reverse":this.element[0].classList.contains("text-align-center")&&(k=" text-align-center"),f||(g='<div class="dropdown-list'+k+(e?" mobile":"")+(this.settings.multiple?" multiple":"")+'" id="dropdown-list" role="application" '+(this.settings.multiple?'aria-multiselectable="true"':"")+'><label for="dropdown-search" class="audible">'+Locale.translate("Search")+'</label><input type="text" class="dropdown-search'+k+'" role="combobox" aria-expanded="true" id="dropdown-search" aria-autocomplete="list"><span class="trigger">'+(e?a.createIcon({icon:"close",classes:["close"]}):a.createIcon("dropdown"))+'<span class="audible">'+(e?Locale.translate("Close"):Locale.translate("Collapse"))+'</span></span><ul role="listbox">');var o=this.element.find("option"),p=this.element.find("optgroup"),q=o.filter(":selected"),r=[];if(l&&n){var s=o.not("[disabled], .hidden").length===q.not("[disabled], .hidden").length;h+='<li role="presentation" class="dropdown-select-all-list-item'+(s?" is-selected":"")+'"><a role="option" href="#" id="dropdown-select-all-anchor" class="dropdown-select-all-anchor">'+Locale.translate("SelectAll")+"</a></li>"}"group"===m&&(p&&p.length?p.each(function(b,c){var d=q.filter(function(){return a.contains(c,this)});r.push(d)}):m="all"),"all"===m&&(o=o.not(q),q.length>0&&(h+=b(Locale.translate("Selected")+" "+(d.isInlineLabel?d.inlineLabelText.text():this.label.text()))),q.each(function(a){h+=c(this,a),i++}),!j&&o.length>0&&(h+=b(Locale.translate("All")+" "+(d.isInlineLabel?d.inlineLabelText.text():this.label.text())))),o.each(function(d){var e,f=d+i,g=a(this),j=g.parent();j.is("optgroup")&&p.length&&(e=j.index(),p.index(j)>-1&&(p=p.not(j),h+=b(""+j.attr("label")),"group"===m&&r[e].each(function(a){h+=c(this,a),i++}))),"none"!==m&&g.is(":selected")||(h+=c(this,f))}),f?this.listUl.html(h):(g+=h+"</ul></div>",this.list=a(g),this.listUl=this.list.find("ul"),this.searchInput=this.list.find("#dropdown-search"))},setValue:function(){var a=this.element.find("option:selected"),b=this.getOptionText(a);if(a.hasClass("clear")&&(b=""),this.settings.empty&&0===a.length)return void this.pseudoElem.find("span").text("");this.setPseudoElemDisplayText(b),this.element.attr("maxlength")&&this.setPseudoElemDisplayText(b.substr(0,this.element.attr("maxlength"))),this.previousActiveDescendant=a.first().val(),this.setBadge(a)},setPseudoElemDisplayText:function(a){this.pseudoElem.find("span").text(a)},copyClass:function(a,b,c){a.hasClass(c)&&b.addClass(c)},setInitial:function(){this.element.is(":disabled")&&this.disable(),this.element.is("[readonly]")&&this.readonly(),this.isHidden&&(this.pseudoElem.hide().prev("label").hide(),this.pseudoElem.next("svg").hide()),this.element.attr("placeholder")&&(this.pseudoElem.attr("placeholder",this.element.attr("placeholder")),this.element.removeAttr("placeholder"))},ignoreKeys:function(a,b){var c=b.which;if(b.altKey&&(38===c||40===c))return b.stopPropagation(),b.preventDefault(),!1;if(8===c&&a.hasClass("dropdown"))return b.stopPropagation(),b.preventDefault(),!1;if(!a.is(":disabled")&&!a.hasClass("is-readonly"))return!0},handleSearchEvents:function(){var b,c=this;this.settings.noSearch&&this.searchInput.prop("readonly",!0),this.searchKeyMode=!1,this.searchInput.on("keydown.dropdown",function(d){var e=a(this);c.ignoreKeys(e,d)&&c.handleKeyDown(e,d)&&(!1!==c.settings.noSearch||c.settings.source||(clearTimeout(b),b=setTimeout(function(){""===e.val()?c.resetList():c.filterList(e.val().toLowerCase())},100)))}).on("keypress.dropdown",function(a){c.isFiltering=!0,c.handleAutoComplete(a)})},filterList:function(b){var c,d=this,e=!1,f=a(".dropdown-option",this.listUl),g=a(".group-label",this.listUl);if(f.length&&this.list&&(!this.list||this.list.length)){if(b||(b=""),b&&b.length&&(c=this.listfilter.filter(f,b)),this.list.addClass("search-mode"),this.list.find(".icon").attr("class","icon search").changeIcon("search"),this.searchInput.removeAttr("aria-activedescendant"),this.unhighlightOptions(),!c||!c.length&&!b)return void this.resetList();f.not(c).add(g).addClass("hidden"),f.filter(c).each(function(c){var f=a(this);f.attr("tabindex",0===c?"0":"-1"),e||(d.highlightOption(f),e=!0);var g=new RegExp("("+b+")","i"),h=f.text().replace(g,"<i>$1</i>");f.removeClass("hidden").children("a").html(h)}),g.each(function(){var b=a(this).nextUntil(".group-label, .selector").not(".hidden");(d.settings.showEmptyGroupHeaders||b.length)&&a(this).removeClass("hidden")}),b="",this.position()}},resetList:function(){function b(a){return a[0]?a[0].textContent||a[0].innerText:""}if(this.list&&(!this.list||this.list.length)){var c=this.isMobile(),d="icon"+(c?" close":""),e=a.getBaseURL(c?"close":"dropdown");this.list.removeClass("search-mode"),this.list.find(".icon").attr("class",d).changeIcon(e);this.listUl.find("li").removeAttr("style").each(function(){var c=a(this).children("a");c.text(b(c))}),this.list.hasClass("is-ontop")&&(this.list[0].style.top=this.pseudoElem.offset().top-this.list.height()+this.pseudoElem.outerHeight()-2+"px"),this.settings.multiple&&this.updateList()}},selectBlank:function(){var b=this.element.find("option").filter(function(){return!this.value||0===a.trim(this.value).length});b.length>0&&(b[0].selected=!0,this.element.triggerHandler("updated").triggerHandler("change"))},handleKeyDown:function(b,c){var d,e=this.element[0].selectedIndex||-1,f=this.element[0].options,g=c.which,h=this;if(!this.isLoading()){if(!h.isOpen()&&(38===g||40===g||32===g))return void h.toggleList();switch(h.isOpen()&&(f=this.listUl.find("li:visible:not(.separator):not(.group-label):not(.is-disabled)"),e=-1,a(f).each(function(b){a(this).is(".is-focused")&&(e=b)})),g){case 37:case 8:case 46:if(!h.isOpen())return h.selectBlank(),c.stopPropagation(),c.preventDefault(),!1;break;case 9:return h.isOpen()&&(h.selectOption(a(f[e])),h.closeList("tab"),this.activate()),!0;case 27:if(h.isOpen())return h.closeList("cancel"),h.activate(),c.stopPropagation(),!1;break;case 32:case 13:if(h.isOpen()){if(32===g&&!0===h.searchKeyMode)break;c.preventDefault(),h.selectOption(a(f[e])),h.settings.closeOnSelect&&(h.closeList("select"),h.activate())}return c.stopPropagation(),!1;case 38:if(c.shiftKey)return;return this.searchKeyMode=!1,e>0&&(d=a(f[e-1]),this.highlightOption(d),d.parent().find(".is-focused").removeClass("is-focused"),d.addClass("is-focused")),c.stopPropagation(),c.preventDefault(),!1;case 40:if(c.shiftKey)return;return this.searchKeyMode=!1,e<f.length-1&&(d=a(f[e+1]),this.highlightOption(d),d.parent().find(".is-focused").removeClass("is-focused"),d.addClass("is-focused")),c.stopPropagation(),c.preventDefault(),!1;case 35:this.searchKeyMode=!1;var i=a(f[f.length-1]);return this.highlightOption(i),c.stopPropagation(),!1;case 36:this.searchKeyMode=!1;var j=a(f[0]);return this.highlightOption(j),c.stopPropagation(),!1}if(h.isOpen()&&h.isControl(g)&&8!==g)return!1;var k=h.searchInput&&h.searchInput.length;return h.initialFilter=!1,h.isOpen()||h.isControl(g)||this.settings.source||this.settings.noSearch||(h.initialFilter=!0,h.isFiltering=!0,h.filterTerm=a.actualChar(c),k&&h.searchInput.val(a.actualChar(c)),h.toggleList()),this.searchKeyMode=!0,h.searchInput&&h.searchInput.attr("aria-activedescendant",""),!0}},timer:null,filterTerm:"",handleAutoComplete:function(b){if(!this.isLoading()){var c=this;clearTimeout(this.timer),c.settings.source&&(c.initialFilter=!0,c.filterTerm+=a.actualChar(b),this.timer=setTimeout(function(){c.isOpen()?c.filterList(c.searchInput.val().toLowerCase()):(c.searchInput.val(c.filterTerm),c.toggleList())},c.settings.delay))}},isControl:function(a){return a>7&&a<48||a>90&&a<94||a>111&&a<146},activate:function(b){var c=this,d=this.pseudoElem;(b||c.isMobile())&&(d=this.searchInput),b&&(d.hasClass("is-readonly")||!0===d.prop("readonly"))||(!function(){c.isMobile()||(d[0].setSelectionRange?d[0].setSelectionRange(0,d[0].value.length):"INPUT"===d[0].tagName&&d[0].select())}(),document.activeElement!==d[0]&&a(document.activeElement).is("body, .dropdown.is-open")&&d[0].focus(),(c.isIe10||c.isIe11)&&setTimeout(function(){d[0].focus()},0))},getOptionText:function(b){var c="";return b||(b=this.element.find("option:selected")),b.each(function(){c.length>0&&(c+=", "),c+=a(this).text()}),c},open:function(){var a=this;this.inputTimer()&&(this.element.is(":disabled")||this.pseudoElem.hasClass("is-disabled")||this.pseudoElem.hasClass("is-readonly")||a.callSource(function(){a.updateList(),a.openList()})||(a.updateList(),this.openList()))},openList:function(){function b(b){var c=a(b.target),d=c.closest("li");if(d.length){if(d.is(".separator, .group-label"))return;c=d}if(c.is(".dropdown-select-all-anchor")&&(c=c.parent()),j.settings.multiple&&c.is(".dropdown-select-all-list-item")){return!c.is(".is-selected")?(c.addClass("is-selected"),j.selectOptions(j.element.find("option:not(:selected)"),!0)):(c.removeClass("is-selected"),j.selectOptions(j.element.find("option:selected"),!0)),!0}b.preventDefault(),b.stopPropagation();var e=c.attr("data-val").replace('"',"/quot/"),f=j.element.find('option[value="'+e+'"]')
;return(0===f.length||f.length>1)&&(f=j.element.find("option").filter(function(){var b=a(this),c=b.attr("value");return b.text()===e||c&&c.replace('"',"/quot/")===e})),!f.is(":disabled")&&(j.selectOption(f),j.settings.closeOnSelect&&j.closeList("select"),!!j.isMobile()||(j.activate(!j.settings.closeOnSelect),!0))}function c(a){return a.closest(".dropdown, .multiselect").length>0||a.closest(".dropdown-list").length>0||!0===j.touchmove}function d(b){k||c(a(b.target))||j.closeList("cancel")}function e(b){var d=a(b.target);if(k||c(d)&&!d.is(".icon"))return b.preventDefault(),void(k=!1);j.closeList("cancel")}function f(b){k=!1,h={x:b.originalEvent.touches[0].pageX,y:b.originalEvent.touches[0].pageY},a(document).on("touchmove.dropdown",function(a){var b={x:a.originalEvent.touches[0].pageX,y:a.originalEvent.touches[0].pageY};(b.x>=h.x+l||b.x<=h.x-l||b.y>=h.y+l||b.y<=h.y-l)&&(k=!0)})}function g(b){if(a(document).off("touchmove.dropdown"),b.preventDefault(),k)return!1;e(b)}var h,i=this.previousActiveDescendant?this.list.find('.dropdown-option[data-val="'+this.previousActiveDescendant.replace('"',"/quot/")+'"]'):this.list.find(".is-selected"),j=this,k=!1,l=10,m=!0;i.length>0&&(m=!0),"ios"===Soho.env.os.name&&a("head").triggerHandler("disable-zoom");var n=1===this.element.closest(".field-short").length;if(this.pseudoElem.attr("aria-expanded","true").addClass("is-open"),this.pseudoElem.attr("aria-label",this.label.text()),this.searchInput.attr("aria-activedescendant",i.children("a").attr("id")),a("select").each(function(){var b=a(this).data();b.dropdown&&b.dropdown.closeList("cancel")}),this.list.appendTo("body").show(),this.isInGrid=1===this.pseudoElem.closest(".datagrid-row").length,this.pseudoElem.parent().hasClass("is-inline")&&(this.isInGrid=!1),this.isInGrid){var o=this.pseudoElem.closest(".datagrid").attr("class").replace("datagrid","");this.list.addClass("datagrid-dropdown-list "+o)}1===this.pseudoElem.closest(".datagrid-filter-wrapper").length&&this.list.addClass("datagrid-filter-dropdown");var p=this.settings.cssClass;p&&"string"==typeof p&&this.list.addClass(p),this.position(),!this.settings.multiple&&this.initialFilter?(setTimeout(function(){j.searchInput.val(j.filterTerm),j.filterList(j.searchInput.val())},0),this.initialFilter=!1):this.searchInput.val(this.pseudoElem.find("span").text());var q=this.settings.multiple;this.highlightOption(i,q),this.settings.multiple&&this.listUl.find(".is-selected").length>0&&(this.highlightOption(this.listUl.find(".dropdown-option").eq(0)),setTimeout(function(){j.listUl.scrollTop(0)},0)),this.settings.multiple||m||this.searchInput.val(i.find("a").text()),this.handleSearchEvents(),this.activate(!0),this.element.trigger("listopened"),this.isMobile()&&j.searchInput.on("keypress.dropdown",function(a){13===a.which&&j.closeList("select")}),j.list.removeClass("dropdown-tall").addClass(n?"dropdown-short":"").onTouchClick("list","li").on("click.list","li",b).on("mouseenter.list","li",function(){var b=a(this);b.is(".separator, .group-label")||(j.list.find("li").removeClass("is-focused"),b.addClass("is-focused"))}),setTimeout(function(){j.list.addClass("is-closable")},100),a(document).on("touchstart.dropdown",f).on("touchend.dropdown touchcancel.dropdown",g).on("click.dropdown",e);var r=j.element.closest(".scrollable").length?j.element.closest(".scrollable"):a(document);r=j.element.closest(".scrollable-y").length?j.element.closest(".scrollable-y"):r,r.on("scroll.dropdown",d),a("body").on("resize.dropdown",function(){j.position(),void 0===window.orientation&&j.closeList("cancel")}),void 0!==window.orientation&&a(window).on("orientationchange.dropdown",function(){j.closeList("cancel")}),"ios"===Soho.env.os.name&&a("head").triggerHandler("enable-zoom")},position:function(){function a(a,c){!0===c.wasFlipped&&(b.list.addClass("is-ontop"),b.listUl.prependTo(b.list));var d=parseInt(window.getComputedStyle(b.listUl[0]).height),e=parseInt(window.getComputedStyle(b.list[0]).height);return d+34>e&&(b.listUl[0].style.height=e-34+"px"),c}var b=this,c={parentXAlignment:"left",placement:"bottom",strategies:["flip","shrink-y"]};this.list[0].removeAttribute("style"),this.listUl[0].removeAttribute("style");var d=this.pseudoElem;this.isInGrid&&(d=this.element.closest(".datagrid-cell-wrapper"));var e,f,g=window.getComputedStyle(d[0]),h=2*parseInt(g.borderLeftWidth),i=Math.round(parseInt(d[0].clientWidth)+h);this.searchInput[0].style.cssText="width: "+i+"px !important",e=Math.round(this.list.width()),f=e<=i,this.searchInput[0].style.width="",c.parent=d,c.useParentWidth=f,c.y=-1*parseInt(g.height+g.borderTopWidth+g.borderBottomWidth),"ie"===Soho.env.browser.name&&"11"===Soho.env.browser.version&&(c.y=2*c.y),this.list.one("afterplace.dropdown",a).place(c),this.list.data("place").place(c)},close:function(){return this.closeList("cancel")},closeList:function(b){this.list&&this.list.is(":visible")&&this.isListClosable()&&this.inputTimer()&&(this.touchmove&&(this.touchmove=!1),this.filterTerm="",this.searchInput.off("keydown.dropdown keypress.dropdown keypress.dropdown"),this.list.off("click.list touchmove.list touchend.list touchcancel.list mousewheel.list mouseenter.list").remove(),this.pseudoElem.removeClass("is-open").attr("aria-expanded","false"),this.searchInput.removeAttr("aria-activedescendant"),a(document).off("click.dropdown scroll.dropdown touchmove.dropdown touchend.dropdown touchcancel.dropdown"),a("body").off("resize.dropdown"),a(window).off("orientationchange.dropdown"),this.element.trigger("listclosed",b),this.activate(),this.list=null,this.searchInput=null,this.listUl=null)},scrollToOption:function(a){var b=this;a&&0!==a.length&&(b.listUl.scrollTop(0),b.listUl.scrollTop(a.offset().top-b.listUl.offset().top-b.listUl.scrollTop()-40))},handleBlur:function(){var a=this;return this.isOpen()&&(this.timer=setTimeout(function(){a.closeList("cancel")},40)),!0},isLoading:function(){return this.element.is(".is-loading")&&this.element.is(".is-blocked")},isOpen:function(){return!(!this.list||!this.list.is(":visible"))},toggleList:function(){if(this.isOpen()||this.isLoading())return void this.closeList("cancel");this.open()},highlightOption:function(a,b){if(!a)return a;0===a.length&&(a=this.list.find(".dropdown-option").eq(0));var c=this.element.find('option[value="'+a.attr("data-val")+'"]');c.hasClass(".is-disabled")||c.is(":disabled")||this.isOpen()&&(this.list.find(".is-focused").removeClass("is-focused").attr({tabindex:"-1"}),c.hasClass("clear")||a.addClass("is-focused").attr({tabindex:"0"}),this.searchInput.attr("aria-activedescendant",a.children("a").attr("id")),b&&!1!==b&&void 0!==b||this.scrollToOption(a))},unhighlightOptions:function(a,b){a&&a.length||(a=this.list.find(".is-selected")),a.removeClass("is-focused").attr({tabindex:"-1"}),this.searchInput.removeAttr("aria-activedescendant"),b&&!1!==b&&void 0!==b||this.scrollToOption(a.first())},selectOptions:function(b,c){Array.isArray(b)&&(b=a(b));var d=this;b.each(function(){d.selectOption(a(this),c)})},selectOption:function(b,c){if(!b)return b;var d;b.is("li")&&(d=b,b=this.element.find('option[value="'+b.attr("data-val")+'"]'),0===b.length&&(b=this.element.find("option").filter(function(){return a(this).text()===d.attr("data-val")})));var e=b.val();if(b&&(!d&&e&&(d=this.listUl.find('li[data-val="'+e.replace('"',"/quot/")+'"]')),!b.hasClass("is-disabled")&&!b.is(":disabled"))){var f=b.val(),g=this.element.val(),h=this.pseudoElem.text(),i="",j="",k=!1,l=!0;if((b.hasClass("clear")||""===f)&&(k=!0),this.settings.multiple){if(g||(g=[]),-1!==a.inArray(f,g))g=a.grep(g,function(a){return a!==f}),d.removeClass("is-selected"),this.previousActiveDescendant=void 0,l=!1;else{if(!isNaN(this.settings.maxSelected)&&this.element.find("option:selected").length>=this.settings.maxSelected)return;g="string"==typeof g?[g]:g,g.push(f),d.addClass("is-selected"),this.previousActiveDescendant=b.val()}var m=this.element.find("option").filter(function(){return-1!==a.inArray(a(this)[0].value,g)});i=this.getOptionText(m)}else g=f,this.listUl.find("li.is-selected").removeClass("is-selected"),k||d.addClass("is-selected"),this.previousActiveDescendant=b.val(),i=b.text();k||this.element.find("option").each(function(){if(this.value===f)return this.selected=!0,!1}),i!==h&&(k?(this.pseudoElem.find("span").text(""),this.searchInput.val("")):(this.pseudoElem.find("span").text(i),this.searchInput.val(i)),this.element.attr("maxlength")&&(j=i.substr(0,this.element.attr("maxlength")),this.pseudoElem.find("span").text(j),this.searchInput.val(j)),this.element.val(g),c||this.element.trigger("change").triggerHandler("selected",[b,l]),this.settings.multiple&&(this.list.hasClass("search-mode")&&this.resetList(),this.activate(!0)),this.setBadge(b))}},setBadge:function(a){if(this.badges){var b=this.element.parent().find(".badge");0===b.length&&(this.element.parent().find(".dropdown-wrapper").append('<span class="badge">1</span>'),b=this.element.parent().find(".badge")),b.attr("class","badge "+(a.attr("data-badge-color")?a.attr("data-badge-color"):"azure07")).text(a.attr("data-badge"))}},callSource:function(b){var c=this;if(this.settings.source){this.isFiltering=!1;var d=typeof this.settings.source,e=function(a,d){function e(a){return a.replace('"',"'")}function f(a){if(null!==a&&void 0!==a){var b="string"==typeof a,c=a;b&&(a={value:c}),a.value=e(a.value),void 0!==a.id&&(isNaN(a.id)||(a.id=""+a.id),a.id=e(a.id)),void 0!==a.label&&(a.label=e(a.label)),a.selected||a.value!==h||(a.selected=!0),g+="<option"+(void 0===a.id?"":' id="'+a.id+'"')+' value="'+a.value+'"'+(a.selected?" selected ":"")+">"+(void 0!==a.label?a.label:void 0!==a.value?a.value:"")+"</option>"}}var g="",h=c.element.val();if(!c.isFiltering&&!Soho.utils.equals(a,c.dataset)){if(c.dataset=a,!d){c.element.empty();for(var i=0;i<a.length;i++){var j;if(a[i].group){j=a[i].options,g+='<optgroup label="'+a[i].group+'">';for(var k=0;k<j.length;k++)f(j[k]);g+="</optgroup>"}else f(a[i])}c.element.append(g)}c.updateList()}c.element.triggerHandler("complete"),c.element.trigger("requestend",["",a]),b()};if(c.element.triggerHandler("start"),c.element.trigger("requeststart"),"function"===d)this.settings.source(e,"",this.settings.sourceArguments);else if("object"===d){var f=a.isArray(this.settings.source)?this.settings.source:[this.settings.source];e(f)}else{var g=this.settings.source.toString(),h=a.getJSON(g);h.done(function(a){e(a)}).fail(function(){e([])})}return!0}return!1},setCode:function(a){var b=this,c=function(){b.element.val(a),b.updated()};b.callSource(c)||c()},isMobile:function(){return["ios","android"].indexOf(Soho.env.os.name)>-1},isListClosable:function(){return this.list.hasClass("is-closable")},disable:function(){this.element.prop("disabled",!0).prop("readonly",!1),this.pseudoElem.is(a(document.activeElement))&&this.pseudoElem.blur(),this.pseudoElem.addClass("is-disabled").removeClass("is-readonly").attr("tabindex","-1").prop("readonly",!1).prop("disabled",!0),this.closeList("cancel")},isDisabled:function(){return this.element.prop("disabled")},enable:function(){this.element.prop("disabled",!1).prop("readonly",!1),this.pseudoElem.prop("disabled",!1).prop("readonly",!1).attr("tabindex","0").removeClass("is-disabled").removeClass("is-readonly")},readonly:function(){this.element.prop("disabled",!1).prop("readonly",!0),this.pseudoElem.removeClass("is-disabled").addClass("is-readonly").attr("tabindex","0").prop("disabled",!1).prop("readonly",!0),this.closeList("cancel")},updated:function(){return this.closeList("cancel"),this.settings.multiple&&!0===this.settings.multiple?this.element.prop("multiple",!0):this.element.prop("multiple",!1),!0===this.element.prop("readonly")?this.readonly():this.pseudoElem.removeClass("is-readonly"),this.pseudoElem[this.element.prop("disabled")?"addClass":"removeClass"]("is-disabled"),this.updateList(),this.setValue(),this.element.trigger("has-updated"),this},destroy:function(){a.removeData(this.element[0],d),this.closeList("cancel"),this.label.remove(),this.pseudoElem.off().remove(),this.icon.remove(),this.wrapper.remove(),this.listfilter.destroy(),this.element.removeAttr("style")},handleEvents:function(){var b=this;this.pseudoElem.on("keydown.dropdown",function(c){b.ignoreKeys(a(this),c),b.handleKeyDown(a(this),c)}).on("keypress.dropdown",function(c){9!==c.keyCode&&(b.ignoreKeys(a(this),c),b.settings.noSearch||b.toggleList(),b.handleAutoComplete(c))}).on("click.dropdown",function(a){a.stopPropagation()}).on("mouseup.dropdown",function(a){2!==a.button&&b.toggleList()}).on("touchend.dropdown touchcancel.dropdown",function(a){a.stopPropagation(),b.toggleList(),a.preventDefault()}),b.element.on("activated.dropdown",function(){b.label.trigger("click")}).on("updated.dropdown",function(a){a.stopPropagation(),b.updated()}).on("openlist.dropdown",function(){b.toggleList()}),b.element.closest("form").on("reset.dropdown",function(){setTimeout(function(){b.element.triggerHandler("updated")},1)}),this.label.onTouchClick().on("click",function(){b.pseudoElem.focus()})}},this.each(function(){var b=a.data(this,d);b?(b.settings=a.extend({},h,b.settings),b.updated()):b=a.data(this,d,new c(this,h))})},a.fn.drag=function(b){"use strict";function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="drag",e={axis:null,clone:!1,cloneCssClass:"is-clone",clonePosIsFixed:!1,cloneAppendTo:null,containment:!1,obstacle:!1,containmentOffset:{left:0,top:0}},f=a.extend({},e,b);return c.prototype={init:function(){this.handleEvents()},finish:function(b,c){var d={top:c,left:b};this.element.off("mouseup.draggable"),a(document).off("mousemove.draggable mouseup.draggable"),this.element.trigger("dragend",d),this.element.removeClass("is-dragging"),this.clone&&("x"===f.axis&&delete d.top,"y"===f.axis&&delete d.left,this.clone.remove(),this.clone=null),this.obstacle&&(this.obstacle=null),this.upperYLimit&&(this.upperYLimit=null),this.upperXLimit&&(this.upperXLimit=null),a("body").removeClass("disable-select")},move:function(b,c){var d=this,e={left:b,top:c};if("x"===f.axis&&delete e.top,"y"===f.axis&&delete e.left,f.containment&&("parent"===f.containment?this.container=this.element.parent():"window"===f.containment?this.container=a(window):"container"===f.containment?this.container=this.element.closest(".page-container"):this.container=a(document),this.upperXLimit||(this.upperXLimit=this.container.width()-this.element.outerWidth()+f.containmentOffset.left),this.upperYLimit||(this.upperYLimit=this.container.height()-this.element.outerHeight()+f.containmentOffset.top),e.top>this.upperYLimit&&(e.top=this.upperYLimit),e.left>this.upperXLimit&&(e.left=this.upperXLimit),e.top<0&&(e.top=0),e.left<0&&(e.left=0),"container"===f.containment&&e.left<=1&&(e.left=1)),f.obstacle){var g=this.clone?this.clone.offset():this.element.offset(),h=this.clone?this.clone.outerWidth():this.element.outerWidth(),i=e.left>g.left;if(!this.obstacle){this.obstacle=a(f.obstacle).not(this.element);var j=a(this.obstacle).offset();this.constraints={top:j.top,left:j.left,bottom:j.top+this.obstacle.outerHeight(),right:j.left+this.obstacle.outerWidth()}}!i&&d.originalPos.left>this.constraints.left&&e.left<=this.constraints.right&&(e.left=this.constraints.right),i&&d.originalPos.left+h<=this.constraints.left&&e.left+h>=this.constraints.left&&(e.left=this.constraints.left-this.obstacle.outerWidth())}var k=function(a,b,c){void 0!==b[c]&&(a[0].style[c]=b[c]+"px")};k(this.clone||this.element,e,"top"),k(this.clone||this.element,e,"left"),this.element.trigger("drag",e)},destroy:function(){a.removeData(this.element[0],d),this.element.off("touchstart.draggable MSPointerDown.draggable pointerdown.draggable touchmove.draggable touchend.draggable touchcancel.draggable mousedown.draggable")},handleEvents:function(){var b=this;b.offset=null,b.element.attr("draggable",!1),"onpointerdown"in window||"onmspointerdown"in window||b.element.on("touchstart.draggable gesturestart.draggable",function(c){var d=a(this).position(),e=c.originalEvent;b.offset={x:e.changedTouches[0].pageX-d.left,y:e.changedTouches[0].pageY-d.top},b.originalPos=d,b.element.addClass("is-dragging"),b.element.trigger("dragstart",d)}).on("touchmove.draggable gesturechange.draggable",function(a){a.preventDefault();var c=a.originalEvent;c.targetTouches.length>1||b.move(c.changedTouches[0].pageX-b.offset.x,c.changedTouches[0].pageY-b.offset.y)}).on("touchend.draggable gestureend.draggable touchcancel.draggable",function(a){a.preventDefault();var c=a.originalEvent.changedTouches[0];b.finish(c.pageX-b.offset.x,c.pageY-b.offset.y)}),b.element.on("mousedown.draggable",function(c){c.preventDefault();var d=f.clonePosIsFixed?b.element[0].getBoundingClientRect():b.element.position();b.offset={x:c.pageX-d.left,y:c.pageY-d.top},b.originalPos=d,a("body").addClass("disable-select"),a(document).on("mousemove.draggable",function(a){a.preventDefault(),b.move(a.pageX-b.offset.x,a.pageY-b.offset.y)}),a(document).on("mouseup.draggable",function(a){a.preventDefault(),b.finish(a.pageX-b.offset.x,a.pageY-b.offset.y)}),b.element.on("mouseup.draggable",function(a){a.preventDefault(),b.finish(a.pageX-b.offset.x,a.pageY-b.offset.y)}),!b.clone&&f.clone&&(b.clone=b.element.clone(!0),"parent"===f.cloneAppendTo&&(f.cloneAppendTo=b.element.parent()),b.clone.addClass(f.cloneCssClass).appendTo(f.cloneAppendTo||"body")),b.element.addClass("is-dragging"),b.element.trigger("dragstart",[d,b.clone])})}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},a.fn.editor=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="editor",e={buttons:{editor:["header1","header2","separator","bold","italic","underline","strikethrough","separator","foreColor","backColor","separator","justifyLeft","justifyCenter","justifyRight","separator","quote","orderedlist","unorderedlist","separator","anchor","separator","image","separator","source"],source:["visual"]},excludeButtons:{editor:["backColor"],source:[]},delay:200,firstHeader:"h3",secondHeader:"h4",placeholder:null,pasteAsPlainText:!1,anchor:{url:"http://www.example.com",class:"hyperlink",target:"New window"},image:{url:"http://lorempixel.com/output/cats-q-c-300-200-3.jpg"}},f=a.extend({},e,b);return c.prototype={init:function(){return this.isIE=a("html").is(".ie"),this.isMac=a("html").is(".is-mac"),this.isIeEdge=a("html").is(".ie-edge"),this.isFirefox=a("html").is(".is-firefox"),this.parentElements=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.id=a(".editor-toolbar").length+1,this.container=this.element.parent(".field, .field-short").addClass("editor-container"),f.anchor.defaultUrl=f.anchor.url,f.anchor.defaultClass=f.anchor.class,f.anchor.defaultTargetText=f.anchor.target,f.anchor.targets={"Same window":"","New window":"_blank"},a.each(f.anchor.targets,function(a,b){f.anchor.defaultTargetText.toLowerCase()===a.toLowerCase()&&(f.anchor.target=b,f.anchor.defaultTarget=b)}),f.anchor.defaultTarget||(f.anchor.target&&a.trim(f.anchor.target).length?f.anchor.defaultTarget=f.anchor.target:(f.anchor.defaultTargetText="Same window",f.anchor.defaultTarget=f.anchor.targets[f.anchor.defaultTargetText])),this.setup()},setup:function(){this.isActive=!0,this.modals={},this.initElements().bindSelect().bindPaste().setPlaceholders().bindWindowActions().setupKeyboardEvents().onPasteTriggered()},initElements:function(){var a,b=this.element;return b.attr({contentEditable:!0,"aria-multiline":!0,role:"textbox"}),b.attr("data-editor",!0),this.bindParagraphCreation(a).bindTab(a),this.initToolbar().bindButtons().bindModals().bindAnchorPreview(),this.initTextarea(),this},sourceViewActive:function(){return this.element.hasClass("source-view-active")},setPlaceholders:function(){var a=this;return a.element.on("blur.editor",function(){a.togglePlaceHolder()}).on("keypress",function(){a.togglePlaceHolder()}),a.togglePlaceHolder(),this},togglePlaceHolder:function(){var a=this.element;""===a.text().trim()?a.addClass("editor-placeholder"):a.removeClass("editor-placeholder")},getCurrentElement:function(){return this.sourceViewActive()?this.textarea:this.element},bindParagraphCreation:function(){var a=this;return a.getCurrentElement().on("keyup.editor",function(b){var c,d=a.getSelectionStart();d&&d.getAttribute("data-editor")&&0===d.children.length&&document.execCommand("formatBlock",!1,"p"),13===b.which&&(d=a.getSelectionStart(),"li"===(c=d.tagName.toLowerCase())||a.isListItemChild(d)||(b.shiftKey||document.execCommand("formatBlock",!1,"p"),"a"===c&&document.execCommand("unlink",!1,null)))}),this},bindTab:function(){var a=this;return a.getCurrentElement().on("keydown.editor",function(b){if(9===b.which){var c=a.getSelectionStart().tagName.toLowerCase();"pre"===c&&(b.preventDefault(),document.execCommand("insertHtml",null,"    ")),"li"===c&&(b.shiftKey?document.execCommand("outdent",b):document.execCommand("indent",b))}}),this},getPasteEvent:function(){var a=document.createElement("input");return a.setAttribute("onpaste",""),("function"==typeof a.onpaste?"paste":"input")+".editor"},initToolbar:function(){return this.toolbar?this:(this.toolbar=this.createToolbar(),this.toolbarActions=this.toolbar,this.toolbar.toolbar(),this)},setExcludedButtons:function(){var a=this,b=function(a,b){var c=-1,d=0;return a.filter(function(a,e){var f=!0;return b.indexOf(a)>-1&&"separator"!==a?(d++,f=!1):"separator"===a&&e-d-1===c&&(d=0,f=!1),"separator"===a&&(c=e),f})};return function(){var c=a.settings,d=c.buttons,e=c.excludeButtons;return a.sourceViewActive()?e&&e.source&&e.source.length?b(d.source,e.source):d.source:e&&e.editor&&e.editor.length?b(d.editor,e.editor):d.editor}()},createToolbar:function(){var b=a('<div class="toolbar editor-toolbar formatter-toolbar"></div>').attr("id","editor-toolbar-"+this.id);return this.toolbarButtons(b),b.insertBefore(this.sourceViewActive()?this.element.prev():this.element),b.find("button").tooltip(),b},toolbarButtons:function(b){var c,d,e=this.setExcludedButtons(),f=b.find(".buttonset");for(f.length||(f=a('<div class="buttonset"></div>').appendTo(b)),c=0;c<e.length;c+=1)(d=this.buttonTemplate(e[c]))&&f.append(d);var g=a('[data-action="foreColor"], [data-action="backColor"]',f);g.colorpicker({placeIn:"editor"}),a(".trigger",g).off("click.colorpicker")},switchToolbars:function(){this.destroyToolbar(),this.setupTextareaEvents().initToolbar().bindButtons().bindModals().bindAnchorPreview(),this.bindSelect().bindPaste().setupKeyboardEvents(),this.toolbar.find("button").button()},initTextarea:function(){var a=this;return this.textarea?this:(this.textarea=this.createTextarea(),this.textarea.text(this.element.html().toString()),this.element.on("input.editor keyup.editor",function(){a.textarea.val(a.element.html().toString())}),this.setupTextareaEvents(),this.textarea)},createTextarea:function(){this.sourceView=a("<div></div>").attr({class:"editor-source editable hidden",id:"editor-source-"+this.id}).insertBefore(this.element),a("<ul></ul>").addClass("line-numbers").appendTo(this.sourceView);var b=a('<div class="text-container"></div>').appendTo(this.sourceView),c="source-textarea-"+(a('[id^="source-textarea-"]').length+1),d=this.element.prev(".label").addClass("audible").text()+" - HTML Source View";return a('<label class="audible" for="'+c+'">'+d+"</label>").appendTo(b),a('<textarea id="'+c+'" class="editable"></textarea>').appendTo(b)},triggerClick:function(b,c){a('button[data-action="'+c+'"]',this.toolbar).trigger("click.editor")},setupKeyboardEvents:function(){var b=this,c=this.getCurrentElement(),d={b:66,e:69,h:72,i:73,l:76,bl:55,n:56,q:81,r:82,u:85,h3:51,h4:52,sv:192};return c.on("keydown.editor",function(a){switch(a=a||window.event,d.charCode=a.which?a.which:!!a.keyCode&&a.keyCode,a.ctrlKey&&d.charCode){case d.h3:b.triggerClick(a,"append-"+f.firstHeader);break;case d.h4:b.triggerClick(a,"append-"+f.secondHeader);break;case d.b:b.triggerClick(a,"bold"),a.preventDefault();break;case d.e:b.triggerClick(a,"justifyCenter");break;case d.h:b.triggerClick(a,"anchor"),a.preventDefault();break;case d.i:b.triggerClick(a,a.shiftKey?"image":"italic"),a.shiftKey||a.preventDefault();break;case d.bl:a.shiftKey&&b.triggerClick(a,"insertunorderedlist"),a.preventDefault();break;case d.l:a.shiftKey||b.triggerClick(a,"justifyLeft"),a.preventDefault();break;case d.n:a.shiftKey&&b.triggerClick(a,"insertorderedlist");break;case d.q:b.triggerClick(a,"append-blockquote");break;case d.r:b.triggerClick(a,"justifyRight");break;case d.u:b.triggerClick(a,"underline"),a.preventDefault();break;case d.sv:b.triggerClick(a,c===b.element?"source":"visual")}}),b.element.on("mousedown.editor","a",function(c){var d=a(this).attr("href");!b.isFirefox&&(b.isMac&&c.metaKey||!b.isMac&&c.ctrlKey)&&(window.open(d,"_blank"),c.preventDefault())}),b},setupTextareaEvents:function(){var b=this;return this.textarea.on("input.editor keyup.editor",function(){b.sourceView.hasClass("hidden")||b.adjustSourceLineNumbers()}).on("focus.editor",function(){b.sourceView.addClass("is-focused")}).on("blur.editor",function(c){b.sourceView.removeClass("is-focused"),b.element.empty().html(a.sanitizeHTML(b.textarea.val())),b.element.data("validate")&&b.element.data("validate").validate(b.element,!0,c)}),this},adjustSourceLineNumbers:function(){var a=this.textarea.parent(),b=parseInt(getComputedStyle(this.textarea[0]).lineHeight),c=this.textarea.innerHeight()-this.textarea.height();this.textarea[0].style.height="";var d=this.textarea[0].scrollHeight,e=Math.floor((d-c)/b),f=this.sourceView.find(".line-numbers"),g=f.find("li").length,h="",i=0;if(!this.lineNumbers||e!==this.lineNumbers){if(this.lineNumbers)if(this.lineNumbers<e){for(;i<e-this.lineNumbers;)h+='<li role="presentation"><span>'+(g+i+1)+"</span></li>",i++;f.append(h)}else this.lineNumbers>e&&(i=this.lineNumbers-e,f.find("li").slice(-i).remove());else{for(this.lineNumbers=e;i<this.lineNumbers;)h+='<li role="presentation"><span>'+(i+1)+"</span></li>",i++;f.append(h)}this.lineNumbers=e,a[0].style.width="calc(100% - "+(f.outerWidth()+1)+"px)"}if(d!==this.textarea[0].scrollHeight)return void this.adjustSourceLineNumbers();this.textarea[0].style.height=f[0].scrollHeight+"px"},wrapTextInTags:function(b,c,d){var e,g;switch(d){case"bold":e=["<b>","</b>"];break;case"italic":e=["<i>","</i>"];break;case"underline":e=["<u>","</u>"];break;case"strikethrough":e=["<strike>","</strike>"];break;case"append-blockquote":e=["<blockquote>","</blockquote>"];break;default:e=["",""]}if("anchor"===d){var h=a('<a href="'+b+'">'+c+"</a>");f.anchor.class&&a.trim(f.anchor.class).length&&h.addClass(f.anchor.class),f.anchor.target&&a.trim(f.anchor.target).length&&h.attr("target",f.anchor.target),g=h[0].outerHTML}else g=e[0]+b+c+e[1];return g},insertTextAreaContent:function(b,c){var d,e,f,g,h=this.textarea[0],i=h.value;b=b||"",document.selection&&"TEXTAREA"===h.tagName?(a(h).focus(),d=document.selection.createRange(),d.text=this.wrapTextInTags(b,d.text,c),a(h).focus()):h.selectionStart||"0"===h.selectionStart?(e=h.selectionStart,f=h.selectionEnd,g=h.scrollTop,d=this.wrapTextInTags(b,i.substring(e,f),c),h.value=i.substring(0,e)+d+i.substring(f,i.length),a(h).focus(),h.selectionStart=e+d.length,h.selectionEnd=e+d.length,h.scrollTop=g):(h.value+=this.wrapTextInTags(b,h.value,c),a(h).focus(),h.value=h.value)},buttonTemplate:function(a){var b=this.getButtonLabels(f.buttonLabels);return{bold:'<button type="button" class="btn" title="'+Locale.translate("ToggleBold")+'" data-action="bold" data-element="b">'+b.bold+"</button>",italic:'<button type="button" class="btn" title="'+Locale.translate("ToggleItalic")+'" data-action="italic" data-element="i">'+b.italic+"</button>",underline:'<button type="button" class="btn underline" title="'+Locale.translate("ToggleUnderline")+'" data-action="underline" data-element="u">'+b.underline+"</button>",strikethrough:'<button type="button" class="btn" title="'+Locale.translate("StrikeThrough")+'" data-action="strikethrough" data-element="strike">'+b.strikethrough+"</button>",foreColor:'<button type="button" class="btn colorpicker-editor-button" title="'+Locale.translate("TextColor")+'" data-action="foreColor" data-element="foreColor">'+b.foreColor+"</button>",backColor:'<button type="button" class="btn colorpicker-editor-button" title="'+Locale.translate("BackgroundColor")+'" data-action="backColor" data-element="backColor">'+b.backColor+"</button>",superscript:'<button type="button" class="btn" title="'+Locale.translate("Superscript")+'" data-action="superscript" data-element="sup">'+b.superscript+"</button>",subscript:'<button type="button" class="btn" title="'+Locale.translate("Subscript")+'" data-action="subscript" data-element="sub">'+b.subscript+"</button>",separator:'<div class="separator"></div>',anchor:'<button type="button" class="btn" title="'+Locale.translate("InsertAnchor")+'" data-action="anchor" data-modal="editor-modal-url" data-element="a">'+b.anchor+"</button>",image:'<button type="button" class="btn" title="'+Locale.translate("InsertImage")+'" data-action="image" data-modal="editor-modal-image" data-element="img">'+b.image+"</button>",header1:'<button type="button" class="btn" title="'+Locale.translate("ToggleH3")+'" data-action="append-'+f.firstHeader+'" data-element="'+f.firstHeader+'">'+b.header1+"</button>",header2:'<button type="button" class="btn" title="'+Locale.translate("ToggleH4")+'" data-action="append-'+f.secondHeader+'" data-element="'+f.secondHeader+'">'+b.header2+"</button>",quote:'<button type="button" class="btn" title="'+Locale.translate("Blockquote")+'" data-action="append-blockquote" data-element="blockquote">'+b.quote+"</button>",orderedlist:'<button type="button" class="btn" title="'+Locale.translate("OrderedList")+'" data-action="insertorderedlist" data-element="ol">'+b.orderedlist+"</button>",unorderedlist:'<button type="button" class="btn" title="'+Locale.translate("UnorderedList")+'" data-action="insertunorderedlist" data-element="ul">'+b.unorderedlist+"</button>",justifyLeft:'<button type="button" class="btn" title="'+Locale.translate("JustifyLeft")+'" data-action="justifyLeft" >'+b.justifyLeft+"</button>",justifyCenter:'<button type="button" class="btn" title="'+Locale.translate("JustifyCenter")+'" data-action="justifyCenter">'+b.justifyCenter+"</button>",justifyRight:'<button type="button" class="btn" title="'+Locale.translate("JustifyRight")+'" data-action="justifyRight" >'+b.justifyRight+"</button>",source:'<button type="button" class="btn" title="'+Locale.translate("ViewSource")+'" data-action="source" >'+b.source+"</button>",visual:'<button type="button" class="btn" title="'+Locale.translate("ViewVisual")+'" data-action="visual" >'+b.visual+"</button>"}[a]||!1},getIcon:function(b,c,d){return'<span class="audible">'+Locale.translate(b)+"</span>"+a.createIcon({classes:d||"",icon:c})},getButtonLabels:function(a){var b,c,d={bold:this.getIcon("Bold","bold"),italic:this.getIcon("Italic","italic"),underline:this.getIcon("Underline","underline"),superscript:'<span aria-hidden="true"><b>x<sup>1</sup></b></span>',subscript:'<span aria-hidden="true"><b>x<sub>1</sub></b></span>',strikethrough:this.getIcon("StrikeThrough","strike-through"),foreColor:this.getIcon("TextColor","fore-color"),backColor:this.getIcon("BackgroundColor","back-color"),anchor:this.getIcon("InsertAnchor","link"),image:this.getIcon("InsertImage","insert-image"),header1:this.getIcon("ToggleH3","h3"),header2:this.getIcon("ToggleH4","h4"),quote:this.getIcon("Blockquote","quote"),orderedlist:this.getIcon("OrderedList","number-list"),unorderedlist:this.getIcon("UnorderedList","bullet-list"),pre:'<span aria-hidden="true"><b>0101</b></span>',indent:'<span aria-hidden="true"><b>&rarr;</b></span>',outdent:'<span aria-hidden="true"><b>&larr;</b></span>',justifyLeft:this.getIcon("JustifyLeft","left-text-align"),justifyCenter:this.getIcon("JustifyCenter","center-text"),justifyRight:this.getIcon("JustifyRight","right-text-align"),
source:this.getIcon("ViewSource","html","html-icon"),visual:this.getIcon("ViewSource","visual","visual-icon")};if("object"==typeof a&&(b=a),"object"==typeof b)for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);return d},activateButton:function(a){this.toolbar.find('[data-element="'+a+'"]').addClass("is-active")},bindButtons:function(){var b=this;return this.toolbar.on("touchstart.editor click.editor","button",function(c){var d=a(this),e=d.attr("data-action");if(!d.is(".btn-actions"))return c.preventDefault(),b.getCurrentElement().focus(),void 0===b.selection&&b.checkSelection(),b.sourceViewActive()||d.toggleClass("is-active"),e&&b.execAction(e,c),!1}),this},bindModals:function(){var b=this;return b.modals={url:b.createURLModal(),image:b.createImageModal()},a('[name="em-target"]').dropdown(),a("#editor-modal-url, #editor-modal-image").modal().on("beforeopen",function(){b.savedSelection=b.saveSelection(),"editor-modal-url"===a(this).attr("id")&&b.selectionRange}).off("open").on("open",function(){var b=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),c=a(this).attr("id"),d=a("input:first",this),e=a(".modal-buttonset .btn-modal-primary",this);a('[name="em-url"]').val(f.anchor.url),a('[name="em-class"]').val(f.anchor.class),a('[name="em-target"]').val(f.anchor.target).trigger("updated"),setTimeout(function(){b&&"editor-modal-image"===c?e.focus():d.focus().select()},10)}).off("close").on("close",function(c,d){if(b.restoreSelection(b.savedSelection),!d)if("editor-modal-url"===a(this).attr("id")){var e=a(b.findElementInSelection("a",b.element[0]));e.length?b.updateCurrentLink(e):b.createLink(a('[name="em-url"]',this))}else b.insertImage(a("#image").val())}),this},createURLModal:function(){var b="",c=!0,d=a("#editor-modal-url");return d.length>0?d:(a.each(f.anchor.targets,function(a,d){b+='<option value="'+d+'">'+a+"</option>",f.anchor.defaultTargetText.toLowerCase()===a.toLowerCase()&&(c=!1)}),c&&(b+='<option value="'+f.anchor.target+'">'+f.anchor.target+"</option>"),a('<div class="modal editor-modal-url" id="editor-modal-url"></div>').html('<div class="modal-content"><div class="modal-header"><h1 class="modal-title">'+Locale.translate("InsertAnchor")+'</h1></div><div class="modal-body"><div class="field"><label for="em-url">'+Locale.translate("Url")+'</label><input id="em-url" name="em-url" type="text" value="'+f.anchor.url+'"></div><div class="field"><label for="em-class">'+Locale.translate("CssClass")+'</label><input id="em-class" name="em-class" type="text" value="'+f.anchor.class+'"></div><div class="field"><label for="em-target" class="label">'+Locale.translate("Target")+'</label><select id="em-target" name="em-target" class="dropdown">'+b+'</select></div><div class="modal-buttonset"><button type="button" class="btn-modal btn-cancel">'+Locale.translate("Cancel")+'</button><button type="button" class="btn-modal-primary">'+Locale.translate("Insert")+"</button></div></div></div>").appendTo("body"))},createImageModal:function(){var b=a("#editor-modal-image");return b.length>0?b:a('<div class="modal editor-modal-image" id="editor-modal-image"></div>').html('<div class="modal-content"><div class="modal-header"><h1 class="modal-title">'+Locale.translate("InsertImage")+'</h1></div><div class="modal-body"><div class="field"><label for="image">'+Locale.translate("Url")+'</label><input id="image" name="image" type="text" value="'+f.image.url+'"></div><div class="modal-buttonset"><button type="button" class="btn-modal btn-cancel">'+Locale.translate("Cancel")+'</button><button type="button" class="btn-modal-primary">'+Locale.translate("Insert")+"</button></div></div></div>").appendTo("body")},bindAnchorPreview:function(){this.element.find("a").tooltip({content:function(){return a(this).attr("href")}})},updateCurrentLink:function(b){var c=a('[name="em-url"]').val(),d=a('[name="em-class"]').val(),e=a('[name="em-target"]').val();b.attr("href",c&&a.trim(c).length?c:f.anchor.defaultUrl),b.attr("class",d&&a.trim(d).length?d:f.anchor.defaultClass),e&&a.trim(e).length?b.attr("target",e):b.removeAttr("target")},createLink:function(b){var c;if(this.restoreSelection(this.savedSelection),b.val(this.fixLinkFormat(b.val())),f.anchor.url=b.val(),f.anchor.class=a('[name="em-class"]').val(),f.anchor.target=a('[name="em-target"]').val(),c=a('<a href="'+b.val()+'">'+b.val()+"</a>"),f.anchor.class&&a.trim(f.anchor.class).length&&c.addClass(f.anchor.class),f.anchor.target&&a.trim(f.anchor.target).length&&c.attr("target",f.anchor.target),this.sourceViewActive())this.insertTextAreaContent(b.val(),"anchor");else{var d,e;if(this.selection.isCollapsed){var g=this;document.execCommand("insertHtml",null,c[0].outerHTML),setTimeout(function(){g.getCurrentElement().focus()},1)}else if(window.getSelection&&(d=window.getSelection(),d.getRangeAt&&d.rangeCount)){e=d.getRangeAt(0),c.html(e+""),e.deleteContents();var h=document.createElement("div");h.innerHTML=c[0].outerHTML;for(var i,j,k=document.createDocumentFragment();i=h.firstChild;)j=k.appendChild(i);e.insertNode(k),j&&(e=e.cloneRange(),e.setStartAfter(j),e.collapse(!0),d.removeAllRanges(),d.addRange(e))}this.bindAnchorPreview()}},fixLinkFormat:function(a){var b=/^https?:\/\//;return a.match(b)?a:"http://"+a},bindSelect:function(){var a=this,b="";return this.selectionHandler=function(){clearTimeout(b),b=setTimeout(function(){a.checkSelection()},f.delay)},a.getCurrentElement().off("mouseup.editor keyup.editor").on("mouseup.editor keyup.editor",this.selectionHandler),this},checkSelection:function(){var a,b;return void 0===this.selection&&this.sourceViewActive()?(a=this.textarea.val().substring(this.textarea[0].selectionStart,this.textarea[0].selectionEnd).toString().trim(),void this.hideToolbarActions()):(a=window.getSelection(),b=this.getSelectionElement(),b?this.checkSelectionElement(a,b):this.hideToolbarActions(),this)},getSelectionElement:function(){var a,b,c,d,e=window.getSelection(),f=function(a){var b=a;try{for(;!b.getAttribute("data-editor");)b=b.parentNode}catch(a){return!1}return b};try{a=e.getRangeAt(0),b=a.commonAncestorContainer,c=b.parentNode,d=b.getAttribute("data-editor")?b:f(c)}catch(a){d=f(c)}return d},checkSelectionElement:function(a,b){var c=this.sourceViewActive()?this.sourceView[0]:this.element[0];if(this.selection=a,this.selectionRange=this.selection.getRangeAt(0),c===b)return void this.setToolbarButtonStates();this.hideToolbarActions()},setToolbarButtonStates:function(){return this.toolbarActions.find("button").removeClass("is-active"),this.checkActiveButtons(),this},checkActiveButtons:function(){this.checkButtonState("bold"),this.checkButtonState("italic"),this.checkButtonState("underline");for(var a=this,b=this.getSelectedParentElement();void 0!==b.tagName&&-1===this.parentElements.indexOf(b.tagName.toLowerCase)&&(this.activateButton(b.tagName.toLowerCase()),!a.element.is(b));)b=b.parentNode},checkButtonState:function(a){document.queryCommandState&&(document.queryCommandState(a)?this.toolbar.find('[data-action="'+a+'"]').addClass("is-active"):this.toolbar.find('[data-action="'+a+'"]').removeClass("is-active"))},rangeSelectsSingleNode:function(a){var b=a.startContainer;return b===a.endContainer&&b.hasChildNodes()&&a.endOffset===a.startOffset+1},getSelectedParentElement:function(){var a=this.selectionRange;return this.rangeSelectsSingleNode(a)?a.startContainer.childNodes[a.startOffset]:3===a.startContainer.nodeType?a.startContainer.parentNode:a.startContainer},hideToolbarActions:function(){void 0!==this.toolbar&&this.toolbar.removeClass("is-active")},bindPaste:function(){var b=this,c=b.getCurrentElement();return b.pasteEvent||(b.pasteEvent=b.getPasteEvent()),this.pasteWrapper=function(a){var c,d,e=a.originalEvent.clipboardData&&a.originalEvent.clipboardData.getData?a.originalEvent.clipboardData.getData("text/plain"):!(!window.clipboardData||!window.clipboardData.getData)&&window.clipboardData.getData("Text"),f="";if(b.sourceViewActive())return this;if(e&&!a.defaultPrevented){for(a.preventDefault(),c=e.split(/[\r\n]/g),d=0;d<c.length;d+=1)""!==c[d]&&(navigator.userAgent.match(/firefox/i)&&0===d?f+="<p>"+b.htmlEntities(c[d])+"</p>":/\.(gif|jpg|jpeg|tiff|png)$/i.test(c[d])?f+='<img src="'+b.htmlEntities(c[d])+'" />':f+="<p>"+b.htmlEntities(c[d])+"</p>");if(document.queryCommandSupported("insertText"))return document.execCommand("insertHTML",!1,f),!1;b.pasteHtmlAtCaret(f)}},this.pasteWrapperHtml=function(c){if(b.sourceViewActive())return this;var d,e,f,g,h,i;if((c.clipboardData||c.originalEvent)&&(c.clipboardData&&c.clipboardData.types?e=c.clipboardData:c.originalEvent&&c.originalEvent.clipboardData&&c.originalEvent.clipboardData.getData&&(e=c.originalEvent.clipboardData)),e&&e.types)((d=e.types)instanceof DOMStringList&&d.contains("text/html")||d.indexOf&&-1!==d.indexOf("text/html"))&&(f=c.originalEvent.clipboardData.getData("text/html"));else for(g=window.clipboardData.getData("Text"),i=g.split(/[\r\n]/g),f="",h=0;h<i.length;h+=1)""!==i[h]&&(navigator.userAgent.match(/firefox/i)&&0===h?f+="<p>"+b.htmlEntities(i[h])+"</p>":/\.(gif|jpg|jpeg|tiff|png)$/i.test(i[h])?f+='<img src="'+b.htmlEntities(i[h])+'" />':f+="<p>"+b.htmlEntities(i[h])+"</p>");return b.pastedData=function(a){var c,d,e,f=a||"",g=["start","xmlns","xmlns:o","xmlns:w","xmlns:x","xmlns:m","onmouseover","onmouseout","onmouseenter","onmouseleave","onmousemove","onload","onfocus","onblur","onclick","style"];for(b.isWordFormat(f)&&(f=b.cleanWordHtml(f)),c=0,d=g.length;c<d;c++)e=new RegExp(" "+g[c]+'="(.*?)"',"gi"),f=b.stripAttribute(f,g[c],e),e=new RegExp(" "+g[c]+"='(.*?)'","gi"),f=b.stripAttribute(f,g[c],e);return f=f.replace(/(ng-\w+-\w+="(.|\n)*?"|ng-\w+="(.|\n)*?"|ng-(\w+-\w+)|ng-(\w+))/g,""),f=f.replace(/<!--(.*?)-->/gm,""),f=f.replace(/\s\s+/g," ").replace(/\s>+/g,">"),f=f.replace(/<(ul|ol)(.*?)>/gi,"<$1>"),f=f.replace(/<\/?(html|body)(.*?)>/gi,""),f=f.replace(/<head\b[^>]*>(.*?)<\/head>/gi,"")}(f),a.when(b.element.triggerHandler("beforepaste",[{pastedData:b.pastedData}])).done(function(){if(b.pastedData&&!c.defaultPrevented){if(c.preventDefault(),document.queryCommandSupported("insertText"))return document.execCommand("insertHTML",!1,b.pastedData),!1;b.pasteHtmlAtCaret(b.pastedData)}b.element.triggerHandler("afterpaste",[{pastedData:b.pastedData}]),b.pastedData=null}),!1},c.on(b.pasteEvent,b.settings.pasteAsPlainText?b.pasteWrapper:b.pasteWrapperHtml),this},pasteHtmlAtCaret:function(a){var b,c;if(window.getSelection){if(b=window.getSelection(),b.getRangeAt&&b.rangeCount){c=b.getRangeAt(0),c.deleteContents();var d=document.createElement("div");d.innerHTML=a;for(var e,f,g=document.createDocumentFragment();e=d.firstChild;)f=g.appendChild(e);c.insertNode(g),f&&(c=c.cloneRange(),c.setStartAfter(f),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(a)},htmlEntities:function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},bindWindowActions:function(){var b=this,c=this.element.closest(".editor-container"),d=b.getCurrentElement();b.element.on("mousedown.editor",function(){b.mousedown=!0}).on("focus.editor",function(){b.isFirefox&&!b.mousedown&&b.element===d&&b.setFocus()}).on("DOMNodeInserted",function(b){var c=a(b.target),d=a("<b>helper</b>");"IMG"===b.target.tagName?c.removeAttr("id style srcset"):"SPAN"===b.target.tagName&&(c.before(d),d.after(c.contents()),d.add(c).remove())}),c.on("focus.editor",".editor, .editor-source",function(){var b=a(this);c.addClass("is-active"),setTimeout(function(){b.hasClass("error")&&(c.parent().find(".editor-toolbar").addClass("error"),c.parent().find(".editor-source").addClass("error"))},100)}).on("blur.editor",".editor, .editor-source",function(){c.removeClass("is-active"),c.parent().find(".editor-toolbar").removeClass("error"),c.parent().find(".editor-source").removeClass("error")});for(var e=this.element.prevAll(".label"),f=0,g=e.length;f<g;f++)e[f].style.cursor="default";return e.on("click.editor",function(){d.focus()}),d.attr("aria-label",e.text()),this},restoreSelection:function(a){var b,c,d=window.getSelection();if(a||(a=this.savedSelection),a)for(d.removeAllRanges(),b=0,c=a.length;b<c;b+=1)d.addRange(a[b])},saveSelection:function(){var a,b,c,d=window.getSelection();if(d.getRangeAt&&d.rangeCount){for(c=[],a=0,b=d.rangeCount;a<b;a+=1)c.push(d.getRangeAt(a));return c}return null},getSelectionStart:function(){var a=document.getSelection().anchorNode;return a&&3===a.nodeType?a.parentNode:a},getrange:function(){return window.getSelection().getRangeAt(0)},findElementInSelection:function(a,b){var c,d,e,f,g,h=this.getrange();if(h){for(g=h.commonAncestorContainer||h.parentElement(),e=g;e!==b;e=e.parentNode)if(e.tagName&&e.tagName.toLowerCase()===a)return e;if(!h.collapsed&&(void 0===h.text||h.text)&&g.getElementsByTagName)for(e=g.getElementsByTagName(a),f=document.createRange?document.createRange():document.body.createTextRange(),c=0,d=e.length;c<d;c++)if(document.createRange){if(f.selectNodeContents(e[c]),h.compareBoundaryPoints(Range.END_TO_START,f)<0&&h.compareBoundaryPoints(Range.START_TO_END,f)>0)return e[c]}else if(f.moveToElementText(e[c]),h.compareEndPoints("StartToEnd",f)<0&&h.compareEndPoints("EndToStart",f)>0)return e[c]}},restoreLinkSelection:function(){var b=a(this.findElementInSelection("a",this.element[0]));f.anchor.url=f.anchor.defaultUrl,f.anchor.class=f.anchor.defaultClass,f.anchor.target=f.anchor.defaultTarget,b.length&&(f.anchor.url=b.attr("href"),f.anchor.class=b.attr("class"),f.anchor.target=b.attr("target"))},execAction:function(a){if(this.getCurrentElement()===this.element)a.indexOf("append-")>-1?(this.execFormatBlock(a.replace("append-","")),this.setToolbarButtonStates()):"anchor"===a?(this.restoreLinkSelection(),this.modals.url.data("modal").open()):"image"===a?this.modals.image.data("modal").open():"foreColor"===a||"backColor"===a?this.colorpickerActions(a):"source"===a||"visual"===a?this.toggleSource():document.execCommand(a,!1,null);else switch(a){case"visual":this.toggleSource();break;case"anchor":this.modals.url.data("modal").open();break;default:this.insertTextAreaContent(null,a)}},insertImage:function(a){document.execCommand("insertImage",!1,a)},toggleSource:function(){if(this.sourceViewActive())this.element.empty().html(a.sanitizeHTML(this.textarea.val())),this.element.removeClass("source-view-active hidden"),this.sourceView.addClass("hidden").removeClass("is-focused"),this.element.trigger("focus.editor");else{var b=this.element.html().toString().trim().replace(/\s+/g," ").replace(/<br( \/)?>/g,"<br>\n").replace(/<\/p> /g,"</p>\n\n").replace(/<\/blockquote>( )?/g,"</blockquote>\n\n");this.textarea.val(b).focus(),this.element.addClass("source-view-active hidden"),this.sourceView.removeClass("hidden"),this.adjustSourceLineNumbers(),this.textarea.focus()}this.switchToolbars()},colorpickerActions:function(b){var c=this,d=a('[data-action="'+b+'"]',this.toolbar),e=d.data("colorpicker"),f=document.queryCommandValue(b);e&&(c.isFirefox&&"backColor"===b&&(f=a(window.getSelection().focusNode.parentNode).css("background-color")),"number"==typeof f&&(f=e.decimal2rgb(f)),f=e.rgb2hex(f),d.attr("data-value",f).find(".icon").css("fill",f)),d.on("selected.editor",function(a,e){var f=("#"+e.data("value")).toLowerCase();if(d.attr("data-value",f).find(".icon").css("fill",f),c.isIE||"foreColor"===b)document.execCommand(b,!1,f);else{document.execCommand("fontSize",!1,"2");var g=function(){var a,b=null;return window.getSelection?(a=window.getSelection(),a.rangeCount&&(b=a.getRangeAt(0).commonAncestorContainer,1!==b.nodeType&&(b=b.parentNode))):(a=document.selection)&&"Control"!==a.type&&(b=a.createRange().parentElement()),b}().parentNode,h=g.getElementsByTagName("font");setTimeout(function(){for(var a=0,b=h.length;a<b;a++)h[a].hasAttribute("size")&&(h[a].setAttribute("style","background-color: "+f+";"),h[a].removeAttribute("size"))},0)}}),e.toggleList()},execFormatBlock:function(a){var b=this.getSelectionData(this.selection.anchorNode);if("blockquote"===a&&b.el&&"blockquote"===b.el.parentNode.tagName.toLowerCase())return document.execCommand("outdent",!1,null);if(b.tagName===a&&(a="p"),this.isIE){if("blockquote"===a)return document.execCommand("indent",!1,a);a="<"+a+">"}return document.execCommand("formatBlock",!1,a)},getSelectionData:function(a){var b;for(a&&a.tagName&&(b=a.tagName.toLowerCase());a&&-1===this.parentElements.indexOf(b);)(a=a.parentNode)&&a.tagName&&(b=a.tagName.toLowerCase());return{el:a,tagName:b}},isListItemChild:function(a){for(var b=a.parentNode,c=b.tagName.toLowerCase();-1===this.parentElements.indexOf(c)&&"div"!==c;){if("li"===c)return!0;if(!(b=b.parentNode)||!b.tagName)return!1;c=b.tagName.toLowerCase()}return!1},destroyToolbar:function(){var b=this.getCurrentElement(),c=this.toolbar.data("toolbar");c&&c.destroy(),this.toolbar.find("button").each(function(){var b=a(this).data("tooltip");b&&"function"==typeof b.destroy&&b.destroy()}),this.toolbar.off("click.editor mousedown.editor"),this.toolbar.remove(),this.toolbar=void 0,this.element.off("mouseup.editor keyup.editor focus.editor blur.editor "+this.pasteEvent),this.textarea.off("mouseup.editor keyup.editor focus.editor blur.editor "+this.pasteEvent),b.off("keydown.editor"),this.element.prev(".label").off("click.editor"),a(window).off("resize.editor"),a.each(this.modals,function(a,b){b.off("beforeclose close open")}),this.modals={},this.element.trigger("destroy.toolbar.editor")},updated:function(){return this},disable:function(){this.element.addClass("is-disabled").attr("contenteditable","false"),this.container.addClass("is-disabled")},enable:function(){this.element.removeClass("is-disabled is-readonly").attr("contenteditable","true"),this.container.removeClass("is-disabled is-readonly")},readonly:function(){this.element.removeClass("is-readonly").attr("contenteditable","false"),this.container.addClass("is-readonly")},setFocus:function(){var b=this,c="<"===a.trim(b.element.html()).slice(0,1)?a(":first-child",b.element)[0]:b.element[0];window.setTimeout(function(){var a,b;window.getSelection&&document.createRange?(b=document.createRange(),b.selectNodeContents(c),b.collapse(!0),a=window.getSelection(),a.removeAllRanges(),a.addRange(b)):document.body.createTextRange&&(b=document.body.createTextRange(),b.moveToElementText(c),b.collapse(!0),b.select())},1)},onPasteTriggered:function(){!this.isFirefox&&document.addEventListener&&document.addEventListener("paste",function(a){if(void 0!==a.clipboardData){var b=a.clipboardData.items[0];if(0===b.type.indexOf("image")){var c=b.getAsFile(),d=new FileReader;d.onload=function(a){var b=a.target.result;document.execCommand("insertImage",!1,b)},d.readAsDataURL(c)}}},!1)},isWordFormat:function(a){return/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test(a)||/class="OutlineElement/.test(a)||/id="?docs\-internal\-guid\-/.test(a)},cleanWordHtml:function(a){var b=a;b=b.replace(/<!--[\s\S]+?-->/gi,""),b=b.replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,""),b=b.replace(/<(\/?)s>/gi,"<$1strike>"),b=b.replace(/&nbsp;/gi," "),b=b.replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(a,b){return b.length>0?b.replace(/./," ").slice(Math.floor(b.length/2)).split("").join(" "):""}),b=b.replace(/(\n|\r| class=(\'|")?Mso[a-zA-Z]+(\'|")?)/g," ");var c,d,e,f=["style","script","applet","embed","noframes","noscript"];for(c=0,d=f.length;c<d;c++)e=new RegExp("<"+f[c]+".*?"+f[c]+"(.*?)>","gi"),b=b.replace(e,"");return b},stripAttribute:function(a,b,c){return"style"===b?this.stripStyles(a,c):a.replace(c,"")},stripStyles:function(a,b){var c=["color","background","font-weight","font-style","text-decoration","text-align"];return a.replace(b,function(a){a=a.replace(/( style=|("|\'))/gi,"");for(var b=a.split(";"),d="",e=0;e<b.length;e++){var f=b[e].split(":");d+=c.indexOf(f[0])>-1?f[0]+":"+f[1]+";":""}return""!==d?' style="'+d+'"':""})},getIndent:function(a){var b="",c=2*a;if(a>-1)for(;c--;)b+=" ";return b},formatHtml:function(a){a=a.trim();for(var b="",c=0,d=a.split(/</),e=0,f=d.length;e<f;e++){var g=d[e].split(/>/);2===g.length?("/"===d[e][0]&&c--,b+=this.getIndent(c),"/"!==d[e][0]&&c++,e>0&&(b+="<"),b+=g[0].trim()+">\n",""!==g[1].trim()&&(b+=this.getIndent(c)+g[1].trim().replace(/\s+/g," ")+"\n"),g[0].match(/^(area|base|br|col|command|embed|hr|img|input|link|meta|param|source)/)&&c--):b+=this.getIndent(c)+g[0]+"\n"}return b.trim()},destroy:function(){a("html").off("mouseup.editor"),this.destroyToolbar(),this.sourceView.remove(),1===a('[data-editor="true"]').length&&a("#editor-modal-url, #editor-modal-image").remove(),a.removeData(this.element[0],d)},handleEvents:function(){}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.expandablearea=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="expandablearea",e={trigger:null,bottomBorder:!1},f=a.extend({},e,b);return c.prototype={init:function(){this.setup().build().handleEvents()},setup:function(){var b;return this.id=b=this.element.attr("id"),b&&void 0!==b||(this.id=b="expandable-area-"+a("body").find(".expandable-area").index(this.element)),this.header=this.settings.trigger?this.element:this.element.children(".expandable-header"),this.footer=this.element.children(".expandable-footer"),this.content=this.element.children(".expandable-pane"),this.isCard=this.element.is(".card, .widget"),this},build:function(){var b=this,c=this.element.hasClass("is-expanded");return this.header.attr({"aria-expanded":""+c,"aria-controls":this.id+"-content",id:this.id+"-header"}),this.content.attr({id:this.id+"-content"}),this.isCard||this.footer.length||this.settings.trigger||(this.footer=a('<div class="expandable-footer"></div>').appendTo(this.element)),this.expander=function(b,c){var d;return!0===c?(d=b.header.find("expandable-expander"),d.length||(d=a('<a href="#" target="_self" class="btn-expander"><svg class="chevron icon" focusable="false" aria-hidden="true" role="presenation"><use xlink:href="#icon-caret-down"></use></svg><span class="audible">'+Locale.translate("ShowMore")+"</span></a>").appendTo(b.header)),d):(d=b.footer.find(".expandable-expander"),d.length||(d=a('<a href="#" target="_self" class="expandable-expander hyperlink"><span data-translated="true">'+Locale.translate("ShowMore")+"</span></a>").prependTo(b.footer)),d)}(b,this.isCard),this.expander.attr("href","#").hideFocus(),0===this.expander.length&&(this.expander=a("#"+this.settings.trigger)),this.settings.bottomBorder&&this.element.addClass("has-bottom-border"),c&&(this.content.addClass("no-transition"),this.element.one("afterexpand.expandable-area",function(){b.content.removeClass("no-transition")}),this.open()),c||(this.content.addClass("no-transition"),this.element.one("aftercollapse.expandable-area",function(){b.content.removeClass("no-transition")}),this.close()),this},isDisabled:function(){return this.element.hasClass("is-disabled")},handleKeys:function(a){if(!this.isDisabled()){var b=a.which;return 13===b||32===b?(a.preventDefault(),this.toggleExpanded(),!1):void 0}},handleFocus:function(){this.isDisabled()||this.header.addClass("is-focused")},handleBlur:function(){this.isDisabled()||this.header.removeClass("is-focused")},isExpanded:function(){return this.element.is(".is-expanded")},toggleExpanded:function(){this.isExpanded()?this.close():this.open()},open:function(){var a=this;!1!==this.element.triggerHandler("beforeexpand",[this.element])&&(this.element.addClass("is-expanded"),this.header.attr("aria-expanded","true"),this.expander.addClass("active"),this.element.triggerHandler("expand",[this.element]),this.expander.find('span[data-translated="true"]').text(Locale.translate("ShowLess")?Locale.translate("ShowLess"):"Show Less"),this.isCard&&this.expander.find(".icon").addClass("active"),this.content[0]&&(this.content[0].style.display="block"),this.content.one("animateopencomplete",function(){a.element.triggerHandler("afterexpand",[a.element])}).animateOpen())},close:function(){var a=this;!1!==this.element.triggerHandler("beforecollapse",[this.element])&&(this.expander.removeClass("active"),this.element.triggerHandler("collapse",[this.element]),this.expander.find('span[data-translated="true"]').text(Locale.translate("ShowMore")?Locale.translate("ShowMore"):"Show More"),this.isCard&&this.expander.find(".icon").removeClass("active"),this.content.one("animateclosedcomplete",function(){a.element.removeClass("is-expanded"),a.header.attr("aria-expanded","false"),a.element.triggerHandler("aftercollapse",[a.element]),a.content[0].style.display="none"}).animateClosed())},disable:function(){this.element.addClass("is-disabled")},enable:function(){this.element.removeClass("is-disabled")},destroy:function(){this.header.children("a").offTouchClick("expandablearea").off(),this.header.off(),this.header.removeAttr("aria-controls").removeAttr("aria-expanded").removeAttr("id"),this.content.removeAttr("id").removeClass("no-transition"),a.removeData(this.element[0],d)},handleEvents:function(){var a=this;return this.expander.onTouchClick("expandablearea").on("click.expandablearea",function(b){a.isDisabled()||(b.preventDefault(),a.toggleExpanded())}),this.header.on("keydown.expandablearea",function(b){a.handleKeys(b)}).on("focus.expandablearea",function(b){a.handleFocus(b)}).on("blur.expandablearea",function(b){a.handleBlur(b)}),this}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},a.fn.disable=function(){return a.each(this.data(),function(a,b){b instanceof jQuery||b.disable&&b.disable()}),this.prop("disabled",!0),this},a.fn.enable=function(){return a.each(this.data(),function(a,b){b instanceof jQuery||b.enable&&b.enable()}),this.prop("disabled",!1),this},a.fn.readonly=function(){return a.each(this.data(),function(a,b){b instanceof jQuery||b.readonly&&b.readonly()}),this.prop("readonly",!0),this},a.fn.trackdirty=function(){return this.each(function(){function b(a){switch(a.attr("type")){case"checkbox":case"radio":return a.prop("checked");default:return a.val()}}function c(a){var b=a.position();return a.parents().each(function(){var a=this;if("relative"===window.getComputedStyle(a,null).position)return!1;b.left+=a.scrollLeft,b.top+=a.scrollTop}),{left:b.left,top:b.top}}var d=a(this);d.data("original",b(d)).on("resetdirty.dirty",function(){d.data("original",b(d)).triggerHandler("doresetdirty.dirty")}).on("change.dirty doresetdirty.dirty",function(e){var f=d,g=d.closest(".field"),h=a("label:visible",g),i={class:"",style:""};if(g.is(".field-fileupload")&&(f=h.prev("input")),h[0]||(h=d.next("label")),"true"===d.attr("data-trackdirty")){if(d.addClass("dirty"),d.is('[type="checkbox"], [type="radio"]')&&(i.class+=" dirty-"+d.attr("type"),i.class+=d.is(":checked")?" is-checked":""),d.is("select")&&(i.class+=" is-select",f=d.next(".dropdown-wrapper").find(".dropdown")),i.icon=f.prev(),i.icon.is(".icon-dirty")||(d.is('[type="checkbox"]')&&(i.rect=c(h),i.style=' style="left:'+i.rect.left+"px; top:"+i.rect.top+'px;"'),i.icon='<span class="icon-dirty'+i.class+'"'+i.style+"></span>",i.msg=Locale.translate("MsgDirty")||"",i.msg='<span class="audible msg-dirty">'+i.msg+"</span>",f.before(i.icon),h.append(i.msg),i.icon=f.prev(),i.msg=h.find(".msg-dirty")),b(d)===d.data("original"))return d.removeClass("dirty"),a(".icon-dirty, .msg-dirty",g).add(i.icon).add(i.msg).remove(),void d.trigger("doresetdirty"===e.type?"afterresetdirty":"pristine");d.trigger("dirty")}})}),this},a(function(){var b,c;a(".label-text").closest("label, .label").each(function(){c=a("input, textarea, select",this),b=c.attr("class"),a(this).addClass(function(){return"inline"+(b?" inline-"+(-1===b.indexOf(" ")?b:b.substr(0,b.indexOf(" "))):"")})})}),a(function(){a("input:radio").on("click.radios",function(){this.focus()})}),a(function(){var b=function(b,c){for(var d=0,e=b.length;d<e;d++)a(b[d]).parent().addClass(c)};b(a(".field > input:checkbox, .field > .inline-checkbox"),"field-checkbox"),b(a(".field > input:radio, .field > .inline-radio"),"field-radio")}),a.fn.fileupload=function(){"use strict";function b(b){this.element=a(b),Soho.logTimeStart(c),this.init(),Soho.logTimeEnd(c)}var c="fileupload";return b.prototype={init:function(){this.build()},build:function(){var b=this.element;this.fileInput=b.find("input"),b.parent(".field").addClass("field-fileupload");var c=b.find("input").attr("name"),d=b.find("input").attr("class"),e=Locale.translate("FileUpload"),f=a('<label for="'+c+'-filename">'+b.text()+' <span class="audible">'+e+"</span></label>"),g=a('<input readonly id="'+c+'-filename" class="fileupload-background-transparent'+(d?" "+d:"")+'" type="text">'),h='<span class="trigger" tabindex="-1">'+a.createIcon("folder")+"</span>";b.before(f,g),this.fileInput.after(h),this.textInput=b.parent().find('[type="text"]'),this.textInput.on("keypress.fileupload",function(a){13!==a.which&&32!==a.which||(a.stopPropagation(),b.find("input").trigger("click"))}),this.fileInput.is(":disabled")&&this.textInput.prop("disabled",!0),this.fileInput.attr("readonly")&&(this.textInput.prop("disabled",!1),this.textInput[0].classList.remove("fileupload-background-transparent"),this.fileInput.attr("disabled","disabled")),this.fileInput.attr("tabindex","-1").on("change.fileupload",function(){b.prev("input").val(this.files[0].name)})},destroy:function(){this.fileInput.removeAttr("tabindex").off("change.fileupload"),this.textInput.off("keypress.fileupload"),this.element.closest(".field-fileupload").removeClass("field-fileupload").find('>label:first, >[type="text"]:first, .trigger, .icon-dirty, .msg-dirty').remove(),a.removeData(this.element[0],c)},disable:function(){this.textInput.prop("disabled",!0),this.fileInput.prop("disabled",!0)},enable:function(){this.textInput.prop("disabled",!1).prop("readonly",!1),this.fileInput.removeAttr("disabled")},readonly:function(){this.textInput.prop("readonly",!0),this.fileInput.prop("disabled",!0)}},this.each(function(){var d=a.data(this,c);d||(d=a.data(this,c,new b(this)))})},a.fn.fileuploadadvanced=function(b){"use strict";function c(b){this.element=a(b),this.settings=f,Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="fileuploadadvanced",e={isStandalone:!0,standaloneClass:"standalone",allowedTypes:"*",maxFilesInProcess:99999,maxFileSize:-1,fileName:"myfile",textDropArea:"Drag and Drop File to Upload",textBtnCancel:"Cancel uploading this file",textBtnCloseError:"Close this error",textBtnRemove:"Remove from server this file",errorAllowedTypes:"<em>"+Locale.translate("Error")+"</em>: "+Locale.translate("ErrorAllowedTypes"),errorMaxFileSize:"<em>"+Locale.translate("Error")+"</em>: "+Locale.translate("ErrorMaxFileSize"),errorMaxFilesInProcess:"<em>"+Locale.translate("Error")+"</em>: "+Locale.translate("ErrorMaxFilesInProcess")},f=a.extend({},e,b);return c.prototype={init:function(){this.build(),this.handleEvents()},build:function(){var b=this.settings,c=b.isStandalone?b.standaloneClass:"";this.element.append('<div class="fileupload-wrapper '+c+'"><div class="container drop-area">'+a.createIcon("upload-adv")+"<p>"+b.textDropArea+"</p></div></div>"),this.dropArea=a(".drop-area",this.element)},handleEvents:function(){var b=this,c=this.settings;b.dropArea.on("dragenter.fileuploadadvanced",function(c){b.element.triggerHandler("filesdragenter"),c.stopPropagation(),c.preventDefault(),a(this).addClass("hover")}).on("dragover.fileuploadadvanced",function(a){a.stopPropagation(),a.preventDefault()}).on("drop.fileuploadadvanced",function(d){var e=d.originalEvent.dataTransfer.files;if(d.preventDefault(),b.element.triggerHandler("filesdroped",[e]),a(this).removeClass("hover"),a("span.msg",this.element).closest(".error").remove(),
e.length+a(".progress",this.element).length>c.maxFilesInProcess)return void b.showError(c.errorMaxFilesInProcess);b.handleFileUpload(e)}),a(document).on("dragenter.fileuploadadvanced dragover.fileuploadadvanced drop.fileuploadadvanced",function(a){a.stopPropagation(),a.preventDefault(),"dragover"===a.type&&b.dropArea.removeClass("hover")})},handleFileUpload:function(a){for(var b=this.settings.fileName.replace("[]",""),c=0,d=a.length;c<d;c++)if(this.isFileTypeAllowed(a[c].name))if(-1!==f.maxFileSize&&a[c].size>f.maxFileSize)this.showError(f.errorMaxFileSize,a[c]);else{this.element.triggerHandler("beforecreatestatus",[a[c]]);var e=new FormData;e.append(b+"[]",a[c]);var g=this.createStatus(a[c]);this.element.triggerHandler("aftercreatestatus",[a[c]]),this.sendFileToServer(e,g)}else this.showError(f.errorAllowedTypes,a[c])},createStatus:function(b){var c=this,d=this.settings,e=a('<div class="container"><div class="file-row"><span class="status-icon"><button type="button" class="btn-icon action">'+a.createIcon({icon:"close",classes:["icon-close"]})+"<span>"+d.textBtnCancel+'</span></button></span><span class="description">'+b.name+'</span><div class="l-pull-right"><span class="size">'+c.formatFileSize(b.size)+'</span></div></div><div class="progress-row"><span class="progress"><span class="progress-bar" data-value="0"></span></span></div></div>'),f=a(".action",e).button(),g=a(".l-pull-right",e),h=a(".progress-bar",e).progress({animationLength:10});return c.dropArea.after(e),{file:b,container:e,setProgress:function(a){c.element.triggerHandler("fileprogress",[{file:b,progress:a}]),h.attr("data-value",a).triggerHandler("updated")},setAbort:function(a){f.on("click.fileuploadadvanced",function(){c.element.triggerHandler("fileaborted",[b]),a.abort(),e.remove()})},setCompleted:function(i){e.addClass("completed"),f.after(a.createIcon("check")),g.append('<button type="button" class="btn-icon action">'+a.createIcon({classes:["icon-close"],icon:"close"})+"<span>"+d.textBtnRemove+"</span></button>"),a(".action",g).button().on("click.fileuploadadvanced",function(){e.remove(),i.remove()}),f.add(h.closest(".progress-row")).remove(),c.element.triggerHandler("filecompleteuploading",[b])}}},sendFileToServer:function(b,c){var d={abort:function(){}},e={remove:function(){}},f=0,g=parseFloat(c.file.size),h=new a.fn.timer(function(){c.setCompleted(e)},g);a(h.event).on("update",function(a,b){f=Math.ceil(b.counter/g*100),c.setProgress(f)}),c.setAbort(d)},sendFileToServer2:function(b,c){this.element.triggerHandler("beforeuploading",[b]);var d=a.ajax({xhr:function(){var b=a.ajaxSettings.xhr();return b.upload&&b.upload.addEventListener("progress",function(a){var b=0,d=a.loaded||a.position,e=a.total;a.lengthComputable&&(b=Math.ceil(d/e*100)),c.setProgress(b)},!1),b},url:"http://myserver.com/upload/upload.php",type:"POST",contentType:!1,processData:!1,cache:!1,data:b,success:function(a){c.setCompleted(a)}});c.setAbort(d)},showError:function(b,c){var d;d=a(b===this.settings.errorMaxFilesInProcess?'<div class="container error"><div class="file-row"><span class="status-icon"><button type="button" class="btn-icon action">'+a.createIcon({classes:["icon-close"],icon:"close"})+"<span>"+f.textBtnCloseError+'</span></button></span><span class="msg">'+b+"</span></div></div>":'<div class="container error"><div class="file-row"><span class="status-icon"><button type="button" class="btn-icon action">'+a.createIcon({classes:["icon-close"],icon:"close"})+"<span>"+f.textBtnCloseError+'</span></button></span><span class="description">'+c.name+'</span><div class="l-pull-right"><span class="size">'+this.formatFileSize(c.size)+'</span></div></div><div class="msg"><p>'+b+"</p></div></div>"),a(".action",d).button().on("click.fileuploadadvanced",function(){d.remove()}),this.dropArea.after(d)},isFileTypeAllowed:function(b){var c=this.settings.allowedTypes.toLowerCase().split(/[\s|]+/g),d=b.split(".").pop().toLowerCase();return!("*"!==this.settings.allowedTypes&&a.inArray(d,c)<0)},formatFileSize:function(a){var b={GB:1e9,MB:1e6,KB:1e3};return"number"!=typeof a?"":a>=b.GB?(a/b.GB).toFixed(2)+" GB":a>=b.MB?(a/b.MB).toFixed(2)+" MB":(a/b.KB).toFixed(2)+" KB"},destroy:function(){this.dropArea.off("dragenter.fileuploadadvanced dragover.fileuploadadvanced drop.fileuploadadvanced"),a(document).off("dragenter.fileuploadadvanced dragover.fileuploadadvanced drop.fileuploadadvanced"),a(".action",this.element).off("click.fileuploadadvanced"),a(".fileupload-wrapper",this.element).remove(),a.removeData(this.element[0],d)}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},a.fn.header=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="header",e={demoOptions:!0,useBackButton:!0,useBreadcrumb:!1,usePopupmenu:!1,tabs:null,wizardTicks:null,useAlternate:!1,addScrollClass:!1},f=a.extend({},e,b);return c.prototype={init:function(){this.setup().build().handleEvents(),this.settings.demoOptions&&this.initPageChanger()},setup:function(){return this.settings.demoOptions=this.element.attr("data-demo-options")?"true"===this.element.attr("data-demo-options"):this.settings.demoOptions,this.settings.useBackButton=this.element.attr("data-use-backbutton")?"true"===this.element.attr("data-use-backbutton"):this.settings.useBackButton,this.settings.useBreadcrumb=this.element.attr("data-use-breadcrumb")?"true"===this.element.attr("data-use-breadcrumb"):this.settings.useBreadcrumb,this.settings.useAlternate=this.element.attr("data-use-alternate")?"true"===this.element.attr("data-use-alternate"):this.settings.useAlternate,this.settings.tabs=a.isArray(this.settings.tabs)?this.settings.tabs:null,this.settings.wizardTicks=a.isArray(this.settings.wizardTicks)?this.settings.wizardTicks:null,this.titleText=this.element.find(".title > h1"),this.levelsDeep=[],this.levelsDeep.push(""+this.titleText.text()),this},build:function(){if(this.toolbarElem=this.element.find(".toolbar"),!this.toolbarElem.data("toolbar")){var b=a.fn.parseOptions(this.toolbarElem);this.toolbarElem.toolbar(b)}if(this.toolbar=this.toolbarElem.data("toolbar"),this.titleButton=this.element.find(".title > .application-menu-trigger"),this.hasTitleButton=this.titleButton.length>0,this.hasTitleButton){this.toolbarElem.addClass("has-title-button");var c=a("#application-menu").data("applicationmenu");c?c.modifyTriggers([this.titleButton],null,!0):a("#application-menu").applicationmenu({triggers:[this.titleButton]})}if(this.settings.tabs&&this.settings.tabs.length&&this.buildTabs(),this.settings.wizardTicks&&this.settings.wizardTicks.length&&this.buildWizard(),this.settings.usePopupmenu&&this.buildPopupmenu(),this.settings.addScrollClass){var d=a(this.element),e=a(this.element).next(".scrollable"),f=1===e.length?e:a(window),g=this.settings.scrollThreshold?this.settings.scrollThreshold:15;f.on("scroll.header",function(){this.scrollTop>g?d.addClass("is-scrolled-down"):d.removeClass("is-scrolled-down")}),f.scrollTop()>g&&d.addClass("is-scrolled-down")}return this},buildTitleButton:function(){this.levelsDeep.length>1&&!this.hasTitleButton&&!this.titleButton.length&&(this.titleButton=a('<button class="btn-icon back-button" type="button"></button>'),this.titleButton.html('<span class="audible">'+Locale.translate("Drillup")+'</span><span class="icon app-header go-back"><span class="one"></span><span class="two"></span><span class="three"></span></span>'),this.titleButton.prependTo(this.element.find(".title")),this.toolbar.element.triggerHandler("updated")),this.titleButton.find(".icon.app-header").addClass("go-back")},buildBreadcrumb:function(){var b=this,c="has-breadcrumb";this.settings.useAlternate&&(c="has-alternate-breadcrumb"),this.element.addClass(c),this.breadcrumb=this.element.find(".breadcrumb"),this.breadcrumb.length||(this.breadcrumb=a('<nav class="breadcrumb" role="navigation" style="display: none;"></nav>').appendTo(this.element),this.breadcrumb.on("click","a",function(a){b.handleBreadcrumbClick(a)})),this.breadcrumb[this.settings.useAlternate?"addClass":"removeClass"]("alternate"),this.adjustBreadcrumb()},adjustBreadcrumb:function(){var b=this.levelsDeep[this.levelsDeep.length-1];this.breadcrumb.empty();var c=a('<ol aria-label="breadcrumb"></ol>').appendTo(this.breadcrumb);a.each(this.levelsDeep,function(d,e){var f="";b===e&&(f=" current"),c.append(a('<li><a href="#" class="hyperlink'+f+'">'+e+"</a></li>"))})},buildTabs:function(){if(this.tabsContainer=this.element.find(".tab-container"),!this.tabsContainer.length){this.tabsContainer=a('<div class="tab-container"></div>').appendTo(this.element);var b=a('<ul class="tab-list" role="tablist"></ul>').appendTo(this.tabsContainer);a('<li class="tab"><a href="#header-tabs-home" role="tab">SoHo Xi Controls | Patterns</a></li>').appendTo(b),a('<li class="tab"><a href="#header-tabs-level-1" role="tab">Level 1 Detail</a></li>').appendTo(b),a('<li class="tab"><a href="#header-tabs-level-2" role="tab">Level 2 Detail</a></li>').appendTo(b)}this.element.addClass(this.settings.useAlternate?"has-alternate-tabs":"has-tabs"),this.tabsContainer[this.settings.useAlternate?"addClass":"removeClass"]("alternate"),a("#header-tabs-level-1").removeAttr("style"),a("#header-tabs-level-2").removeAttr("style"),this.tabsContainer.tabs({containerElement:"#maincontent"})},buildWizard:function(){if(this.element.addClass("has-wizard"),this.wizard=this.element.find(".wizard"),!this.wizard.length){this.wizard=a('<div class="wizard"></div>').appendTo(this.element);var b=a('<div class="wizard-header"></div>').appendTo(this.wizard),c=a('<div class="bar"></div>').appendTo(b);a('<div class="completed-range"></div>').appendTo(c),a('<a href="#" class="tick current"><span class="label">Context Apps</span></a>').appendTo(c),a('<a href="#" class="tick"><span class="label">Utility Apps</span></a>').appendTo(c),a('<a href="#" class="tick"><span class="label">Inbound Configuration</span></a>').appendTo(c),a('<a href="#" class="tick"><span class="label">OID Mapping</span></a>').appendTo(c)}this.wizard[this.settings.useAlternate?"addClass":"removeClass"]("alternate"),this.wizard.wizard()},buildPopupmenu:function(){var b=this.toolbarElem.children(".title");if(this.titlePopup=b.find(".btn-menu"),!this.titlePopup.length){var c=b.find("h1");c.wrap('<button id="header-menu" type="button" class="btn-menu"></button>'),this.titlePopup=c.parent(".btn-menu")}this.titlePopupMenu=this.titlePopup.next(".popupmenu"),this.titlePopupMenu.length||(this.titlePopupMenu=a('<ul class="popupmenu is-selectable"></ul>').insertAfter(this.titlePopup),a('<li class="is-checked"><a href="#">Page One Title</a></li><li><a href="#">Page Two Title</a></li><li><a href="#">Page Three Title</a></li><li class="is-disabled"><a href="#">Page Four Title</a></li><li><a href="#">Page Five Title</a></li>').appendTo(this.titlePopupMenu)),this.titlePopupMenu.addClass("is-selectable"),this.titlePopup.children("h1").text(this.titlePopupMenu.children().first().text()),this.titlePopup.button().popupmenu(),this.toolbarElem.triggerHandler("updated")},handleEvents:function(){var b=this;return this.element.on("updated.header",function(){b.updated()}).on("reset.header",function(){b.reset()}).on("drilldown.header",function(a,c){b.drilldown(c)}).on("drillup.header",function(a,c){b.drillup(c)}),this.titleButton.bindFirst("click.header",function(a){b.levelsDeep.length>1&&(a.stopImmediatePropagation(),b.drillup(),a.returnValue=!1)}),this.settings.usePopupmenu&&this.titlePopup.on("selected.header",function(b,c){a(this).children("h1").text(c.text())}),this},handleBreadcrumbClick:function(b){var c,d=a(b.target).parent(),e=this.breadcrumb.find("li"),f=e.index(d);if(!d.hasClass("current")){if(0===f)return this.reset();if(f<e.length-1)for(c=e.length-1-f;c>0;)this.drillup(),c-=1}},initPageChanger:function(){this.element.find(".page-changer").on("selected.header",function(b,c){if(c.attr("data-theme")){var d=c.attr("data-theme");return void a("body").trigger("changetheme",d.replace("-theme",""))}if(c.attr("data-lang"))return void Locale.set(c.attr("data-lang"));var e=c.attr("data-rgbcolor");a("body").trigger("changecolors",[e])})},drilldown:function(a){this.element.addClass("is-drilldown"),this.levelsDeep.push(a.toString()),this.titleText.text(this.levelsDeep[this.levelsDeep.length-1]),this.settings.useBackButton&&this.buildTitleButton(),this.settings.useBreadcrumb&&(this.breadcrumb&&this.breadcrumb.length?this.adjustBreadcrumb():(this.buildBreadcrumb(),this.breadcrumb.css({display:"block",height:"auto"})))},drillup:function(a){var b;if(this.element.removeClass("is-drilldown"),this.levelsDeep.length>1&&(this.levelsDeep.pop(),b=this.levelsDeep[this.levelsDeep.length-1]),void 0!==a&&(b=a),this.levelsDeep.length>1)return this.settings.useBreadcrumb&&this.adjustBreadcrumb(),void this.titleText.text(b);b=this.levelsDeep[0],this.settings.useBackButton&&this.removeButton(),this.settings.useBreadcrumb&&this.removeBreadcrumb(),this.settings.usePopupmenu&&this.removePopupmenu(),this.titleText.text(b),this.element.trigger("drillTop")},reset:function(){for(;this.levelsDeep.length>1;)this.levelsDeep.pop();return this.titleText.text(this.levelsDeep[0]),this.removeBreadcrumb(),this.removeTabs(),this.removeWizard(),this.removePopupmenu(),this.removeButton(),this.element.trigger("afterreset"),this},removeButton:function(){if(this.hasTitleButton)return void this.titleButton.find(".icon.app-header").removeClass("go-back");this.titleButton&&this.titleButton.length&&(this.titleButton.remove(),this.titleButton=a(),this.toolbar.element.triggerHandler("updated"))},removeBreadcrumb:function(){function b(){c&&(clearTimeout(c),c=null),d.element.off(e+".breadcrumb-header"),d.breadcrumb.off().remove(),d.breadcrumb=a()}if(this.breadcrumb&&this.breadcrumb.length){var c,d=this,e=a.fn.transitionEndName();d.element.removeClass("has-breadcrumb").removeClass("has-alternate-breadcrumb"),this.breadcrumb.is(":not(:hidden)")?(this.element.one(e+".breadcrumb-header",b),c=setTimeout(b,300)):b()}},removeTabs:function(){function b(){c&&(clearTimeout(c),c=null),d.element.off(e+".tabs-header"),d.tabsContainer.data("tabs").destroy(),d.tabsContainer.remove(),d.tabsContainer=null,a("#header-tabs-level-1").css("display","none"),a("#header-tabs-level-2").css("display","none")}if(this.tabsContainer&&this.tabsContainer.length){var c,d=this,e=a.fn.transitionEndName();this.element.removeClass("has-tabs").removeClass("has-alternate-tabs"),this.tabsContainer.is(":not(:hidden)")?(this.element.one(e+".tabs-header",b),c=setTimeout(b,300)):b()}},removeWizard:function(){function b(){c&&(clearTimeout(c),c=null),d.element.off(e+".wizard-header"),d.wizard.data("wizard").destroy(),d.wizard.remove(),d.wizard=null}if(this.wizard&&this.wizard.length){var c,d=this,e=a.fn.transitionEndName();this.element.removeClass("has-wizard"),this.wizard.is(":not(:hidden)")?(this.element.one(e+".wizard-header",b),c=setTimeout(b,300)):b()}},removePopupmenu:function(){var a=this;this.titlePopup&&this.titlePopup.length&&(this.titlePopup.data("popupmenu").destroy(),this.titlePopup.data("button").destroy(),this.titlePopupMenu.remove(),this.titlePopup.children("h1").detach().insertBefore(a.titlePopup),this.titlePopup.remove(),this.titlePopup=void 0,this.titlePopupMenu=void 0,this.toolbarElem.triggerHandler("updated"))},unbind:function(){return this.titleButton.off("click.header"),this.element.off("drilldown.header drillup.header"),this},updated:function(){this.reset().unbind().init()},destroy:function(){this.unbind(),this.hasTitleButton&&this.toolbarElem.removeClass("has-title-button"),a.removeData(this.element[0],d)}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.hierarchy=function(b){"use strict";function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="hierarchy",e={legend:[],legendKey:"",dataset:[],newData:[],templateId:"",mobileView:!1,mouseEnterTarget:"",rightClickTarget:"",leafHeight:null,leafWidth:null,beforeExpand:null},f=a.extend({},e,b),g=["azure08","turquoise02","amethyst06","slate06","amber06","emerald07","ruby06"],h={container:"container",chart:"content",toplevel:"top-level",sublevel:"sub-level",noSublevel:"no-sublevel",sublist:"sublist",button:"btn-expand",leaf:"leaf",inner:"inner",multiRoot:"multi-root",root:"root",back:"back",activeBranch:"active-branch",branchExpanded:"branch-expanded",branchCollapsed:"branch-collapsed",collapsedLeaf:"collapsed-leaf",expanded:"expanded",collapsed:"collapsed",close:"close",open:"open",shadow:"shadow",line:"line",selected:"selected",show:"show",hide:"hidden"};return c.prototype={init:function(){var b=a(this.element).parent().width()<610;if(this.mobileView=!!b,this.handleEvents(),f.dataset)if(f.dataset[0].children.length>0){var c=void 0===f.dataset[0]?f.dataset:f.dataset[0];c.isRootNode=!0,c.isExpanded=!0,this.render(c)}else a(this.element).append("<p style='padding:10px;'>No data available</p>");if(null!==f.leafHeight&&null!==f.leafWidth){var d="body .hierarchy .leaf,body .hierarchy .sublevel .leaf,body .hierarchy .container .root.leaf { width: "+f.leafWidth+"px;  height: "+f.leafHeight+"px;  }";a("<style type='text/css' id='hierarchyLeafStyles'>"+d+"</style>").appendTo("body")}},handleEvents:function(){var b=this;b.element.onTouchClick("hierarchy","."+h.button).on("click.hierarchy","."+h.button,function(c){f.newData.length>0&&(f.newData=[]);var d=a(this).closest("."+h.leaf).attr("id"),e=b.data(d,f.dataset,f.newData),g={branch:a(this).closest("li"),leaf:a(this).closest("."+h.leaf),button:a(this)};e.isExpanded?b.collapse(c,e,g):b.expand(c,e,g)}),b.element.onTouchClick("click","."+h.back).on("click","."+h.back,function(){var c=a(this).parent().find("."+h.leaf).attr("id"),d=b.data(c,f.dataset,f.newData),e={branch:a(this).closest("li"),leaf:a(this).closest("."+h.leaf),button:a(this)};b.collapse(event,d,e)}),b.element.on("keypress","."+h.leaf,function(c){var d=a(this).attr("id"),e=b.data(d,f.dataset,f.newData);13===c.which&&(e.isExpanded?b.collapse(c,e):b.expand(c,e))}),b.element.on("mousedown","."+h.leaf,function(b){var c=a(this).data(),d={target:b.target,pageX:b.pageX,pageY:b.pageY};a(".is-"+h.selected).removeClass("is-"+h.selected),a("#"+c.id).addClass("is-"+h.selected),a(this).trigger("selected",c,d)});var c=""===f.rightClickTarget?"."+h.leaf:f.rightClickTarget;b.element.on("mousedown",c,function(b){var c=a(this).data(),d={target:b.target,pageX:b.pageX,pageY:b.pageY};1===b.which&&a(this).trigger("click"),3===b.which&&a(this).trigger("rightClick",[c,d])});var d=""===f.mouseEnterTarget?"."+h.leaf:f.mouseEnterTarget;b.element.on("mouseenter",d,function(b){var c=a(this).data(),d={target:b.target,pageX:b.pageX,pageY:b.pageY};3!==b.which&&a(this).trigger("mouseEnter",[c,d])}),b.element.on("dblclick","."+h.leaf,function(b){var c=a(this).data(),d={target:b.target,clientX:b.clientX,clientY:b.clientY};a(this).trigger("doubleClick",c,d)})},data:function(b,c,d,e){function g(a,b,c){if(void 0===b.length)i(a,b,c);else for(var d=0,e=b.length;d<e;d++){var f=b[d];i(a,f,c)}}function i(a,c,d){for(var f in c)"id"===f&&b===c.id&&(c.isLoaded||c.isRootNode||(e.updateDisplay?c.displayClass=h.hide+" "+h.collapsed:j(c,e)),l.push(c));c.children&&g(a,c.children,d)}function j(a,b){b.insert&&(delete a.isLeaf,delete a.displayClass,a.displayClass=h.expanded,a.isExpanded=!0),0!==d.length&&b.insert?a.children=[d]:a.children=d}void 0===e&&(e={});var k=c.isRootNode?c:c[0],l=[];return f.newData.length>0&&(f.newData=[]),void 0!==d&&g(this,k,d),0!==l.length&&a("#"+l[0].id).data(l[0]),l[0]},add:function(b,c,d){var e=this,g=void 0!==c.id?c.id:b,i=a("#"+g),j=i.parent().hasClass("leaf-container")?i.parent().parent():i.parent(),k={},l=j.parent().attr("class")!==h.sublevel,m=1===j.children("."+h.sublist).length;if(l?m?k.element=j.children("."+h.sublist):(k.el=j.append("<ul class='"+h.sublist+"'></ul>"),k.element=a(k.el).find("."+h.sublist)):(k.el=j.children("ul"),k.element=a(k.el)),!c.isRootNode){for(var n=0,o=d.length;n<o;n++)f.newData.push(d[n]);e.createLeaf(d,k.element)}},expand:function(a,b,c){var d=this,e=c.leaf,g=e.next().not("."+h.line);g.animateOpen(),d.element.trigger(h.expanded,[b,f.dataset]),e.hasClass("root")&&(g=g.next("ul"),g.animateOpen()),b.isExpanded=!0,d.setNodeData(b),e.parent().removeClass(h.branchCollapsed).addClass(h.branchExpanded),d.setButtonState(e,b)},collapse:function(a,b,c){var d=this,e=c.leaf,g=e.next().not("."+h.line);g.animateClosed().on("animateclosedcomplete",function(){d.element.trigger(h.collapsed,[b,f.dataset])}),e.hasClass("root")&&(g=g.next("ul"),g.animateClosed()),b.isExpanded=!1,d.setNodeData(b),e.parent().removeClass(h.branchExpanded).addClass(h.branchCollapsed),d.setButtonState(e,b)},render:function(b){function c(a,b,c){if(null!==b&&void 0!==b)for(var e=0,f=b.length;e<f;e++){var g=b[e];d(a,g,c)}}function d(a,b,d){for(var e in b)if("children"===e){var f=b.id,g=b,h=b.children;return null!==h&&void 0!==h&&h.length>0&&a.add(f,g,h),c(a,h,d)}}var e=f.legend,g=b.children,i=this.checkChildren(g,"top-level"),j=this.checkChildren(g,"sub-level"),k=[],l={legend:"<legend><ul></ul></legend>",chart:"<ul class='"+h.container+"'><li class='"+h.chart+"'></li></ul>",toplevel:"<ul class='"+h.toplevel+"'></ul>",sublevel:"<ul class='"+h.sublevel+"'></ul>"},m=this.element.append(l.chart),n=a("."+h.chart,m);if(0!==e.length){this.element.prepend(l.legend);var o=a("legend",m);this.createLegend(o)}if(this.setColor(b),this.displayButton(b),b.isMultiRoot){var p="<div class='"+h.leaf+" "+h.multiRoot+"'><div class='"+h.inner+"'><h2>"+b.multiRootText+"</h2></div></div>";k.push(p),a(k[0]).addClass(h.root).appendTo(n)}else{var q=H.compile("{{#dataset}}"+a("#"+f.templateId).html()+"{{/dataset}}"),r=q.render({dataset:b});k.push(r),a(k[0]).addClass(h.root).appendTo(n),this.setNodeData(b)}if(i||a("<div class='"+h.line+"'></div>").insertAfter("."+h.root),g.length>0)for(var s=0,t=g.length;s<t;s++){var u=b.children[s].children;if(this.isLeaf(g[s])?this.createLeaf(b.children[s],a(l.toplevel)):this.createLeaf(b.children[s],a(l.sublevel)),void 0!==u&&null!==u){var v=b.children[s].children,w=this;c(w,v,b)}}j||a("."+h.topLevel).addClass(h.noSublevel);var x=this.element.find("."+h.container).outerWidth(),y=a(window).width(),z=(x-y)/2;this.element.scrollLeft(z)},checkChildren:function(a,b){for(var c=0,d=a.length;d--;)"top-level"===b&&a[d].isLeaf&&(c+=1),"subLevel"===b&&a[d].children&&(c+=1);return c>0},createLegend:function(a){for(var b=0,c=0,d=f.legend.length;c<d;c++){var e=f.legend[c].label,h=g[c];c-1+1==4&&(a.append("<ul></ul>"),b++),a.children("ul").eq(b).append("<li><span>"+e+"</span><span class='key "+h+"'></span></li>")}},createLeaf:function(b,c){function d(b,d){e.setColor(b),e.displayButton(b);var g=H.compile("{{#dataset}}"+a("#"+f.templateId).html()+"{{/dataset}}"),i=g.render({dataset:b}),l=b.isExpanded||void 0===b.isExpanded?"expand":"collapse",m=1===k.length?k:c,n="";m.children("li").children(".ln").removeClass("last-line"),n+=d?"<span class='ln last-line'></span>":"<span class='ln'></span>";var o=a(i);e.setButtonState(o,b),j!==h.sublevel&&j!==h.toplevel&&a(o).append("<span class='horizontal-line'></span>");var p=b.isExpanded||void 0===b.isExpanded?h.branchExpanded:h.branchCollapsed;if(b.isLeaf&&(p=""),m.append("<li class="+p+">"+n+a(o)[0].outerHTML+"</li>"),e.setNodeData(b),b.children){var q="";b.isLoaded=!0,b.displayClass===h.expanded||b.isExpanded?(b.isExpanded=!0,a("#"+b.id).data(b)):b.isExpanded=!1;for(var r=0,s=b.children.length;r<s;r++){e.setColor(b.children[r]),e.displayButton(b.children[r]);var t=g.render({dataset:b.children[r]}),u=a(t);a(u).append("<span class='horizontal-line'></span>"),r===b.children.length-1?q+="<li><span class='ln last-line'></span>"+a(u)[0].outerHTML+"</li>":q+="<li><span class='ln'></span>"+a(u)[0].outerHTML+"</li>"}m=a("#"+b.id).parent(),m.append("<ul>"+q+"</ul>");for(var v=b.children.length;v--;)e.setNodeData(b.children[v]);b.isExpanded||b.isLeaf||e.animateExpandCollapse(a("#"+b.id).parent(),l)}}var e=this,g=e.element.attr("class"),i=a("."+g+" ."+h.chart,e.container),j=c.attr("class"),k=void 0!==j?a("."+j):c;if(k.length<1&&(j===h.toplevel?c.insertAfter("."+h.root):c.appendTo(i)),b.length)for(var l=0,m=b.length;l<m;l++){var n=l===b.length-1;d(b[l],n)}else d(b,!0)},setColor:function(a){for(var b=0,c=f.legend.length;b<c;b++){if(a[f.legendKey]===f.legend[b].value){a.colorClass=g[b];break}""===a[f.legendKey]&&(a.colorClass="default-color")}if(a.children&&!a.isRootNode)for(var d=0,e=a.children.length;d<e;d++)for(var h=0,i=f.legend.length;h<i;h++)a.children[d][f.legendKey]===f.legend[h].value&&(a.children[d].colorClass=g[h])},setNodeData:function(b){a("#"+b.id).data(b).data=b},isLeaf:function(a){return void 0===a.children?(a.isLeaf=!0,a.isLeaf):f.beforeExpand?a.isLeaf:!(a.children&&a.children.length>0)},setButtonState:function(a,b){var c=a.find("."+h.button);b.isExpanded||b.isExpanded,c.find("svg.icon").changeIcon("caret-up"),void 0===b.isExpanded&&c.button()},displayButton:function(a){a.isLeaf?a.displayClass=h.hide:a.displayClass=h.show,a.isRootNode&&(a.displayClass=h.hide),a.isExpanded?a.displayClass+=" "+h.expanded:a.displayClass+=" "+h.collapsed,void 0===a.isExpanded&&(a.isLeaf||!a.children||a.isRootNode||(a.displayClass=h.expanded))}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},a.fn.highlight=function(a){function b(a,c){var d,e,f,g,h=0;if(3===a.nodeType)d=a.data.toUpperCase().indexOf(c),(d-=a.data.substr(0,d).toUpperCase().length-a.data.substr(0,d).length)>=0&&(e=document.createElement("mark"),e.className="highlight",f=a.splitText(d),f.splitText(c.length),g=f.cloneNode(!0),e.appendChild(g),f.parentNode.replaceChild(e,f),h=1);else if(1===a.nodeType&&a.childNodes&&!/(script|style)/i.test(a.tagName))for(var i=0;i<a.childNodes.length;++i)i+=b(a.childNodes[i],c);return h}return this.length&&a&&a.length?this.each(function(){b(this,a.toUpperCase())}):this},a.fn.unhighlight=function(){return this.find("mark.highlight").each(function(){var a=this.parentNode;a.replaceChild(this.firstChild,this),a.normalize()}).end()},a.fn.homepage=function(b){function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="homepage",e={gutterSize:20,widgetWidth:360,widgetHeight:370,animate:!0,timeout:100,columns:3,easing:"blockslide"},f=a.extend({},e,b);return c.prototype={init:function(){this.settings=f,this.isTransitionsSupports=this.supportsTransitions(),this.initHeroWidget(),this.handleEvents(),this.resize(this,!1)},initColumns:function(a){a=a||0,this.rowsAndCols[a]=[];for(var b=0,c=this.settings.columns;b<c;b++)this.rowsAndCols[a][b]=!0},initHeroWidget:function(){var b=a(".hero-widget");b.length>1&&(b=b.not(":first").remove()),this.heroWidget=b},initRowsAndCols:function(){this.rowsAndCols=[],this.initColumns()},getAvailability:function(a){var b,c,d,e,f,g,h=this,i=h.rowsAndCols.length,j={},k=!1;for(b=0,e=i;b<e&&!k;b++)for(c=0,g=!0,f=h.rowsAndCols[b].length;c<f&&!k;c++)if(h.rowsAndCols[b][c]&&a.w+c<=f){if(a.w>1&&f>c+1)for(d=0;d<a.w;d++)if(!h.rowsAndCols[b][c+d]){g=!1;break}if(a.h>1&&i>b+1)for(d=0;d<a.h;d++)if(!h.rowsAndCols[b+d][c]){g=!1;break}g&&(j.row=b,j.col=c,k=!0)}return Object.getOwnPropertyNames(j).length||(h.initColumns(i),j.row=i,j.col=0),j},fitBlock:function(a,b,c){var d,e,f,g,h=this,i=!0;if(c.x=b,c.y=a,1===c.w&&1===c.h)h.rowsAndCols[a][b]=!1;else if(1!==c.w)for(d=a,f=c.h+a;d<f;d++)for(e=b,g=c.w+b;e<g;e++)h.rowsAndCols[d]||h.initColumns(d),h.rowsAndCols[d][e]=!1;else for(d=a,f=c.h+a;d<f;d++)for(e=b,g=c.h+b;e<g;e++)h.rowsAndCols[d]||h.initColumns(d),h.rowsAndCols[d][b]=!1;for(d=0,f=h.rowsAndCols[a].length;d<f;d++)h.rowsAndCols[a][d]&&(i=!1);i&&(h.rowsAndCols[a+1]||h.initColumns(a+1))},setBlocks:function(){var b=this;b.blocks=[],b.element.find(".card, .widget").each(function(){var c=a(this),d=c.hasClass("double-height")?2:1,e=c.hasClass("quad-width")?4:c.hasClass("triple-width")?3:c.hasClass("double-width")?2:1;b.blocks.push({w:e,h:d,elem:c,text:c.text()})});for(var c=0,d=0,e=0,f=b.blocks.length;c<f;c++)b.settings.columns>1&&(b.blocks[c].w>=b.settings.columns&&c&&b.arrayIndexMove(b.blocks,c,d),(e+=b.blocks[c].w)>=b.settings.columns&&(e=0,d=b.blocks[d].w>=b.settings.columns?d+1:c))},arrayIndexMove:function(a,b,c){a.splice(c,0,a.splice(b,1)[0])},resize:function(a,b){var c=4*a.settings.widgetWidth+3*a.settings.gutterSize,d=3*a.settings.widgetWidth+2*a.settings.gutterSize,e=2*a.settings.widgetWidth+a.settings.gutterSize,f=a.settings.widgetWidth,g=c,h=a.element.outerWidth(),i=h>=c,j=h>=d&&h<=c,k=h>=e&&h<=d,l=h<=e,m=this.element.attr("data-columns"),n=a.element.find("> .content");this.settings.columns=parseInt(m||this.settings.columns),i&&4===a.settings.columns&&(a.settings.columns=4,g=c),(j||i&&3===a.settings.columns)&&(a.settings.columns=3,g=d),k&&(a.settings.columns=2,g=e),l&&(a.settings.columns=1,g=f),n.length&&(n[0].style.marginLeft="-"+g/2+"px"),this.setBlocks(),this.initRowsAndCols();for(var o=0,p=a.blocks.length;o<p;o++){var q,r,s,t,u=a.blocks[o];u.elem.removeClass("to-single to-double to-triple"),u.w>a.settings.columns&&(u.w=a.settings.columns,1===a.settings.columns?u.elem.addClass("to-single"):2===a.settings.columns?u.elem.addClass("to-double"):3===a.settings.columns&&u.elem.addClass("to-triple")),t=a.getAvailability(u);var v=a.settings.widgetWidth+a.settings.gutterSize,w=v*a.settings.columns;if(q=Locale.isRTL()?w-(v*u.w+v*t.col):v*t.col,r=(a.settings.widgetHeight+a.settings.gutterSize)*t.row,s={left:q,top:r},b){var x=a.settings.easing,y=[.09,.11,.24,.91];"blockslide"===x?a.isTransitionsSupports?(a.applyCubicBezier(u.elem,y),u.elem[0].style.left=s.left+"px",u.elem[0].style.top=s.top+"px"):u.elem.animate(s,a.settings.timeout):u.elem.animate(s,a.settings.timeout,x)}else u.elem[0].style.left=s.left+"px",u.elem[0].style.top=s.top+"px";a.fitBlock(t.row,t.col,u)}a.element.triggerHandler("resize",a.settings.columns)},applyCubicBezier:function(a,b){a[0].style["-webkit-transition"]="all .3s cubic-bezier("+b+")",a[0].style["-moz-transition"]="all .3s cubic-bezier("+b+")",a[0].style["-ms-transition"]="all .3s cubic-bezier("+b+")",a[0].style["-o-transition"]="all .3s cubic-bezier("+b+")",a[0].style.transition="all .3s cubic-bezier("+b+")"},supportsTransitions:function(){var a=document.createElement("p").style,b="transition";if("string"==typeof a[b])return!0;var c=["Moz","webkit","Webkit","Khtml","O","ms"];b=b.charAt(0).toUpperCase()+b.substr(1);for(var d=0,e=c.length;d<e;d++)if("string"==typeof a[c[d]+b])return!0;return!1},detachEvents:function(){a("body").off("resize.homepage"),a(".application-menu").off("applicationmenuopen.homepage applicationmenuclose.homepage")},destroy:function(){this.detachEvents(),a.removeData(this.element[0],d)},handleEvents:function(){var b=this;a("body").on("resize.homepage",function(){b.resize(b,b.settings.animate)}),a(".application-menu").on("applicationmenuopen.homepage applicationmenuclose.homepage",function(){b.resize(b,b.settings.animate)})}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},a.fn.icon=function(b){"use strict";function c(b,c){this.settings=a.extend({},c),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="icon",e={use:"user-profile",focusable:!1},f=a.extend({},e,b);return c.prototype={init:function(){return this.getExistingUseTag(),this.render().handleEvents()},render:function(){var a=this;if(this.element.addClass("icon"),!this.element.is("svg"))return this;var b=this.element[0].getElementsByTagName("use")[0];return b?(b.getAttribute("xlink:href")!==a.getBasedUseTag()&&setTimeout(function(){b.setAttribute("xlink:href",a.getBasedUseTag())},0),this):this},getBasedUseTag:function(){return a.getBaseURL("#icon-"+this.settings.use)},getExistingUseTag:function(){if(this.element.is("svg")){var a=this.element.children("use");if(!a.length)return this;var b=a.attr("xlink:href")
;return this.settings.use=b.replace("#icon-",""),this}},handleEvents:function(){var a=this;return this.element.on("updated."+d,function(){a.updated()}),this},updated:function(){return this.teardown().init()},teardown:function(){return this.element.off("updated."+d),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)}},this.each(function(){var b=a.data(this,d);b||(b=a.data(this,d,new c(this,f)))})},function(){"use strict";function b(b){var c={icon:"user-profile",classes:["icon"]};return b=b||a.extend({},c),"string"==typeof b&&(b=a.extend({},c,{icon:b.replace("icon-","")})),!b.classes&&b.class&&(b.classes=b.class,delete b.class),b.classes||(b.classes=[].concat(c.classes)),"string"==typeof b.classes&&(b.classes=b.classes.split(" ")),-1===b.classes.indexOf("icon")&&b.classes.push("icon"),b}a.createIcon=function(a){return a=b(a),['<svg class="'+a.classes.join(" ")+'" focusable="false" aria-hidden="true" role="presentation"><use xlink:href="#icon-'+a.icon+'"></use></svg>'].join("")},a.createIconElement=function(b){return a(a.createIcon(b))},a.createIconPath=function(c){return c=b(c),a.getBaseURL("#icon-"+c.icon.replace("icon-",""))},a.fn.changeIcon=function(b){a(this).find("use").attr("xlink:href",a.createIconPath({icon:b}))},a.fn.getIconName=function(){var b=a(this),c=b.find("use");return 1===c.length?c.attr("xlink:href").substr(c.attr("xlink:href").indexOf("#icon-")+6):b.attr("data-icon")}}(),a.fn.lookup=function(b){"use strict";function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="lookup",e={click:null,field:"id",title:null,buttons:[],options:null,beforeShow:null,modalContent:null,editable:!0,typeahead:!1,autoApply:!0,validator:null},f=a.extend({},e,b),g="lookup-datagrid";return c.prototype={init:function(){this.settings=f,this.inlineLabel=this.element.closest("label"),this.inlineLabelText=this.inlineLabel.find(".label-text"),this.isInlineLabel=!!this.inlineLabelText.length,this.build(),this.handleEvents(),this.grid=null,this.selectedRows=null},build:function(){var b=this.element,c=this.element.is(".input-xs")?"lookup-wrapper xs":this.element.is(".input-sm")?"lookup-wrapper sm":this.element.is(".input-lg")?"lookup-wrapper lg":"lookup-wrapper";this.element.is(".has-actions")&&(c+=" has-actions-wrapper"),this.icon=a('<span class="trigger" tabindex="-1"></span>').append(a.createIcon("search-list")),this.isInlineLabel?this.inlineLabel.addClass(c):(this.container=a('<span class="'+c+'"></span>'),b.wrap(this.container)),b.after(this.icon),b.attr("data-mask")&&b.mask(),this.element.is(":disabled")&&this.disable(),this.settings.editable||this.element.attr("readonly","true").addClass("is-not-editable"),this.addAria()},addAria:function(){var b=this;setTimeout(function(){b.label=b.isInlineLabel?b.inlineLabelText:a('label[for="'+b.element.attr("id")+'"]'),b.label&&b.label.append('<span class="audible">'+Locale.translate("UseEnter")+"</span>")},500)},handleEvents:function(){var b=this;this.icon.on("click.lookup",function(a){b.openDialog(a)}),this.element.on("keyup.lookup",function(c){a("#autocomplete-list").length>0||40===c.which&&b.openDialog(c)})},openDialog:function(a){var b=this;if(!1!==b.element.triggerHandler("beforeopen")&&!(b.isDisabled()||b.isReadonly()&&!b.element.hasClass("is-not-editable"))){if(b.settings.click)return void b.settings.click(a,this);if(this.settings.beforeShow){var c=function(a){a&&b.createGrid(a),b.createModal(),b.element.triggerHandler("complete"),b.element.trigger("open",[b.modal,b.grid]),b.settings.validator&&b.settings.validator(b.element,b.modal,b.grid)};return this.element.triggerHandler("start"),void this.settings.beforeShow(this,c)}if(this.settings.options){b.createModal(),b.element.trigger("open",[b.modal,b.grid]),b.modal.element.find(".btn-actions").removeClass("is-selected");var d=b.modal.element.find(".toolbar .more > .btn-actions");d.length&&setTimeout(function(){window.Soho.utils.fixSVGIcons(d)},600),b.element.trigger("afteropen",[b.modal,b.grid]),b.settings.validator&&b.settings.validator(b.element,b.modal,b.grid)}}},createModal:function(){var b=this,c='<div id="'+g+'"></div>',d=a('label[for="'+b.element.attr("id")+'"]'),e=b.isInlineLabel?b.inlineLabelText:d.length?d.clone().find("span").remove().end().text():"";this.settings.title&&(e=this.settings.title);var f=this.settings.modalContent;f&&f instanceof jQuery&&(c=f,f.show()),!f||f instanceof jQuery||(c=f);var h=this.settings.buttons;(this.settings.options&&"multiple"===this.settings.options.selectable&&0===h.length||!b.settings.autoApply&&0===h.length)&&(h=[{text:Locale.translate("Cancel"),click:function(a,c){b.element.focus(),c.close()}},{text:Locale.translate("Apply"),click:function(a,c){var d=b.grid.selectedRows();c.close(),b.insertRows(d)},isDefault:!0}]),this.settings.options&&"single"===this.settings.options.selectable&&0===h.length&&b.settings.autoApply&&(h=[{text:Locale.translate("Cancel"),click:function(a,c){b.element.focus(),c.close()}}]);var i=this.settings.options&&this.settings.options.toolbar&&this.settings.options.toolbar.keywordFilter;a("body").modal({title:e,content:c,buttons:h,cssClass:"lookup-modal"+(i?"":" lookup-no-search")}).off("open.lookup").on("open.lookup",function(){b.createGrid()}).off("close.lookup").on("close.lookup",function(){b.element.focus(),b.element.triggerHandler("close",[b.modal,b.grid])}),b.modal=a("body").data("modal"),this.settings.title||b.modal.element.find(".modal-title").append(' <span class="datagrid-result-count"></span>'),b.modal.element.off("beforeclose.lookup").on("beforeclose.lookup",function(){b.closeTearDown()}),setTimeout(function(){a(".modal.is-visible .searchfield").on("keypress.lookup",function(a){if(13===a.keyCode)return!1})},300)},closeTearDown:function(){var b=a(".modal.is-visible .searchfield").off("keypress.lookup");b.data()&&b.data("searchfield")&&b.data("searchfield").destroy(),b.data()&&b.data("toolbarsearchfield")&&(b.data("toolbarsearchfield").destroy(),b.removeData()),b=null,this.grid||this.grid.destroy()},createGrid:function(a){var b,c=this;a?(b=a,g=a.attr("id"),c.settings.options=a.data("datagrid").settings):b=c.modal.element.find("#"+g),c.settings.options&&("single"===c.settings.options.selectable&&c.settings.autoApply&&(c.settings.options.cellNavigation=!1,b.find("tr").addClass("is-clickable")),c.settings.options.isList=!0,b.data("datagrid")||b.datagrid(c.settings.options)),c.grid=b.data("datagrid"),!this.settings.title&&c.modal&&c.modal.element.find(".title").remove(),!(this.settings.options&&this.settings.options.toolbar&&this.settings.options.toolbar.keywordFilter)&&c.modal&&c.modal.element.find(".toolbar").appendTo(c.modal.element.find(".modal-header")),b.off("selected.lookup");var d=c.element.val();d&&c.selectGridRows(d),this.settings.options&&b.on("selected.lookup",function(a,b){b&&0!==b.length&&(c.settings.validator&&c.settings.validator(c.element,c.modal,c.grid),"single"===c.settings.options.selectable&&c.settings.autoApply&&setTimeout(function(){c.modal.close(),c.insertRows()},100))})},selectGridRows:function(a){var b=this,c=a;if(a)if(c.indexOf(",")>1)for(var d=c.split(","),e=0;e<d.length;e++)b.selectRowByValue(b.settings.field,d[e]);else b.selectRowByValue(b.settings.field,c)},selectRowByValue:function(a,b){if(this.settings.options){for(var c=this,d=this.settings.options.dataset,e=[],f=0;f<d.length;f++)"function"!=typeof c.settings.match?d[f][a]==b&&e.push(f):c.settings.match(b,d[f],c.element,c.grid)&&e.push(f);this.grid&&this.grid.selectedRows(e)}},insertRows:function(){var a=this,b="";a.selectedRows=a.grid.selectedRows();for(var c=0;c<a.selectedRows.length;c++){var d="";d="function"==typeof a.settings.field?a.settings.field(a.selectedRows[c].data,a.element,a.grid):a.selectedRows[c].data[a.settings.field],b+=(0!==c?",":"")+d}a.element.val(b).trigger("change",[a.selectedRows]),a.element.focus()},enable:function(){this.element.prop("disabled",!1).prop("readonly",!1),this.element.parent().removeClass("is-disabled")},disable:function(){this.element.prop("disabled",!0),this.element.parent().addClass("is-disabled")},readonly:function(){this.element.prop("readonly",!0)},isDisabled:function(){return this.element.prop("disabled")},isReadonly:function(){return this.element.prop("readonly")},destroy:function(){a.removeData(this.element[0],d),this.element.off("click.dropdown keypress.dropdown"),this.icon.remove(),this.element.unwrap(),this.label&&null!=this.label&&this.label.find(".audible").remove()}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})};var F=[".expandable-area",".accordion"],G=[];a.fn.destroy=function(){return j(a(this),"destroy")},a.fn.closeChildren=function(){return j(a(this),"close",F)},a.fn.handleResize=function(){return j(a(this),"handleResize",G)},a.fn.listview=function(b){function c(b){this.settings=a.extend({},g),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="listview",f={dataset:[],template:null,description:null,paging:!1,pagesize:10,searchable:!1,selectable:"single",selectOnFocus:!0,hoverable:!0,source:null},g=a.extend({},f,b);return c.prototype={init:function(){this.setup(),this.refresh(),this.selectedItems=[],this.lastSelectedRow=0,this.isSelectedAll=!1,this.sortInit("listview","click.listview","data-sortlist"),this.handleEvents(),this.handleResize()},setup:function(){var a=this,b=this.element.closest(".card, .widget"),c=this.element.attr("data-selectable"),d=this.element.attr("data-select-onfocus");c&&c.length&&(this.settings.selectable=c),d&&d.length&&(this.settings.selectOnFocus=JSON.parse(d)),a.actionButton=b.find(".btn-actions"),a.actionButton.length>0&&(a.actionButton.data("popupmenu")||a.actionButton.popupmenu()),this.element.attr({tabindex:"-1"}),(this.element.is(".paginated")||!0===this.settings.paging)&&this.element.pager({componentAPI:this,pagesize:this.settings.pagesize,source:this.settings.source});var f=this.element.parent(".card-content, .widget-content");if(f[0]&&(f[0].style.overflow="hidden"),this.element.attr({role:"listbox","aria-label":this.settings.description||b.find(".card-title, .widget-title").text()}),this.settings.searchable&&(this.searchfield=this.element.parent().find(".searchfield, .autocomplete"),this.searchfield.length,this.listfilter=new e({filterMode:"contains"})),this.settings.dataset&&"string"==typeof this.settings.dataset){var g=window[this.settings.dataset];g&&g.length&&(this.settings.dataset=g)}},getTotals:function(a){var b,c={count:a.length};if(a[0]){for(b in a[0])c[b]=0;for(var d=0;d<a.length;d++)for(b in a[d])c[b]+=parseFloat(a[d][b]);return c}},render:function(b,c){var d=this,e={};if("object"==typeof H&&b&&this.settings.template){this.settings.template instanceof a&&(this.settings.template=""+this.settings.template.html()),this.settings.template.indexOf("{{#totals}}")>-1&&(e=this.getTotals(b));var f=H.compile(this.settings.template),g=f.render({dataset:b,totals:e});this.element.html(g)}this.settings.paging&&this.renderPager(c),a("ul",this.element).attr({role:"presentation"});var h=this.element.find("li, tbody > tr").first(),i=this.element.find("li, tr"),j="multiple"===this.settings.selectable;h.attr("tabindex",0),this.settings.selectable||1!==h.find("a").length||h.removeAttr("tabindex"),i.each(function(b){var c=a(this);if(c.attr("role","option"),j){d.element.addClass("is-muliselect");var e=d.element.prevAll(".toolbar");e.length&&e.data("toolbar")&&e.data("toolbar").toggleMoreMenu()}c.attr({"aria-posinset":b+1,"aria-setsize":i.length}),c.hasClass("is-disabled")&&c.attr("aria-disabled","true")}),this.element.children().initialize(),this.element.trigger("rendered",[b]),this.element.off("updated").on("updated",function(){d.refresh()})},renderPager:function(a){var b=this.element.data("pager");b&&this.settings.pager&&b.updatePagingInfo(a)},refresh:function(){this.loadData(),this.list&&this.render(this.list.data)},loadData:function(b,c){function d(a,c){b=a,f.render(b,c)}var e=!1,f=this;if(b=b||this.settings.dataset,c=c||{},b){var g=this.settings.source;if("string"!=typeof b||0!==b.indexOf("http")&&0!==b.indexOf("/")||(g=b,e=!0),g||e)switch(typeof g){case"function":return g(c,d);case"string":return void(0!==g.indexOf("http")&&0!==g.indexOf("/")||a.ajax({url:g,async:!1,dataType:"json",success:function(a){return b=f.settings.dataset=a,f.render(b,c)}}));default:return b=this.settings.dataset=g,this.render(g,c)}this.render(b,c)}},toggleAll:function(){this[this.isSelectedAll?"unselectRowsBetweenIndexes":"selectRowsBetweenIndexes"]([0,a("li, tbody tr",this.element).length-1]),this.isSelectedAll=!this.isSelectedAll},selectRowsBetweenIndexes:function(b){this.clearSelection(),b.sort(function(a,b){return a-b});for(var c=b[0];c<=b[1];c++){var d=a("li, tbody tr",this.element).eq(c);d.is(".is-disabled, .is-selected")||this.select(d)}},unselectRowsBetweenIndexes:function(b){b.sort(function(a,b){return a-b});for(var c=b[0];c<=b[1];c++){var d=a("li, tbody tr",this.element).eq(c);!d.is(".is-disabled")&&d.is(".is-selected")&&this.select(d)}},clearSelection:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},handleResize:function(){var b=a("li .listview-heading, tr .listview-heading",this.element),c=b.eq(1),d=c.width();c.length&&d&&(b[0].style.width=d+"px"),this.setChildIconsValign(),this.element.data("pager")&&this.element.data("pager").renderBar()},handleSearch:function(b,c){var d,e=this.element.find("li, tbody > tr"),f=c.val();this.resetSearch(e),f&&f.length&&(d=this.listfilter.filter(e,f)),d&&(d.length||f)&&(e.not(d).addClass("hidden"),e.filter(d).each(function(b){var c=a(this);c.attr("tabindex",0===b?"0":"-1"),c.highlight(f)}),this.renderPager())},resetSearch:function(b){b.removeClass("hidden").each(function(){a(this).unhighlight()})},setChildIconsValign:function(){a("li > .icon, li > button",this.element).each(function(){var b=a(this),c=b.is("button")?42:22,d=b.closest("li"),e=parseInt(d[0].style.paddingTop,10)+parseInt(d[0].style.paddingBottom,10),f=d.outerHeight()-e;this.style.top=(f-c)/2+"px"})},focus:function(a){a.is(":hidden")||a.is(".is-disabled")||(a.siblings().removeAttr("tabindex"),a.attr("tabindex",0).focus(),this.settings.selectable||1!==a.find("a").length||(a.find("a").focus(),a.removeAttr("tabindex")),this.settings.selectOnFocus&&"multiple"!==this.settings.selectable&&this.select(a))},remove:function(b){"number"==typeof b&&(b=a(this.element.children()[0]).children().eq(b)),b.is(".is-selected")&&this.select(b,!0),b.remove()},clear:function(){a(this.element.children()[0]).empty()},removeAllSelected:function(){var b=this;a.each(this.selectedItems,function(a,c){b.remove(c)})},clearAllSelected:function(){var b=this;a.each(this.selectedItems,function(a,c){b.select(c)})},sortInit:function(b,c,d){d&&""!==a.trim(d)&&a("["+d+"]").each(function(){var e=a(this),f=a.fn.parseOptions(e,d);e.on(c,function(c){a(f.list).data(b).setSortColumn(f),c.preventDefault()})})},setSortColumn:function(a){var b,c=a.orderBy||this.list.sort.field,d=a.order;(this.list.data||c)&&(d=d?"desc"===d:!(this.list.sort&&this.list.sort[c]&&this.list.sort[c].reverse),(a.reloadApi||a.reloadApiNoSort)&&this.loadData(),a.reloadApiNoSort&&(c=this.list.sort.field,d=this.list.sort[c].reverse),b=this.sortFunction(c,d),this.list.data.sort(b),this.render(this.list.data),this.list.sort={field:c},this.list.sort[c]={reverse:d},this.element.trigger("sorted",[this.element,this.list.sort]))},sortFunction:function(a,b,c){var d;return c||(c=function(a){return a=void 0===a||null===a?"":a,"string"==typeof a&&(a=a.toUpperCase(),isNaN(parseFloat(a))||(a=parseFloat(a))),a}),d=c?function(b){return c(b[a])}:function(b){return b[a]},b=b?-1:1,function(a,c){return a=d(a),c=d(c),b*((a>c)-(c>a))}},unselect:function(b){"number"==typeof b&&(b=a(this.element.children()[0]).children().eq(b)),b.is(".is-selected")&&this.select(b)},select:function(b,c){var d=this,e=!1;if(d.selectedItems=[],"number"==typeof b&&(b=a(this.element.children()[0]).children().eq(b)),e=b.hasClass("is-selected"),b.is('[tabindex="0"]')||(b.siblings().removeAttr("tabindex"),b.attr("tabindex",0)),!1!==this.settings.selectable&&"false"!==this.settings.selectable){if("multiple"!==this.settings.selectable&&(b.parent().children().removeAttr("aria-selected"),b.parent().find(".is-selected").removeClass("is-selected"),d.selectedItems[0]=a(this)),e?(d.selectedItems=[],b.removeClass("is-selected")):this.settings.selectable&&(b.addClass("is-selected"),d.lastSelectedRow=b.index()),b.parent().find(".is-selected").each(function(b){d.selectedItems[b]=a(this)}),b.attr("aria-selected",!e),!c){var f=e?"unselected":"selected";this.element.triggerHandler(f,{selectedItems:this.selectedItems,elem:b})}var g,h,i=this.element.closest(".card, .widget");if(i.length||(i=this.element.parent()),g=i.find(".listview-toolbar, .contextual-toolbar"),h=g.data("toolbar"),d.selectedItems.length>0){h&&h.toggleMoreMenu(),g.one("animateopencomplete",function(){d.element.addClass("is-toolbar-open"),g.trigger("recalculate-buttons").removeClass("is-hidden")}),g[0]&&(g[0].style.display="block"),g.animateOpen({distance:40});var j=g.find(".title, .selection-count");j&&j.length||(j=a('<div class="title selection-count"></div>'),g.prepend(j)),j.text(d.selectedItems.length+" "+Locale.translate("Selected"))}else g.addClass("is-hidden").one("animateclosedcomplete",function(a){a.stopPropagation(),this.style.display="none"}).animateClosed()}},updated:function(){return this.refresh(),this},teardown:function(){return a("body").off("resize.listview"),this.element.off("focus.listview click.listview touchend.listview keydown.listview change.selectable-listview afterpaging.listview").empty(),this},destroy:function(){this.teardown(),this.element.removeData(d)},handleEvents:function(){var b=this,c=!1,d=!1,e="multiple"===b.settings.selectable;if(this.element.on("focus.listview","li, tbody tr",function(){var e=a(this);if(e.is(":first-child")&&e.hasClass("is-disabled")){var f=a.Event("keydown.listview");f.keyCode=40,c=!0,e.trigger(f)}c||e.hasClass("is-disabled")||!b.settings.selectOnFocus||"multiple"===b.settings.selectable||(b.select(e),c=!0,d=!0)}),this.element.on("keydown.listview","li, tr, a",function(c){var d=a(this),f=d.is("a")?d.closest("li"):a(this),g=f.is("a")?f.closest("ul"):f.parent(),h=c.keyCode||c.charCode||0,i=c.metaKey;if(0!==f.index()||38!==c.keyCode){if((40===h||38===h)&&!i){var j=40===c.keyCode?f.nextAll(":not(.is-disabled):visible:first"):f.prevAll(":not(.is-disabled):visible:first");j.length&&(a(c.target).is(f)||c.shiftKey||d.is("a"))&&b.focus(j),c.preventDefault(),c.stopPropagation()}if(35===h||40===h&&i){var k=g.children().last();return b.focus(k),c.stopPropagation(),!1}if(36===h||38===h&&i){var l=g.children().first();return b.focus(l),c.stopPropagation(),!1}32===h&&a(c.target).is(f)&&(e&&c.shiftKey?b.selectRowsBetweenIndexes([b.lastSelectedRow,f.index()]):b.select(f),c.preventDefault()),e&&(c.ctrlKey||c.metaKey)&&65===h&&(b.toggleAll(),b.focus(f),c.preventDefault())}}),this.settings.selectable){this.element.addClass("is-selectable");var f=a(".list-detail-back-button").find(".app-header"),g=a(this.element).closest(".list-detail, .builder");f.parent().onTouchClick("listview").on("click.listview",function(a){return f.hasClass("go-back")&&(f.removeClass("go-back"),g.removeClass("show-detail")),a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault(),!1}),this.element.off("click.listview","li, tr").on("click.listview","li, tr",function(h){var i=a(this);d||i.hasClass("is-disabled")||(c=!0,e&&h.shiftKey?(b.selectRowsBetweenIndexes([b.lastSelectedRow,i.index()]),h.preventDefault()):b.select(i),i.focus()),g.length>0&&a(window).outerWidth()<767&&!i.hasClass("is-disabled")&&(g.toggleClass("show-detail"),f.toggleClass("go-back")),d=!1})}this.settings.hoverable&&"false"!==this.settings.hoverable||(this.element.removeClass("is-selectable"),this.element.addClass("disable-hover")),this.settings.selectable&&"false"!==this.settings.selectable||(this.element.removeClass("is-selectable"),this.element.addClass("disable-hover")),"multiple"===this.settings.selectable&&this.element.on("change.selectable-listview",".listview-checkbox input",function(b){a(this).parent().trigger("click"),b.stopPropagation()}),this.settings.searchable&&this.searchfield.on("contents-checked.searchable-listview",function(c){b.handleSearch(c,a(this))}),this.element.data("pager")&&this.element.on("afterpaging.listview",function(){b.element.scrollTop(0)}),a("body").on("resize.listview",function(){b.handleResize()}),b.element.prev(".listview-header").onTouchClick().on("click",function(){var c=a(this).find(".plus-minus");c.hasClass("active")?(c.removeClass("active"),b.element.animateClosed()):(c.addClass("active"),b.element.animateOpen())})}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,g))})},a.fn.listbuilder=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="listbuilder",e={dataset:[],btnAdd:"add",btnEdit:"edit",btnDelete:"delete",btnGoUp:"goup",btnGoDown:"godown",template:'<ul data-handle=".handle">{{#dataset}}{{#text}}<li{{#value}} data-value="{{value}}"{{/value}}{{#selected}} selected="selected"{{/selected}}{{#disabled}} class="is-disabled"{{/disabled}}><span class="handle" focusable="false" aria-hidden="true" role="presentation">&#8286;</span><div class="item-content"><p>{{text}}</p></div></li>{{/text}}{{/dataset}}</ul>',templateNewItem:'<li data-value="{{text}}" role="option"><span class="handle" focusable="false" aria-hidden="true" role="presentation">&#8286;</span><div class="item-content"><p>{{text}}</p></div></li>',templateItemContent:"<p>{{text}}</p>"},f=a.extend({},e,b);return c.prototype={init:function(){var a=this;this.loadListview().initDataset().setElements().handleEvents(),setTimeout(function(){a.setSelected()},0)},loadListview:function(){var b=this.settings,c=a(".listview",this.element);return!b.dataset.length&&c.length&&a("li",c).length?this.listApi=c.listview({selectable:"single"}).data("listview"):c.length&&(this.listApi=c.listview({dataset:b.dataset,template:b.template,selectable:"single"}).data("listview")),this},initDataset:function(){var b=this.settings,c=a(".listview li",this.element);this.dataset=[];for(var d=0,e=c.length;d<e;d++){var f,g=a(c[d]);b.dataset?(f=JSON.parse(JSON.stringify(b.dataset[d])),f.node=g):f=this.extractNodeData(g),this.dataset.push(f)}return this},extractNodeData:function(b){var c={node:b,text:a.trim(a(".item-content",b).text())},d=b.attr("data-value");return void 0!==d&&(c.value=d),c},setElements:function(){var b=this,c=this.settings,d=function(c){return b.isjQuery(c)?c:"string"==typeof c?a('[data-action="'+c+'"]',b.element):null};return c.btnAdd=d(c.btnAdd),c.btnGoUp=d(c.btnGoUp),c.btnGoDown=d(c.btnGoDown),c.btnEdit=d(c.btnEdit),c.btnDelete=d(c.btnDelete),this.topButtons=c.btnAdd.add(c.btnGoUp).add(c.btnGoDown).add(c.btnEdit).add(c.btnDelete),this.topButtons.tooltip(),this.ul=a(".listview ul",this.element),this.arrangeApi=this.ul.arrange({placeholder:c.templateNewItem}).data("arrange"),this},handleEvents:function(){var b,c=this,d=c.settings,e=function(a,b){a.offTouchClick("listbuilder").off("click.listbuilder").onTouchClick("listbuilder").on("click.listbuilder",function(){c[b]()})};return e(d.btnAdd,"addItem"),e(d.btnGoUp,"moveItemUp"),e(d.btnGoDown,"moveItemDown"),e(d.btnEdit,"editItem"),e(d.btnDelete,"deleteItem"),c.arrangeApi.element.on("beforearrange.listbuilder",function(a,b){var e=c.getDataByNode(b.start),f=d.templateItemContent.replace(/{{text}}/g,e.data.text);c.arrangeApi.placeholders.attr("data-value",e.data.text).find(".item-content").html(f)}).on("arrangeupdate.listbuilder",function(a,d){c.updateAttributes(),c.arrayIndexMove(c.dataset,d.startIndex,d.endIndex),b=c.getDataByNode(d.end),b.indexBeforeMove=d.startIndex,c.element.triggerHandler("arrangeupdate",[b])}),a("li:not(.is-disabled) "+c.arrangeApi.handle,c.ul).on("mousedown.listbuilder touchstart.listbuilder",function(){var b=a(this);b.is(".is-selected")||b.trigger("click")}),a(".listview",c.element).off("selected.listbuilder").on("selected.listbuilder",function(a,b){var d=c.getDataByNode(b.elem[0]);c.element.triggerHandler("selected",[d])}),c.updatedEventsStr="arrangeupdate.listbuilder aftergoup.listbuilder aftergodown.listbuilder exiteditmode.listbuilder",c.element.off(c.updatedEventsStr).on(c.updatedEventsStr,function(a,b){c.element.triggerHandler("updated",[b])}),this},addItem:function(){var b=this,c=b.settings;a.when(b.element.triggerHandler("beforeadd")).done(function(){var d,e,f=0,g=b.listApi.selectedItems[0],h=c.templateNewItem.replace(/{{text}}/g,Locale.translate("NewItem"));g&&g.length>0?(e=b.getDataByNode(g),f=e.index+1,a(h).insertAfter(g),d=a("li",b.ul).eq(f)):(b.ul.prepend(h),d=a("li:first-child",b.ul)),b.dataset.push(b.extractNodeData(d)),b.arrayIndexMove(b.dataset,b.dataset.length-1,f),b.updateAttributes(),d.trigger("click"),b.arrangeApi.updated(),b.editItem(!0),e=b.dataset[f],b.element.triggerHandler("afteradd",[e])})},moveItemUp:function(){var b=this,c=b.listApi.selectedItems[0];if(c&&c.length>0){var d=b.getDataByNode(c);void 0!==d.index&&d.index>0&&a.when(b.element.triggerHandler("beforegoup",[d])).done(function(){var a=c.prev();c.insertBefore(a),b.updateAttributes(),b.arrayIndexMove(b.dataset,d.index,d.index-1),d.indexBeforeMove=d.index,d.index=d.index-1,b.element.triggerHandler("aftergoup",[d])})}},moveItemDown:function(){var b=this,c=b.listApi.selectedItems[0];if(c&&c.length>0){var d=b.getDataByNode(c);void 0!==d.index&&d.index<b.dataset.length-1&&a.when(b.element.triggerHandler("beforegodown",[d])).done(function(){var a=c.next();c.insertAfter(a),b.updateAttributes(),b.arrayIndexMove(b.dataset,d.index,d.index+1),d.indexBeforeMove=d.index,d.index=d.index+1,b.element.triggerHandler("aftergodown",[d])})}},editItem:function(a){var b=this.listApi.selectedItems[0];b&&b.length>0&&(b.is(".is-editing")?this.commitEdit(b,a):this.makeEditable(b,a))},makeEditable:function(b,c){var d=this,e=d.getDataByNode(b),f=a(".item-content",b);void 0!==e.index&&e.index<d.dataset.length&&a.when(d.element.triggerHandler("beforeedit",[e])).done(function(){var g=f.text().trim(),h=a('<input name="edit-input" class="edit-input" type="text" value="'+g+'" />');b.addClass("is-editing"),f.html(h),h.focus().select(),h.on("click.listbuilder",function(){return!1}).on("blur.listbuilder",function(){d.commitEdit(b,c)}).on("keypress.listbuilder",function(a){13===(a.keyCode||a.charCode||0)&&(d.commitEdit(b,c),b.focus())}),d.element.triggerHandler("entereditmode",[e])})},commitEdit:function(b,c){var d=this,e=this.settings,f=d.getDataByNode(b),g=a(".item-content",b),h=a(".edit-input",g);c&&(f.data.value=h.val()),f.data.text=h.val(),h.off("click.listbuilder blur.listbuilder keypress.listbuilder"),g.html(e.templateItemContent.replace(/{{text}}/g,h.val())),b.removeClass("is-editing"),d.element.triggerHandler("exiteditmode",[f])},deleteItem:function(){var b=this,c=b.listApi.selectedItems[0];if(c&&c.length>0){var d=b.getDataByNode(c);void 0!==d.index&&a.when(b.element.triggerHandler("beforedelete",[d])).done(function(){b.listApi.removeAllSelected(),b.updateAttributes(),b.dataset.splice(d.index,1),b.element.triggerHandler("afterdelete",[d])})}},getDataByNode:function(b){for(var c={},d=0,e=this.dataset.length;d<e;d++){var f=this.dataset[d];if(a(f.node).is(b)){c={index:d,data:f};break}}return c},arrayIndexMove:function(a,b,c){a.splice(c,0,a.splice(b,1)[0])},isjQuery:function(a){return a&&(a instanceof jQuery||a.constructor.prototype.jquery)},moveCursorToEnd:function(a){setTimeout(function(){if("number"==typeof a.selectionStart)a.selectionStart=a.selectionEnd=a.value.length;else if(void 0!==a.createTextRange){var b=a.createTextRange();b.collapse(!1),b.select()}},100)},updateAttributes:function(){var b=a("li",this.ul),c=b.length;b.each(function(b){a(this).attr({"aria-posinset":b+1,"aria-setsize":c})})},updateDataset:function(b){var c=this,d=a("li",this.ul),e=a(".listview",this.element).data("listview");e.unselectRowsBetweenIndexes([0,d.length-1]),this.settings.dataset=b,e.loadData(this.settings.dataset),this.initDataset().setElements().handleEvents(),setTimeout(function(){c.setSelected()},0)},setSelected:function(){return a("li[selected]",this.ul).each(function(){var b=a(this);b.removeAttr("selected"),b.is(".is-selected")||b.trigger("click")}),this},select:function(a){var b=this.getListItem(a);b&&(b.is(".is-selected")||b.trigger("click"))},unselect:function(a){var b=this.getListItem(a);b&&b.is(".is-selected")&&b.trigger("click")},getListItem:function(b){var c=a();if(this.isElement(b)&&a.contains(this.ul,b))c=this.isjQuery(b)?b:a(b);else{var d=parseInt(b),e=a("li",this.ul);!isNaN(d)&&d>-1&&d<e.length?c=e.eq(d):"first"===(b+"").toLowerCase()?c=e.first():"last"===(b+"").toLowerCase()&&(c=e.last())}return c.length<1?null:c.length>1?c.eq(0):c},isElement:function(a){return this.isjQuery(a)&&a.get(0)instanceof Element||a instanceof Element},enable:function(){this.element.removeClass("is-disabled").find(".toolbar .buttonset button").removeAttr("disabled").end().find(".toolbar .buttonset button[data-original-disabled]").attr("disabled","disabled").removeAttr("data-original-disabled"),this.ul.find("li").removeClass("is-disabled").end().find("li[data-original-disabled]").addClass("is-disabled").removeAttr("data-original-disabled")},disable:function(){this.element.addClass("is-disabled").find(".toolbar .buttonset button[disabled]").attr("data-original-disabled","disabled").end().find(".toolbar .buttonset button").attr("disabled","disabled"),this.ul.find("li.is-disabled").attr("data-original-disabled","is-disabled").end().find("li").addClass("is-disabled")},unbind:function(){return this.element.off(this.updatedEventsStr),a(".listview",this.element).off("selected.listbuilder"),a("li "+this.arrangeApi.handle,this.ul).off("mousedown.listbuilder touchstart.listbuilder"),this.arrangeApi.element.off("beforearrange.listbuilder arrangeupdate.listbuilder").destroy(),this.topButtons.off("click.listbuilder").each(function(){a(this).data("tooltip").destroy()}),this.listApi.destroy(),this},updated:function(){return this.unbind().init()},destroy:function(){this.unbind(),a.removeData(this.element[0],d)}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.circlepager=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="circlepager",e={slidesToShow:1,startingSlide:null,loop:!1},f=a.extend({},e,b);return c.prototype={init:function(){this.setElements(),this.slides.length&&(this.createControls(),this.handleEvents(),this.showCollapsedView(),this.initActiveSlide())},setElements:function(){var b=this,c=this.settings;this.container=a(".slides",this.element),this.slidesJQ=a(".slide",this.element),this.slidesToShow=c.slidesToShow,this.slides=[],this.slidesJQ.each(function(){b.slides.push({node:a(this)})}),this.slides.length&&this.element.css({"min-width":this.slidesJQ.eq(0).width()+5}),this.activeIndex=null!==c.startingSlide&&c.startingSlide>-1&&c.startingSlide<this.slides.length?c.startingSlide:0},createControls:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=this.slides.length,p='<div class="controls">',q="",r=0;for(b=0,c=o;b<c;b+=this.slidesToShow){e="",r++,k=1===this.slidesToShow||o-b==1,g=Locale.translate(k?"SlideOf":"SlidesOf")+"",f=k?"#slide {0} of {1}":"#slides {0} and {1} of {2}";for(var s=0;s<this.slidesToShow&&b+s<o;s++)e+=b+s+1+", ";g=g.replace(k?"{1}":"{2}",o),f=f.replace(k?"{1}":"{2}",o),e=e.slice(0,-2),j=e.lastIndexOf(","),i=e.substr(j+2),k?(l="",d=this.slides[b].node,d.is(".is-disabled, [disabled]")&&!d.is('[disabled="false"]')&&(l=' disabled tabindex="-1"',this.slides[b].isDisabled=!0),
d.is(".active")&&null===this.settings.startingSlide&&""===l&&(this.activeIndex=b),h=d.attr("data-button-text"),g=h&&h.length?h:g.replace("{0}",e),f=f.replace("{0}",e)):(e=e.substr(0,j),g=g.replace("{1}",i).replace("{0}",e),f=f.replace("{1}",i).replace("{0}",e)),f=f.toLowerCase().replace(/[\s,--]+/g,"-"),q+='<a href="'+f+'" class="control-button hyperlink hide-focus"'+l+'><span class="audible">'+g+"</span></a>"}p+=q+"</div>",this.isBulletsNav=this.element.width()>29*r,m=a(".btn-previous",this.element),n=a(".btn-next",this.element),this.isBulletsNav?m.add(n).remove():(m.length||(p+='<button class="btn-previous" type="button">'+a.createIcon("left-arrow")+'<span class="audible">'+Locale.translate("Previous")+"</span></button>"),n.length||(p+='<button class="btn-next" type="button">'+a.createIcon("right-arrow")+'<span class="audible">'+Locale.translate("Next")+"</span></button>")),this.element.append(p)},isVisibleInContainer:function(a){if(a&&a[0]){var b=a[0].getBoundingClientRect(),c=this.element[0].getBoundingClientRect();return b.left>c.left&&b.left<c.left+c.width&&b.top>c.top&&b.top<c.top+c.height}return-1},updateSlidesToShow:function(a){if(this.isActive)return this.settings.slidesToShow=a||1,this.updated(),this},responsiveSlidesToShow:function(a){if(this.isActive){var b=this;this.slidesToShow=a||this.settings.slidesToShow,this.unbind().slidesJQ.css("width",""),this.slides.length&&setTimeout(function(){b.createControls(),b.handleEvents(),b.showCollapsedView(),b.initActiveSlide()},0)}},show:function(a){if(this.isActive){a=void 0!==a?a:this.activeIndex,this.activeIndex=a;var b=a>0?(Locale.isRTL()?"":"-")+100*a+"%":0;this.controlButtons.removeClass("is-active").eq(a).addClass("is-active"),this.container[0].style.left=b,this.isBulletsNav?(this.element.removeClass("is-bullets-nav-hidden"),this.controlButtons.find("span").addClass("audible")):(this.element.addClass("is-bullets-nav-hidden"),this.controlButtons.find("span").addClass("audible").end().eq(a).find("span").removeClass("audible")),this.isFocus&&this.isBulletsNav&&(this.isFocus=!1,this.controlButtons.eq(a).focus())}},first:function(){this.show(0)},last:function(){this.show(Math.round(this.slides.length/this.slidesToShow)-1)},prev:function(){var a=this,b=this.activeIndex>0?this.activeIndex-1:this.settings.loop?Math.round(this.slides.length/this.slidesToShow)-1:0;if(this.slides[b].isDisabled)return setTimeout(function(){a.prev()},0),this.activeIndex=b,!1;this.show(b)},next:function(){var a=this,b=this.activeIndex>=Math.round(this.slides.length/this.slidesToShow)-1?this.settings.loop?0:this.activeIndex:this.activeIndex+1;if(this.slides[b].isDisabled)return setTimeout(function(){a.next()},0),this.activeIndex=b,!1;this.show(b)},showCollapsedView:function(){if(this.isActive=!0,this.element.addClass("is-active"),this.container[0].style.width=100*this.slides.length+"%",this.settings.slidesToShow>1&&this.slidesJQ.eq(0).width()*this.slidesToShow>this.element.width())return void this.responsiveSlidesToShow(this.slidesToShow-1);for(var a=0,b=this.slidesJQ.length;a<b;a++)this.slidesJQ[a].style.width=100/this.slidesToShow/this.slides.length+"%";this.show()},showExpandedView:function(){this.isActive=!1,this.element.removeClass("is-active"),this.element[0].style.width="",this.container[0].style.width="",this.container[0].style.left=""},initActiveSlide:function(){if(this.slides[this.activeIndex].isDisabled)return this.next(),!1;this.show()},unbind:function(){return a("body").off("resize.circlepager"),this.element.off("focus.circlepager keydown.circlepager","*"),this.controlButtons.off("click.circlepager keydown.circlepager"),a(".btn-previous, .btn-next",this.element).off("click.circlepager"),a(".controls",this.element).remove(),this.showExpandedView(),this},updated:function(){return this.unbind().init()},destroy:function(){this.unbind(),a.removeData(this.element[0],d)},handleEvents:function(){var b=this;a(".btn-previous",this.element).onTouchClick("circlepager").on("click.circlepager",function(a){b.prev(),a.stopImmediatePropagation()}),a(".btn-next",this.element).onTouchClick("circlepager").on("click.circlepager",function(a){b.next(),a.stopImmediatePropagation()}),this.controlButtons=a(".control-button",this.element),this.controlButtons.each(function(c){var d=a(this);d.hideFocus(),d.on("click.circlepager",function(a){a.preventDefault(),b.slides[c].isDisabled||b.show(c)})}),this.element.on("focus.circlepager","*",function(c){var d=!1;if(!b.isVisibleInContainer(a(this)))for(var e=b.element.find(":focusable"),f=0,g=e.length;f<g;f++)if(b.isVisibleInContainer(e.eq(f))){e.eq(f).focus(),d=!0;break}if(c.stopPropagation(),d)return!1}),this.element.on("keydown.circlepager","*",function(c){var d=c.which||c.keyCode||c.charCode||0,e=!1,f=a(":focusable"),g=f.index(this);if(9===d)if(c.shiftKey){for(var h=g-1;h>=0;h--)if(b.element.has(f.eq(h)).length<1||b.isVisibleInContainer(f.eq(h))){f.eq(h).focus(),e=!0;break}}else b.isVisibleInContainer(f.eq(g+1))||(b.controlButtons.first().focus(),e=!0);if(c.stopPropagation(),e)return!1}),this.controlButtons.on("keydown.circlepager",function(a){var c=a.which||a.keyCode||a.charCode||0,d=!1,e=Locale.isRTL();if(-1!==[37,39].indexOf(c)&&(b.isFocus=!0,a.altKey?37===c&&!e||39===c&&e?b.first():b.last():(!e&&37===c||e&&39===c?b.prev():b.next(),d=!0)),d)return a.preventDefault(),a.stopPropagation(),!1}),a("body").on("resize.circlepager",function(){b.responsiveSlidesToShow()})}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.pager=function(b){function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="pager",e={componentAPI:void 0,type:"list",position:"bottom",activePage:1,hideOnOnePage:!1,source:null,pagesize:15,pagesizes:[15,25,50,75],showPageSizeSelector:!0,indeterminate:!1},f=a.extend({},e,b),g="li:not(.pager-prev):not(.pager-next):not(.pager-first):not(.pager-last)";return c.prototype={pagerInfo:{},init:function(){this.setup(),this.createPagerBar(),this.setActivePage(this.settings.activePage),this.renderBar(),this.renderPages("initial"),this.handleEvents()},setup:function(){if(-1===a.inArray(this.settings.pagesize,this.settings.pagesizes)){var b=function(a,b){return a-b};this.settings.pagesizes.push(this.settings.pagesize),this.settings.pagesizes=this.settings.pagesizes.sort(b)}var c=this.element.parents(".card, .widget");this.element.is("tbody")&&(this.isTable=!0,this.settings.type="table",this.mainContainer=this.element.closest(".datagrid-container"),this.settings.componentAPI||(this.settings.componentAPI=this.mainContainer.data("datagrid")),c.length&&c[0].classList.add("has-datagrid"));var d=this.element.is(".listview");return d.length&&(this.isTable=!1,this.settings.type="list",this.mainContainer=d,this.settings.componentAPI||(this.settings.componentAPI=this.element.data("listview"))),this.isRTL=Locale.isRTL(),this},createPagerBar:function(){if(this.pagerBar=this.element.prev(".pager-toolbar"),0===this.pagerBar.length){this.pagerBar=a('<ul class="pager-toolbar"></ul>');var b='<li class="pager-prev"><a href="#" rel="prev" title="PreviousPage">'+a.createIcon({icon:"previous-page"})+'<span class="audible">'+Locale.translate("PreviousPage")+'</span></a></li><li class="pager-next"><a href="#" rel="next" title="NextPage">'+a.createIcon({icon:"next-page"})+'<span class="audible">'+Locale.translate("NextPage")+"</span></a></li>";"table"===this.settings.type&&(b='<li class="pager-first"><a href="#" title="FirstPage">'+a.createIcon({icon:"first-page"})+'<span class="audible">'+Locale.translate("FirstPage")+"</span></a></li>"+b+'<li class="pager-last"><a href="#" title="LastPage">'+a.createIcon({icon:"last-page"})+'<span class="audible">'+Locale.translate("LastPage")+"</span></a></li>"),this.pagerBar.html(b),this.pagerBar.children("li").children("a").button()}if(this.isTable?this.mainContainer.after(this.pagerBar):"bottom"===this.settings.position?this.element.after(this.pagerBar):this.element.before(this.pagerBar),this.element.closest(".card, .widget").length){var c=this;["widget","card"].forEach(function(b){var d=c.element.closest("."+b+"-content");if(d.length){var e=d.next("."+b+"-footer");e.length||(e=a('<div class="'+b+'-footer"></div>').insertAfter(d)),c.pagerBar.appendTo(e)}})}this.pagerBar.find("a").tooltip()},handleEvents:function(){var b=this;b.element.on("afterpaging.pager",function(){a("li[tabindex]:visible, td[tabindex]:visible",b.element).length||a("li:visible:first, td:visible:first",b.element).attr("tabindex","0"),a("li a",b.pagerBar).each(function(){var b=a(this),c=b.closest("li");b.is("[disabled]")||c.attr("tabindex","0").on("focus.pager",function(){a("a",this).focus()})})}),this.pagerBar.onTouchClick("pager","a").on("click.pager","a",function(c){var d=a(this).parent();if(c.preventDefault(),!a(this).attr("disabled"))return d.is(".pager-prev")?(b.setActivePage(b.activePage-1,!1,"prev"),!1):d.is(".pager-next")?(b.setActivePage((-1===b.activePage?0:b.activePage)+1,!1,"next"),!1):d.is(".pager-first")?(b.setActivePage(1,!1,"first"),!1):d.is(".pager-last")?(b.setActivePage(b.pageCount(),!1,"last"),!1):(b.setActivePage(a(this).parent().index()+("table"===b.settings.type?-1:0),!1,"page"),!1)}).on("focus.pager","a",function(){a(this).parent("li").addClass("is-focused")}).on("blur.pager","a",function(){a(this).parent("li").removeClass("is-focused")}),this.pagerBar.on("keydown.pager","a",function(b){b=b||window.event;var c=b.which||b.keyCode||b.charCode||!1,d=a(this).parent(),e=37===c||9===c&&b.shiftKey?d.prev():39===c?d.next():a();(9===c&&b.shiftKey&&d.prev().is(".pager-prev, .pager-first, .pager-count")||9===c&&b.shiftKey&&d.is(".pager-prev, .pager-first"))&&(d.removeAttr("tabindex"),setTimeout(function(){d.attr("tabindex","0")},0)),e=a("a",e).length?e:a(":text",e),e.length&&!e.is("[disabled]")&&e.focus()})},showPageSizeSelector:function(a){a="true"===(a+"").toLowerCase(),this.settings.showPageSizeSelector=a,a?(this.isShowPageSizeSelectorCall=a,this.pageCount()):this.pagerBar.find(".pager-pagesize").remove()},setActivePage:function(a,b,c){var d,e=this.pagerBar.find(g);return isNaN(a)||(d=a,a={activePage:d}),this.activePage&&!isNaN(this.activePage)||(this.activePage=this.settings.activePage),void 0===d||0===d||isNaN(d)||d>this.pageCount()||d===this.activePage&&!b?(this.renderBar(a),this.activePage):(this.activePage=d,this.settings.source||(e.filter(".selected").removeClass("selected").removeAttr("aria-selected").find("a").removeAttr("aria-disabled").find(".audible").html(Locale.translate("Page")),e.eq(d-1).addClass("selected").attr("aria-selected",!0).find("a").attr("aria-disabled",!0).find(".audible").html(Locale.translate("PageOn"))),this.renderBar(a),this.renderPages(c),this.settings.componentAPI&&this.settings.componentAPI.saveUserSettings(),d)},_pageCount:0,pageCount:function(b){var c=this,d=this.isShowPageSizeSelectorCall;if(delete this.isShowPageSizeSelectorCall,void 0===b&&this.settings.indeterminate&&(this._pageCount=this.settings.pagesize),void 0===b&&!this.settings.source&&!d)return this._pageCount;if(void 0!==b&&(this._pageCount=b),!this.isTable){var e,f,h,i,j;for(this.pagerBar.find(g).remove(),e=b;e>0;e--)e===(this.activePage||1)?(f='class="selected"',h=Locale.translate("PageOn"),i='aria-selected="true"',j='aria-disabled="true"'):(f="",h=Locale.translate("Page"),i="",j=""),a("<li "+f+i+'><a href="#" '+j+'><span class="audible">'+h+" </span>"+e+"</a></li>").insertAfter(this.pagerBar.find(".pager-prev"))}if(this.isTable&&!this.settings.indeterminate&&0===this.pagerBar.find(".pager-count").length){var k=Locale.translate("PageOf");k=k.replace("{0}",'<input name="pager-pageno" value="'+this.activePage+'">'),k=k.replace("{1}",'<span class="pager-total-pages">'+(b||1)+"</span>"),a('<li class="pager-count"><label>'+k+" </label>").insertAfter(this.pagerBar.find(".pager-prev"));var l=null;this.pagerBar.find(".pager-count input").on("focus",function(){l=a(this).val()}).on("blur",function(){l!==a(this).val()&&a(this).val(c.setActivePage(parseInt(a(this).val()),!1,"page"))}).on("keydown",function(b){13===b.which&&c.setActivePage(parseInt(a(this).val()),!1,"page")})}if(this.isTable&&0===this.pagerBar.find(".btn-menu").length&&c.settings.showPageSizeSelector){var m=a('<li class="pager-pagesize"></li>'),n=a('<button type="button" class="btn-menu"><span>'+Locale.translate("RecordsPerPage").replace("{0}",this.settings.pagesize)+"</span> "+a.createIcon({icon:"dropdown"})+" </button>").appendTo(m);m.insertAfter(this.pagerBar.find(".pager-last"));for(var o=a('<ul class="popupmenu has-icons"></ul>'),p=0;p<c.settings.pagesizes.length;p++){var q=c.settings.pagesizes[p];o.append("<li "+(q===c.settings.pagesize?' class="is-checked"':"")+'><a href="#">'+q+"</a></li>")}n.after(o);var r={placementOpts:{parent:n,parentXAlignment:this.isRTL?"left":"right",strategies:["flip"]}};n.popupmenu(r).on("selected.pager",function(a,b){var d=b;d.closest(".popupmenu").find(".is-checked").removeClass("is-checked"),d.parent("li").addClass("is-checked"),c.settings.pagesize=parseInt(d.text()),c.settings.componentAPI&&(c.settings.componentAPI.settings.pagesize=c.settings.pagesize),c.setActivePage(1,!0,"first")})}var s=(""+this._pageCount).replace(/\d/g,"#");return this.pagerBar.find(".pager-count input").attr("data-mask","").mask({pattern:s,mode:"number",processOnInitialize:!1}),this._pageCount=this._pageCount||1,this._pageCount},getPageableElements:function(){var a=this.element.children().not(".datagrid-expandable-row");return a.is("ul")&&(a=a.children()),a},renderBar:function(b){var c,d,e=this.pagerBar,f=this.element.parent().width()/e.find("li:first").width(),h=Math.floor(f-3);if(b||(b={}),this.element.attr("data-pagesize")&&(this.settings.pagesize=this.element.attr("data-pagesize")),!this.settings.source){var i=this.getPageableElements().not(".is-filtered").length;if(d=Math.ceil(i/this.settings.pagesize),this.isTable){var j=function(a){return!a.isFiltered},k=this.settings.dataset.filter(j).length;d=Math.ceil(k/this.settings.pagesize)}this.pageCount(d)}this.pagerBar.find(".pager-count input").val(this.activePage),"0"===this._pageCount||isNaN(this._pageCount)||this.pagerBar.find(".pager-total-pages").text(this._pageCount),this.pagerBar.find(".btn-menu span").text(Locale.translate("RecordsPerPage").replace("{0}",this.settings.pagesize));var l=e.find(".pager-prev a"),m=e.find(".pager-next a"),n=e.find(".pager-first a"),o=e.find(".pager-last a"),p=l.add(n).add(".pager-prev").add(".pager-first"),q=m.add(o).add(".pager-next").add(".pager-last"),r={disabled:"disabled",tabindex:-1};if(this.pagerBar[0].classList.remove("hidden"),p.add(q).removeAttr("disabled tabindex"),!1===b.firstPage&&p.removeAttr("disabled").removeAttr("tabindex"),!1===b.lastPage&&q.removeAttr("disabled").removeAttr("tabindex"),(!0===b.firstPage||void 0===b.firstPage&&1===this.activePage)&&(p.attr(r),!0!==b.lastPage&&q.attr({tabIndex:0})),(!0===b.lastPage||void 0===b.lastPage&&this.activePage===this.pageCount())&&(q.attr(r),!0!==b.firstPage&&p.attr({tabindex:0})),this.settings.hideOnOnePage&&b.total<=b.pagesize&&this.pagerBar[0].classList.add("hidden"),!0===b.firstPage&&!0===b.lastPage&&b.hideDisabledPagers&&this.pagerBar[0].classList.add("hidden"),!this.settings.source){if(c=e.find(g),c.show(),c.length<h)return;c.each(function(){var b=a(this);e.find(".pager-next").offset().top-e.offset().top>1&&!b.is(".selected")&&a(this).hide()})}},renderPages:function(a){var b,c=this,d={activePage:c.activePage,pagesize:c.settings.pagesize,type:a,total:c.settings.componentAPI?c.settings.componentAPI.settings.dataset.length:-1};setTimeout(function(){if(!1!==c.element.triggerHandler("beforepaging",d)){if(c.settings.source&&a){var e;e=function(a,b){b&&b.activePage&&b.activePage>-1&&(c.activePage=b.activePage),b.preserveSelected=!0,c.settings.componentAPI.loadData(a,b,!0),setTimeout(function(){c.element.trigger("afterpaging",b)},1)},c.settings.componentAPI.sortColumn&&c.settings.componentAPI.sortColumn.sortId&&(d.sortAsc=c.settings.componentAPI.sortColumn.sortAsc,d.sortField=c.settings.componentAPI.sortColumn.sortField,d.sortId=c.settings.componentAPI.sortColumn.sortId),c.settings.componentAPI.filterExpr&&(d.filterExpr=c.settings.componentAPI.filterExpr),c.settings.source(d,e)}c.element.trigger("paging",d);var f=c.getPageableElements();if(c.settings.source)f.show();else{var g=c.settings.pagesize;c.updatePagingInfo(d),c.settings.componentAPI&&"function"==typeof c.settings.componentAPI.renderRows&&c.settings.componentAPI.renderRows(),f.hide(),c.element.children().filter(".datagrid-expandable-row.is-expanded").removeClass("is-expanded").hide().prev().removeClass(".is-expanded").find(".plus-minus").removeClass("active"),b=1===c.activePage?':not(".is-filtered"):lt('+g+")":':not(".is-filtered"):lt('+c.activePage*g+"):gt("+((c.activePage-1)*g-1)+")",f.filter(b).show()}c.settings.source||c.element.trigger("afterpaging",d)}},0)},updatePagingInfo:function(a){if(a){if(a.pagesize&&(this.settings.pagesize=a.pagesize,this.isTable&&this.settings.componentAPI&&(this.settings.componentAPI.settings.pagesize=a.pagesize)),a.total||(a.total=0),this.settings.source)return this._pageCount=Math.ceil(a.total/this.settings.pagesize),this.setActivePage(a,!1,"pageinfo");this.renderBar(a)}},destroy:function(){a.removeData(this.element[0],d)}},this.each(function(){var b=a.data(this,d);b||(b=a.data(this,d,new c(this,f)))})},a.fn.place=function(b){"use strict";function c(a){var b=this;return["x","y","container","containerOffsetX","containerOffsetY","callback","parent","parentXAlignment","parentYAlignment","useParentWidth","useParentHeight","placement","strategies"].forEach(function(c){if(null!==a[c])return"x"===c||"y"===c?(b.setCoordinate(c,a[c]),void(b["original"+c]=a[c])):void(b[c]=a[c])}),this.modified=!1,this.sanitize()}function d(b){this.settings=a.extend({},j),this.element=a(b),this.init()}var e={bleedFromContainer:!1,callback:null,container:null,parent:null,parentXAlignment:"center",parentYAlignment:"center",placement:"bottom",strategies:["nudge"]},f=["nudge","clockwise","flip","shrink","shrink-x","shrink-y"],g=["top","left","right","bottom","center"],h=["left","center","right"],i=["top","center","bottom"],j=a.extend({},e,b);return c.prototype={isReasonableDefault:function(b,c){return a.inArray(b,c)>-1},sanitize:function(){var b=this;this.bleedFromContainer=!0===this.bleedFromContainer,this.callback="function"==typeof this.callback?this.callback:j.callback,this.container=this.container instanceof a&&this.container.length?this.container:j.container,this.containerOffsetX=isNaN(parseInt(this.containerOffsetX))?0:this.containerOffsetX,this.containerOffsetY=isNaN(parseInt(this.containerOffsetY))?0:this.containerOffsetY,this.parent=this.parent instanceof a&&this.parent.length?this.parent:j.parent,this.parentXAlignment=this.isReasonableDefault(this.parentXAlignment,h)?this.parentXAlignment:j.parentXAlignment,this.parentYAlignment=this.isReasonableDefault(this.parentYAlignment,i)?this.parentYAlignment:j.parentYAlignment,this.placement=this.isReasonableDefault(this.placement,g)?this.placement:j.placement,this.useParentHeight=!0===this.useParentHeight,this.useParentWidth=!0===this.useParentWidth,a.isArray(this.strategies)&&this.strategies.length||(this.strategies=["nudge"]),this.strategies.forEach(function(a,c){b.strategies[c]=b.isReasonableDefault(a,f)?a:b.strategies[c]})},setCoordinate:function(a,b){var c=["x","y"];this.isReasonableDefault(a,c)&&(isNaN(b)&&(b=0),this[a]=parseInt(b,10))}},d.prototype={init:function(){return this.build().handleEvents()},build:function(){this.element.hasClass("placeable")||this.element.addClass("placeable"),this.originalStyles={};var a=this.element[0].style.height,b=this.element[0].style.width;return a&&(this.originalStyles.height=a),b&&(this.originalStyles.width=b),this},handleEvents:function(){var a=this;return this.element.on("place.place",function(b,d,e){a.place(new c({x:d,y:e}))}).on("updated.place",function(){a.updated()}),this},render:function(a){var b=/(px|%)/i;this.element.offset({left:a.x,top:a.y}),a.height&&(this.element[0].style.height=a.height+(b.test(a.height+"")?"":"px")),a.width&&(this.element[0].style.width=a.width+(b.test(a.width+"")?"":"px"))},place:function(a){var b=[this.element[0].style.left,this.element[0].style.top];return this.element.trigger("beforeplace",[b])?(a instanceof c||(a=new c(a)),null==a.x&&null==a.y?b:(this.clearOldStyles(),a.parent?this._placeWithParent(a):this._placeWithCoords(a))):b},_placeWithParent:function(b){function c(a){var b,c,d=a.placement,e=a.parentXAlignment,h=a.parentYAlignment;switch(d){case"top":c=f.top-g.height-a.y+(i?k:0);break;case"left":b=f.left-g.width-a.x+(i?j:0);break;case"right":b=f.right+a.x+(i?j:0);break;default:c=f.bottom+a.y+(i?k:0)}if("top"===d||"bottom"===d)switch(e){case"left":b=f.left-a.x+(i?j:0);break;case"right":b=f.right-g.width+a.x+(i?j:0);break;default:b=f.left+(f.width-g.width)/2+a.x+(i?j:0)}if("right"===d||"left"===d)switch(h){case"top":c=f.top-a.y+(i?k:0);break;case"bottom":c=f.bottom-g.height+a.y+(i?k:0);break;default:c=f.top+(f.height-g.height)/2+a.y+(i?k:0)}return[b,c]}function d(a){var b=c(a);return a.setCoordinate("x",b[0]),a.setCoordinate("y",b[1]),e.render(a),a=e._handlePlacementCallback(a)}if(!b.parent||!b.parent.length)return[void 0,void 0];var e=this,f=Soho.DOM.getDimensions(b.parent[0]),g=Soho.DOM.getDimensions(this.element[0]),h=this.getContainer(b),i=h.length&&h[0]===document.body,j=i?a(window).scrollLeft():h.scrollLeft(),k=i?a(window).scrollTop():h.scrollTop();return b.useParentWidth&&(b.width=f.width),b.useParentHeight&&(b.height=f.height),b=d(b),b.strategies.forEach(function(a){b=e.checkBleeds(b),b.bleeds&&(b=function(c){switch(a){case"nudge":return c.nudge(b);case"clockwise":return c.clockwise(b);case"flip":return b=c.flip(b),b.setCoordinate("x",b.originalx),b.setCoordinate("y",b.originaly),b=d(b);case"shrink":return c.shrink(b);case"shrink-x":return c.shrink(b,"x");case"shrink-y":return c.shrink(b,"y");default:return b}}(e),e.render(b))}),this.element.trigger("afterplace",[b]),b},_placeWithCoords:function(a){return this.render(a),a=this._handlePlacementCallback(a),this.render(a),a=this.checkBleeds(a),a.bleeds&&(a=this.nudge(a)),this.render(a),a=this.checkBleeds(a),a.bleeds&&(a=this.shrink(a)),this.render(a),this.element.trigger("afterplace",[a]),a},_handlePlacementCallback:function(a){var b=a.callback||this.settings.callback;return b&&"function"==typeof b&&(a=b(a)),this.render(a),a},_accountForScrolling:function(a){var b,c=a.container,d=window.getComputedStyle(this.element[0]).position;return"fixed"!==d&&(c&&c.length||(c=this.element.parents().filter(function(){var a=window.getComputedStyle(this).position;return"absolute"===a||"fixed"===a})),!c||!c.length||c[0]!==document.body&&(b=window.getComputedStyle(c[0]),"fixed"!==(d=b.position)&&("absolute"!==d||"hidden"!==b.overflow)))},getContainer:function(b){if(b.container instanceof a&&b.container.length)return b.container;var c=this.element.parents(".modal");return c.length?c:a(document.body)},checkBleeds:function(b){function c(a){switch(a){case"top":return(e?0:j.top)-(g?-1*l:0);case"left":return(e?0:j.left)-(g?-1*k:0);case"right":return(e?n:j.right)-(g?-1*k:0);default:return(e?m:j.bottom)-(g?-1*l:0)}}var d,e=this.settings.bleedFromContainer,f=this.getContainer(b),g=f.length&&f[0]===document.body,h=this.element[0].getBoundingClientRect(),i={},j=f?f[0].getBoundingClientRect():{},k=g?a(window).scrollLeft():f.scrollLeft(),l=g?a(window).scrollTop():f.scrollTop(),m=Math.max(document.documentElement.clientHeight,window.innerHeight||0),n=Math.max(document.documentElement.clientWidth,window.innerWidth||0);i.width=h.width,i.height=h.height,i.top=h.top,i.right=h.right,i.bottom=h.bottom,i.left=h.left;var o=c("right");if(i.width>=o){d=i.width-o;var p=i.width-d;b.width=p,this.element[0].style.width=p+"px",i.width=p}var q=c("bottom");if(i.height>=q){d=i.height-q;var r=i.height-d;b.height=r,this.element[0].style.height=r+"px",i.height=r}var s=i.right>c("right"),t=i.left<c("left"),u=i.top<c("top"),v=i.bottom>c("bottom");return s||t||u||v?(b.bleeds={},b.bleeds.right=s?i.right-c("right"):null,b.bleeds.left=t?-(i.left-c("left")):null,b.bleeds.top=u?-(i.top-c("top")):null,b.bleeds.bottom=v?i.bottom-c("bottom"):null,b):(b.bleeds=void 0,b)},nudge:function(a){a.nudges||(a.nudges={x:0,y:0});var b=0;return a.bleeds.right&&(b=Math.abs(a.bleeds.right)+Math.abs(a.containerOffsetX),a.setCoordinate("x",a.x-b),a.nudges.x=a.nudges.x-b),a.bleeds.left&&(b=Math.abs(a.bleeds.left)+Math.abs(a.containerOffsetX),a.setCoordinate("x",a.x+b),a.nudges.x=a.nudges.x+b),a.bleeds.top&&(b=Math.abs(a.bleeds.top)+Math.abs(a.containerOffsetY),a.setCoordinate("y",a.y+b),a.nudges.y=a.nudges.y+b),a.bleeds.bottom&&(b=Math.abs(a.bleeds.bottom)+Math.abs(a.containerOffsetY),a.setCoordinate("y",a.y-b),a.nudges.y=a.nudges.y-b),a.wasNudged=!0,a.bleeds=void 0,a},flip:function(b){function c(a){switch(a){case"left":return"right";case"right":return"left";case"top":return"bottom";default:return"top"}}function d(a){var c=0;switch(a){case"left":c=(h?0:k.left)-(f?m:0)-l.left+b.containerOffsetX;break;case"right":c=(h?p:k.right)-(f?m:0)-l.right-b.containerOffsetX;break;case"top":c=(h?0:k.top)-(f?n:0)-l.top+b.containerOffsetY;break;default:c=(h?o:k.bottom)-(f?n:0)-l.bottom-b.containerOffsetY}return Math.abs(c)}function e(c){return a.inArray(c,b.attemptedFlips)>-1}if(!b.bleeds[b.placement])return b;if(b.attemptedFlips||(b.attemptedFlips=[]),b.attemptedFlips.push(b.placement),b.attemptedFlips.length>3)return b=this.giveup(b);var f=this._accountForScrolling(b),g=["left","right"].indexOf(b.placement)>-1,h=this.settings.bleedFromContainer,i=this.getContainer(b),j=i.length&&i[0]===document.body,k=i?i[0].getBoundingClientRect():{},l=b.parent[0].getBoundingClientRect(),m=j?a(window).scrollLeft():i.scrollLeft(),n=j?a(window).scrollTop():i.scrollTop(),o=Math.max(document.documentElement.clientHeight,window.innerHeight||0),p=Math.max(document.documentElement.clientWidth,window.innerWidth||0);return b.placement=function(a){var f=c(a),h=g?"top":"left",i=c(h),j=d(a),k=d(f);if(!e(f))return j>=k?a:(b.wasFlipped=!0,f);var l=b.originalx;b.originalx=b.originaly,b.originaly=l;var m=d(h),n=d(i);if(!e(h)){if(m>=n)return h;if(!e(i))return i}return a}(b.placement),b},clockwise:function(a){return a},shrink:function(b,c){var d,e=this._accountForScrolling(b),f=this.settings.bleedFromContainer,g=this.getContainer(b),h=g?g[0].getBoundingClientRect():{},i=g.length&&g[0]===document.body,j=this.element[0].getBoundingClientRect(),k=void 0===c||null===c||"x"===c,l=void 0===c||null===c||"y"===c,m=i?a(window).scrollLeft():g.scrollLeft(),n=i?a(window).scrollTop():g.scrollTop(),o=Math.max(document.documentElement.clientHeight,window.innerHeight||0),p=Math.max(document.documentElement.clientWidth,window.innerWidth||0),q=(e?m:0)+(f?0:h.left)+b.containerOffsetX,r=(e?n:0)+(f?0:h.top)+b.containerOffsetY,s=(e?m:0)+(f?p:h.right)-b.containerOffsetX,t=(e?n:0)+(f?o:h.bottom)-b.containerOffsetY;return b.nudges=b.nudges||{},k&&(j.left<q&&(d=Math.abs(q-j.left),j.right>=s&&(d-=b.containerOffsetX),b.width=j.width-d,b.setCoordinate("x",b.x+d),b.nudges.x=b.nudges.x+d),j.right>s&&(d=Math.abs(j.right-s),j.left<=q&&(d-=b.containerOffsetX),b.width=j.width-d)),l&&(j.top<r&&(d=Math.abs(r-j.top),j.bottom>=t&&(d-=b.containerOffsetY),b.height=j.height-d,b.setCoordinate("y",b.y+d),b.nudges.y=b.nudges.y+d),j.bottom>t&&(d=Math.abs(j.bottom-t),j.top<=r&&(d-=b.containerOffsetY),b.height=j.height-d)),b},giveup:function(a){return a.giveup=!0,a.strategy=this.settings.strategy,a.placement=this.settings.placement,a},clearOldStyles:function(){this.element[0].style.left="",this.element[0].style.top="",this.element[0].style.width="",this.element[0].style.height="";var a=this.originalStyles;return a&&(a.width&&(this.element[0].style.width=a.width),a.height&&(this.element[0].style.height=a.height)),this},setArrowPosition:function(a,b,c){var d=b.parent,e=c.find("div.arrow"),f=b.placement,g=["left","right"].indexOf(f)>-1,h={},i=c[0].getBoundingClientRect(),j={},k={},l=!1;if(d&&d.length&&e.length){if(e[0].removeAttribute("style"),c.removeClass("top right bottom left").addClass(f),this.isRTL&&g){var m="right"===f?"left":"right";c.removeClass("right left").addClass(m)}d.is(".colorpicker")&&(d=d.next(".trigger")),d.is(".datepicker, .timepicker")&&(d=d.next(".icon")),d.is(".btn-split-menu, .btn-menu, .btn-actions, .btn-filter, .tab, .tab-more")&&(d=d.find(".icon").last()),d.is(".searchfield-category-button")&&(d=d.find(".icon.icon-dropdown")),d.is(".colorpicker-editor-button")&&(d=d.find(".trigger .icon")),d.length||(d=b.parent),h=d.length?d[0].getBoundingClientRect():h,j=e.length?e[0].getBoundingClientRect():j,k={};var n={};n[function(a){return"right"===a||"left"===a?"margin-top":"margin-left"}(f)]=function(){var a=0,b=0,c=0;return"left"!==f&&"right"!==f||(a=h.top+h.height/2,b=j.top+j.height/2,c=a-b,k.top=j.top+c,k.bottom=j.bottom+c,(k.top<=i.top||k.bottom>=i.bottom)&&(l=!0)),"top"!==f&&"bottom"!==f||(a=h.left+h.width/2,b=j.left+j.width/2,c=a-b,k.left=j.left+c,k.right=j.right+c,(k.left<=i.left||k.right>=i.right)&&(l=!0)),c}(),l&&(n.display="none"),e.css(n)}},updated:function(){return this.teardown().init()},teardown:function(){return this.clearOldStyles(),this.element.removeClass("placeable"),this.element.off("updated.place place.place"),this.element.trigger("afterteardown"),this},destroy:function(){this.teardown(),a.removeData(this.element[0],"place")}},this.each(function(){var c=a.data(this,"place");c?(c.settings=a.extend({},c.settings,b),c.updated()):c=a.data(this,"place",new d(this,j))})},a.fn.popdown=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="popdown",e={},f=a.extend({},e,b);return c.prototype={init:function(){return this.setup().build().handleEvents()},setup:function(){function b(b){return!!b&&("string"==typeof b&&(b.match("#")&&0===b.indexOf("#")||(b="#"+b),b=a(b)),!!b.length&&(c.popdown=b,!0))}var c=this;return this.popdown=a(),this.trigger=this.element,this.trigger.is(".dropdown, .multiselect")&&(this.trigger=a("#"+this.element.attr("id")+"-shdo")),b(this.trigger.attr("data-popdown"))||b(this.trigger.next(".popdown")),this.id=this.popdown.attr("id"),this.id||(this.id="popdown-"+a("body").find(".popdown").index(this.popdown),this.popdown.attr("id",this.id)),this},build:function(){this.popdown.addClass("popdown").removeClass("hidden"),this.popdown.children(".popdown-contents").length||this.popdown.children().wrap('<div class="popdown-contents"></div>'),this.arrow=a('<div class="arrow"></div>').prependTo(this.popdown),this.place();var b=this.trigger.attr("aria-expanded");return b&&void 0!==b||this.trigger.attr("aria-expanded",""),"true"===b&&this.open(),this.trigger.attr("aria-controls",this.id),this},handleEvents:function(){var a=this;return this.trigger.onTouchClick("popdown").on("click.popdown",function(){a.toggle()}).on("updated.popdown",function(){a.updated()}),this},isOpen:function(){return"true"===this.trigger.attr("aria-expanded")},open:function(){if(!this.isAnimating){var b=this,c=!1;this.isAnimating=!0,this.trigger.attr("aria-expanded","true"),this.position(),this.popdown.addClass("visible"),setTimeout(function(){b.popdown.one("focusin.popdown",function(){c||(c=!0,a(document).on("focusin.popdown",function(c){var d=c.target;a.contains(b.popdown[0],d)||b.close()}))}),a("body").on("resize.popdown",function(){a(document.activeElement).closest(".popdown").length||b.close()}),a(document).on("click.popdown",function(c){var d=a(c.target);d.is(".popdown")||d.closest(".popdown").length||b.close()}),b.isAnimating=!1},400)}},close:function(){if(!this.isAnimating){var b=this;this.isAnimating=!0,this.trigger.attr("aria-expanded","false"),this.popdown.removeClass("visible"),this.popdown.off("focusin.popdown"),a("body").off("resize.popdown"),
a(document).off("click.popdown focusin.popdown"),setTimeout(function(){b.popdown[0].style.display="none",b.isAnimating=!1},400)}},toggle:function(){if(this.isOpen())return void this.close();this.open()},place:function(){this.scrollparent=a("body"),this.popdown.detach().appendTo(this.scrollparent)},position:function(){var b={offset:{left:0,top:0},scrollDistance:{left:0,top:0}},c=window.innerHeight+a(document).scrollTop(),d=window.innerWidth-2+a(document).scrollLeft();this.popdown.removeAttr("style"),this.arrow.removeAttr("style"),this.scrollparent.length&&(b.offset=this.scrollparent.offset(),b.scrollDistance.top=this.scrollparent.scrollTop(),b.scrollDistance.left=this.scrollparent.scrollLeft(),c-=b.offset.top+b.scrollDistance.top,d-=b.offset.left+b.scrollDistance.left);var e,f=!1,g=!1,h=this.trigger,i=h.offset(),j=0,k=0;this.popdown.addClass("bottom"),this.popdown[0].style.left=i.left+"px",this.popdown[0].style.top=i.top+h.outerHeight(!0)+11+"px",this.arrow[0].style.left=h.outerWidth(!0)/2+"px",this.arrow[0].style.top="-11px",e=this.popdown.offset(),e.left<0&&(f=!0,j=0-e.left);var l=e.left+this.popdown.outerWidth(!0);if(l>d&&(f=!0,j=l-d+(Locale.isRTL()?20:0)),f){this.popdown[0].style.left=e.left+-1*j+"px";var m=this.popdown[0].getBoundingClientRect(),n=h[0].getBoundingClientRect(),o=m.right-n.right+10;this.arrow[0].style.left="auto",this.arrow[0].style.right=o+"px",e=this.popdown.offset()}e.top<0&&(g=!0,k=0-e.top);var p=e.top+this.popdown.outerHeight(!0);p>c&&(g=!0,k=p-c),g&&(this.arrow[0].style.display="none",this.popdown[0].style.top=e.top+-1*k+"px",this.arrow[0].style.top=parseInt(this.arrow[0].style.top)- -1*k+"px",e=this.popdown.offset()),(e.top<0||e.top+this.popdown.outerHeight(!0)>c)&&(this.popdown[0].style.top=0,e=this.popdown.offset(),p=e.top+this.popdown.outerHeight(!0),this.popdown[0].style.height=parseInt(this.popdown[0].style.height)-(p-c)+"px")},updated:function(){return this},teardown:function(){return this.isOpen()&&this.close(),this.trigger.offTouchClick("popdown").off("updated.popdown click.popdown").removeAttr("aria-controls").removeAttr("aria-expanded"),this.originalParent&&this.originalParent.length&&this.popdown.detach().appendTo(this.originalParent),this.arrow.remove(),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.popupmenu=function(b){function c(b){this.settings=a.extend({},f),this.element=a(b),this.isOldIe=a("html").is(".ie11, .ie10, .ie9"),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="popupmenu",e={menu:null,trigger:"click",autoFocus:!0,mouseFocus:!0,attachToBody:!1,beforeOpen:null,ariaListbox:!1,eventObj:void 0,placementOpts:{containerOffsetX:10,containerOffsetY:10,strategies:["flip","shrink"]},offset:{x:0,y:0}},f=a.extend({},e,b);return c.prototype={init:function(){this.setup(),this.addMarkup(),this.handleEvents(),this.iconFilteringSetup(),"immediate"===this.settings.trigger&&this.open(this.settings.eventObj),this.menu.find(".submenu").length&&this.menu.addClass("has-submenu")},isRTL:function(){return"rtl"===a("html").attr("dir")},setup:function(){this.element.attr("data-popupmenu")&&!this.settings.menu&&(this.settings.menu=this.element.attr("data-popupmenu").replace(/#/g,"")),this.settings.menuId&&(this.settings.menu=this.settings.menuId,this.settings.menuId=void 0),this.id||(this.id=(parseInt(a(".popupmenu-wrapper").length,10)+1).toString())},addMarkup:function(){function b(){var a=this?this.style.overflow:null;return"auto"!==a&&"visible"!==a&&"scroll"!==a}var c,d="rightClick"!==this.settings.trigger,e="immediate"===this.settings.trigger;switch(typeof this.settings.menu){case"string":c=this.settings.menu,this.menu=a("#"+this.settings.menu);break;case"object":null===this.settings.menu?this.menu=this.element.next(".popupmenu, .popupmenu-wrapper"):this.menu=a(this.settings.menu),c=this.menu.attr("id"),c&&""!==c||(this.menu.attr("id","popupmenu-"+this.id),c=this.menu.attr("id"))}if(this.menu.is(".popupmenu-wrapper")&&(this.preExistingWrapper=!0,this.wrapper=this.menu,this.menu=this.wrapper.children(".popupmenu").first()),this.menu.parent().is(".popupmenu-wrapper")&&(this.preExistingWrapper=!0,this.wrapper=this.menu.parent()),0===this.menu.length)return!1;this.settings.attachToBody&&this.menu.parent().not("body").length>0&&(this.originalParent=this.menu.parent(),this.menu.detach().appendTo("body")),this.menu.is(".popupmenu")||this.menu.addClass("popupmenu").attr("role",this.settings.ariaListbox?"listbox":"menu"),this.menu.data("trigger",this.element),this.wrapper=this.menu.parent(".popupmenu-wrapper"),this.wrapper.length||(this.wrapper=this.menu.wrap('<div class="popupmenu-wrapper"></div>')),this.wrapper.find("svg").each(function(){a(this).data("icon")||a(this).icon()}),this.menu.parent(".popupmenu-wrapper").attr("role","application").attr("aria-hidden","true"),0===this.wrapper.parents().filter(b).length&&(this.wrapper[0].style.position="absolute"),this.menu.find(".popupmenu").each(function(b,c){var d=a(c);d.parent().hasClass("wrapper")||d.wrap('<div class="wrapper"></div>')});var f=this.element.parent().attr("class");if(this.element.hasClass("btn-menu")||this.element.hasClass("btn-actions")||"colorpicker-menu"===this.settings.menu||this.element.closest(".toolbar").length>0||this.element.closest(".masthead").length>0||this.element.is(".searchfield-category-button")||f&&f.indexOf("more")>=0||f&&f.indexOf("btn-group")>=0){var g=a('<div class="arrow"></div>');this.menu.parent(".popupmenu-wrapper").addClass("bottom").append(g)}var h=this.element.closest(".field-short").length;if(this.menu[h?"addClass":"removeClass"]("popupmenu-short"),void 0!==f&&this.element.closest(".masthead").not(".search-results .masthead").length>0&&this.menu.parent(".popupmenu-wrapper").addClass("alternate"),this.element.attr("aria-haspopup",!0),this.element.attr("aria-controls",c),this.markupItems(),!d&&!e){0===a("#popupmenu-f10-label").length&&this.element.after('<span style="display:none;" id="popupmenu-f10-label">'+Locale.translate("PressShiftF10")+"</span>"),this.element.attr("aria-describedby","popupmenu-f10-label")}this.menu.is(".hidden")&&this.menu.removeClass("hidden")},markupItems:function(){var b=this,c=this.menu.find("li:not(.heading):not(.separator)"),d=this.menu[0].className,e=Soho.DOM.classNameHas(d,"isTranslatable");c.each(function(c,d){var f=a(d).children("a")[0],g=a(f).children("span")[0],h=a(d).children(".wrapper")[0];if(d.setAttribute("role","presentation"),f){f.setAttribute("tabindex","-1"),f.setAttribute("role",b.settings.ariaListbox?"option":"menuitem"),e&&(g.innerText=Locale.translate(g.innerText)||g.innerText);var i=a(f),j=a(d);f.hasAttribute("disabled")||j.hasClass("is-disabled")?(Soho.DOM.addClass(d,"is-disabled"),f.setAttribute("aria-disabled","true"),f.disabled=!0):(j.removeClass("is-disabled"),i.prop("disabled",!1).removeAttr("aria-disabled")),h instanceof HTMLElement&&(d.className+=(Soho.DOM.classNameExists(d)?" ":"")+"submenu"),Soho.DOM.classNameHas(d.className,"submenu")&&(g||(f.innerHTML="<span>"+f.innerHTML+"</span>",g=i.children("span")[0]),0===i.find("svg.arrow").length&&i.append(a.createIconElement({classes:["arrow","icon-dropdown"],icon:"dropdown"})),f.setAttribute("aria-haspopup","true")),Soho.DOM.classNameHas(d.className,"is-checked")&&(f.setAttribute("role","menuitemcheckbox"),f.setAttribute("aria-checked",!0)),Soho.DOM.classNameHas(d.className,"is-not-checked")&&(d.className=d.className.replace("is-not-checked",""),f.setAttribute("role","menuitemcheckbox"),f.removeAttribute("aria-checked"))}})},handleEvents:function(){function a(a){return a.stopPropagation(),a.preventDefault(),!1}function b(a){var b="rightClick"===d.settings.trigger;if(a.stopPropagation(),a.preventDefault(),b&&d.menu.hasClass("is-open"))return d.close(),void d.open(a);d.menu.hasClass("is-open")?d.close():d.open(a)}function c(a,c){if(a.preventDefault(),d.keydownThenClick)return void(d.keydownThenClick=void 0);var e=!0===c?0:2;a.button>e||d.element.is(":disabled")||b(a)}var d=this,e="rightClick"!==this.settings.trigger;"immediate"===this.settings.trigger||(e&&this.element.on("click.popupmenu",function(a){c(a,!0)}),e||(this.menu.parent().on("contextmenu.popupmenu",a),this.element.on("contextmenu.popupmenu",function(b){a(b),c(b)}))),this.element.not(".autocomplete").on("keydown.popupmenu",function(a){switch(a.which){case 13:case 32:"click"===d.settings.trigger&&(d.keydownThenClick=!0,d.open(a));break;case 121:a.shiftKey&&d.open(a)}}).off("updated.popupmenu").on("updated.popupmenu",function(a){a.stopPropagation(),d.updated()}),window.matchMedia&&(this.matchMedia=window.matchMedia("(orientation: landscape)"),this.mediaQueryListener=function(){d.menu.hasClass("is-open")&&d.close()},this.matchMedia.addListener(this.mediaQueryListener))},handleKeys:function(){var b=this;this.menu.onTouchClick("popupmenu","a").on("click.popupmenu","a",function(c){b.handleItemClick(c,a(this))});var c="li:not(.separator):not(.hidden):not(.heading):not(.group):not(.is-disabled)";this.settings.mouseFocus&&this.menu.on("mouseenter.popupmenu","li",function(){b.highlight(a(this).children("a"))}),setTimeout(function(){a(document).off("keydown.popupmenu."+this.id).on("keydown.popupmenu."+this.id,function(d){var e,f=d.which;if(27===f)return d.stopPropagation(),d.stopImmediatePropagation(),b.close(!0),!1;if(9===f&&(d.stopPropagation(),b.close(!0)),32===f){d.stopPropagation();var g=a(d.target),h=g.find("input:checkbox");if(h.length)return void h.trigger("click");var i=a();if(g.is(".tab")||g.parent().is(".tab")||g.is(".tab-more"))return void d.preventDefault();if(g.is("li")&&(i=g.children("a")),g.is("a")&&(i=g),i.length)return void i.trigger("click")}e=b.menu.find(":focus");var j="colorpicker-menu"===b.settings.menu,k=b.element.is(".autocomplete");if(37!==f||k||(d.stopPropagation(),d.preventDefault(),e.closest(".popupmenu")[0]!==b.menu[0]&&e.closest(".popupmenu").length>0&&(e.closest(".popupmenu").removeClass("is-open").parent().parent().removeClass("is-submenu-open"),b.highlight(e.closest(".popupmenu").parent().prev("a")))),!j&&38===f||j&&37===f){if(d.stopPropagation(),d.preventDefault(),0===e.parent().prevAll(c).length)return void(0===e.length?b.highlight(b.menu.children(c).last().find("a")):b.highlight(e.closest(".popupmenu").children(c).last().find("a")));b.highlight(e.parent().prevAll(c).first().find("a"))}if(j&&38===f&&(d.stopPropagation(),d.preventDefault(),e.parent().prevAll(c).length>0&&b.highlight(a(e.parent().prevAll(c)[9]).find("a"))),39!==f||k||(d.stopPropagation(),d.preventDefault(),e.parent().hasClass("submenu")&&(b.showSubmenu(e.parent()),b.highlight(e.parent().find(".popupmenu a:first")))),!j&&40===f||j&&39===f&&!k){if(d.stopPropagation(),d.preventDefault(),0===e.parent().nextAll(c).length)return void(0===e.length?b.highlight(b.menu.children(c).first().find("a")):b.highlight(e.closest(".popupmenu").children(c).first().find("a")));b.highlight(e.parent().nextAll(c).first().find("a"))}j&&40===f&&(d.stopPropagation(),d.preventDefault(),e.parent().nextAll(c).length>0&&b.highlight(a(e.parent().nextAll(c)[9]).find("a")))})},1)},handleItemClick:function(a,b){var c=b.attr("href"),d=[b];if(a||b){if(b.parent().is(".submenu, .hidden, .is-disabled")||b[0].disabled)return void a.preventDefault();if(!(b.find("input[checkbox]").length>0||(this.element.hasClass("btn-filter")&&(this.iconFilteringUpdate(b),a.preventDefault()),(this.isInSelectableSection(b)||this.menu.hasClass("is-selectable")||this.menu.hasClass("is-multiselectable"))&&(d=this.select(b)),b.parent().hasClass("is-toggleable")&&b.parent().toggleClass("is-checked"),a&&(1===d.length&&d.push(void 0),d.push(!0),this.element.triggerHandler("selected",d)),this.menu.hasClass("is-multiselectable")||this.isInMultiselectSection(b)||(this.close(),this.element.is(".autocomplete")))))return c&&"#"!==c.charAt(0)?("_blank"===b.attr("target")?window.open(c,"_blank"):window.location.href=c,!0):void(a&&(a.preventDefault(),a.stopPropagation()))}},iconFilteringSetup:function(b){if(this.element.hasClass("btn-filter")){var c=this.element.find("svg.icon-dropdown"),d=b||a("li:first a",this.menu),e=d.find("span").text();1===c.length&&this.element.append(a.createIconElement({classes:"icon-dropdown",icon:"dropdown"})),c.first().changeIcon(d.find("svg").getIconName()),this.element.find(".audible").text(e)}},iconFilteringUpdate:function(b){if(this.element.hasClass("btn-filter")){var c=b||a("li:first a",this.menu),d=c.find("span").text();this.element.find(".audible").text(d),this.element.find("svg:not(.ripple-effect):first").changeIcon(c.find("svg").getIconName())}},getPositionFromEvent:function(a){var b=0,c=0;return a||(a=window.event),a?(a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:b,y:c}):{}},position:function(b){function c(a,b){return b="x"===b||"y"===b?b:"x",j[b]}function d(){m.parentXAlignment=h?"right":"left"}function e(){m.parentXAlignment=h?"left":"right"}var f=this,g=this.element,h=this.isRTL(),i=this.menu.parent(".popupmenu-wrapper"),j=this.getPositionFromEvent(b),k={width:this.menu.outerWidth(),height:this.menu.outerHeight()};if(i.length){var l=this.element.outerWidth();l>k.width&&this.menu.width(l),g.is("svg, .icon")&&g.closest(".tab").length&&(g=g.closest(".tab")),i.find(".arrow").removeAttr("style");var m=a.extend({},this.settings.placementOpts),n=["flip"];n.push("shrink-y"),"immediate"===this.settings.trigger&&this.settings.eventObj||"rightClick"===this.settings.trigger?(m.x=c(b,"x")-(h?k.width:0)+(h?-1:1)*this.settings.offset.x,m.y=c(b,"y")+this.settings.offset.y,0===m.x&&0===m.y&&(m.x=this.settings.offset.x||0,m.y=this.settings.offset.y||0,m.parent=this.element,m.placement="bottom",m.parentXAlignment=h?"right":"left")):(m.x=this.settings.offset.x||0,m.y=this.settings.offset.y||0,m.parent=this.element,m.placement="bottom"),m.strategies=n;var o=g.parents(".toolbar"),p=o.length>0,q=g.parents(".title").length>0,r=p&&o.children(".buttonset, .title").length>1,s=g.parents(".pager-pagesize").length>0;!function(){g.is(".btn-menu")?s?e():p&&r?q?d():e():d():g.is(".btn-actions")?e():g.is(".tab-more")?e():g.is(".btn-split-menu, .tab, .searchfield-category-button")&&!g.parent(".pager-pagesize").length&&d()}(),g.parents(".masthead").length>0&&function(){m.y=m.y+15}();var t=this.element.parents(".page-container");t.length&&(m.container=t.first()),i.one("afterplace.popupmenu",function(a,b){f.handleAfterPlace(a,b)}),i.place(m),i.data("place").place(m)}},handleAfterPlace:function(a,b){var c=this.menu.parent(".popupmenu-wrapper");return c.data("place").setArrowPosition(a,b,c),b.height&&(c[0].style.height="",this.menu[0].style.height=b.height+(/(px|%)/i.test(b.height+"")?"":"px")),b.width&&(c[0].style.width="",this.menu[0].style.width=b.width+(/(px|%)/i.test(b.width+"")?"":"px")),c.triggerHandler("popupmenuafterplace",[b]),b},callSource:function(b,c){if("function"==typeof this.settings.beforeOpen){var d=this,e=function(e){d.ajaxContent instanceof a&&d.ajaxContent.off().remove(),d.ajaxContent=a(e),d.menu.append(d.ajaxContent),d.wrapper.removeAttr("style"),d.markupItems(),c&&d.open(b,!0)};if("string"==typeof this.settings.beforeOpen)return void window[this.settings.beforeOpen](e);this.settings.beforeOpen(e)}},open:function(b,c){var d=this;if(!1!==this.element.triggerHandler("beforeopen",[this.menu])){c||this.callSource(b,!0),a(".popupmenu.is-open").filter(function(){return 0===a(this).parents(".popupmenu").length}).not(this.menu).each(function(){var b=a(this).data("trigger");if(b&&b.length){var c=a(this).data("trigger").data("popupmenu");c&&"function"==typeof c.close&&c.close()}}),this.element.addClass("is-open"),this.menu.addClass("is-open").attr("aria-hidden","false"),this.position(b),this.element.closest(".header").length>0&&(this.menu.parent()[0].style.zIndex="9001"),setTimeout(function(){a(document).on("touchend.popupmenu."+d.id+" click.popupmenu."+d.id,function(b){2!==b.button&&(a(b.target).is(d.element)||0===a(b.target).closest(".popupmenu").length&&d.close(!0,"rightClick"===d.settings.trigger))}),void 0===window.orientation&&a("body").on("resize.popupmenu",function(){d.close()}),a(window).on("scroll.popupmenu",function(){d.close()}),a(".scrollable").on("scroll.popupmenu",function(){d.close()}),d.element.triggerHandler("open",[d.menu]),"rightClick"===d.settings.trigger&&d.element.on("click.popupmenu touchend.popupmenu",function(){d.close()})},300),a("iframe").each(function(){var b=a(this);b.ready(function(){try{b.contents().find("body").on("click.popupmenu",function(){d.close()})}catch(a){}})}),this.handleKeys();var e,f,g,h=0;d.menu.find(".popupmenu").removeClass("is-open"),d.menu.on("mouseenter.popupmenu touchstart.popupmenu",".submenu",function(b){var c=a(this);e=b.pageX,clearTimeout(g),g=setTimeout(function(){d.showSubmenu(c)},300),a(document).on("mousemove.popupmenu."+this.id,function(a){h=a.pageX})}).on("mouseleave.popupmenu",".submenu",function(){a(document).off("mousemove.popupmenu."+this.id),f=a(this).find("ul");var b=parseInt(f.parent(".wrapper")[0].style.left)<0,c=h-e<3.5;b&&(c=h-e>=0),c&&(f.removeClass("is-open").removeAttr("style"),f.parent(".wrapper").removeAttr("style"),f.parent().parent().removeClass("is-submenu-open"),f=null),clearTimeout(g)}),d.settings.autoFocus&&setTimeout(function(){var a=":not(.separator):not(.hidden):not(.heading):not(.group):not(.is-disabled)",b=d.menu.children(a).find(".is-selected").children("a");b.length||(b=d.menu.children(a).first().children("a")),d.highlight(b),d.element.triggerHandler("afteropen",[d.menu])},1)}},showSubmenu:function(b){if(!Soho.DOM.classNameHas(b[0].className,"is-disabled")&&!b[0].disabled){this.element.triggerHandler("show-submenu",[b]);var c=b.children(".wrapper").filter(":first"),d=this.isRTL();if(0===c.length){var e=b.children("ul").filter(":first");e.wrap('<div class="wrapper"></div>'),c=e.parent()}var f=c.children(".popupmenu"),g=b.parents(".popupmenu-wrapper:first").offset().top,h=b.position().left+b.outerWidth();b.parent().find(".popupmenu").removeClass("is-open").removeAttr("style"),d&&(h=b.position().left-b.outerWidth()+30),c[0].style.left=h+"px",c[0].style.top=parseInt(b.position().top)-5+"px",c.children(".popupmenu").addClass("is-open");var i=f.outerWidth();if((c.offset().left+i>a(window).width()+a(document).scrollLeft()||d&&c.offset().left<0)&&(c[0].style.left="-9999px",i=f.outerWidth(),h=b.position().left-i,d&&(h=b.position().left+i+30),c[0].style.left=h+"px",(c.offset().left<0||d&&c.offset().left+i>a(window).width()+a(document).scrollLeft())&&(h=b.position().left-i+Math.abs(c.offset().left)+40,d&&(h=b.position().left-i-30-40),c[0].style.left=h+"px",i=f.outerWidth()),c.offset().left+i>a(window).width()+a(document).scrollLeft()||d&&c.offset().left<0)){i-=c.offset().left+i-(a(window).width()+a(document).scrollLeft()),f[0].style.width=i+"px"}var j=f.outerHeight();if(c.offset().top+j>a(window).height()+a(document).scrollTop()){var k=c.offset().top+j,l=k-(a(window).height()+a(document).scrollTop());if(c[0].style.top=c.position().top-l+"px",c.offset().top+j>a(window).height()+a(document).scrollTop()&&(c[0].style.top=a(window).height()+a(document).scrollTop()-j-g+"px"),c.offset().top-a(document).scrollTop()<0&&(c[0].style.top=0,c[0].style.top=-1*c.offset().top+"px",j=f.outerHeight()),c.offset().top+j>a(window).height()+a(document).scrollTop()){j=j-(c.offset().top+j-(a(window).height()+a(document).scrollTop()))-32,f[0].style.height=j+"px"}}b.parent().find(".is-submenu-open").removeClass("is-submenu-open"),b.addClass("is-submenu-open")}},highlight:function(a){if(!a||!a.length)return!1;var b=a.parent();b.parent().children("li").removeClass("is-focused"),b.addClass("is-focused"),a.focus(),b.closest(".header").scrollTop(0)},select:function(a){var b=this.menu.is(".is-selectable"),c=this.menu.is(".is-multiselectable"),d=this.isInSingleSelectSection(a),e=this.isInMultiselectSection(a),f=a.parent(),g=[a,"selected"];if(b||c||d||e)return b||d?(f.prevUntil(".heading, .separator").add(f.nextUntil(".heading, .separator")).removeClass("is-checked"),f.addClass("is-checked"),g):c||e?f.hasClass("is-checked")?(g[1]="deselected",f.removeClass("is-checked"),g):(f.addClass("is-checked"),g):void 0},getSelected:function(){return this.menu.is(".is-selectable, .is-multiselectable")?this.menu.children(".is-checked").children("a"):a()},isInSelectableSection:function(a){var b=a.parent().prevAll().filter(".separator").first();return b.hasClass("multi-selectable-section")||b.hasClass("single-selectable-section")},isInSingleSelectSection:function(a){return a.parent().prevAll().filter(".separator").first().hasClass("single-selectable-section")},isInMultiselectSection:function(a){return a.parent().prevAll().filter(".separator").first().hasClass("multi-selectable-section")},detach:function(){a(document).off("touchend.popupmenu."+this.id+" click.popupmenu."+this.id+" keydown.popupmenu"),a(window).off("scroll.popupmenu orientationchange.popupmenu"),a("body").off("resize.popupmenu"),a(".scrollable").off("scroll.popupmenu"),this.menu.off("click.popupmenu touchend.popupmenu touchcancel.popupmenu"),"rightClick"===this.settings.trigger&&this.element.off("click.popupmenu touchend.popupmenu"),a("iframe").each(function(){var b=a(this);try{b.contents().find("body").off("click.popupmenu touchend.popupmenu touchcancel.popupmenu")}catch(a){}})},close:function(b,c){if(b&&void 0!==b||(b=!1),this.menu.hasClass("is-open")){var d=this,e=this.menu.parent(".popupmenu-wrapper"),f=this.menu.find(".popupmenu");this.menu.removeClass("is-open").attr("aria-hidden","true"),this.menu[0]&&(this.menu[0].style.height="",this.menu[0].style.width=""),e[0]&&(e[0].style.left="-999px",e[0].style.height="",e[0].style.width=""),this.menu.find(".submenu").off("mouseenter mouseleave").removeClass("is-submenu-open"),f[0]&&(f[0].style.left="",f[0].style.top="",f[0].style.height="",f[0].style.width=""),this.menu.find(".is-focused").removeClass("is-focused"),a(document).off("keydown.popupmenu."+this.id+" click.popupmenu."+this.id+" mousemove.popupmenu."+this.id),this.menu.off("click.popupmenu touchend.popupmenu touchcancel.popupmenu mouseenter.popupmenu mouseleave.popupmenu"),this.element.removeClass("is-open").triggerHandler("close",[b]),this.detach(),"immediate"===this.settings.trigger&&this.destroy(),c||d.element.removeClass("hide-focus").focus()}},teardown:function(){function b(a){var b=a.parent();b.is(".popupmenu-wrapper, .wrapper")&&(b.data("place")&&b.data("place").destroy(),a.unwrap())}var c=this.menu.parent(".popupmenu-wrapper");if(this.ajaxContent&&this.ajaxContent.off().remove(),this.menu.parent().off("contextmenu.popupmenu"),this.element.hasClass("btn-actions")&&this.menu.parent().removeClass("bottom").find(".arrow").remove(),this.originalParent)this.menu.appendTo(this.originalParent);else{var d=this.element,e=this.element.parent().children(".searchfield");e.length&&(d=e.first()),this.menu.insertAfter(d)}return this.menu.find(".submenu").children("a").each(function(b,c){var d=a(c).find("span").text();a(c).find("span, svg").remove(),a(c).text(d)}),this.menu.find(".popupmenu").each(function(){b(a(this))}),c.data("place")&&c.data("place").destroy(),c.off().remove(),this.matchMedia&&this.matchMedia.removeListener(this.mediaQueryListener),this.menu[0]&&a.removeData(this.menu[0],"trigger"),this.detach(),this.element.removeAttr("aria-controls").removeAttr("aria-haspopup").off("touchend.popupmenu touchcancel.popupmenu click.popupmenu keypress.popupmenu contextmenu.popupmenu"),this},updated:function(){this.teardown().init()},destroy:function(){this.teardown(),this.menu.trigger("destroy"),a.removeData(this.element[0],d)}},this.each(function(){var e=a.data(this,d);e?("function"==typeof e[b]&&e[b](),e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.progress=function(b){function c(b){this.element=a(b),this.settings=f,Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="progress",e={},f=a.extend({},e,b);return c.prototype={init:function(){var a=this;a.update(),this.element.off("updated.progress").on("updated.progress",function(b){b.stopPropagation(),a.update()})},updateAria:function(a){this.element.attr({role:"progressbar","aria-valuenow":a,"aria-maxvalue":"100"});var b=this.element.parent();b.data("tooltip")?b.data("tooltip").content=a+"%":b.attr("title",a+"%").tooltip()},update:function(a){var b=this.element.attr("data-value");a&&(b=a,this.element.attr("data-value",a)),this.element[0].style.width=b+"%",this.updateAria(b)},destroy:function(){a.removeData(this.element[0],d),this.element.off("updated.progress")}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})};a.fn.mask=function(b){function c(b){this.settings=a.extend({},h),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="mask",e={pattern:"",placeholder:"_",definitions:{"#":/[0-9]/,0:/[0-9]/,x:/[\u00C0-\u017Fa-zA-Z]/,"*":/[\u00C0-\u017Fa-zA-Z0-9]/,"?":/./,"~":/[-0-9]/,a:/[APap]/,m:/[Mm]/},groupComplete:!1,mode:void 0,mustComplete:!1,negative:!1,number:!1,processOnInitialize:!0,processOnBlur:!0,thousandsSeparator:!1,showSymbol:void 0},f=["group","number","date","time"],g=["currency","percent"],h=a.extend({},e,b);return c.prototype={init:function(){function b(a){var b=c.element.val();c.settings.mustComplete&&c.checkCompletion(),b&&c.initValue!==b&&((a||c.settings.processOnBlur)&&c.remask(!a),c.element.trigger("change"))}var c=this;c.buffer="",this.element.addClass("is-mask");var d=this.element.attr("data-mask")||!1;d&&(this.settings.pattern=d);var e=this.element.attr("data-mask-mode")||!1;e&&(this.settings.mode=e),this.settings.mode&&-1===a.inArray(this.settings.mode,f)&&(this.settings.mode="group");var h=this.element.attr("data-thousands")||!1;h&&(this.settings.thousandsSeparator="true"===h),this.settings.negative="number"===this.settings.mode&&-1!==this.settings.pattern.indexOf("-");var i=this.element.attr("data-must-complete")||!1;i&&(this.settings.mustComplete=i);var j,k=this.settings.showSymbol;if(!0===k&&(k="currency"),k&&void 0!==k&&-1!==g.indexOf(k)&&"number"===this.settings.mode){switch(k){case"currency":j=Locale.currentLocale.data?Locale.currentLocale.data.currencySign:"$";break;case"percent":j="%"}a('<span class="audible '+k+'"></span>').text(" "+j).appendTo(c.element.prev("label")),this.element.parent(".field, .datagrid-filter-wrapper").attr("data-currency-symbol",""+j).addClass(k)}var l="addClass";if("number"!==c.settings.mode&&(c.maskParts=c.getPatternParts(),l="removeClass"),this.element[l]("is-number-mask"),c.element.attr("data-group-complete")&&(this.settings.groupComplete=!0),"time"===this.settings.mode&&(this.settings.mode="group"),c.element.on("keypress.mask keydown.mask keyup.mask "+c.getPasteEvent(),function(a){if(c.element.prop("readonly"))return a.preventDefault(),!1;c.handleKeyEvents(c,a)}),c.element.on("focus.mask",function(a){if(c.element.prop("disabled")||c.element.prop("readonly"))return a.preventDefault(),!1;c.initValue=c.element.val()}),c.element.on("updated.mask",function(a){c.evaluateCurrentContents(void 0,a)}),c.element.on("remask.mask",function(){b(!0)}),c.element.on("blur.mask",function(a){return c.element.prop("readonly")?(a.preventDefault(),!1):(b(),c.initValue=null,!0)}),this.element.is(":hidden")||!this.settings.processOnInitialize)return this;var m=c.element.val();return m.length>0&&(c.element.val(""),c.processStringAgainstMask(m)),this},getPasteEvent:function(){return window.Soho.env.pasteEvent+".mask"},killEvent:function(a){return a&&(a.returnValue=!1,a.preventDefault&&a.preventDefault()),!1},caret:function(a,b){var c,d=this;return 0===d.element.val().length||d.element.is(":hidden")?{begin:0,end:0}:"number"==typeof a?(b="number"==typeof b?b:a,d.element.each(function(){this.setSelectionRange?this.setSelectionRange(a,b):this.createTextRange&&(c=this.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select())})):(d.element[0].setSelectionRange?(a=d.element[0].selectionStart,b=d.element[0].selectionEnd):document.selection&&document.selection.createRange&&(c=document.selection.createRange(),a=0-c.duplicate().moveStart("character",-1e5),b=a+c.text.length),{begin:a,end:b})},moveCursor:function(a,b){var c=this,d=c.caret();switch(a=c.evaluateDirecton(a),b=b||1,a){case"next":c.caret(d.begin+b);break;case"prev":c.caret(d.begin-b)}},evaluateDirecton:function(b){if(!b)return"current";var c=["current","next","prev"];return c[a.inArray(b,c)]},checkCompletion:function(){var a=this.element.val().length;this.settings.pattern.length!==a&&this.element.val("")},evaluateCurrentContents:function(b,c){null!==b&&void 0!==b||(b=this.element.val()),c||(c=a.Event()),this.element.val(""),document.activeElement===c.target&&this.caret(0),this.processStringAgainstMask(b,c)},handleKeyEvents:function(b,c){var d=c||window.event,e=d.originalEvent.type,f=c.which,g=a.actualChar(c);if("keyup"!==e){if("keypress"===e){if(d.ctrlKey||d.metaKey||f<32)return;d.altKey&&b.killEvent(c),"number"===b.settings.mode?b.processNumberMask(g,d):b.processMask(g,d)}"paste"===e&&b.handlePaste(d)}else if(8===f)return this.handleBackspace(c)},handleBackspace:function(){var a=this.element.val();this.element.trigger("write.mask",[a])},handleEscape:function(a){var b=this;return b.element.val(b.initValue),b.caret(0,b.initValue.length),b.initValue=null,b.killEvent(a)},handleTab:function(a){return this.evaluateCurrentContents(void 0,a)},handlePaste:function(a){var b=a.originalEvent.clipboardData&&a.originalEvent.clipboardData.getData?a.originalEvent.clipboardData.getData("text/plain"):!(!window.clipboardData||!window.clipboardData.getData)&&window.clipboardData.getData("Text");if(b){var c=2*this.settings.pattern.length>b.length?b.length:2*this.settings.pattern.length,d=b.substring(0,c);this.processStringAgainstMask(d,a)}this.element.trigger("afterpaste.mask"),this.killEvent(a)},isCharacterLiteral:function(b){return-1===a.inArray(b,Object.keys(this.settings.definitions))},isCharacterDecimal:function(a){return"."===a},insertAtIndex:function(a,b,c){return a.substring(0,c)+b+a.substring(c)},replaceAtIndex:function(a,b,c,d){return a.substr(0,c)+b+a.substr(isNaN(d)?c+b.length:d)},deleteAtIndex:function(a,b,c){return a.substr(0,c)+a.substr(c+b.length)},getCharacterAtIndex:function(a,b){return a.substr(b,1)},resetStorage:function(){this.originalPos=null,this.currentMaskBeginIndex=null,this.buffer=""},writeInput:function(a){function b(a){g.begin=g.begin+a,g.end=g.end+a}function c(){if(!0!==a){var b=f.substring(g.begin,g.end);f=m(f,"",g.begin,g.end),g.end=g.end-b.length}}function d(){!0!==a&&(f=e.insertAtIndex(f,h,g.begin),b(i))}var e=this,f=this.element.val(),g=this.originalPos,h=!0===a?"":this.buffer,i=!0===a?0:h.length,j=""+this.settings.pattern,k=j.length,l="number"===this.settings.mode,m=this.replaceAtIndex,n=new RegExp(n,"g"),o=new RegExp("\\.","g"),p=new RegExp("^0+(?!\\.|$)"),q=new RegExp(",","g"),r=new RegExp("(\\.|,)","g");if(this.settings.thousandsSeparator||(j=j.replace(q,""),k=j.length),!l)return c(),d(),f=f.substring(0,k),this.element.val(f),!0!==a&&this.caret(g.begin>=k?k:g.begin),void this.element.trigger("write.mask",[f]);c();var s=f,t=j.indexOf(".")>-1,u=f.indexOf("."),v=h.indexOf(".")>-1,w=!0,x=!1;x=-1!==u,x&&(w=u>=g.begin),d(),this.settings.negative&&-1===f.indexOf("-")&&(j=j.substring(1),k=j.length,f=f.substring(0,k)),f=this.replaceAllButFirst(n,f,""),f=this.replaceAllButFirst(o,f,"");var y=f.replace(p,""),z=f.length-y.length;f=y,b(-z);var A,B=j.replace(q,"").split("."),C=B[0].length+(B[1]?B[1].length:0),D=f.substring(0,g.begin),E=D.length-D.replace(q,"").length;if(b(-E),f=f.replace(r,""),A=s.length-f.length,f.length>C&&(f=f.substring(0,C)),t)if(x){var F,G=s.replace(q,"").split(".")
;G[1].length<B[1].length?F=G[0].length>=B[0].length?B[0].length:G[0].length:G[1].length===B[1].length?(w||(f=f.substring(0,G[0].length+B[1].length)),F=f.length-B[1].length):F=f.length-B[1].length,f=this.insertAtIndex(f,".",F)}else v?(f.length-(g.begin-1)>B[1].length&&(f=f.substring(0,g.begin-1+B[1].length)),f=0===h.indexOf(".")?this.insertAtIndex(f,".",g.begin-1):this.insertAtIndex(f,".",h.indexOf("."))):f.length>B[0].length&&(f=this.insertAtIndex(f,".",B[0].length),g.begin===B[0].length&&b(1));if(this.settings.thousandsSeparator){var H=f.length-f.replace(o,"").length>0,I=H?f.split("."):[f],J=I[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");I[0]=J,f=H?I.join("."):I[0]+(H?".":""),D=J.substring(0,this.originalPos.begin+A),E=D.length-D.replace(q,"").length,E>0&&b(E),","===f.substring(g.begin-1,g.begin)&&f.substr(g.begin,i)===h&&b(i)}this.element.val(f),!0!==a&&this.caret(g.end>=k?k:g.end),this.element.trigger("write.mask",[f])},processNumberMask:function(a,b){var c,d,e=this,f=e.element.val(),g=e.settings.pattern.replace(/#/g,""),h=e.settings.pattern.length-g.length;if(e.originalPos=e.caret(),e.currentMaskBeginIndex=e.currentMaskBeginIndex||e.originalPos.begin,e.currentMaskBeginIndex>=e.settings.pattern.length)return e.resetStorage(),e.killEvent(b);var i=f.substring(0,e.originalPos.begin),j=i.length!==i.replace(/\./g,"").length,k=f.replace(/\./g,""),l=f.length!==k.length,m=i.length-i.replace(/,/g,"").length,n=i.length-m;if(d=e.getCharacter("current",n),j){var o=e.settings.pattern.split(".")[1],p=i.split(".")[1],q=e.originalPos.begin-1-i.indexOf(".");d=o.charAt(q);return f.substring(e.originalPos.begin,e.originalPos.end).length<f.length&&p.length>=o.length?(e.resetStorage(),e.killEvent(b)):(c=e.testCharAgainstRegex(a,d))?(e.buffer+=a,e.writeInput(),e.resetStorage(),e.killEvent(b)):(e.resetStorage(),e.killEvent(b))}var r=e.settings.pattern.length!==e.settings.pattern.replace(/\./g,"").length;if(e.isCharacterDecimal(a)){if(!r)return e.resetStorage(),e.killEvent(b);if(l){var s=f.substring(e.originalPos.begin,e.originalPos.end);return s.length!==s.replace(/\./g,"").length&&(s.length===f.length&&(e.buffer+="0"),e.buffer+=a,e.writeInput()),e.resetStorage(),e.killEvent(b)}return 0!==f.length&&0!==e.originalPos.begin||(e.buffer+="0"),e.buffer+=a,e.writeInput(),e.resetStorage(),e.killEvent(b)}if(e.isCharacterDecimal(d))return l||(e.buffer+=d),d=e.getCharacter("next",n),c=e.testCharAgainstRegex(a,d),c&&(e.buffer+=a),e.writeInput(),e.resetStorage(),e.killEvent(b);if("-"===a)return!e.settings.negative||e.originalPos.begin>0?(e.resetStorage(),e.killEvent(b)):(e.buffer+=a,e.writeInput(),e.resetStorage(),e.killEvent(b));var t=f.split("."),u=t[0].replace(/,/g,""),v=u.replace(/-/g,""),w=v.length;return(c=e.testCharAgainstRegex(a,d))||e.settings.negative&&e.testCharAgainstRegex(a,"~")?w>=h?(e.buffer+=!l&&r?"."+a:a,e.writeInput(),e.resetStorage(),e.killEvent(b)):(e.buffer+=a,e.writeInput(),e.resetStorage(),e.killEvent(b)):(e.resetStorage(),e.killEvent(b))},getPatternParts:function(){var b,c=this,d=Object.keys(this.settings.definitions),e=[],f=[],g=!1,h=0,i="";a.each(d,function(a,b){i+=b}),i="["+i+"]+",b=new RegExp(i,"g"),e=c.settings.pattern.match(b)||[],e[0]&&c.settings.pattern.substring(0,1)!==e[0].substring(0,1)&&(f.push(c.settings.pattern.substring(0,c.settings.pattern.indexOf(e[0]))),g=!0);for(var j=f&&f[0]?c.settings.pattern.indexOf(f[0])+f[0].length:0;h<e.length;){var k=j+e[h].length,l=c.settings.pattern.substring(k,c.settings.pattern.length),m=c.settings.pattern.length-l.length,n=m+(e[h+1]?l.indexOf(e[h+1]):l.length),o=c.settings.pattern.substring(k,n);""!==o&&f.push(o),j=n,h++}for(var p="",q=0;q<f.length;q++)p+=f[q];for(var r=c.removeDuplicates(p),s="",t=0;t<e.length;t++)s+=e[t];return{editable:e,literal:f,allLiterals:p,allEditables:s,containedLiterals:r,containedEditables:c.removeDuplicates(s),startsWithLiteral:g}},analyzeInput:function(b){var c=this,d=void 0!==b?b:c.element.val(),e=!1,f=c.maskParts.editable,g=c.maskParts.literal,h=f.length+g.length,i=[],j=[],k="",l="",m="",n=0,o=0,p="",q="",r=0,s=0,t=0,u=0,v=0;for(c.maskParts.startsWithLiteral&&(e=!0),u;u<h;u++)if(e){for(k=d.substring(r,d.length),o=r+k.length,q="",v=0;v<k.length;v++)if(-1===a.inArray(k[v],c.maskParts.containedLiterals)){o=r+v;break}q=d.substring(r,o),q.length>0&&j.push(q),m+=q,r+=q.length,e=!1,t++}else{for(k=d.substring(r,d.length),n=r+k.length,p="",v=0;v<k.length;v++)if(-1!==a.inArray(k[v],c.maskParts.containedLiterals)){n=r+v;break}p=d.substring(r,n),p.length>0&&i.push(p),l+=p,r+=p.length,e=!0,s++}return 0===i.length&&i.push(""),{editables:i,allEditables:l,literals:j,allLiterals:m}},buildPatternFromParts:function(){var a=this.getPatternParts(),b="",c=0,d=0;for(a.startsWithLiteral&&(b+=a.literal[0],c++),a.literal,a.editable;d<a.editable.length;)b+=a.editable[d],a.literal[c]&&(b+=a.literal[c]),d++,c++;return b},removeDuplicates:function(b){for(var c=[],d=0;d<b.length;d++)-1===a.inArray(b[d],c)&&c.push(b[d]);return c},processMask:function(b,c){var d,e=this,f=e.maskParts.editable,g=e.maskParts.literal,h=0;e.originalPos=e.caret(),e.currentMaskBeginIndex=e.currentMaskBeginIndex||e.originalPos.begin;var i=e.element.val().substring(0,e.originalPos.begin),j=e.analyzeInput(i);if(e.originalPos.begin===e.originalPos.end&&j.allEditables.length>=e.maskParts.allEditables.length)return e.resetStorage(),e.killEvent(c);for(var k=0;k<e.maskParts.containedEditables.length&&!(d=e.testCharAgainstRegex(b,e.maskParts.containedEditables[k]));k++);if(!d&&-1===a.inArray(b,e.maskParts.containedLiterals))return e.resetStorage(),e.killEvent(c);h=0,e.maskParts.startsWithLiteral&&(h+=1);var l=j.editables.length-1>0?j.editables.length-1:0;if(j.editables[l].length>f[l].length)return e.resetStorage(),e.killEvent(c);var m=void 0!==g[l+h]&&-1!==a.inArray(b,e.maskParts.containedLiterals)&&!j.literals[l+h];if(m&&!e.settings.groupComplete&&j.editables[l].length>0)return e.checkSectionForLiterals(c,b,g[l+h]),e.writeInput(),e.resetStorage(),e.killEvent(c);if(m&&e.settings.groupComplete&&j.editables[l].length===f[l].length)return e.checkSectionForLiterals(c,b,g[l+h]),e.writeInput(),e.resetStorage(),e.killEvent(c);if(h>0&&0===l&&!j.literals[0]&&(e.buffer+=g[0],-1!==a.inArray(b,e.maskParts.containedLiterals)))return e.writeInput(),e.resetStorage(),e.killEvent(c);var n,o,p,q=j.editables[l]||"";return q.length<f[l].length?(o=f[l].substring(j.editables[l].length,j.editables[l].length+1),j.literals[l+h]&&g[l+h]!==j.literals[l+h]&&(n=e.element.val(),p=n.substring(e.originalPos.begin,n.length),i=i.substring(0,i.length-j.literals[l+h].length),e.caret(e.originalPos.begin-j.literals[l+h].length),e.originalPos=e.caret(),e.element.val(i+p),e.buffer+=g[l+h],o=f[l+1].substring(0,1)),d=e.testCharAgainstRegex(b,o),-1===a.inArray(b,e.maskParts.containedLiterals)&&d&&(e.buffer+=b,e.writeInput())):q.length===f[l].length&&(f[l+1]&&g[l+h]?(j.literals[l+h]&&g[l+h]!==j.literals[l+h]&&(n=e.element.val(),p=n.substring(e.originalPos.begin,n.length),i=i.substring(0,i.length-j.literals[l+h].length),e.caret(e.originalPos.begin-j.literals[l+h].length),e.originalPos=e.caret(),e.element.val(i+p),e.buffer+=g[l+h]),j.literals[l+h]||(e.buffer+=g[l+h]),o=f[l+1].substring(0,1),d=e.testCharAgainstRegex(b,o),-1===a.inArray(b,e.maskParts.containedLiterals)&&d&&(e.buffer+=b)):(n=e.element.val(),p=n.substring(e.originalPos.begin,n.length),p.length>0&&e.element.val(n.substring(0,e.originalPos.begin))),e.buffer.length>0&&e.writeInput()),e.resetStorage(),e.killEvent(c)},checkSectionForLiterals:function(a,b,c){for(var d=0;d<c.length;d++)if(b===c[d]){this.buffer+=c;break}},processStringAgainstMask:function(a,b){if(this.element.is(":hidden"))return this;switch(this.settings.mode){case"number":this.originalPos||(this.originalPos=this.caret()),this.buffer=a,this.writeInput(),this.resetStorage();break;default:for(var c=a.split(""),d=0;d<c.length;d++){var e=this.getCharacter();this.processMask(c[d],e,b)}}return this},remask:function(a){return this.originalPos||(this.originalPos=a?{begin:0,end:this.element.val().length}:this.caret()),this.writeInput(!0),this.resetStorage(),this},testCharAgainstRegex:function(a,b){var c=this.settings.definitions[b];return!!c&&c.test(a)},replaceAllButFirst:function(a,b,c){c||(c="");return b=b.replace(a,function(a){return a})},getCharacter:function(a,b){var c="number"===this.settings.mode?this.settings.pattern.replace(/,/g,""):this.settings.pattern,d=b||this.caret().begin;switch(a=this.evaluateDirecton(a)){case"next":return c.substring(d+1,d+2);case"prev":return c.substring(d-1,d);default:return c.substring(d,d+1)}},updated:function(){return this.teardown().init()},teardown:function(){return this.settings.showCurrency&&(this.element.parent(".field").removeClass("currency").attr("data-currency-symbol",""),this.element.prev("label").find(".currency").remove()),this.element.off("updated.mask keydown.mask keypress.mask keyup.mask focus.mask blur.mask "+this.getPasteEvent()),this.element.removeClass("is-mask").removeClass("is-number-mask"),this},destroy:function(){return this.teardown(),a.removeData(this.element[0],d),this}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,h))})},a.fn.multiselect=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="multiselect",e={filterMode:"contains",maxSelected:void 0,moveSelected:"all",showEmptyGroupHeaders:!1,showSelectAll:!1,source:void 0},f=a.extend({},e,b);return c.prototype={init:function(){this.build()},build:function(){var a={closeOnSelect:!1,empty:!0,moveSelected:"all",multiple:!0};return this.settings.filterMode&&(a.filterMode=this.settings.filterMode),this.settings.source&&(a.source=this.settings.source),this.settings.maxSelected&&(a.maxSelected=this.settings.maxSelected),this.settings.moveSelected&&(a.moveSelected=this.settings.moveSelected),this.settings.showEmptyGroupHeaders&&(a.showEmptyGroupHeaders=this.settings.showEmptyGroupHeaders),this.settings.showSelectAll&&(a.showSelectAll=this.settings.showSelectAll),this.element.dropdown(a),this.dropdown=this.element.data("dropdown"),this},enable:function(){this.dropdown.enable()},disable:function(){this.dropdown.disable()},updated:function(){this.build()},destroy:function(){this.dropdown.destroy(),this.element.off(),a.removeData(this.element[0],d)}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.message=function(b){function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="message",e={title:"Message Title",isError:!1,message:"Message Summary",width:"auto",buttons:null,cssClass:null,returnFocus:null},f=a.extend({},e,b);return c.prototype={init:function(){var b,c=this;this.message=a('<div class="modal message"></div>'),this.messageContent=a('<div class="modal-content"></div>'),this.title=a('<h1 class="modal-title" id="message-title">'+f.title+"</h1>").appendTo(this.messageContent).wrap('<div class="modal-header"></div>'),this.content=a('<div class="modal-body"><p class="message" id="message-text">'+f.message+"</p></div>").appendTo(this.messageContent),this.element.is("body")||(b=this.element,this.content.empty().append(b.show())),this.message.append(this.messageContent).appendTo("body"),this.message.modal({trigger:"immediate",buttons:f.buttons,resizable:f.resizable,close:f.close,isAlert:!0}),"auto"!==f.width&&(this.content.closest(".modal")[0].style.maxWidth="none",this.content.closest(".modal")[0].style.width=f.width+(/(px|%)/i.test(f.width+"")?"":"px")),f.cssClass&&this.message.addClass(f.cssClass),this.message.on("beforeclose.message",function(){return c.element.triggerHandler("beforeclose")}).on("beforeopen.message",function(){return c.element.triggerHandler("beforeopen")}).on("open.message",function(){c.element.trigger("open")}).on("afterclose.message",function(){c.destroy(),f.returnFocus&&f.returnFocus.focus(),a(document).off("keypress.message keydown.message")}),a(document).on("keypress.message keydown.message",function(a){27===(a.which||a.keyCode)&&setTimeout(function(){var a=c.message.data("modal");void 0!==a&&a.close()},0)}),f.isError?this.title.addClass("is-error").prepend(a.createIconElement("error")):this.title.removeClass("is-error").find("svg").remove()},destroy:function(){var a=this.message.data("modal");void 0!==a&&a.destroy(),this.message.off("beforeclose.message beforeopen.message open.message afterclose.message").remove()}},this.each(function(){new c(this,f)})},a.fn.modal=function(b){function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d),this.reStructure()}var d="modal",e={trigger:"click",buttons:null,isAlert:!1,content:null,cssClass:null,autoFocus:!0,id:null,frameHeight:180,frameWidth:46},f=a.extend({},e,b);return c.prototype={init:function(){var b=this;if(this.id=parseInt(a(".modal").length,10)+1,this.trigger=a('button[data-modal="'+this.element.attr("id")+'"]'),this.overlay=a('<div class="overlay"></div>'),this.oldActive=this.trigger,"click"===this.settings.trigger&&this.trigger.on("click.modal",function(){b.open()}),"immediate"===this.settings.trigger&&setTimeout(function(){b.open()},1),b.isCancelled=!1,this.settings.content)return this.settings.trigger=this.settings.content instanceof jQuery?this.settings.trigger:"immediate",this.appendContent(),void setTimeout(function(){b.open()},1);b.addButtons(this.settings.buttons),this.element.appendTo("body"),this.element[0].style.display="none"},appendContent:function(){var b=!1;if(this.element=a('<div class="modal"><div class="modal-content"><div class="modal-header"><h1 class="modal-title">'+this.settings.title+'</h1></div><div class="modal-body-wrapper"><div class="modal-body"></div></div></div></div>'),this.settings.id&&this.element.attr("id",this.settings.id),a(this.settings.content).is(".modal"))this.element=a(this.settings.content);else if(this.settings.content&&this.settings.content.length>0){if(this.settings.content instanceof jQuery&&this.settings.content.parent().is(".modal-body"))b=!0,this.element=this.settings.content.closest(".modal");else{var c=this,d=c.element.find(".modal-body");d.append(c.settings.content),Soho.utils.fixSVGIcons(d)}this.settings.content instanceof jQuery&&this.settings.content.show()}b||this.element.appendTo("body"),this.settings.cssClass&&this.element.addClass(this.settings.cssClass),this.settings.title&&this.element.find(".modal-title").text(this.settings.title),b||this.addButtons(this.settings.buttons)},reStructure:function(){var b=a(".modal-body",this.element),c=a("hr:first-child",b),d=a(".modal-buttonset",this.element);b&&b.length&&!b.parent().hasClass("modal-body-wrapper")&&b.wrap('<div class="modal-body-wrapper"></div>'),c&&c.length&&!c.parent().hasClass("modal-content")&&c.insertAfter(this.element.find(".modal-header")),d&&d.length&&!d.parent().hasClass("modal-content")&&d.insertAfter(this.element.find(".modal-body-wrapper"))},disableSubmit:function(){var b=this.element,c=b.find("[data-validate]:visible"),d=b.find(".modal-buttonset button"),e=d.filter(".btn-modal-primary").not(".no-validation");if(c.length>0){e.removeAttr("disabled");var f=!0;c.each(function(){var b=a(this);if(!(b.closest(".datagrid-filter-wrapper").length>0)){var c=null!==b[0].offsetParent;b.is(".required")?c&&!b.val()&&(f=!1):(b.checkValidation(),c&&!b.isValid()&&(f=!1)),f&&e.removeAttr("disabled")}}),f||e.is(":disabled")||e.attr("disabled","true")}},addButtons:function(b){var c,d=this,e=this.element.find(".modal-body"),f=e.parent(),g=100,h=!1;if(this.modalButtons=b,!b){var i=this.element.find(".modal-buttonset button");g=100/i.length;for(var j=0,k=i.length;j<k;j++)i[j].style.width=g+"%";return i.button(),void i.not("[data-ng-click], [ng-click], [onclick], :submit").on("click.modal",function(b){a(b.target).is(".btn-cancel")&&(d.isCancelled=!0),d.close()})}if(this.element.is(".contextual-action-panel")){if(h=!0,c=this.element.find(".buttonset"),!c.length){var l=this.element.find(".toolbar");l.length||a('<div class="toolbar"></div>').appendTo(this.element.find(".modal-header")),c=a('<div class="buttonset"></div>').appendTo(this.element.find(".toolbar"))}}else c=this.element.find(".modal-buttonset"),c.length||(c=a('<div class="modal-buttonset"></div>').insertAfter(f));g=100/b.length,b&&c.empty(),a.each(b,function(b,e){var f=a('<button type="button"></button>');f.text(e.text),"separator"===e.cssClass&&(f=a('<div class="separator"></div>')),e.cssClass?f.attr("class",e.cssClass):e.isDefault?f.addClass("btn-modal-primary"):f.addClass("btn-modal"),void 0===e.validate||e.validate||f.addClass("no-validation");for(var i={},j=["id","name","text"],k=0;k<j.length;k++)e[j[k]]&&(i[j[k]]=e[j[k]]);if("input"===e.type){var l=a('<label class="audible" for="filter">'+e.text+"</label>"),m=a('<input class="searchfield">').attr(i);return void c.append(l,m)}e.icon&&"#"===e.icon.charAt(0)&&(f.html("<span>"+f.text()+"</span>"),a.createIconElement({classes:["#icon-close"===e.icon?"icon-close":""],icon:e.icon.substr("#icon-".length)}).prependTo(f)),e.id&&f.attr("id",e.id),f.on("click.modal",function(a){if(e.click)return void e.click.apply(d.element[0],[a,d]);d.close()}),h||(f[0].style.width=g+"%"),f.button(),c.append(f)})},sizeInner:function(){var b;b=this.element.find(".detailed-message");var c=a(window).height()-b.offset().top-150;b[0].style.maxHeight=c+"px",b[0].style.overflow="auto",b[0].style.width=b.width()+"px"},open:function(){function b(){var a=d.element.find(":focusable").not(".modal-header .searchfield").first();if(d.keepFocus(),d.element.trigger("open",[d]),0===a.length&&(a=d.element.find(".btn-modal-primary")),1===a.length&&a.is(".btn-modal")&&(a=d.element.find(".btn-modal-primary")),1===a.length&&a.is("button")&&!a.is(":disabled")&&a.addClass("hide-focus"),d.settings.autoFocus){var b,c;if(a.is(".tab:not(.is-selected) a")&&(c=a.closest(".tab-container"),b=c.find(".is-selected"),b.length))return a=b,void c.data("tabs").select(b.children("a").attr("href"));a.focus()}}var c,d=this,e=!0;if(this.trigger&&0!==this.trigger.length||(this.oldActive=a(":focus")),this.element.after(this.overlay),this.element&&!this.element.parent().hasClass("modal-wrapper")&&this.element.wrap('<div class="modal-page-container"><div class="modal-wrapper"></div>'),this.root=this.element.closest(".modal-page-container"),c=d.element.find(".detailed-message"),1===c.length&&(a("body").on("resize.modal-"+this.id,function(){d.sizeInner()}),d.sizeInner()),e=this.element.triggerHandler("beforeopen"),d.isCancelled=!1,!1===e)return d.overlay.remove(),d.root[0].style.display="none",!1;if(a(".modal").each(function(b){var c=a(this);if(this.style.zIndex=(1020+(b+1)).toString(),c.data("modal")&&c.data("modal").overlay&&(c.data("modal").overlay[0].style.zIndex=(1020+b).toString()),!c.data("modal")){var d=c.closest(".modal-page-container").next(".overlay");d&&d[0]&&(d[0].style.zIndex=(1020+b).toString())}}),a("body > *").not(this.element).not(".modal, .overlay, .modal-page-container").attr("aria-hidden","true"),this.settings.isAlert)this.element.attr("aria-labeledby","message-title"),this.element.attr("aria-describedby","message-text");else{var f=this.element.find("h1:first"),g=f.attr("id");g||(g=(this.element.attr("id")?this.element.attr("id"):"h1")+"-title",f.attr("id",g));var h=this.element.find(".modal-body"),i=(this.element.attr("id")?this.element.attr("id"):"message")+"-text";this.element.attr("aria-labeledby",g),this.element.find(".toolbar .title").length?(this.element.find(".toolbar .title").attr("id",i),this.element.attr("aria-describedby",i)):(h.attr("id",i),this.element.attr("aria-describedby",i))}this.mainContent=a("body").children(".scrollable-container"),this.mainContent.length||(this.mainContent=a("body")),this.removeNoScroll=!this.mainContent.hasClass("no-scroll"),this.mainContent.addClass("no-scroll"),a("body").on("resize.modal-"+this.id,function(){d.resize()}),this.root[0].style.display="",this.element[0].style.display="",setTimeout(function(){d.resize(),d.element.addClass("is-visible").attr("role",d.settings.isAlert?"alertdialog":"dialog"),d.root.attr("aria-hidden","false"),d.overlay.attr("aria-hidden","true"),d.element.attr("aria-modal","true")},1),a("body").addClass("modal-engaged"),a(this.element).on("keypress.modal",function(b){var c=a(b.target);c.is(".searchfield")||c.is("textarea")||c.is(":button")||c.is(".dropdown")||c.closest(".tab-list").length||13===b.which&&d.isOnTop()&&!c.closest("form").find(":submit").length&&d.element.find(".btn-modal-primary:enabled").length&&(b.stopPropagation(),b.preventDefault(),d.element.find(".btn-modal-primary:enabled").trigger("click"))}),a(".skip-link").on("focus.modal",function(a){a.preventDefault(),d.getTabbableElements().first.focus()}),d.element.find(".paginated").on("afterpaging",function(){d.resize()}),setTimeout(function(){d.disableSubmit()},10),this.element.find("[data-validate]").removeClass("disable-validation"),setTimeout(function(){b()},200),setTimeout(function(){d.element.trigger("afteropen")},300)},resize:function(){var b=.9*a(window).height()-this.settings.frameHeight,c=1*a(window).width()-this.settings.frameWidth,d=this.element.find(".modal-body-wrapper");if(this.element.find(".modal-contents").css("width",""),d.length&&(d[0].style.maxHeight=b+"px",d[0].style.maxWidth=c+"px"),this.element.hasClass("lookup-modal")){var e=this.element.find(".datagrid-body"),f=this.element.find(".pager-toolbar"),g=e.closest(".datagrid-container");b=b-(g.prev().is(".toolbar")?130:60)-(g.next().is(".pager-toolbar")?35:0),e[0].style.maxHeight=b+(f.length?-15:0)+"px",e[0].style.maxWidth=c+"px"}},isOpen:function(){return this.element.is(".is-visible")},isOnTop:function(){var b=0,c=this.element;return a(".modal.is-visible").each(function(){var a=this.style.zIndex;b<a&&(b=a)}),b===c[0].style.zIndex},getTabbableElements:function(){var b=a(this.element).find("a[href], area[href], input:not([disabled]),select:not([disabled]), textarea:not([disabled]),button:not([disabled]), iframe, object, embed, *[tabindex],*[contenteditable]").filter(":visible");return{first:b[0],last:b[b.length-1]}},keepFocus:function(){var b,c=this;a(c.element).on("keypress.modal keydown.modal",function(a){var d=a.which||a.keyCode;27===d&&setTimeout(function(){c.close()},0),9===d&&(b=c.getTabbableElements(),a.target!==b.last||a.shiftKey?a.target===b.first&&a.shiftKey&&(a.preventDefault(),b.last.focus()):(a.preventDefault(),b.first.focus()),c.element.find("#message-title").removeAttr("tabindex"))})},close:function(b){if(!this.isOpen())return!0;var c=this.element.triggerHandler("beforeclose"),d=this,e=this.element.find("[data-validate]");if(this.root=this.element.closest(".modal-page-container"),e.addClass("disable-validation"),!1===c)return!1;this.mainContent&&this.removeNoScroll&&this.mainContent.removeClass("no-scroll"),a("body").off("resize.modal-"+this.id),this.element.off("keypress.modal keydown.modal"),this.element.removeClass("is-visible"),this.overlay.attr("aria-hidden","true"),this.root&&this.root.attr("aria-hidden","true"),a('.modal-page-container[aria-hidden="false"]').length<1&&(a("body").removeClass("modal-engaged"),a("body > *").not(this.element.closest(".modal-page-container")).removeAttr("aria-hidden"),a(".overlay").remove()),d.element.trigger("close",d.isCancelled),this.oldActive&&a(this.oldActive).is("a:visible, button:visible, input:visible, textarea:visible")?(this.oldActive.focus(),this.oldActive=null):this.trigger.parents(".toolbar, .formatter-toolbar").length<1&&this.trigger.focus(),a("#validation-errors, #tooltip, #validation-tooltip").addClass("is-hidden"),a(".skip-link").off("focus.modal"),setTimeout(function(){d.overlay.remove(),d.root[0].style.display="none",d.element.trigger("afterclose"),("immediate"===d.settings.trigger||b)&&d.destroy()},300)},destroy:function(){function b(){c.modalButtons&&c.element.find("button").off("click.modal"),1===c.element.find(".detailed-message").length&&a("body").off("resize.modal-"+this.id),"click"===c.settings.trigger&&c.trigger.off("click.modal"),c.element.closest(".modal-page-container").remove(),a.removeData(c.element[0],"modal")}var c=this;if(this.element.trigger("beforedestroy")){if(!this.isOpen())return void b();this.element.one("afterclose.modal",function(){b()}),this.close(!0)}}},this.each(function(){var e=a.data(this,d),g=a(this);if(g.is(".modal")||(e=g.closest(".modal").data(d)),e)return"function"==typeof e[b]&&e[b](),e.settings=a.extend({},e.settings,b),void("immediate"===f.trigger&&e.open());e=a.data(this,d,new c(this,f))})},a.fn.rating=function(b){function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="rating",e={},f=a.extend({},e,b);return c.prototype={init:function(){this.handleEvents(),this.allInputs=this.element.find("input"),this.readonly()},handleEvents:function(){var b=this;a("input",b.element).each(function(c){a(this).on("change",function(){b.element.hasClass("is-readonly")||b.val(c+1)})})},val:function(b){var c,d,e=this;if(!b)return this.currentValue;for(this.currentValue=parseFloat(b,10),d=Math.round(this.currentValue),c=0;c<this.allInputs.length;c++){var f=a(this.allInputs[c]),g=f.parent().is(".inline")?"svg":"label";c<b?f.addClass("is-filled").removeClass("is-half"):f.removeClass("is-filled").removeClass("is-half"),f.next(g).find("svg").changeIcon("star-filled"),c+1===d&&f.prop("checked",!0),d!==e.currentValue&&c+1===d&&f.addClass("is-half").next(g).find("svg").changeIcon("star-half")}return d<=0&&a(this.allInputs[0]).prop("checked",!0),this.currentValue},readonly:function(){var b=a(this.element);b.hasClass("is-readonly")&&b.find("input").attr("disabled","")},enable:function(){a(this.element).removeClass("is-readonly").find("input").removeAttr("disabled")}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},a.fn.searchfield=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}b||(b={});var d="searchfield",e={allResultsCallback:void 0,showAllResults:!0,categories:void 0,categoryMultiselect:!1,showCategoryText:!1,source:void 0,template:void 0,clearable:!1},f=a.extend({},e,b);return c.prototype={init:function(){this.inlineLabel=this.element.closest("label"),this.inlineLabelText=this.inlineLabel.find(".label-text"),this.isInlineLabel=this.element.parent().is(".inline"),this.build().setupEvents()},build:function(){if(this.optionsParseBoolean(),this.label=this.element.prev("label, .label"),(this.settings.source||this.element.attr("data-autocomplete"))&&this.element.autocomplete(this.settings),this.autocomplete=this.element.data("autocomplete"),this.element.attr("autocomplete","off"),this.wrapper=this.element.parent(".searchfield-wrapper"),!this.wrapper||!this.wrapper.length){this.isInlineLabel?this.wrapper=this.inlineLabel.addClass("searchfield-wrapper"):this.wrapper=this.element.wrap('<span class="searchfield-wrapper"></span>').parent(),this.element.closest(".toolbar").length&&this.label.prependTo(this.wrapper);for(var b,c=["context","alternate"],d=0;d<c.length;d++)this.element.hasClass(c[d])&&(b=c[d],this.wrapper.addClass(b),this.element.removeClass(b))}var e=this.wrapper.find(".icon:not(.icon-dropdown)"),f=this.wrapper.hasClass("context")||this.wrapper.hasClass("has-categories");if(e&&e.length||(e=a.createIconElement("search")),e[f?"insertBefore":"insertAfter"](this.element).icon(),this.hasCategories()){this.wrapper.addClass("has-categories"),this.button=this.wrapper.find(".btn, .searchfield-category-button"),this.button.length||(this.button=a('<button type="button" class="btn searchfield-category-button"></button>')),e.appendTo(this.button),e=this.button,this.button.insertBefore(this.element),this.settings.showCategoryText&&this.wrapper.addClass("show-category");var g=e.find(".icon-dropdown");g.length||(g=a.createIconElement({classes:"icon-dropdown",icon:"dropdown"}).icon()),g.appendTo(e);if(this.button.data("popupmenu"))this.setCategories(this.settings.categories);else{this.list=this.wrapper.find("ul.popupmenu"),this.list&&this.list.length||(this.list=a('<ul class="popupmenu"></ul>'));var h=this.settings.categoryMultiselect?"is-multiselectable":"is-selectable";this.list.addClass(h);var i="is-selectable";this.settings.categoryMultiselect||(i="is-multiselectable"),this.list.removeClass(i),this.setCategories(this.settings.categories),this.list.insertAfter(this.element),this.button.popupmenu({menu:this.list,offset:{y:10}})}this.setCategoryButtonText()}var j=this.element.hasClass("alternate");return this.wrapper[j?"addClass":"removeClass"]("alternate"),this.settings.clearable&&this.element.clearable(),this},optionsParseBoolean:function(){var a,b,c=["showAllResults","categoryMultiselect","showCategoryText","clearable"];for(a=0,b=c.length;a<b;a++)this.settings[c[a]]=this.parseBoolean(this.settings[c[a]])},hasCategories:function(){return this.settings.categories&&a.isArray(this.settings.categories)&&this.settings.categories.length>0},setupEvents:function(){var b=this;return this.element.on("updated.searchfield",function(){b.updated()}).on("focus.searchfield",function(a){b.handleFocus(a)}).on("blur.searchfield",function(a){b.handleBlur(a)}).onTouchClick("searchfield",".searchfield").on("click.searchfield",function(a){b.handleClick(a)}).on("keydown.searchfield",function(a){b.handleKeydown(a)}).on("beforeopen.searchfield",function(a,c){b.handlePopupBeforeOpen(a,c)}).on("safe-blur.searchfield listclose.searchfield",function(){b.wrapper.removeClass("popup-is-open")}),this.wrapper.on("mouseenter.searchfield",function(){a(this).addClass("is-hovered")}).on("mouseleave.searchfield",function(){a(this).removeClass("is-hovered")}),this.hasCategories()&&this.button.on("selected.searchfield",function(a,c){b.handleCategorySelected(a,c)}).on("focus.searchfield",function(a){b.handleCategoryFocus(a)}).on("blur.searchfield",function(a){b.handleCategoryBlur(a)}).on("close.searchfield",function(a){b.handlePopupClose(a)}),this.element.off("populated.searchfield").on("populated.searchfield",function(a,c){c.length>0?b.settings.showAllResults&&b.addMoreLink():b.addNoneLink()}),this.element.on("listopen.searchfield",function(c,d){var e=a("#autocomplete-list");b.wrapper.addClass("popup-is-open"),e.off("click").on("click.autocomplete","a",function(c){var e=a(c.currentTarget),f=e.text().trim(),g=e.hasClass("more-results"),h=e.hasClass("no-results");if(g||h||b.element.attr("aria-activedescendant",e.parent().attr("id")),g){var i=b.settings.allResultsCallback;i&&"function"==typeof i&&i(f)}if(e.parent().attr("data-value"))for(var j=0;j<d.length;j++)d[j].value.toString()===e.parent().attr("data-value")&&(f=d[j]);return b.element.trigger("selected",[e,f]),b.element.data("popupmenu").close(),c.preventDefault(),!1}),e.find(".more-results, .no-results").off("focus").on("focus.searchfield",function(){var c=a(this);e.find("li").removeClass("is-selected"),c.parent("li").addClass("is-selected"),b.element.val("")})}),this},recalculateParent:function(){var a=this.element.closest(".toolbar");a.length&&setTimeout(function(){a.triggerHandler("recalculate-buttons")},300)},setAsActive:function(a,b){if(a||!this.element.hasClass("active")){this.element.addClass("active");var c=this.element.closest('.toolbar, [class$="-toolbar"]');c.length&&c.addClass("searchfield-active"),this.isToolbarSearchfield()||this.wrapper.addClass("has-focus"),!0===b&&this.element.focus(),this.recalculateParent()}},hasFocus:function(){var b=document.activeElement;if(a.contains(this.wrapper[0],b))return!0;if(this.button&&this.button.length){if(this.button.data("popupmenu").menu.has(b).length)return!0}return!1},handleFocus:function(){this.setAsActive()},handleBlur:function(){this.recalculateParent(),this.hasFocus()&&this.wrapper.removeClass("has-focus")},handleClick:function(){this.setAsActive()},handleKeydown:function(a){27===a.which&&this.clear()},
handlePopupBeforeOpen:function(a,b){if(b){var c=this.wrapper.hasClass("context")?"addClass":"removeClass",d=this.wrapper.hasClass("alternate")?"addClass":"removeClass";return b[c]("context"),b[d]("alternate"),!0}},setCategoryButtonText:function(b){if(this.settings.showCategoryText&&this.hasCategoryButton()){var c="",d=this.wrapper.find(".btn"),e=d.find("span");if(e&&e.length||(e=a('<span class="category"></span>').insertAfter(d.find(".icon").first())),e.empty(),"string"==typeof b&&b.length)return void e.text(b.trim());var f=this.getSelectedCategories();f.length&&(c=f.length>1?f.length+" "+Locale.translate("Selected"):f.text().trim(),e.text(c))}},isToolbarSearchfield:function(){return this.wrapper.is(".toolbar-searchfield-wrapper")},handleCategorySelected:function(a,b){this.setCategoryButtonText(a,b.text().trim());var c=this.element.data("toolbarsearchfield");c&&"function"==typeof c.setOpenWidth&&(c.calculateOpenWidth(),c.setOpenWidth())},handleCategoryFocus:function(){this.isToolbarSearchfield()||this.wrapper.removeClass("active").addClass("has-focus")},handleCategoryBlur:function(){this.isToolbarSearchfield()||this.wrapper.removeClass("has-focus")},getCategories:function(){return this.list.children("li:not(.separator)")},getSelectedCategories:function(){return this.getCategories().filter(".is-checked")},getCategoryData:function(a){var b=this.getCategories(),c=[];return b.each(function(){var b=this.classList,d=b.contains("is-checked");if(!0!==a||!1!==d){var e={name:this.innerText,checked:d};this.id&&(e.id=this.id);var f=this.getAttribute("data-value");void 0!==f&&(e.value=f),c.push(e)}}),c},updateCategories:function(a){this.settings.categories=a,this.setCategories(this.settings.categories)},setCategories:function(a){this.list.empty();var b=this,c=!1;a.forEach(function(a){if("string"==typeof a&&(a={name:a}),a.name){var d="";"string"==typeof a.id&&a.id.length&&(d=' id="'+a.id+'"');var e="";["string","number"].indexOf(typeof a.value)>-1&&(e=' data-value="'+a.value+'"');var f="";!0===a.checked&&!0!==c&&(f=' class="is-checked"',b.settings.categoryMultiselect||(c=!0)),b.list.append("<li"+f+d+e+'><a href="#">'+a.name+"</a></li>")}});var d=this.button.data("popupmenu");d&&"function"==typeof d.updated&&d.updated()},hasCategoryButton:function(){return this.wrapper.find(".btn").length>0},handlePopupClose:function(){return this.setAsActive(!0,!0)},clear:function(){this.element.val("").trigger("change").focus()},addMoreLink:function(){var b=a("#autocomplete-list"),c=this.element.val();if(!(a(".more-results",b).length>0)){a('<li class="separator" role="presentation"></li>').appendTo(b);var d=a('<li role="presentation"></li>').appendTo(b);this.moreLink=a('<a href="#" class="more-results" tabindex="-1" role="menuitem"></a>').html("<span>"+Locale.translate("AllResults")+' "'+c+'"</span>').appendTo(d)}},addNoneLink:function(){var b=a("#autocomplete-list");if(!(a(".no-results",b).length>0)){var c=a('<li role="presentation"></li>').appendTo(b);this.noneLink=a('<a href="#" class="no-results" tabindex="-1" role="menuitem"></a>').html("<span>"+Locale.translate("NoResults")+"</span>").appendTo(c)}},updated:function(){this.teardown().init()},enable:function(){this.element.prop("disabled",!1)},disable:function(){this.element.prop("disabled",!0)},parseBoolean:function(a){return!/^(false|0)$/i.test(a)&&!!a},teardown:function(){return this.element.off("updated.searchfield focus.searchfield blur.searchfield click.searchfield keydown.searchfield beforeopen.searchfield listopen.searchfield listclose.searchfield safe-blur.searchfield"),this.autocomplete&&this.autocomplete.destroy(),this.wrapper.hasClass("context")&&this.element.addClass("context"),this.element.next(".icon").remove(),this.element.parent().hasClass("searchfield-wrapper")&&(this.element.parent().find("ul").remove(),this.element.parent().find(".icon").remove()),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)}},this.each(function(){var e=a(this);if(e.parents(".toolbar").length&&!b.noToolbarSearchfieldInvoke){var g=e.data("toolbarsearchfield");if(!g)return e.toolbarsearchfield(b);g.updated()}var h=a.data(this,d);h?(h.settings=a.extend({},h.settings,b),h.updated()):h=a.data(this,d,new c(this,f))})},a.fn.signin=function(b){"use strict";function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="signin",e={},f=a.extend({},e,b);return c.prototype={init:function(){this.settings=f,this.handleKeys()},isCapslock:function(a){a=a||window.event;var b=a.which?a.which:!!a.keyCode&&a.keyCode,c=a.shiftKey?a.shiftKey:!!a.modifiers&&!!(4&a.modifiers);return!!(b>=97&&b<=122&&c)||b>=65&&b<=90&&!c},destroy:function(){a.removeData(this.element[0],d),a("body").off("keypress.signin blur.signin change.signin")},handleKeys:function(){var b=this,c=a.createIconElement({classes:"icon-capslock",icon:"capslock"});document.msCapsLockWarningOff=!0,this.element.on("keypress.signin",'[type="password"]',function(d){var e=a(this),f=e.parent(".field"),g=a(".icon-capslock",f);b.isCapslock(d)&&!e.hasClass("error")?g.length||(f.append(c),a("body").toast({audibleOnly:!0,message:Locale.translate("CapsLockOn")})):g.remove()}).on("blur.signin change.signin",'[type="password"]',function(){var b=a(this),d=b.closest(".field"),e=a(".icon-capslock",d);setTimeout(function(){e&&e.length&&(b.hasClass("error")?e.remove():d.append(c))},150)})}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},a.fn.slider=function(b){"use strict";function c(c){this.settings=a.extend({},h,b),this.element=a(c),Soho.logTimeStart(g),this.init(),Soho.logTimeEnd(g)}function d(a){return a%1==0}function e(a,b){return b&&!isNaN(b)&&0!==b||(b=1),Math.round(a/b)*b}function f(a,b){var c=a[0],d=a[1],e=b[0],f=b[1];return Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2))}var g="slider",h={value:[50],min:0,max:100,range:!1,step:void 0,ticks:[],tooltipContent:void 0,persistTooltip:!1};return c.prototype={init:function(){return this.buildSettings().addMarkup().bindEvents()},buildSettings:function(){var b=this;this.element.is(":disabled")&&this.element.closest(".field").addClass("is-disabled"),this.settings||(this.settings={}),this.settings.value=void 0!==this.element.attr("value")?this.element.attr("value"):this.settings.value,this.settings.min=void 0!==this.element.attr("min")?parseInt(this.element.attr("min")):this.settings.min,this.settings.max=void 0!==this.element.attr("max")?parseInt(this.element.attr("max")):this.settings.max,this.settings.range=void 0!==this.element.attr("data-range")?"true"===this.element.attr("data-range"):this.settings.range,this.settings.step=isNaN(this.element.attr("step"))?this.settings.step:Number(this.element.attr("step")),""===this.settings.value&&(this.settings.value=this.settings.min);var c;if(void 0!==this.element.attr("data-ticks")){try{c=JSON.parse(b.element.attr("data-ticks"))}catch(a){}a.isArray(c)&&(this.settings.ticks=c)}var d="true"===this.element.attr("data-tooltip-persist")||!0===this.element.attr("data-tooltip-persist");if(this.settings.persistTooltip=void 0!==this.element.attr("data-tooltip-persist")?d:this.settings.persistTooltip,this.settings.tooltip=this.settings.tooltipContent,void 0!==this.element.attr("data-tooltip-content"))try{b.settings.tooltip=JSON.parse(b.element.attr("data-tooltip-content"))}catch(a){}if("string"==typeof this.settings.tooltip)if(-1===this.settings.tooltip.indexOf(","))this.settings.tooltip=[this.settings.tooltip,""];else{var e=this.settings.tooltip.split(",");this.settings.tooltip=[e[0]],this.settings.tooltip.push(e[1]?e[1]:"")}this.settings.tooltip&&1===this.settings.tooltip.length&&this.settings.tooltip.push(""),this.ticks=[];var f={value:this.settings.min,description:b.getModifiedTextValue(this.settings.min)},g={value:this.settings.max,description:b.getModifiedTextValue(this.settings.max)};if(this.settings.ticks){var h=b.settings.ticks||[];if(a.isArray(h)&&h.length>0){var i=h.filter(function(a){return a.value===b.settings.min}),j=h.filter(function(a){return a.value===b.settings.max});i.length>0&&(f.description=i[0].description,f.color=i[0].color,h=a.grep(h,function(a){return a!==i[0]})),j.length>0&&(g.description=j[0].description,g.color=j[0].color,h=a.grep(h,function(a){return a!==j[0]}))}b.ticks.push(f);for(var k=0;k<h.length;k++){var l={};void 0!==h[k].value&&(l.value=h[k].value,l.description=void 0!==h[k].description?h[k].description:"",l.color=h[k].color,b.ticks.push(l))}b.ticks.push(g)}else this.ticks.push(f,g);if(a.isArray(this.settings.value))this.settings.value[0]=isNaN(this.settings.value[0])?(this.settings.min+this.settings.max)/2:parseInt(this.settings.value[0]);else if("number"==typeof this.settings.value)this.settings.value=[this.settings.value];else if(-1===this.settings.value.indexOf(","))this.settings.value=[isNaN(this.settings.value)?(this.settings.min+this.settings.max)/2:parseInt(this.settings.value)];else{var m=this.settings.value.split(",");m[0]=isNaN(m[0])?this.settings.min:parseInt(m[0]),m[1]=isNaN(m[1])?this.settings.max:parseInt(m[1]),this.settings.value=m}return this.settings.range&&!this.settings.value[1]&&this.settings.value.push(this.settings.max),this},addMarkup:function(){function b(b){var e=c.isRtlHorizontal?100-c.convertValueToPercentage(b.value):c.convertValueToPercentage(b.value),f="calc("+e+"% - 4px)";b.element=a('<div class="tick" data-value="'+b.value+'"></div>'),b.label=a('<span class="label">'+b.description+"</span>"),b.element[0].style[d?"bottom":"left"]=f,b.element.append(b.label),c.wrapper.append(b.element),d||(b.label[0].style.left=-(b.label.outerWidth()/2-b.element.width()/2)+"px")}var c=this,d=!1;if("INPUT"!==c.element[0].tagName)throw new Error('Element with ID "'+c.element.id+"\" cannot invoke a slider;  it's not an Input element.");c.originalElement={type:c.element.attr("type")},c.element.attr("type","hidden"),c.wrapper=a('<div class="slider-wrapper"></div>').attr("id",c.element.attr("id")+"-slider").insertAfter(c.element),c.hitarea=a('<div class="slider-hit-area"></div>').appendTo(c.wrapper),c.range=a('<div class="slider-range"></div>').appendTo(c.wrapper),this.element.hasClass("vertical")&&(this.wrapper.addClass("vertical"),d=!0),this.isRtlHorizontal=Locale.isRTL()&&!d,this.isRtlVertical=Locale.isRTL()&&d;var e=this.element.attr("style");e&&(e.match(/min-height/)&&(this.wrapper[0].style.minHeight=this.element[0].style.minHeight,e=e.replace("min-height","")),e.match(/height/)&&(this.wrapper[0].style.height=this.element[0].style.height),e.match(/min-width/)&&(this.wrapper[0].style.minWidth=this.element[0].style.minWidth,e=e.replace("min-width","")),e.match(/width/)&&(this.wrapper[0].style.width=this.element[0].style.width)),c.handles=[];var f=c.element.prev("label").text(),g=a('<div class="slider-handle'+(c.settings.range?" lower":"")+'" tabindex="0"></div>').attr("aria-label",(c.settings.range?Locale.translate("SliderMinimumHandle"):Locale.translate("SliderHandle"))+" "+f);if(c.handles.push(g),c.settings.range){var h=a('<div class="slider-handle higher" tabindex="0"></div>').attr("aria-label",Locale.translate("SliderMaximumHandle")+" "+f);c.handles.push(h)}return a.each(c.handles,function(a,b){b.attr({role:"slider","aria-orientation":d?"vertical":"horizontal","aria-valuemin":c.settings.min,"aria-valuemax":c.settings.max}).hideFocus(),b.appendTo(c.wrapper)}),c.ticks.forEach(function(a){b(a)}),c.value(c.settings.value),c.updateRange(),a.each(c.handles,function(a,b){c.settings.tooltip&&(b.tooltip({content:function(){return""+c.getModifiedTextValue(Math.floor(c.value()[a]))},placement:d?"right":"bottom",trigger:"focus",keepOpen:c.settings.persistTooltip}),b.removeAttr("aria-describedby"))}),!0===this.element.prop("disabled")&&this.disable(),c},handleRangeClick:function(b){if(b.preventDefault(),!this.isDisabled()){var c,d,e,g,h=this,i=this.wrapper.hasClass("vertical"),j="click"!==b.originalEvent.type?b.originalEvent.changedTouches[0].pageX:b.pageX,k="click"!==b.originalEvent.type?b.originalEvent.changedTouches[0].pageY:b.pageY,l=j-h.wrapper.offset().left-a(document).scrollLeft(),m=k-h.wrapper.offset().top-a(document).scrollTop(),n=[l,m],o=h.handles[0].offset().left+h.handles[0].width()/2-h.wrapper.offset().left-a(document).scrollLeft(),p=h.handles[0].offset().top+h.handles[0].height()/2-h.wrapper.offset().top-a(document).scrollTop(),q=[o,p],r=h.value(),s=f(n,q),t=r[0],u=h.handles[0];u.addClass("hide-focus");var v=function(){if(i){var a=h.wrapper.height();return(a-m)/a*100}return l/h.wrapper.width()*100}(),w=h.convertPercentageToValue(v);h.handles[1]?(c=h.handles[1].offset().left+h.handles[1].width()/2-h.wrapper.offset().left-a(document).scrollLeft(),d=h.handles[1].offset().top+h.handles[1].height()/2-h.wrapper.offset().top-a(document).scrollTop(),e=[c,d],g=f(n,e),s>g?(h.value([void 0,w]),u=h.handles[1],t=r[1]):h.value([w])):h.value([w]),h.checkHandleDifference(u,t,w),w<t?h.decreaseValue(b,u,w,0):h.increaseValue(b,u,w,0),h.settings.tooltip||u.focus()}},activateHandle:function(a){a.addClass("is-active")},deactivateHandle:function(a){a.removeClass("is-active")},enableHandleDrag:function(b){function c(a,b,c){if(!d.isDisabled()){var e=function(){if(d.isVertical()){var a=d.wrapper.height(),e=a-b.outerHeight();return(e-c.top)/e*100}return c.left/(d.wrapper.width()-b.outerWidth())*100}(),f=d.convertPercentageToValue(e);if(d.settings.range){var g=d.value();b.hasClass("higher")&&f<=g[0]&&(f=g[0]),b.hasClass("lower")&&f>=g[1]&&(f=g[1])}d.settings.step&&(f=Math.round(f/d.settings.step)*d.settings.step),a.defaultPrevented||(d.value(b.hasClass("higher")?[void 0,f]:[f]),d.updateRange(),d.updateTooltip(b),d.element.trigger("sliding",b,f))}}if(!this.isDisabled()){var d=this,e={containment:"parent",axis:this.isVertical()?"y":"x",clone:!1};b.drag(e).on("drag.slider",function(b,d){c(b,a(b.currentTarget),d)}).on("dragstart",function(){a(this).addClass("is-dragging"),d.range.addClass("is-dragging"),d.element.trigger("slidestart",b)}).on("dragend",function(){a(this).removeClass("is-dragging"),d.range.removeClass("is-dragging"),d.element.trigger("slidestop",b)})}},disableHandleDrag:function(a){a.off("drag.slider dragstart dragend"),this.range.removeClass("is-dragging"),a.removeClass("is-dragging");var b=a.data("drag");b&&b.destroy()},convertValueToPercentage:function(a){return(a-this.settings.min)/(this.settings.max-this.settings.min)*100},convertPercentageToValue:function(a){var b=a/100*(this.settings.max-this.settings.min)+this.settings.min;return this.isRtlHorizontal?this.settings.max-b+this.settings.min:b},getIncrement:function(){var a=.1*(this.settings.max-this.settings.min);return void 0!==this.settings.step&&a<=this.settings.step&&(a=this.settings.step),a},handleKeys:function(b,c){if(!c.isDisabled()){var d=b.which,e=a(b.currentTarget);switch(e.removeClass("hide-focus"),d){case 33:c.increaseValue(b,e,void 0,this.getIncrement());break;case 34:c.decreaseValue(b,e,void 0,this.getIncrement());break;case 35:c.increaseValue(b,e,this.settings.max);break;case 36:c.decreaseValue(b,e,this.settings.min);break;case 38:case 39:c.isRtlHorizontal&&39===d?c.decreaseValue(b,e):c.increaseValue(b,e);break;case 37:case 40:c.isRtlHorizontal&&37===d?c.increaseValue(b,e):c.decreaseValue(b,e)}}},increaseValue:function(a,b,c,f){a.preventDefault(),clearTimeout(b.data("animationTimeout"));var g,h,i,j=this.value().slice(0),k=void 0!==f?f:void 0!==this.settings.step?this.settings.step:1;if(b.hasClass("higher"))g=void 0!==c?c:j[1],k=d(g)?k:isNaN(g%k)?0:g%k,h=g+k<this.settings.max?g+k:this.settings.max,i=h%k?h:e(h,k),this.value([void 0,i]);else{g=void 0!==c?c:j[0];var l=void 0===j[1]?this.settings.max:j[1];k=d(g)?k:isNaN(g%k)?0:k-g%k,h=g+k<l?g+k:l,i=h%k?h:e(h,k),this.value([i])}this.checkHandleDifference(b,g,i),this.updateRange(),this.updateTooltip(b)},decreaseValue:function(a,b,c,f){a.preventDefault(),clearTimeout(b.data("animationTimeout"));var g,h,i,j=this.value(),k=void 0!==f?f:void 0!==this.settings.step?this.settings.step:1;if(b.hasClass("higher")){g=void 0!==c?c:j[1];var l=void 0===j[0]?this.settings.min:j[0];k=d(g)?k:isNaN(g%k)?0:k-g%k,h=g-k>l?g-k:l,i=h%k?h:e(h,k),this.value([void 0,i])}else g=void 0!==c?c:j[0],k=d(g)?k:isNaN(g%k)?0:g%k,h=g-k>this.settings.min?g-k:this.settings.min,i=h%k?h:e(h,k),this.value([i]);this.checkHandleDifference(b,g,i),this.updateRange(),this.updateTooltip(b)},updateRange:function(){function b(a,b){var c=g?i[1]:i[0],d=g?100-b:b;a.css(c,"calc("+d+"% - "+a.outerWidth()/2+"px)")}for(var c=this,d=this.value(),e=[],f=this.getColorClosestToValue(),g=c.wrapper.hasClass("vertical"),h=0;h<this.ticks.length;h++){(this.settings.range?d[0]<this.ticks[h].value&&this.ticks[h].value<=d[1]:this.ticks[h].value<=d[0])?(this.ticks[h].element.addClass("complete"),f&&(this.ticks[h].element[0].style.backgroundColor=f,this.ticks[h].element.addClass("inherit"))):(this.ticks[h].element.removeClass("complete"),f&&(this.ticks[h].element[0].style.backgroundColor="",this.ticks[h].element.removeClass("inherit")))}f&&(this.range[0].style.backgroundColor=f,a.each(this.handles,function(a,b){b[0].style.backgroundColor=f,b[0].style.borderColor=f})),a.each(c.ticks,function(a){c.ticks[a].label[0].style.color=""}),e[0]=this.convertValueToPercentage(d[0]),void 0!==d[1]&&(e[1]=this.convertValueToPercentage(d[1]));var i=g?["bottom","top"]:c.isRtlHorizontal?["right","left"]:["left","right"],j={};this.handles[1]?(j[i[0]]=e[0]+"%",j[i[1]]=100-e[1]+"%"):(j[i[0]]="0%",j[i[1]]=100-e[0]+"%"),this.range.css(j),this.handles[0].hasClass("is-animated")&&this.handles[0].data("animationTimeout",setTimeout(function(){c.handles[0].removeClass("is-animated").trigger("slide-animation-end"),c.range.removeClass("is-animated")},201)),b(this.handles[0],e[0]),this.handles[1]&&(this.handles[1].hasClass("is-animated")&&this.handles[1].data("animationTimeout",setTimeout(function(){c.handles[1].removeClass("is-animated").trigger("slide-animation-end"),c.range.removeClass("is-animated")},201)),b(this.handles[1],e[1]),this.handles[0].attr("aria-valuemax",d[1]),this.handles[1].attr("aria-valuemin",d[0]))},checkHandleDifference:function(b,c,d){if(!a("html").hasClass("ie9")){var e=this.convertValueToPercentage(c),f=this.convertValueToPercentage(d);Math.abs(e-f)>3&&(b.addClass("is-animated"),this.range.addClass("is-animated"))}},updateTooltip:function(a){function b(){e.position(),a.focus()}if(this.settings.tooltip){if(!a){var c,d=this.handles[0].data("tooltip");return this.handles[1]&&(c=this.handles[1].data("tooltip")),d.hide(),void(c&&c.hide())}var e=a.data("tooltip");a.hasClass("is-animated")?(e.hide(),a.one("slide-animation-end",function(){b()})):b()}},getColorClosestToValue:function(){for(var a,b,c=Soho.theme,d={light:{default:"#000000","very-poor":"#a13030",poor:"#d66221",adequate:"#f2bc41",good:"#9cce7c","very-good":"#76b051",superior:"#488421"},dark:{default:"#ffffff","very-poor":"#a13030",poor:"#d66221",adequate:"#f2bc41",good:"#9cce7c","very-good":"#76b051",superior:"#488421"},"high-contrast":{default:"#000000","very-poor":"#a13030",poor:"#d66221",adequate:"#e4882b",good:"#76b051","very-good":"#56932e",superior:"#397514"}},e=d[c],f=this.value()[0],g=0;g<this.ticks.length;g++)(b=this.ticks[g].color)&&f>=this.ticks[g].value&&(a=b,a=b.indexOf("#")>-1?b:e[b]||e.default);return a},value:function(b,c){var d=this;return void 0===b&&void 0===c?d._value:(b&&a.isArray(b)&&(void 0!==b[1]&&(c=b[1]),b=b[0]),void 0===b&&a.isArray(d._value)&&void 0!==d._value[0]&&(b=d._value[0]),void 0===c&&a.isArray(d._value)&&void 0!==d._value[1]&&(c=d._value[1]),d._value=[b,c],d.element.val(void 0!==c?d._value:d._value[0]),a.each(d.handles,function(b,c){var e=d._value[b],f=d.getModifiedTextValue(e);a.each(d.ticks,function(a,b){b.value===e&&(f=b.description)}),c.attr({"aria-valuenow":d._value[b],"aria-valuetext":f})}),d.element.trigger("change"),d._value)},getModifiedTextValue:function(a){return this.settings.tooltip?this.settings.tooltip[0]+a+this.settings.tooltip[1]:a},enable:function(){this.element.prop("disabled",!1),this.wrapper.removeClass("is-disabled");var b=this;return a.each(this.handles,function(a,c){b.enableHandleDrag(c)}),this},disable:function(){this.element.prop("disabled",!0),this.wrapper.addClass("is-disabled");var b=this;return a.each(this.handles,function(a,c){b.disableHandleDrag(c)}),this},isDisabled:function(){return this.element.prop("disabled")},isVertical:function(){return this.wrapper.hasClass("vertical")},setValue:function(a,b){var c=this.value();this.checkHandleDifference(this.handles[0],c[0],a),this.handles[1]&&this.checkHandleDifference(this.handles[1],c[1],b);var d=this.value(a,b);return this.updateRange(),this.updateTooltip(),d},refresh:function(a,b){return this.setValue(a,b)},updated:function(){return this.element.removeAttr("value"),this.teardown().init()},teardown:function(){var b=this;return a.each(b.handles,function(a,c){b.disableHandleDrag(c),c.off("mousedown.slider click.slider blur.slider keydown.slider keyup.slider")}),this.wrapper.off("click.slider touchend.slider touchcancel.slider").remove(),this.element.attr("type",this.originalElement.type),this},destroy:function(){this.teardown(),a.removeData(this.element[0],g)},bindEvents:function(){var b=this;return a.each(b.handles,function(c,d){d.on("mousedown.slider",function(){b.isDisabled()||a(this).focus()}).on("click.slider",function(a){a.preventDefault()}).on("keydown.slider",function(a){b.activateHandle(d),b.handleKeys(a,b)}).on("keyup.slider blur.slider",function(){b.deactivateHandle(d)}),b.enableHandleDrag(d)}),b.wrapper.on("click.slider touchend.slider touchcancel.slider",function(a){b.handleRangeClick(a)}),b.element.on("updated.slider",function(){b.updated()}),b}},this.each(function(){var d=a.data(this,g);d?("function"==typeof d[b]?d[b]():d.settings=a.extend({},d.settings,b),d.updated()):d=a.data(this,g,new c(this,b))})},a.fn.arrange=function(b){"use strict";function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="arrange",e={handle:null,itemsSelector:null,connectWith:!1,placeholder:null,placeholderCssClass:"arrange-placeholder"},f=a.extend({},e,b);return c.prototype={init:function(){this.isTouch=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.isIe11="ie"===Soho.env.browser.name&&"11"===Soho.env.browser.version,this.handleEvents()},getElementByTouchInList:function(b,c,d){var e=!1;return a(b).each(function(){var b=a(this),f=b.offset();c<=f.left||c>=f.left+b.outerWidth()||d<=f.top||d>=f.top+b.outerHeight()||(e=b)}),e},dragTouchElement:function(a,b){var c=a.originalEvent.changedTouches[0];b[0].style.top=c.pageY-this.offset.y+"px",b[0].style.left=c.pageX-this.offset.x+"px"},unbind:function(){return this.items.removeClass("draggable").removeAttr("draggable").off("selectstart.arrange "+this.dragStart+" "+this.dragEnd+" "+this.dragWhileDragging),a(this.handle,this.items).removeClass("draggable").off("mousedown.arrange mouseup.arrange touchstart.arrange touchend.arrange"),this},updated:function(){return this.unbind().init()},destroy:function(){this.unbind(),a.removeData(this.element[0],d)},handleEvents:function(){var b,c,d=this,e={},g=d.element.children().not('[data-arrange-exclude="true"]'),h=a("<"+(/^(ul|ol)$/i.test(d.element[0].tagName)?"li":"div")+">");f.itemsSelector&&(g=a(f.itemsSelector,d.element).not('[data-arrange-exclude="true"]'),h=a("<"+g.first()[0].tagName+" />")),f.placeholder&&(h=a(f.placeholder)),d.dragStart="dragstart.arrange touchstart.arrange gesturestart.arrange",d.dragEnd="dragend.arrange touchend.arrange touchcancel.arrange gestureend.arrange",d.dragWhileDragging="dragover.arrange dragenter.arrange drop.arrange touchmove.arrange gesturechange.arrange",d.handle=f.handle||d.element.attr("data-arrange-handle"),d.connectWith=d.element.attr("data-arrange-connectWith"),d.placeholders=h,d.isTouch||d.placeholders.addClass(f.placeholderCssClass+" draggable"),a(d.handle,g).addClass("draggable").on("mousedown.arrange touchstart.arrange",function(){c=!0}).on("mouseup.arrange touchend.arrange",function(){c=!1}),d.connectWith&&(g=g.add(a(d.connectWith).children().not('[data-arrange-exclude="true"]')).data("connectWith",d.connectWith)),d.items=g,d.items.attr("draggable",!0).addClass(d.handle?"":"draggable").add([this,h]).not("a[href], img").on("selectstart.arrange",function(){return this.dragDrop&&this.dragDrop(),!1}).end().each(function(){a(this).on(d.dragStart,function(f){if(d.handle&&!c)return!!d.isTouch&&void 0;if(c=!1,d.dragging=a(this),b=d.dragging.addClass("arrange-dragging").index(),a.extend(e,{start:d.dragging,startIndex:b}),d.element.triggerHandler("beforearrange",e),d.isTouch){var g=d.dragging[0].getBoundingClientRect(),h=f.originalEvent.changedTouches[0];d.offset={x:h.pageX-g.left,y:h.pageY-g.top},d.placeholderTouch=d.dragging.clone().addClass("is-touch").attr("id","arrange-placeholder-touch").insertBefore(d.dragging),d.dragTouchElement(f,d.placeholderTouch)}else{var i=f.originalEvent.dataTransfer;i.effectAllowed="move",i.setData("Text","dummy")}}).on(d.dragEnd,function(){d.dragging&&(d.isTouch&&(d.dragging.css("opacity",1),d.placeholderTouch.remove()),d.placeholders.filter(":visible").after(d.dragging),d.dragging.removeClass("arrange-dragging").show(),d.placeholders.detach(),b!==d.dragging.index()&&(a.extend(e,{end:d.dragging,endIndex:d.dragging.index()}),d.element.triggerHandler("arrangeupdate",e)),d.dragging=null,d.placeholderTouch=null)}).on(d.dragWhileDragging,function(b){if(d.dragging){var c,f=this;if(b.preventDefault(),"drop"===b.type)return b.stopPropagation(),d.dragging.trigger("dragend.arrange"),!1;if(d.isTouch){var i=b.originalEvent.touches[0];f=d.getElementByTouchInList(g,i.pageX,i.pageY)||f}if(f=a(f),d.isTouch||(b.originalEvent.dataTransfer.dropEffect="move"),g.is(f)&&h.index()!==f.index()){d.isTouch?d.dragging.css("opacity",0):d.dragging.hide(),h.index()<f.index()?(h.insertAfter(f),c=f.index()):(h.insertBefore(f),c=h.index()),a.extend(e,{over:f,overIndex:c}),d.element.triggerHandler("draggingarrange",e);var j=a("svg",f);d.isIe11&&j.length&&f.html(f.html()),d.placeholders.not(h).detach()}else d.placeholders.is(this)||(d.placeholders.detach(),d.element.append(h));return!!d.isTouch&&void d.dragTouchElement(b,d.placeholderTouch)}})})}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.scrollaction=function(b){function c(b,c){this.settings=a.extend({},d,c),this.element=a(b),e.trackScrolling.call(this)}var d={scrollActionTarget:".js-scroll-target",classToAdd:"scrolled-down"},e={trackScrolling:function(){var b=this;b.lastScrollTop=0,this.element.scroll(function(){var c=a(this).scrollTop();c>b.lastScrollTop?a(b.settings.scrollActionTarget).addClass(b.settings.classToAdd):a(b.settings.scrollActionTarget).removeClass(b.settings.classToAdd),b.lastScrollTop=c})}};return this.each(function(){var d=a.data(this,"scrollaction");d?d.settings=a.extend({},d.settings,b):d=a.data(this,"scrollaction",new c(this,b))})},a.fn.spinbox=function(b,c){"use strict";function d(b){this.element=a(b),Soho.logTimeStart(e),this.init(),Soho.logTimeEnd(e)}var e="spinbox",f={min:null,max:null,step:null},g=a.extend({},f,b);return d.prototype={init:function(){this.settings=a.extend({},g),this.inlineLabel=this.element.closest("label"),this.inlineLabelText=this.inlineLabel.find(".label-text"),this.isInlineLabel=this.element.parent().is(".inline"),this.isWrapped=this.element.parent().is(".spinbox-wrapper"),this.setInitialValue().addMarkup().bindEvents().setWidth()},setWidth:function(){var a=this.element[0].style;return a.width&&(this.element.parent()[0].style.width=parseInt(a.width)+2*this.element.parent().find(".down").outerWidth()+"px"),this},setInitialValue:function(){var a=this,b=a.checkForNumeric(a.element.val());return this.element.val(b),this.element.attr("data-trackdirty")&&this.element.data("original",b),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&this.element.attr("pattern","\\d*"),this.settings.max&&this.element.attr("max",this.settings.max),this.settings.step&&this.element.attr("step",this.settings.step),this.settings.min&&this.element.attr("min",this.settings.min),this},addMarkup:function(){var b=this;this.isInlineLabel?this.inlineLabel.addClass("spinbox-wrapper"):this.isWrapped||this.element.wrap('<span class="spinbox-wrapper"></span>'),this.isTouch=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.isWrapped&&(this.buttons={down:this.element.parent().find(".down").button(),up:this.element.parent().find(".up").button()},this.isTouch&&(this.buttons.down.attr("aria-hidden","true"),this.buttons.up.attr("aria-hidden","true"))),this.buttons||(this.buttons={down:a("<span "+(this.isTouch?"":'aria-hidden="true"')+' class="spinbox-control down">-</span>').insertBefore(this.element).button(),up:a("<span "+(this.isTouch?"":'aria-hidden="true"')+' class="spinbox-control up">+</span>').insertAfter(this.element).button()});var c,d=this.element.attr("min"),e=this.element.attr("max"),f=this.element.attr("data-mask"),g="",h={role:"spinbutton"},i=0;if(d||e||f||(e="9999999"),(d||e)&&!f){var j="",k=d||"",l=e||"",m=k.length>l.length?k:l;for(i=0;i<=m.length;)j+="#",i++;-1===k.indexOf("-")&&-1===l.indexOf("-")||(j="-"+j.substring(0,j.length-1)),h["data-mask"]=j,f=j}for(c=f.length,i=0;i<=c;)g+="9",i++;return-1===f.indexOf("-")?(h.min=d||0,h.max=e||g):(h.min=d||g,h.max=e||g.substring(0,g.length-1)),this.element.attr("data-mask-mode")&&"number"===this.element.attr("data-mask-mode")||(h["data-mask-mode"]="number"),this.element.data("mask")&&"object"==typeof this.element.data("mask")&&this.element.data("mask").destroy(),d&&(h["aria-valuemin"]=d),e&&(h["aria-valuemax"]=e),this.element.attr(h),this.updateAria(b.element.val()),this.element.mask(),this.isDisabled()&&this.disable(),this},enableLongPress:function(b,c){c.addButtonStyle(b),c.longPressInterval=setInterval(function(){a(b.currentTarget).is(":hover")&&c.handleClick(b)},140)},disableLongPress:function(a,b){b.removeButtonStyle(a),clearInterval(b.longPressInterval),b.longPressInterval=null},handleClick:function(b){if(!this.isDisabled()&&1===b.which){var c=a(b.currentTarget);c.hasClass("up")?this.increaseValue():this.decreaseValue(),this.isTouch?c.focus():this.element.focus()}},handleKeyDown:function(b,c){var d=b.which,e=[35,36,37,38,39,40];if(-1!==a.inArray(d,e))switch(d){case 35:c.element.attr("min")&&c.element.val(c.element.attr("min"));break;case 36:c.element.attr("max")&&c.element.val(c.element.attr("max"));break;case 38:case 39:Locale.isRTL()&&39===d?(c.addButtonStyle(c.buttons.down),c.decreaseValue()):(c.addButtonStyle(c.buttons.up),c.increaseValue());break;case 37:case 40:Locale.isRTL()&&37===d?(c.addButtonStyle(c.buttons.up),c.increaseValue()):(c.addButtonStyle(c.buttons.down),c.decreaseValue())}},handleKeyPress:function(a,b){if(!b.isDisabled()){var c=a.which;if(!(c<48||c>57&&c<96||c>105)){var d=Number(this.checkForNumeric(this.element.val())),e=b.element.attr("min"),f=b.element.attr("max");return d<e?(a.preventDefault(),b.updateVal(e)):d>f?(a.preventDefault(),b.updateVal(f)):void 0}}},handleKeyup:function(a,b){if(!b.isDisabled()){var c=a.which;switch(c){case 38:case 39:Locale.isRTL()&&39===c?b.removeButtonStyle(b.buttons.down):b.removeButtonStyle(b.buttons.up);break;case 37:case 40:Locale.isRTL()&&39===c?b.removeButtonStyle(b.buttons.up):b.removeButtonStyle(b.buttons.down)}b.updateAria(b.element.val())}},handleAfterPaste:function(a){var b=Number(a.element.attr("min")),c=Number(a.element.attr("max")),d=Number(a.element.val());d=d<b?b:d>c?c:d,a.updateVal(d)},increaseValue:function(){var a=this.checkForNumeric(this.element.val())+Number(this.element.attr("step")||1);this.element.attr("max")&&a>this.element.attr("max")||this.updateVal(a)},decreaseValue:function(){var a=this.checkForNumeric(this.element.val())-Number(this.element.attr("step")||1);this.element.attr("min")&&a<this.element.attr("min")||this.updateVal(a)},updateVal:function(a){this.element.val(a),this.updateAria(a),
this.element.focus()},checkForNumeric:function(b){return""===b?b:a.isNumeric(b)?Number(b):(b=parseInt(b),a.isNumeric(b)?Number(b):0)},updateAria:function(a){var b=this.element.attr("min"),c=this.element.attr("max");a=this.checkForNumeric(a),this.element.attr("aria-valuenow",""!==a?a:""),this.setIsDisabled(this.buttons.up,""!==a&&c&&a>=c?"disable":"enable"),this.setIsDisabled(this.buttons.down,""!==a&&b&&a<=b?"disable":"enable")},addButtonStyle:function(b){if(!this.isDisabled()){var c=b;b.currentTarget&&(c=a(b.currentTarget)),c.addClass("is-active")}},removeButtonStyle:function(b){if(!this.isDisabled()){var c=b;b.currentTarget&&(c=a(b.currentTarget)),c.removeClass("is-active")}},enable:function(){this.element.prop("disabled",!1),this.element.parent(".spinbox-wrapper").removeClass("is-disabled")},disable:function(){this.element.prop("disabled",!0),this.element.parent(".spinbox-wrapper").addClass("is-disabled")},isDisabled:function(){return this.element.prop("disabled")},setIsDisabled:function(a,b){b=void 0===b||!(!b||"enable"===b),a[b?"addClass":"removeClass"]("is-disabled")},destroy:function(){var b=this.element.data("mask");b&&"function"==typeof b.destroy&&b.destroy();for(var c in this.buttons){var d=a(c).data("button");d&&d.destroy()}this.buttons.up.off("click.spinbox mousedown.spinbox"),this.buttons.up.remove(),this.buttons.down.off("click.spinbox mousedown.spinbox"),this.buttons.down.remove(),this.element.off("focus.spinbox blur.spinbox keydown.spinbox keyup.spinbox"),this.element.unwrap(),a.removeData(this.element[0],e)},bindEvents:function(){var b=this,c=!1;return this.element.on("focus.spinbox",function(){b.element.parent(".spinbox-wrapper").addClass("is-focused")}).on("blur.spinbox",function(){b.element.parent(".spinbox-wrapper").removeClass("is-focused"),b.element.trigger("change")}).on("keydown.spinbox",function(a){b.handleKeyDown(a,b)}).on("keypress.spinbox",function(a){b.handleKeyPress(a,b)}).on("keyup.spinbox",function(a){b.handleKeyup(a,b)}).on("afterpaste.mask",function(){b.handleAfterPaste(b)}),this.buttons.up.add(this.buttons.down[0]).on("touchstart.spinbox mousedown.spinbox",function(d){if(1===d.which){if(c||b.handleClick(d),b.isTouch)return;c=!0,b.enableLongPress(d,b),a(document).one("mouseup",function(){b.disableLongPress(d,b),c=!1,b.element.focus()}),this.isTouch&&(d.preventDefault(),d.stopPropagation())}}),this}},this.each(function(){var h=a.data(this,e);h?("function"==typeof h[b]&&h[b](c),h.settings=a.extend({},f,b)):h=a.data(this,e,new d(this,g))})},a.fn.splitter=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="splitter",e={axis:"x",side:"left",resize:"immediate",containment:null,save:!0},f=a.extend({},e,b);return c.prototype={init:function(){return this.build().handleEvents()},build:function(){var b,c=this,d=this.settings,e=this.element,f=e.parent(),g=f.width(),h="x"===d.axis?"left":"top",i=f.is(".content")?f.parent():f;if(setTimeout(function(){b=f.height()},0),this.docBody=a("body"),this.isSplitterRightSide=e.is(".splitter-right")||"x"===d.axis&&"right"===d.side,this.isSplitterHorizontal=e.is(".splitter-horizontal")||"y"===d.axis,d.uniqueId=this.uniqueId(),this.isSplitterRightSide){if(this.leftSide=i,i.addClass("is-right-side").next().addClass("flex-grow-shrink is-right-side").parent().addClass("splitter-container"),e.addClass("splitter-right"),d.collapseButton){var j=0,k=a('<button type="button" class="splitter-btn" id="splitter-collapse-btn" title="Collapse"><svg class="icon" focusable="false" aria-hidden="true" role="presentation"><use xlink:href="#icon-double-chevron"></use></svg></button>');k.appendTo(e),e[0].offsetLeft>10&&a("#splitter-collapse-btn").addClass("rotate"),a("#splitter-collapse-btn").click(function(){j<=0?e[0].offsetLeft<=10?(c.splitTo(299,b),a(this).addClass("rotate")):(j=e[0].offsetLeft,c.splitTo(0,b),a(this).removeClass("rotate")):e[0].offsetLeft>10?(j=e[0].offsetLeft,c.splitTo(0,b),a(this).removeClass("rotate")):(c.splitTo(j,b),a(this).addClass("rotate"),j=0)})}}else this.isSplitterHorizontal?(this.topPanel=e.prev(),g=this.topPanel.height(),f.addClass("splitter-container is-horizontal"),e.next().addClass("flex-grow-shrink"),e.addClass("splitter-horizontal")):(this.rightSide=i,this.leftSide=i.prev().parent(),i.prev().addClass("flex-grow-shrink").parent().addClass("splitter-container"));return localStorage&&d.save&&!isNaN(parseInt(localStorage[d.uniqueId]))&&(g=localStorage[d.uniqueId]),g=parseInt(g),this.isSplitterHorizontal?e[0].style.top=g+"px":e[0].style.top=0,this.splitTo(g,b),this.documentWidth=0,this.element.drag({axis:d.axis,containment:d.containment||"x"===d.axis?"document":"parent",containmentOffset:{left:20,top:0}}).on("dragstart.splitter",function(){var b=a("iframe");if(c.documentWidth=a(document).width(),b.length>0)for(var d=0,e=b.length;d<e;d++){var f=a(b[d]),g=parseInt(getComputedStyle(f.parent()[0]).width,10)-40+"px";f.before('<div class="overlay" style="opacity: 0; visibility: visible; height: 100%; width: '+g+'"></div>')}}).on("dragend.splitter",function(e,f){a(".overlay").remove(),d.collapseButton&&(f[h]<=10?a("#splitter-collapse-btn").removeClass("rotate"):a("#splitter-collapse-btn").addClass("rotate")),"end"===d.resize&&c.splitTo(f[h],b)}).on("drag.splitter",function(a,e){if(e.left<=0)return!1;"immediate"===d.resize&&c.splitTo(e[h],b)}),"y"===d.axis&&this.element.addClass("splitter-horizontal"),this.element.attr({"aria-dropeffect":"move",tabindex:"0","aria-grabbed":"false"}),this},toggleSelection:function(){this.element.toggleClass("is-dragging")},resizeTop:function(a,b,c){(b>c||b<0)&&(b=parseInt(c)/2),this.topPanel[0].style.height=b+"px"},resizeLeft:function(a,b){var c=this.leftSide.outerWidth()-b;this.rightSide[0].style.width=c+"px",a[0].style.left=""},resizeRight:function(a,b){this.leftSide[0].style.width=b+"px",a[0].style.left=b-1+"px"},uniqueId:function(){return this.element.attr("id")||window.location.pathname.split("/").pop()+"-splitter-"+a(".splitter").length},splitTo:function(a,b){var c=this,d=this.element;this.isSplitterRightSide?this.resizeRight(d,a):this.isSplitterHorizontal?this.resizeTop(d,a,b):this.resizeLeft(d,a),this.element.trigger("split",[a]),this.docBody.triggerHandler("resize",[c]),localStorage&&(localStorage[this.settings.uniqueId]=a),this.split=a,this.parentHeight=b},updated:function(){return this.teardown().init()},teardown:function(){return this.element.off("updated."+d),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)},handleEvents:function(){var a=this;return this.element.on("updated."+d,function(){a.updated()}).on("keydown."+d,function(b){32===b.which&&(a.toggleSelection(),b.preventDefault()),37===b.which&&a.splitTo(a.split-15,a.parentHeight),39===b.which&&a.splitTo(a.split+15,a.parentHeight)}),this}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.stepprocess=function(b){function c(b){this.element=a(b),this.init()}var d={linearProgression:!1,folderIconOpen:"caret-up",folderIconClosed:"caret-down",stepList:"#step-list",stepLi:".js-step",stepLink:".js-step-link",stepFolder:".js-step-folder",btnPrev:".js-step-link-prev",btnNext:".js-step-link-next",beforeSelectStep:null},e=a.extend({},d,b);return c.prototype={init:function(){this.settings=a.extend({},e),this.$stepList=a(this.settings.stepList),this.initStepprocess(),this.handleKeys(),this.setupEvents(),this.focusFirst()},initStepprocess:function(){var b=this;b.$stepList.find(this.settings.stepLi).each(function(){b.decorateNode(this)});var c=a(this.settings.stepLi+".is-selected"),d=c.find(this.settings.stepLink);this.selectStep(d)},decorateNode:function(b){var c=this,d=a(b),e=d.children(this.settings.stepLink),f=d.children(this.settings.stepFolder),g=e.hasClass("is-disabled"),h=f.hasClass("is-open");g&&e.attr("aria-disabled","true"),f.length&&(d.addClass("folder"),f.attr("role","group"),g&&(f.addClass("disabled"),h&&f.children().each(function(){a(this).find(c.settings.stepLink).addClass("is-disabled").attr("aria-disabled","true")})),e.attr("aria-expanded",h));var i=e.parentsUntil(this.$stepList,"ul").length-1,j=d.index(),k=d.siblings().addBack().length;e.attr({role:"stepitem",tabindex:"-1","aria-selected":"false","aria-level":i+1,"aria-posinset":j+1,"aria-setsize":k,"aria-disabled":g}).addClass("hide-focus").hideFocus()},focusFirst:function(){this.$stepList.find(this.settings.stepLi+":first").attr("tabindex","0")},folderClose:function(b){var c=this,d=a(b),e=d.children(this.settings.stepLink),f=d.children(this.settings.stepFolder),g=e.closest(".folder").removeClass("is-open").end().find("svg.icon-tree");this.setIcon(g,this.settings.folderIconClosed),this.isAnimating=!0,f.one("animateclosedcomplete",function(){f.removeClass("is-open"),c.isAnimating=!1}).animateClosed(),e.attr("aria-expanded","false")},folderOpen:function(b){var c=this,d=a(b);if(!this.isOpen(d)){var e=d.children(this.settings.stepLink),f=d.children(this.settings.stepFolder);d.addClass("is-open"),e.attr("aria-expanded","true");var g=e.find("svg.icon-tree");c.setIcon(g,c.settings.folderIconOpen),c.isAnimating=!0,f.one("animateopencomplete",function(){c.isAnimating=!1}).addClass("is-open").css("height",0).animateOpen()}},folderToggle:function(a){var b=a.closest(this.settings.stepLi);if(this.isFolder(b)){var c=b.children(this.settings.stepFolder);this.isOpen(c)?this.folderClose(b):this.folderOpen(b)}},getSelectedStep:function(){return a(this.settings.stepLi+".is-selected",this.$stepList)},getNextNode:function(a){var b=a.parent().next().find(this.settings.stepLink+":first"),c=b.closest(this.settings.stepLi);if(a.next().is(this.settings.stepFolder)&&a.next().hasClass("is-open")&&(b=a.next().find(this.settings.stepLink+":first")),b.hasClass("is-disabled")&&(b=c.next().find(this.settings.stepLink+":first")),0===b.length)for(var d=0,e=a;d<2&&(e=e.parent().closest(".folder"),b=e.next().find(this.settings.stepLink+":first"),!b.length);d++);return b},getNextStep:function(){var a=this.getSelectedStep(),b=a.children(this.settings.stepLink),c=a.next(this.settings.stepFolder),d=this.getNextNode(b),e=d.next(this.settings.stepFolder),f=null,g=null;return c.length?(g=c,f=g.children().length?g.find(this.settings.stepLink).first():d):e.length?(g=e,f=g.children().length?g.find(this.settings.stepLink).first():d):f=d,f},getPreviousNode:function(a){var b=a.parent().prev().find(this.settings.stepLink+":first"),c=b.closest(this.settings.stepLi);return c.is(".folder.is-open")&&c.find("ul.is-open a").length&&!c.find("ul.is-disabled").length&&(b=c.find("ul.is-open "+this.settings.stepLink+":last")),b.hasClass("is-disabled")&&(b=c.prev().find(this.settings.stepLink+":first")),0===b.length&&(b=a.closest(this.settings.stepFolder).prev(this.settings.stepLink)),b},getPreviousStep:function(){var a=this.getSelectedStep(),b=a.children(this.settings.stepLink),c=this.getPreviousNode(b),d=c.closest(this.settings.stepLi),e=c;if(this.isFolder(d))if(this.isOpen(d))e=this.getPreviousNode(c);else{var f=d.children(this.settings.stepFolder);f.children().length&&(e=f.find(this.settings.stepLink).last())}return e},goToNextStep:function(){var a=this.getNextStep();a.length&&this.selectStep(a,"next")},goToPreviousStep:function(){var a=this.getPreviousStep();a.length&&this.selectStep(a,"prev")},handleKeys:function(){var b=this;this.$stepList.on("focus.stepprocess",this.settings.stepLink,function(){var b=a(this);if(0===parseInt(b.attr("aria-level"))&&1===parseInt(b.attr("aria-posinset"))&&b.hasClass("is-disabled")){var c=a.Event("keydown.stepprocess");return c.keyCode=40,void b.trigger(c)}}),this.$stepList.on("keydown.stepprocess",this.settings.stepLink,function(c){var d,e,f=c.charCode||c.keyCode,g=a(this);if(!b.isAnimating){if(40===f){var h=b.getNextNode(g);b.setFocus(h)}if(38===f){var i=b.getPreviousNode(g);b.setFocus(i)}if(32===c.keyCode&&g.trigger("click.stepprocess"),37===f)return Locale.isRTL()?g.next().hasClass("is-open")?(e=g.next().find(b.settings.stepLink+":first"),b.setFocus(e)):b.folderToggle(g):g.next().hasClass("is-open")?b.folderToggle(g):(e=g.closest(".folder").find(b.settings.stepLink+":first"),b.setFocus(e)),c.stopPropagation(),!1;if(39===f)return Locale.isRTL()?g.next().hasClass("is-open")?b.folderToggle(g):(d=g.closest(".folder").find(b.settings.stepLink+":first"),b.setFocus(d)):g.next().hasClass("is-open")?(d=g.next().find(b.settings.stepLink+":first"),b.setFocus(d)):(b.folderToggle(g),b.setFocus(g)),c.stopPropagation(),!1;36===f&&(d=b.$stepList.find(b.settings.stepLink+":first:visible"),b.setFocus(d)),35===f&&(d=b.$stepList.find(b.settings.stepLink+":last:visible"),b.setFocus(d))}}),this.$stepList.on("keypress.stepprocess",this.settings.stepLink,function(c){var d=c.charCode||c.keyCode,e=a(this);if(d>=37&&d<=40||32===d)return c.stopPropagation(),!1;0!==c.which&&e.closest(b.settings.stepLi).nextAll().find(".js-step-link:visible").each(function(){var d=a(this);if(d.text().substr(0,1).toLowerCase()===String.fromCharCode(c.which).toLowerCase())return b.setFocus(d),!1})})},isFolder:function(b){return a(b).hasClass("folder")},isInFolder:function(b){return a(b).closest(this.settings.stepFolder,this.$stepList).length},isOpen:function(b){return a(b).hasClass("is-open")},setFocus:function(a){a.focus()},setIcon:function(a,b){var c=b.replace(/icon-|hide-focus|\s?/gi,"");a.changeIcon(c)},selectStep:function(a,b){var c=this;void 0===b&&(b="none");var d;if("function"==typeof c.settings.beforeSelectStep){var e={stepLink:a,isStepping:b};d=c.settings.beforeSelectStep(e),d.done&&"function"==typeof d.done?d.done(function(d,e){d&&(e&&(a=e),c.selectStepFinish(a,b))}):d&&c.selectStepFinish(a,b)}else c.selectStepFinish(a,b)},selectStepFinish:function(b,c){var d=this,e=a(this.settings.stepLink,this.$stepList),f=b.closest(this.settings.stepLi);if(e.attr({tabindex:"-1","aria-selected":"false"}).parent().removeClass("is-selected"),b.attr({tabindex:"0","aria-selected":"true"}),f.addClass("is-selected"),this.isFolder(f))"none"===c?this.folderToggle(f):this.folderOpen(f);else{var g=f.closest(this.settings.stepFolder,this.$stepList);g.length&&this.folderOpen(g.closest(this.settings.stepLi)),this.showStepPanel(b.attr("href"))}b.focus(),setTimeout(function(){d.element.triggerHandler("selected",b)},0)},unSelectedNode:function(b){var c=a(this.settings.stepLink,this.$stepList),d=a(b),e=d.children(this.settings.stepLink);c.attr("tabindex","-1"),e.attr("tabindex","0"),d.removeClass("is-selected"),e.attr("aria-selected","false")},setupEvents:function(){var b=this;b.$stepList.on("updated.stepprocess",function(){b.initStepprocess()}).on("click.stepprocess",b.settings.stepLink+":not(.is-clone)",function(c){if(c.preventDefault(),!b.settings.linearProgression){var d=a(this);d.is(".is-disabled, .is-loading")||(b.selectStep(d),c.stopPropagation())}}),a(this.settings.btnPrev).on("click",function(a){a.preventDefault(),b.goToPreviousStep.call(b)}),a(this.settings.btnNext).on("click",function(a){a.preventDefault(),b.goToNextStep.call(b)}),a(this.settings.contentScroll).scrollaction({scrollActionTarget:".main"}),a(this.settings.stepListScroll).scrollaction({scrollActionTarget:".sidebar"}),a(".js-toggle-sidebar").click(function(a){a.preventDefault(),b.element.toggleClass("tablet-hide-steps").toggleClass("phone-hide-steps")})},showStepPanel:function(b){a(".step-panel-active").removeClass("step-panel-active"),a(b).addClass("step-panel-active"),this.element.addClass("phone-hide-steps")},destroy:function(){this.$stepList.removeData("stepprocess"),this.$stepList.off("updated.stepprocess click.stepprocess focus.stepprocess keydown.stepprocess keypress.stepprocess").empty()}},this.each(function(){var f=a.data(this,"stepprocess");f?f.settings=a.extend({},d,b):f=a.data(this,"stepprocess",new c(this,e))})},a.fn.swaplist=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="swaplist",e={available:null,selected:null,additional:null,availableClass:".available",selectedClass:".selected",additionalClass:".full-access",availableBtn:".btn-moveto-selected",selectedBtnLeft:".btn-moveto-left",selectedBtnRight:".btn-moveto-right",additionalBtn:".btn-moveto-selected",template:'<ul data-swap-handle=".handle">{{#dataset}}{{#text}}<li{{#value}} data-value="{{value}}"{{/value}}{{#selected}} selected="selected"{{/selected}}{{#disabled}} class="is-disabled"{{/disabled}}><span class="handle" focusable="false" aria-hidden="true" role="presentation">&#8286;</span><div class="swaplist-item-content"><p>{{text}}</p></div></li>{{/text}}{{/dataset}}</ul>'},f=a.extend({},e,b);return c.prototype={init:function(){var b=this,c=b.settings;b.isTouch=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),b.isAdditional=a(c.additionalClass+" .listview",b.element).length>0,b.isTouch&&b.element.addClass("is-touch"),b.loadListview(),b.initDataset(),b.setElements(),b.isMultiSelectClass(),setTimeout(function(){b.makeDraggable(),b.handleEvents(),b.initSelected(c.availableClass),b.initSelected(c.additionalClass)},0)},loadListview:function(){var b,c,d,e,f=this,g=f.settings,h=[{dataset:g.available,class:g.availableClass},{dataset:g.selected,class:g.selectedClass},{dataset:g.additional,class:g.additionalClass}];for(b=0,c=h.length;b<c;b++)e=h[b],d=a(e.class+" .listview",f.element),!e.dataset&&d.length&&a("li",d).length?d.listview({selectable:"multiple"}):d.length&&d.listview({dataset:e.dataset||[],template:g.template,selectable:"multiple"})},setElements:function(){this.offset=null,this.containers=a(this.settings.availableClass+","+this.settings.selectedClass+","+this.settings.additionalClass,this.element),this.actionButtons=a(this.settings.availableBtn+","+this.settings.additionalBtn+","+this.settings.selectedBtnLeft+","+this.settings.selectedBtnRight,this.element),this.selectedButtons=a(this.settings.selectedBtnLeft+","+this.settings.selectedBtnRight,this.element),this.tabButtonsStr=this.settings.availableBtn+" "+this.settings.additionalBtn+" "+(this.selectedButtons.length>1?this.settings.selectedBtnRight:this.settings.selectedBtnLeft),this.dragElements="ul, li:not(.is-disabled)",this.dragStart="dragstart.swaplist touchstart.swaplist gesturestart.swaplist",this.dragEnterWhileDragging="dragenter.swaplist",this.dragOverWhileDragging="dragover.swaplist touchmove.swaplist gesturechange.swaplist",this.dragEnd="dragend.swaplist touchend.swaplist touchcancel.swaplist gestureend.swaplist",this.selections={items:[],owner:null,related:null,droptarget:null,isInSelection:null,isHandle:null,placeholder:null,placeholderTouch:null,dragged:null,draggedIndex:null},this.settings.numOfSelectionsClass="num-of-selections",this.settings.itemContentClass="swaplist-item-content",this.settings.itemContentTempl=a('<div><p><span class="'+this.settings.numOfSelectionsClass+'">###</span> '+Locale.translate("ItemsSelected")+"</p><div/>")},isMultiSelectClass:function(){var b,c,d,e=this.settings,f=[e.availableClass,e.selectedClass,e.additionalClass];for(b=0,c=f.length;b<c;b++)d=a(f[b]+" .listview",this.element),a("li",d).length||d.addClass("is-muliselect")},initSelected:function(b){var c;b=this.isjQuery(b)?b:a(b,this.element),b.length&&(c=a(".listview",b).data("listview"),a("li[selected]",b).each(function(){a(this).removeAttr("selected"),c.select(a(this))}),this.moveElements(b,this.settings.selectedClass),a(this.settings.selectedClass+" li:last-child",this.element).blur())},moveElements:function(b,c){var d,e,f,g,h=this;b="string"!=typeof b?b:a(b,h.element),c="string"!=typeof c?c:a(c,h.element),g=a(".listview",b).data("listview"),h.clearSelections(),h.selections.owner=b,h.selections.droptarget=c,h.isTouch?a.each(g.selectedItems,function(a,b){h.selections.items[a]=b.closest("li")}):h.selections.items=g.selectedItems,h.setSelectionsItems(h.selections.owner),h.unselectElements(g),h.selections.items.length&&(h.element.triggerHandler("beforeswap",[h.selections.itemsData]),d=a("ul",c),f=a("li",d).length,e=h.selections.items.length+f,a.each(h.selections.items,function(b,c){c=a(c),c.attr({"aria-posinset":f+b+1,"aria-setsize":e}),d.append(c),c.focus()}),h.afterUpdate(a(".listview",c).data("listview")))},unselectElements:function(b){a.each(b.selectedItems,function(a,c){b.select(c)})},isDragAndDropSupports:function(){var a=document.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},isMatchMediaSupports:function(){return void 0!==window.matchMedia||void 0!==window.msMatchMedia},viewport:function(){var a=window,b="inner";return"innerWidth"in window||(b="client",a=document.documentElement||document.body),{width:a[b+"Width"],height:a[b+"Height"]}},isMaxWidth:function(a){return this.isMatchMediaSupports()&&window.matchMedia("(max-width: "+a+"px)").matches||this.viewport().width<=a},makeDraggable:function(){var b=this,c=a("ul",b.element);b.isDragAndDropSupports&&(b.handle=c.first().attr("data-swap-handle"),b.handle=a(b.handle,c).length>0?b.handle:null,a(b.handle,c).addClass("draggable").off("mousedown.swaplist touchstart.swaplist").on("mousedown.swaplist touchstart.swaplist",function(){b.selections.isHandle=!0}).off("mouseup.swaplist touchend.swaplist").on("mouseup.swaplist touchend.swaplist",function(){b.selections.isHandle=!1}),b.targets=c.attr({"aria-dropeffect":"none"}),b.items=a("li:not(.is-disabled)",b.element).not("a[href], img").off("selectstart.swaplist").on("selectstart.swaplist",function(){return this.dragDrop&&this.dragDrop(),!1}).end().attr({draggable:!0}).addClass(b.handle?"":"draggable"))},getElementByTouchInList:function(b,c,d){var e=!1;return a(b).each(function(){var b=a(this),f=b.offset();c<=f.left||c>=f.left+b.outerWidth()||d<=f.top||d>=f.top+b.outerHeight()||(e=b)}),e},draggTouchElement:function(a,b){var c=a.originalEvent.changedTouches[0];b[0].style.top=c.pageY-this.offset.y+"px",b[0].style.left=c.pageX-this.offset.x+"px"},hasModifier:function(a){return a.ctrlKey||a.metaKey||a.shiftKey},addDropeffects:function(){this.targets.each(function(){a(this).attr({"aria-dropeffect":"move",tabindex:0})}),a.each(this.selections.items,function(b,c){a(c).attr({"aria-grabbed":!0,tabindex:0})})},clearDropeffects:function(){this.targets.attr({"aria-dropeffect":"none"}).removeAttr("tabindex"),a.each(this.selections.items,function(b,c){c=a(c),c.removeAttr("aria-grabbed"+(c.is(":focus")?"":" tabindex"))})},clearSelections:function(){this.selections.items=[],this.selections.itemsData=[],this.selections.owner=null,this.selections.related=null,this.selections.droptarget=null,this.selections.isInSelection=null,this.selections.dragged=null,this.selections.placeholder=null,this.selections.placeholderTouch=null,a("ul, li",this.element).removeClass("over"),a("#sl-placeholder-container, #sl-placeholder-touch, #sl-placeholder-touch2, #sl-placeholder").remove()},setSelectionsItems:function(b){b=this.isjQuery(b)?b:a(b,this.element);for(var c=a(".listview li",b),d=this.getDataList(b),e=0,f=c.length;e<f;e++){a(c[e]).is(".is-selected")&&this.selections.itemsData.push(d[e])}},initDataset:function(){var b=this.settings,c=[{type:"available",dataset:b.available,class:b.availableClass},{type:"selected",dataset:b.selected,class:b.selectedClass},{type:"additional",dataset:b.additional,class:b.additionalClass}];this.dataset={available:[],selected:[]},this.isAdditional&&(this.dataset.additional=[]);for(var d=0,e=c.length;d<e;d++)for(var f=c[d],g=a(f.class+" .listview li",this.element),h=0,i=g.length;h<i;h++){var j,k,l=a(g[h]);f.dataset?(j=JSON.parse(JSON.stringify(f.dataset[h])),delete j.selected):(j={text:a.trim(a(".swaplist-item-content",l).text())},(k=l.attr("data-value"))&&(j.value=k)),this.dataset[f.type]&&(j.node=l,this.dataset[f.type].push(j))}},getDataList:function(b){var c=this.settings,d=this.dataset;return b=this.isjQuery(b)?b:a(b,this.element),b.is(c.additionalClass)?d.additional:b.is(c.selectedClass)?d.selected:b.is(c.availableClass)?d.available:[]},arrayIndexMove:function(a,b,c){a.splice(c,0,a.splice(b,1)[0])},syncDataset:function(b,c){for(var d=a(".listview li",c),e=this.getDataList(b),f=this.getDataList(c),g=0,h=this.selections.items.length;g<h;g++)for(var i=this.selections.items[g],j=0,k=d.length;j<k;j++)if(a(d[j]).is(i))for(var l=0,m=e.length;l<m;l++){var n=e[l];if(n.node&&n.node.is(i)){f.push(n),e.splice(l,1),this.arrayIndexMove(f,f.length-1,j);break}}},isjQuery:function(a){return a&&(a instanceof jQuery||a.constructor.prototype.jquery)},updateAttributes:function(b){var c=a("li",b),d=c.length;c.each(function(b){a(this).attr({"aria-posinset":b+1,"aria-setsize":d})})},afterUpdate:function(b){var c=this;setTimeout(function(){b&&(c.selections.placeholder&&(b.select(c.selections.placeholder),c.selections.placeholder.focus()),c.unselectElements(b),c.syncDataset(c.selections.owner,c.selections.droptarget),c.updateAttributes(a(".listview",c.selections.owner)),c.updateAttributes(a(".listview",c.selections.droptarget)),c.selections.items.length&&c.element.triggerHandler("swapupdate",[c.selections.itemsData])),c.clearDropeffects(),c.clearSelections(),c.items.removeClass("is-dragging is-dragging-touch")},100)},getItems:function(b){return b=this.isjQuery(b)?b:a(b,this.element),this.getDataList(b)},getAvailable:function(){return this.getDataList(this.settings.availableClass)},getSelected:function(){return this.getDataList(this.settings.selectedClass)},getAdditional:function(){return this.getDataList(this.settings.additionalClass)},draggedMakeSelected:function(b,c){var d=this,e=!1;d.selections.isInSelection||(a.each(b.selectedItems,function(a,b){if(c[0]===b[0])return e=!0,!1}),e||(b.select(c),d.selections.isInSelection=!0))},updateDataset:function(b){var c,d,e,f,g,h=this,i=h.settings,j=[{type:"available",dataset:b.available,class:i.availableClass},{type:"selected",dataset:b.selected,class:i.selectedClass},{type:"additional",dataset:b.additional,class:i.additionalClass}];for(c=0,d=j.length;c<d;c++)f=j[c],e=a(f.class+" .listview",h.element),(g=e.data("listview"))&&(g.unselectRowsBetweenIndexes([0,a("li",e).length-1]),i[f.type]=f.dataset||[],g.loadData(i[f.type]));h.initDataset(),h.makeDraggable(),h.initSelected(i.availableClass),h.initSelected(i.additionalClass)},unbind:function(){return this.actionButtons.off("click.swaplist"),this.containers.off("keydown.swaplist"),this.selectedButtons.off("keydown.swaplist"),this.element.off(this.dragStart+" "+this.dragEnterWhileDragging+" "+this.dragOverWhileDragging+" "+this.dragEnd,this.dragElements),a("#sl-placeholder-container, #sl-placeholder-touch, #sl-placeholder-touch2, #sl-placeholder").remove(),this},updated:function(){return this.unbind().init()},destroy:function(){this.unbind(),a.removeData(this.element[0],d)},handleEvents:function(){var b=this,c=b.settings,d=b.selections;b.actionButtons.off("click.swaplist").on("click.swaplist",function(){var d=a(this),e=d.closest(".card");e.is(c.availableClass)?b.moveElements(c.availableClass,c.selectedClass):e.is(c.additionalClass)?b.moveElements(c.additionalClass,c.selectedClass):e.is(c.selectedClass)&&(d.is(c.selectedBtnLeft)?b.moveElements(c.selectedClass,c.availableClass):d.is(c.selectedBtnRight)&&b.moveElements(c.selectedClass,c.additionalClass))}),b.containers.on("keydown.swaplist",function(d){var e=a(this);d=d||window.event,77===d.keyCode&&b.hasModifier(d)&&(!e.is(c.selectedClass)||e.is(c.selectedClass)&&1===b.selectedButtons.length?e.find(b.actionButtons).trigger("click.swaplist"):b.selectedButtons.first().focus(),d.preventDefault())}),b.selectedButtons.on("keydown.swaplist",function(c){var d,e,f=a(this);c=c||window.event,13!==c.keyCode&&32!==c.keyCode||(f.trigger("click.swaplist"),c.preventDefault()),(37===c.keyCode||39===c.keyCode)&&b.selectedButtons.length>1&&(d=b.selectedButtons.index(this),e=37===c.keyCode?d>0?d-1:b.selectedButtons.length-1:d<b.selectedButtons.length-1?d+1:0,b.selectedButtons[e].focus())}),b.element.on("keydown.swaplist",b.tabButtonsStr,function(b){var c=a(this);9!==(b.keyCode||b.which)||b.shiftKey||(a("li:first-child",c.closest(".card")).focus(),b.preventDefault())}),b.element.on("mousedown.swaplist",b.dragElements,function(c){if(b.handle){a(c.target).closest("li").attr({draggable:a(c.target).is(".draggable")})}c.stopPropagation()}).onTouchClick("swaplist",b.dragElements).on(b.dragStart,b.dragElements,function(e){if(e.stopImmediatePropagation(),b.handle&&!d.isHandle)return void e.stopPropagation();var f,g,h,i=a(e.target).closest("li"),j=a(".listview",i.closest(".card")).data("listview");if(j){if(b.isTouch||b.draggedMakeSelected(j,i),b.clearSelections(),d.owner=i.closest(".card"),d.dragged=i,d.draggedIndex=i.index(),d.placeholder=i.clone(!0),d.placeholder.attr("id","sl-placeholder"),b.setSelectionsItems(d.owner),d.items=j.selectedItems,b.element.triggerHandler("beforeswap",[d.itemsData]),a("."+c.numOfSelectionsClass,c.itemContentTempl).html(d.items.length),b.addDropeffects(),b.isTouch){f=i[0].getBoundingClientRect(),g=e.originalEvent.changedTouches[0],b.offset={x:g.pageX-f.left,y:g.pageY-f.top};for(var k=0,l=b.containers.length;k<l;k++)b.containers[k].style.zIndex="1";d.placeholderTouch=d.dragged.clone(!0),d.items.length>1&&!a("#sl-placeholder-touch2").length&&d.dragged.clone().addClass("is-dragging-touch").attr("id","sl-placeholder-touch2").insertBefore(d.dragged).hide(),d.placeholderTouch.attr("id","sl-placeholder-touch").removeClass("is-selected").hide(),h=b.element.is(".one-third")&&b.isMaxWidth(766)?b.element.parent():b.element,h.prepend('<ul id="sl-placeholder-container"></ul>'),a("#sl-placeholder-container").append(d.placeholderTouch),a("#sl-placeholder-container")[0].style.width=d.owner.width()+"px",a("#sl-placeholder-touch")[0].style.width=d.owner.width()+"px",b.draggTouchElement(e,d.placeholderTouch)}else d.dragged.addClass("is-dragging"),e.originalEvent.dataTransfer.setData("text",""),d.items.length>1&&a("."+c.itemContentClass,d.dragged).html(c.itemContentTempl.html());e.stopPropagation()}}).on(b.dragEnterWhileDragging,b.dragElements,function(c){d.dragged&&(b.element.triggerHandler("draggingswap",[d.itemsData]),d.related=c.target,a("ul, li",b.element).removeClass("over"),a(c.target).closest("ul, li").addClass("over"),d.droptarget=a(d.related).closest(".card"),a('[aria-grabbed="true"]',b.element).not(d.dragged).slideUp(),c.stopPropagation())}).on(b.dragOverWhileDragging,b.dragElements,function(e){if(d.dragged){var f,g=a(this),h=a(".listview",d.dragged.closest(".card")).data("listview");if(b.isTouch){if(b.handle&&!d.isHandle)return;d.isInSelection||(b.draggedMakeSelected(h,d.dragged),d.items=h.selectedItems,a("."+c.numOfSelectionsClass,c.itemContentTempl).html(d.items.length)),f=e.originalEvent.touches[0],g=b.getElementByTouchInList(a("ul, li",b.element),f.pageX,f.pageY)||g,d.dragged.addClass("is-dragging"),d.placeholderTouch.addClass("is-dragging is-dragging-touch"),d.placeholderTouch.show(),a('[aria-grabbed="true"]',b.element).not(d.dragged).not(d.placeholderTouch).not("#sl-placeholder-touch2").slideUp(),d.items.length>1&&(a("."+c.itemContentClass,d.placeholderTouch.add("#sl-placeholder-touch2")).html(c.itemContentTempl.html()),a("#sl-placeholder-touch2").show(),d.dragged.hide()),b.draggTouchElement(e,d.placeholderTouch),b.element.triggerHandler("draggingswap",[d.itemsData]),d.related=g,a("ul, li",this.element).removeClass("over"),g.closest("ul, li").addClass("over"),d.droptarget=d.related.closest(".card")}e.preventDefault(),e.stopPropagation()}}).on(b.dragEnd,b.dragElements,function(e){if(d.dragged){var f=a(d.related).closest("li"),g=a("ul",d.droptarget),h=a("li",g).length,i=d.items.length+h;if(b.unselectElements(a(".listview",d.owner).data("listview")),a.each(d.items,function(b,c){if(c=a(c),h&&!a(d.related).is("ul")){var e=f.index()<d.draggedIndex,j=e?c:a(d.items[d.items.length-1-b]),k=f.index()+(e?b+1:b+2);c.attr({"aria-posinset":k,"aria-setsize":i}),f[e?"before":"after"](j)}else c.attr({"aria-posinset":h+b+1,"aria-setsize":i}),g.append(c);c.focus()}),
d.items.length>1&&(a("."+c.itemContentClass,d.dragged).html(a("."+c.itemContentClass,d.placeholder).html()),b.isTouch&&d.dragged.show()),b.isTouch)for(var j=0,k=b.containers.length;j<k;j++)b.containers[j].style.zIndex="";d.isHandle=null,a('[aria-grabbed="true"]',b.element).show(),b.afterUpdate(a(".listview",d.droptarget).data("listview")),e.preventDefault(),e.stopPropagation()}})}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.toast=function(b){"use strict";function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="toast",e={title:"(Title)",message:"(Content)",position:"top right",audibleOnly:!1,progressBar:!0,timeout:6e3},f=a.extend({},e,b);return c.prototype={init:function(){this.settings=f,this.show()},show:function(){var b,c=this,d=c.settings,e=parseFloat(d.timeout),f=!1,g=100,h=a("#toast-container"),i=a('<div class="toast"><span class="toast-title">'+d.title+'</span><span class="toast-message">'+d.message+"</span></div>"),j=a('<button type="button" class="btn-icon btn-close" title="'+Locale.translate("Close")+'" aria-hidden="true">'+a.createIcon("close")+'<span class="audible"> '+Locale.translate("Close")+"</span></button>"),k=a('<div class="toast-progress"></div>');h.length||(h=a('<div id="toast-container" class="toast-container" aria-relevant="additions" aria-live="polite"></div>').appendTo("body")),h.removeClass("toast-top-left toast-top-right toast-bottom-right toast-bottom-left").addClass("toast-"+d.position.replace(" ","-")),d.timeout=d.audibleOnly?100:d.timeout,b=new a.fn.timer(function(){c.remove(i)},d.timeout),d.progressBar&&i.append(k),a(b.event).on("update",function(a,b){g=(e-b.counter)/e*100,Locale.isRTL()&&(g=100-g),d.progressBar&&(k[0].style.width=g+"%")}),h.append(i),i.addClass(d.audibleOnly?"audible":"effect-scale"),i.append(j),a(document).on("keydown keyup",function(a){a=a||window.event,a.ctrlKey&&a.altKey&&80===a.keyCode&&(f="keydown"===a.type,b[f?"pause":"resume"]())}),i.on("mousedown.toast touchstart.toast mouseup.toast touchend.toast",function(a){f=!!/mousedown|touchstart/i.test(a.type),b[f?"pause":"resume"]()}),j.on("click",function(){b.cancel(),c.remove(i)})},remove:function(a){if(this.settings.audibleOnly)return void a.remove();a.addClass("effect-scale-hide"),setTimeout(function(){a.remove()},500)},destroy:function(){a("#toast-container").remove(),a.removeData(this.element[0],d)}},this.each(function(){var g=a.data(this,d);g?(g.settings=a.extend({},e,b),g.show()):g=a.data(this,d,new c(this,f))})},a.fn.tabs=function(b){function c(b){this.settings=a.extend({},g),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="tabs",e={addTabButton:!1,addTabButtonCallback:null,ajaxOptions:null,containerElement:null,changeTabOnHashChange:!1,hashChangeCallback:null,lazyLoad:!0,moduleTabsTooltips:!1,source:null,sourceArguments:{},tabCounts:!1,verticalResponsive:!1},f=["horizontal","vertical","module-tabs","header-tabs"],g=a.extend({},e,b);return c.prototype={init:function(){return this.setup().build().setupEvents()},setup:function(){return this.tabsIndex=a(".tab-container").index(this.element),this},build:function(){function b(){var b,c=a(this),e=c.parent(),f=e.data("popupmenu"),g=c.attr("href");if("#"===g.substr(0,1)){if(void 0!==g&&"#"!==g){if(b=a(g),e.is(":not(.has-popupmenu)")&&!b.length)return;c.data("panel-link",b),b.data("tab-link",c),d.panels=d.panels.add(b)}f&&f.menu.children("li").each(function(){var b=a(this),c=b.children("a"),e=c.attr("href"),f=a(e);if(c.data("panel-link",f),f.data("tab-link",c),d.panels=d.panels.add(f),d.anchors=d.anchors.add(c),b.hasClass("dismissible")){var g=b.children(".icon");g.length||(g=a.createIconElement({icon:"close",classes:"icon close"})),g.detach().appendTo(c)}}).on("click.popupmenu",".icon",function(b){var c=a(this),e=c.closest("li");e.is(".dismissible")&&c.is(".icon")&&(b.preventDefault(),b.stopPropagation(),d.closeDismissibleTab(e.children("a").attr("href")))})}}var c,d=this,e=!1;c=this.element.next(".tab-panel-container"),c.length||(c=this.element.children(".tab-panel-container"),this.isVerticalTabs()||(e=!0));var g=a("body > .page-container, .application-menu + .page-container");this.element.closest(".header").length>0&&g.length&&(c=g),this.element.next(".application-menu").length&&(c=this.element.next().next(".page-container"),e=!1),this.settings.containerElement&&a(this.settings.containerElement).length&&(c=a(this.settings.containerElement),e=!1),c&&c.length||(c=a('<div class="tab-panel-container"></div>'),e=!0),c[0].classList.contains("tab-panel-container")||c[0].classList.add("tab-panel-container"),e&&c.insertAfter(this.element),this.container=c;var h=this.element.children(".tab-list-container");!h.length&&this.isScrollableTabs()&&(h=a('<div class="tab-list-container"></div>').prependTo(this.element)),h.length&&(this.tablistContainer=h);var i=!0,j=this.element.closest(".header");f.forEach(function(a,b){d.element.hasClass(f[b])&&(i=!1)}),i&&(j.length?d.element.addClass("header-tabs"):d.element.addClass("horizontal")),d.settings.tabCounts&&d.element.addClass("has-counts"),this.tablist=this.element.children(".tab-list"),this.tablist.length||(this.tablistContainer&&(this.tablist=this.tablistContainer.children(".tab-list")),this.tablist.length||(this.tablist=a('<ul class="tab-list"></ul>'),this.tablistContainer?this.tablist.appendTo(this.tablistContainer):this.tablist.appendTo(this.element))),this.tablistContainer&&(this.tablist.parent().is(this.tablistContainer)||this.tablistContainer.append(this.tablist),this.tablistContainer.on("mousewheel.tabs",function(a){a.deltaY&&(this.scrollLeft+=a.deltaY)})),d.tablist.attr({class:"tab-list",role:"tablist","aria-multiselectable":"false"}),this.checkResponsive(),this.renderHelperMarkup(),d.anchors=d.tablist.children("li:not(.separator)").children("a"),d.anchors.each(function(){var b=a(this);b.attr({role:"tab","aria-expanded":"false","aria-selected":"false",tabindex:"-1"}).parent().attr("role","presentation").addClass("tab"),b.parent().hasClass("dismissible")&&!b.parent().children(".icon").length&&a.createIconElement({icon:"close",classes:"icon close"}).insertAfter(b);var c=b.nextAll("ul").first();if(c.length>0){c.addClass("dropdown-tab");b.parent().addClass("has-popupmenu").popupmenu({menu:c,trigger:"click",attachToBody:!0}),b.removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected"),b.parent().children(".icon.icon-more").length||a.createIconElement({classes:"icon-more",icon:"dropdown"}).insertAfter(b)}d.settings.tabCounts&&0===a(this).find(".count").length&&a(this).prepend('<span class="count">0 </span>'),d.settings.moduleTabsTooltips&&b.on("beforeshow.toolbar",function(){return"yes"===b.data("cutoffTitle")}).tooltip({content:""+b.text().trim()})}),d.panels=a(),d.anchors.each(b),d.panels.addClass("tab-panel").attr({role:"tabpanel"}).find("h3:first").attr("tabindex","0"),d.panels.appendTo(d.container);var k=":not(.separator):not(.is-disabled):not(.is-hidden)",l=this.tablist.children("li"+k),m=this.tablist.children("li.is-selected"+k),n=m.children("a");if(d.nestedTabControls=d.panels.find(".tab-container"),l.length){if(this.settings.changeTabOnHashChange){var o=window.location.hash;if(o&&o.length){var p=l.find('a[href="'+o+'"]');p.length&&(m=p.first().parent(),n=m.children("a"))}}m.length||(m=l.not(".add-tab-button, .application-menu-trigger").first(),n=m.children("a")),m.length&&this.activate(n.attr("href"))}return this.isModuleTabs()&&this.element.children(".toolbar").length&&this.element.addClass("has-toolbar"),this.setOverflow(),this.hasSquareFocusState()&&this.positionFocusState(n),this.hasAnimatedBar()&&(this.animatedBar.addClass("no-transition"),this.focusBar(void 0,function(){setTimeout(function(){d.animatedBar.removeClass("no-transition")},0)})),this.tablistContainer&&(this.tablistContainer.on("scroll.tabs",function(){d.renderEdgeFading()}),this.renderEdgeFading()),this},renderHelperMarkup:function(){var b=this.tablistContainer||this.tablist;this.isModuleTabs()&&(b=this.tablist),this.hasSquareFocusState()?(this.focusState=this.element.find(".tab-focus-indicator"),this.focusState.length||(this.focusState=a('<div class="tab-focus-indicator" role="presentation"></div>').insertBefore(this.tablist))):this.focusState&&this.focusState.length&&(this.focusState.off().remove(),this.focusState=void 0),this.hasAnimatedBar()?(this.animatedBar=this.element.find(".animated-bar"),this.animatedBar.length||(this.animatedBar=a('<div class="animated-bar" role="presentation"></div>')),this.animatedBar.insertBefore(this.tablist)):this.animatedBar&&this.animatedBar.length&&(this.animatedBar.off().remove(),this.animatedBar=void 0),this.moreButton||(this.moreButton=a()),this.isVerticalTabs()?this.moreButton.length&&(this.moreButton.off().remove(),this.moreButton=a()):(this.moreButton.length||(this.moreButton=b.next(".tab-more")),this.moreButton.length||(this.moreButton=a("<div>").attr({class:"tab-more"}),this.moreButton.append(a('<span class="more-text">').text(Locale.translate("More"))),this.moreButton.append(a.createIconElement({classes:"icon-more",icon:"dropdown"}))),b.after(this.moreButton));var c=this.tablist.find(".application-menu-trigger");return this.isModuleTabs()?c.length||(c=a('<li class="tab application-menu-trigger"><a href="#"><span class="icon app-header"><span class="one"></span><span class="two"></span><span class="three"></span></span><span>Menu</span></a></tab>'),this.tablist.prepend(c)):this.isVerticalTabs()&&c.length&&c.off().remove(),this.settings.addTabButton?this.addTabButton&&this.addTabButton.length||(this.addTabButton=a('<div class="add-tab-button" tabindex="0" role="button"><span aria-hidden="true" role="presentation">+</span><span class="audible">'+Locale.translate("AddNewTab")+"</span></div>"),this.addTabButton.insertAfter(this.moreButton),this.element.addClass("has-add-button")):this.addTabButton&&this.addTabButton.length&&(this.addTabButton.remove(),this.addTabButton=void 0,this.element.removeClass("has-add-button")),this},setupEvents:function(){function b(b){var c=a(b.currentTarget);if(!0===this.wasTapped)return void(this.wasTapped=!1);"touchend"===b.type&&(this.wasTapped=!0),"#"===c.attr("href").substr(0,1)&&b.preventDefault()}function c(b){var c=a(this);if(!c.is("[disabled]")&&!c.parent().hasClass("is-disabled")){var d=a(c).parent();d.hasClass("dismissible")&&(b.preventDefault(),b.stopPropagation(),g.closeDismissibleTab(d.children("a").attr("href")))}}function d(){a(this).parent().removeClass("is-focused")}function e(b,c){function d(a){a.altKey&&e.is(".dismissible")&&g.closeDismissibleTab(f.attr("href"))}var e=a(c),f=e.children("a");e.data("popupmenu").menu.on("keydown.popupmenu","a",function(a){switch(a.which){case 27:e.addClass("is-selected"),f.focus();break;case 8:case 46:d(a)}}),e.on("selected.tabs",function(b,c){var d=a(this),e=a(c).attr("href");return g.activate(e),g.hasSquareFocusState()&&g.positionFocusState(f),g.hasAnimatedBar()&&g.focusBar(d),f.focus(),g.scrollTabList(d),d.addClass("is-selected"),!1})}function f(b,c){a(c).children("a").on("keydown.tabs",function(a){g.handleDismissibleTabKeydown(a)})}var g=this,h=g.element.closest(".modal");return h.length&&h.on("afteropen",function(){g.hasAnimatedBar()&&g.focusBar()}),this.tablist.on("mousedown.tabs","> li",function(b){if(g.handleAddFocusData(b,a(this)),3!==b.which)return g.handleTabClick(b,a(this))}).on("click.tabs","a",b).on("click.tabs",".icon",c).on("focus.tabs","a",function(b){return g.handleTabFocus(b,a(this))}).on("blur.tabs","a",d).on("keydown.tabs","a",function(a){return g.handleTabKeyDown(a)}),g.tablist.find("li").filter(".has-popupmenu").each(e),g.tablist.find("li").filter(".dismissible").each(f),this.isResponsiveVerticalTabs()||this.setupHelperMarkupEvents(),this.panels.on("keydown.tabs",function(a){g.handlePanelKeydown(a)}),this.element.on("focusout.tabs",function(){var b=!a.contains(g.element[0],document.activeElement),c=0===g.tablist.children(".has-popupmenu.is-open").length;b&&c&&!g.moreButton.is(".is-selected, .popup-is-open")&&g.hideFocusState()}).on("updated.tabs",function(){g.updated()}).on("activated.tabs",function(a){a.stopPropagation()}).on("add.tabs",function(a,b,c,d){g.add(b,c,d)}).on("remove.tabs",function(a,b){g.remove(b)}),a("body").on("resize.tabs"+this.tabsIndex,function(){g.handleResize()}),g.handleResize(!0),this},setupHelperMarkupEvents:function(){var b=this;this.moreButton.onTouchClick("tabs").on("click.tabs",function(a){b.handleMoreButtonClick(a)}).on("keydown.tabs",function(a){b.handleMoreButtonKeydown(a)}).on("focus.tabs",function(a){b.handleMoreButtonFocus(a)}).on("mousedown.tabs",function(c){b.handleAddFocusData(c,a(this))}),this.settings.addTabButton&&this.addTabButton.onTouchClick("tabs").on("click.tabs",function(){b.handleAddButton()}).on("keydown.tabs",function(a){b.handleAddButtonKeydown(a)}).on("focus.tabs",function(a){b.handleAddButtonFocus(a)})},removeHelperMarkupEvents:function(){return this.moreButton&&this.moreButton.length&&this.moreButton.offTouchClick("tabs").off("click.tabs keydown.tabs focus.tabs mousedown.tabs"),this.addTabButton&&this.addTabButton.length&&this.addTabButton.offTouchClick("tabs").off("click.tabs keydown.tabs focus.tabs"),this},handleAddFocusData:function(a,b){var c=b;if(c.is(".is-disabled"))return a.preventDefault(),!1;c.is(this.moreButton)||(c=c.children("a")),this.hideFocusState(),c.data("focused-by-click",!0)},handleTabClick:function(b,c){if(this.element.is(".is-disabled")||c&&(c.is(".is-disabled")||c.is(".separator")))return b.stopPropagation(),b.preventDefault(),!1;if(this.handleAppMenuTabKeydown(b)){var d=c.children("a");if(d.data("focused-by-click",!0),this.popupmenu&&this.popupmenu.element.hasClass("is-open")&&this.popupmenu.close(),c.is(".has-popupmenu"))return void this.positionFocusState(d);var e=d.attr("href");return c.is(".add-tab-button")&&(d=this.handleAddButton(),c=d.parent(),e=d.attr("href"),this.element.trigger("tab-added",[d])),2===b.which?(c.is(".dismissible")&&a(b.target).is(".close")&&this.closeDismissibleTab(e),void b.preventDefault()):(this.activate(e),this.changeHash(e),this.hasSquareFocusState()&&this.focusState.removeClass("is-visible"),d.focus(),this.isScrollableTabs()&&this.scrollTabList(c),this.focusBar(c),this.positionFocusState(d),(!0!==this.settings.lazyLoad||!this.isURL(e))&&void 0)}},handleMoreButtonClick:function(a){if(this.element.is(".is-disabled")||this.moreButton.is(".is-disabled"))return a.preventDefault(),a.stopPropagation(),!1;this.moreButton.data("focused-by-click",!0),this.container.hasClass("has-more-button")||a.stopPropagation(),this.moreButton.hasClass("popup-is-open")?(this.popupmenu.close(),this.moreButton.removeClass("popup-is-open")):this.buildPopupMenu(),this.hideFocusState()},handleTabFocus:function(b,c){if(this.element.is(".is-disabled"))return b.preventDefault(),!1;var d=c.parent(),e=c.data("focused-by-click"),f=void 0===e||e&&!1===e;a.removeData(c[0],"focused-by-click"),this.isTabOverflowed(d)?(this.buildPopupMenu(c.attr("href")),this.moreButton.addClass("is-focused"),this.positionFocusState(this.moreButton)):(d.addClass("is-focused"),this.positionFocusState(c,f))},handleMoreButtonFocus:function(b){if(this.element.is(".is-disabled"))return void b.preventDefault();var c=this.moreButton.data("focused-by-click"),d=c&&!1===c;a.removeData(this.moreButton[0],"focused-by-click"),this.hasSquareFocusState()&&(this.focusState.removeClass("is-visible"),this.positionFocusState(this.moreButton,d))},handleTabKeyDown:function(b){function c(){return a.inArray(b.which,j)>-1}function d(a){b.preventDefault(),setTimeout(function(){i.buildPopupMenu(a)},0)}function e(){for(var a=o.index(m)-1;a>-1&&!k;){if(o.eq(a).is(l))return o.eq(a);a-=1}if(i.settings.addTabButton)return i.addTabButton;var b=i.tablist.children("li"+l).last();return i.hasMoreButton()&&i.isScrollableTabs()&&d(b.find("a").attr("href")),b}function f(){for(var a=o.index(m)+1;a<o.length&&!k;){if(o.eq(a).is(l))return o.eq(a);a++}var b=i.tablist.children("li"+l).first();return i.hasMoreButton()&&i.isScrollableTabs()?(d(b.find("a").attr("href")),b):i.settings.addTabButton?i.addTabButton:b}function g(){(n.attr("ng-click")||n.attr("data-ng-click"))&&n.click()}function h(){if(m.hasClass("has-popupmenu"))return void m.data("popupmenu").open();var a=n.attr("href");m.is(".add-tab-button")&&(n=i.handleAddButton(),m=n.parent(),a=n.attr("href"),i.element.trigger("tab-added",[n])),i.activate(a),i.changeHash(a),i.focusBar(m),g(),n[0].focus(),i.hideFocusState(),i.handleOutboundLink(a)}if(this.element.is(".is-disabled"))return b.preventDefault(),!1;if(!(b.shiftKey||b.ctrlKey||b.metaKey||b.altKey&&8!==b.which)){var i=this,j=[8,13,32];if(!(b.which<32&&!c()||b.which>46)){if(c()){if(!this.handleAppMenuTabKeydown(b))return}var k,l=":not(.separator):not(.is-disabled):not(:hidden)",m=a(b.currentTarget).parent(),n=m.children("a"),o=i.tablist.children("li"+l),p=Locale.isRTL();switch(b.which){case 8:return void(b.altKey&&m.is(".dismissible")&&(b.preventDefault(),i.closeDismissibleTab(n.attr("href"))));case 13:case 32:return h(),!1;case 38:k=e(),b.preventDefault();break;case 37:k=p?f():e(),b.preventDefault();break;case 40:k=f(),b.preventDefault();break;case 39:k=p?e():f(),b.preventDefault()}if(k){var q=k.is(".add-tab-button"),r=q?k:k.children("a");if(this.isTabOverflowed(k))return d(k.children("a").attr("href"));q?i.addTabButton.focus():r.focus(),this.isScrollableTabs()&&this.scrollTabList(r),i.hasSquareFocusState()&&i.positionFocusState(r,!0)}}}},handleDismissibleTabKeydown:function(b){var c=b.which,d=a(b.target);if(d.is("a")&&(d=d.parent()),b.altKey&&46===c){if(d.children("a").is("[disabled]")||d.hasClass("is-disabled"))return;b.preventDefault(),this.closeDismissibleTab(d.children("a").attr("href"))}},handleAppMenuTabKeydown:function(b){var c=a(b.target);if(!c.parent().is(".application-menu-trigger")&&!c.is(".application-menu-trigger"))return!0;var d=a("#application-menu");return!!d.length&&(b.preventDefault(),this.hideFocusState(),d.hasClass("is-open")?(d.trigger("close-applicationmenu"),!1):(d.trigger("open-applicationmenu"),!1))},handleMoreButtonKeydown:function(a){function b(){a.preventDefault(),d.buildPopupMenu(d.tablist.find(".is-selected").children("a").attr("href")),d.positionFocusState(d.moreButton,!0)}function c(){a.preventDefault(),d.findLastVisibleTab()}if(this.element.is(".is-disabled"))return a.preventDefault(),!1;var d=this,e=Locale.isRTL();switch(a.which){case 37:if(e){b();break}c();break;case 38:c();break;case 13:case 32:a.preventDefault();case 39:if(e){c();break}b();break;case 40:b()}},handlePanelKeydown:function(b){var c=b.which,d=a(b.target),e=this.anchors.filter("#"+d.attr("id"));return this.anchors.filter("#"+d.attr("id")).parent().is(".dismissible")&&b.altKey&&46===c?(b.preventDefault(),this.closeDismissibleTab(e.attr("href"))):b.ctrlKey&&38===c&&a.contains(document.activeElement,d[0])?(b.preventDefault(),this.activate(e.attr("href"))):void 0},handleAddButton:function(){var b=this.settings.addTabButtonCallback;if(b&&"function"==typeof b){var c=b();return this.anchors.filter('[href="#'+c+'"]')}var d=this.tablist.children().index(this.addTabButton),e=function(){var b=a('[id^="new-tab"]');return b.length?"new-tab-"+b.length:"new-tab-0"}(),f=function(a){var b=a.toString().split("-");return b.forEach(function(a,c){b[c]=a.charAt(0).toUpperCase()+a.slice(1)}),b.join(" ")}(e),g={name:f,content:"&nbsp;",isDismissible:!0};d<0&&(d=this.tablist.find("li:not(.separator)").length);var h=this.element.triggerHandler("before-tab-added",[e,g,d]);return h?(h.newId&&h.newId.length&&"string"==typeof h.newId&&(e=h.newId),h.settings&&"object"==typeof h.settings&&(g=h.settings),isNaN(h.newIndex)||(d=h.newIndex),this.add(e,g,d),this.anchors.filter('[href="#'+e+'"]')):(this.add(e,g,d),this.anchors.filter('[href="#'+e+'"]'))},handleAddButtonKeydown:function(a){function b(){if(a.preventDefault(),d=e.tablist.find(g).last(),e.isTabOverflowed(d))return e.buildPopupMenu(d.children("a").attr("href")),void e.positionFocusState(e.moreButton,!0)}function c(){d=e.tablist.find(g).first()}if(this.element.is(".is-disabled"))return a.preventDefault(),!1;var d,e=this,f=Locale.isRTL(),g="li:not(.separator):not(.is-disabled):not(:hidden)";switch(a.which){case 37:if(f){c();break}b();break;case 38:b();break;case 13:case 32:return a.preventDefault(),this.handleAddButton();case 39:if(f){b();break}c();break;case 40:c();break;default:return}d.children("a").focus()},handleAddButtonFocus:function(){this.tablist.find("li:not(.separator)").add(this.moreButton).removeClass("is-focused"),this.addTabButton.addClass("is-focused"),this.positionFocusState(this.addTabButton,!0)},handleResize:function(a){a||this.checkResponsive(),this.setOverflow();var b=this.tablist.find(".is-selected");(!b.length||this.moreButton.is(".is-selected")||this.isTabOverflowed(b))&&(b=this.moreButton),b.length?(this.focusBar(b),this.positionFocusState(b)):(this.defocusBar(),this.hideFocusState()),this.handleVerticalTabResize(),this.renderVisiblePanel(),this.renderEdgeFading()},checkResponsive:function(){function a(){c.removeHelperMarkupEvents(),c.renderHelperMarkup(),c.setupHelperMarkupEvents()}function b(){d.contains("is-in-responsive-mode")&&(d.add("vertical"),d.remove("is-in-responsive-mode"),d.remove("header-tabs"),d.remove("alternate"),a())}var c=this,d=c.element[0].classList;this.isResponsiveVerticalTabs()&&Soho.breakpoints.isBelow("phone-to-tablet")?function(){d.contains("is-in-responsive-mode")||(d.add("is-in-responsive-mode"),d.add("header-tabs"),d.add("alternate"),d.remove("vertical"),a())}():b()},handleVerticalTabResize:function(){if(this.isVerticalTabs()&&this.isNested()&&!this.isNestedInLayoutTabs()&&!this.isHidden()){var a=window.getComputedStyle(this.element[0]),b=a.getPropertyValue("height")+a.getPropertyValue("margin-top")+a.getPropertyValue("margin-bottom");this.tablist[0].style.height=b}},handleOutboundLink:function(a,b){if("#"===a.charAt(0))return!1;"/"!==a.charAt(0)||b&&!1!==b||(a=window.location.origin+a),window.location=a},hasAnimatedBar:function(){return!this.isModuleTabs()&&!this.isVerticalTabs()},hasSquareFocusState:function(){return!0},hasMoreButton:function(){return this.element[0].classList.contains("has-more-button")},isInResponsiveMode:function(){return this.element[0].classList.contains("is-in-responsive-mode")},isModuleTabs:function(){return this.element.hasClass("module-tabs")},isVerticalTabs:function(){return this.element.hasClass("vertical")},isResponsiveVerticalTabs:function(){return!0===this.settings.verticalResponsive},isHeaderTabs:function(){return this.element.hasClass("header-tabs")},isScrollableTabs:function(){return!this.isModuleTabs()&&!this.isVerticalTabs()},isHidden:function(){return this.element.is(":hidden")},isNested:function(){return this.element.closest(".tab-panel").length},isActive:function(a){return!(!a||!a.length||1===a.length&&a.indexOf("#")<1)&&this.getPanel(a)[0].classList.contains("can-show")},isNestedInLayoutTabs:function(){var a=this.element.closest(".module-tabs").length,b=this.element.closest(".header-tabs").length,c=this.element.closest(".tab-panel-container").length;return a>0||b>0||c>0},isTab:function(a){return a instanceof jQuery&&a.length&&a.is("li.tab")},isAnchor:function(a){return a instanceof jQuery&&a.length&&a.is("a")},getAnchor:function(a){return this.isAnchor(a)?a:(-1===a.indexOf("#")&&"/"!==a.charAt(0)&&(a="#"+a),this.anchors.filter('[href="'+a+'"]'))},getPanel:function(b){return this.isTab(b)&&(b=b.children("a")),this.isAnchor(b)&&(b=b.attr("href")),b&&""!==b&&"#"!==b?this.panels.filter('[id="'+b.replace(/#/g,"")+'"]'):a()},getMenuItem:function(a){return this.isAnchor(a)&&(a=a.attr("href")),-1===a.indexOf("#")&&(a="#"+a),this.moreMenu.children().children().filter('[data-href="'+a+'"]').parent()},getPreviousTab:function(a){for(var b=this.getTab(null,a),c="li:not(.separator):not(:hidden):not(.is-disabled)",d=this.tablist.find(c),e=d.eq(d.index(b)-1);e.length&&!e.is(c);)e=d.eq(d.index(e)-1);if(e.is(".has-popupmenu")){var f=e.data("popupmenu");f&&(e=f.menu.children("li").first())}return e},activatePreviousTab:function(a,b){var c=this.getTab(null,a);if(b&&b instanceof jQuery||(b=this.getPreviousTab(a)),!b.length)return this.hideFocusState(),this.defocusBar(),b;var d=b.children("a");return c.is(".is-selected")&&(this.activate(d.attr("href")),d.focus()),this.positionFocusState(d),this.focusBar(b),b},isURL:function(a){return!(!a||0===a.indexOf("#"))},activate:function(b){var c,d,e,f,g,h,i,j,k=this;if(k.isURL(b))return this.callSource(b,!0);c=k.getAnchor(b),d=c.parent(),e=k.getPanel(b),f=e[0],g=k.anchors.parents().filter(".is-selected");for(var l=0;l<k.panels.length;l++)k.panels[l].classList.contains("is-visible")&&(h=a(k.panels[l]));if(h||(h=k.panels),k.element.trigger("beforeactivate",[c])){if(e.length<1){if(this.settings.source)return this.callSource(b)}else h[0].classList.remove("can-show"),h[0].classList.remove("is-visible"),h.closeChildren(),k.element.trigger("activated",[c]),f.classList.add("can-show"),k.renderVisiblePanel(),f.offsetHeight,e.one(a.fn.transitionEndName()+".tabs",function(){k.element.trigger("afteractivated",[c])}),f.classList.add("is-visible");k.updateAria(c),g.add(this.moreButton).removeClass("is-selected"),d[0].classList.contains("tab")&&(i=d,j=d);var m,n=d.parents(".popupmenu");n.length&&(m=n.data("trigger"),m.length&&(i=m,j=m)),this.isTabOverflowed(j)&&(j=this.moreButton,i=this.moreButton),this.focusBar(j),i.addClass("is-selected");var o=e.find(".toolbar");o.length&&o.each(function(){var b=a(this).data("toolbar");b&&"function"==typeof b.handleResize&&b.handleResize()})}},renderEdgeFading:function(){if(this.isScrollableTabs()&&this.tablistContainer){var a=Locale.isRTL(),b=this.tablistContainer[0],c=b.scrollLeft,d=b.scrollWidth,e=parseInt(window.getComputedStyle(b).getPropertyValue("width"));a?(this.element[0].classList[c>0?"add":"remove"]("scrolled-left"),this.element[0].classList[d-c<=e?"remove":"add"]("scrolled-right")):(this.element[0].classList[c>0?"add":"remove"]("scrolled-right"),this.element[0].classList[d-c<=e?"remove":"add"]("scrolled-left"))}},callSource:function(b,c){function d(b,c){var d=a.extend({dataType:"html"},c,{url:b}),e=a.ajax(d);return e.done(g),e}if((void 0===c||null===c||!1===c)&&!this.settings.source)return!1;if(!0!==this.settings.lazyLoad)return!1;var e=this,f=typeof this.settings.source,g=function(d){if(void 0!==d&&null!==d){if(d=a.sanitizeHTML(d),c){var f=e.tablist.find('[href="'+b+'"]'),g=e.element[0].id||"",h=f.uniqueId("tab",g);b="#"+h,f.attr("href",b)}e.createTabPanel(b,d,!0),e.activate(b),e.element.triggerHandler("complete"),e.element.trigger("requestend",[b,d])}};if(this.container.triggerHandler("start"),this.container.trigger("requeststart"),c)return d(b,this.ajaxOptions);if("function"===f)return this.settings.source(g,b,this.settings.sourceArguments);if("string"===f){var h=b.replace(/#/g,""),i=this.settings.source.toString();if(!(i.indexOf(h)>-1)){var j="tab="+h,k=i.indexOf("?"),l=i.indexOf("#"),m=i.length;k<0?(j="?"+j,l>-1&&(m=l+1)):(j+="&",m=k+1),i=Soho.string.splice(i,m,0,j)}return d(i,this.ajaxOptions)}return!1},renderVisiblePanel:function(){this.resizeNestedTabs()},changeHash:function(a){if(this.settings.changeTabOnHashChange){a||(a=""),a.replace(/#/g,"");var b=this.settings.hashChangeCallback;b&&"function"==typeof b?b(a):window.location.hash=a,this.element.triggerHandler("hash-change",[a])}},updateAria:function(a){a&&(this.anchors.attr({"aria-selected":"false","aria-expanded":"false",tabindex:"-1"}),this.moreButton.attr({tabindex:"-1"}),a.length&&this.element.is(":not(.is-disabled)")&&(a.parent().removeClass("is-selected"),this.isTabOverflowed(a.parent())?this.moreButton.attr({tabindex:"0"}):a.attr({"aria-selected":"true","aria-expanded":"true",tabindex:"0"}).parent().addClass("is-selected")))},resizeNestedTabs:function(){this.nestedTabControls.each(function(b,c){var d=a(c),e=d.data("tabs");e&&e.handleResize&&"function"==typeof e.handleResize&&e.handleResize(!0)})},add:function(b,c,d){function e(b){switch(typeof b){case"string":null!==b.match(/#/g)&&(b=a(b).length?a(b).clone():b);break;case"object":b=a(b).clone()}return b}if(!b)return this;c||(c={});var f=0===this.tablist.find("li").not(".application-menu-trigger, .add-tab-button").length;b=""+b.replace(/#/g,""),c.name=c.name?c.name.toString():"&nbsp;",c.isDismissible=!!c.isDismissible&&!0===c.isDismissible,c.isDropdown=!!c.isDropdown&&!0===c.isDropdown,c.content&&(c.content=e(c.content)),c.dropdown&&(c.dropdown=e(c.dropdown));var g=a('<li role="presentation" class="tab"></li>'),h=a('<a href="#'+b+'" role="tab" aria-expanded="false" aria-selected="false" tabindex="-1">'+c.name+"</a>"),i=this.createTabPanel(b,c.content);return g.html(h),c.isDismissible&&(g.addClass("dismissible"),g.append(a.createIconElement({icon:"close",classes:"close icon"}))),this.settings.tabCounts&&h.prepend('<span class="count">0 </span>'),c.dropdown,function(a,b){var c,d=a.tablist.children("li"),e=d.not(".application-menu-trigger, .add-tab-button"),f=d.length-1;if(!d.length)return g.appendTo(a.tablist),void i.appendTo(a.container);var h=d.filter(".add-tab-button"),j=d.filter(".application-menu-trigger");(void 0===b||null===b||isNaN(b))&&(b=d.length),d.length>e.length&&(function(a){return a>d.length-1}(b)&&h&&h.length&&(b-=1),function(a){return a<=0}(b)&&j&&j.length&&(b+=1));var k=d.eq(b).length>0;f=k?b:f,c="insertAfter",k&&(c="insertBefore"),g[c](d.eq(f)),i.appendTo(a.container)}(this,d),this.panels=this.panels.add(i),this.anchors=this.anchors.add(h),h.data("panel-link",i),i.data("tab-link",h),this.settings.moduleTabsTooltips&&h.on("beforeshow.toolbar",function(){return"yes"===h.data("cutoffTitle")}).tooltip({content:""+h.text().trim()}),this.setOverflow(),f&&(this.positionFocusState(h),this.focusBar(g),this.activate(h.attr("href")),h.focus()),this},remove:function(b,c){var d=this,e=this.doGetTab(null,b);if(e&&e.length){var f=e.children("a"),g=this.getPanel(b),h=g&&g.length,i=this.tablist.children("li").index(e),j=".application-menu-trigger, .separator, .is-disabled, :hidden",k=e.prev();if(!c){if(!1===this.element.triggerHandler("beforeclose",[e]))return!1}var l=!1;e.hasClass("is-selected")?l=!0:k=this.tablist.children("li").not(j).filter(".is-selected"),h&&(this.panels=this.panels.not(g)),this.anchors=this.anchors.not(f),this.settings.moduleTabsTooltips&&f.off("beforeshow.toolbar").data("tooltip").destroy();var m=e.data("popupmenu");e.hasClass("has-popupmenu")&&m&&(m.menu.children("li").each(function(){d.remove(a(this).children("a").attr("href"))}),m.destroy());var n=e.closest(".dropdown-tab"),o=n.data("trigger");e.off("click.tabs"),f.off("click.tabs focus.tabs keydown.tabs"),e.remove(),h&&g.remove();var p=f.data("moremenu-link");p&&(p.parent().off().remove(),a.removeData(f[0],"moremenu-link")),function(a){return a.length&&0===a.children("li:not(.separator)").length}(n)&&(k=this.getPreviousTab(o),setTimeout(function(){d.remove(o)},1)),o&&o.length&&o.data("popupmenu").close(),this.setOverflow(),this.element.trigger("close",[e]);for(var q=i-1;q>-1;)q=-1,k.is(j)&&(k=k.prev(),q-=1);if(k.length||(k=this.tablist.children("li").not(j).first()),!k.length)return this.hideFocusState(),this.defocusBar(),this.element.trigger("afterclose",[e]),this;var r=k.children("a"),s=r;return this.positionFocusState(r),l&&(k.is(".has-popupmenu")&&k.data("popupmenu")&&(s=k.data("popupmenu").menu.children().first().children("a")),this.activate(s.attr("href"))),this.focusBar(k),r.focus(),this.element.trigger("afterclose",[e]),this}},createTabPanel:function(b,c,d){b=b.replace(/#/g,"");var e=a('<div id="'+b+'" class="tab-panel" role="tabpanel"></div>');return c instanceof a?e.append(c):e[0].innerHTML=c||"",!0===d&&this.container.append(e),this.panels=this.panels.add(e),e},checkPopupMenuItems:function(b){function c(b){if(!b||!b.menu)return a();var c=b.menu,d=c.children("li");return d.length?d:(b.destroy(),a())}
if(b.is(".has-popupmenu"))return c(b.data("popupmenu"));var d=b.closest(".dropdown-tab");return d.length?c(d.data("popupmenu")):a()},getTab:function(b,c){var d=this,e=a();return c instanceof a&&c.length>0?c.is("a")?c.parent():c:b?function(b){var c=a(b.currentTarget);return c.is(".tab")?c:c.closest(".tab").length?c.closest(".tab").first():null}(b):c?function(a){if(!a||""===a||"#"===a)return null;-1===a.indexOf("#")&&(a="#"+a);var b=d.anchors.filter('[href="'+a+'"]');return b.length?b.parent():null}(c):e},doGetTab:function(b,c){return(b||c)&&(!b||b instanceof a.Event||"string"==typeof b)?b?"string"!=typeof b?this.getTab(b):this.getTab(null,b):this.getTab(null,c):a()},hide:function(a,b){var c=this.doGetTab(a,b);return c.is(".is-selected")&&this.activatePreviousTab(b),c.addClass("hidden"),this.focusBar(),this.positionFocusState(),this},show:function(a,b){return this.doGetTab(a,b).removeClass("hidden"),this.focusBar(),this.positionFocusState(),this},disableTab:function(a,b){var c=this.doGetTab(a,b);return c.is(".is-selected")&&this.activatePreviousTab(b),c.addClass("is-disabled"),this.focusBar(),this.positionFocusState(),this},enableTab:function(a,b){return this.doGetTab(a,b).removeClass("is-disabled"),this.focusBar(),this.positionFocusState(),this},rename:function(a,b,c){if(a&&"string"==typeof a&&(c=b,b=a),c){var d,e=this.doGetTab(a,b),f=this.settings.tabCounts,g=this.settings.moduleTabsTooltips,h=e.children("a");f&&(d=h.find(".count").clone()),h.text(c.toString()),f&&h.prepend(d),g&&h.data("tooltip").setContent(c.trim());var i=this.tablist.children("li").length<2?e:void 0;this.positionFocusState(i),this.focusBar(i)}},updateCount:function(a,b,c){if(a&&"string"==typeof a&&(c=b,b=a),this.settings.tabCounts&&c){var d=this.doGetTab(a,b);d.children("a").find(".count").text(c.toString()+" ");var e=this.tablist.children("li").length<2?d:void 0;this.positionFocusState(e),this.focusBar(e)}},getActiveTab:function(){var a=this.panels.filter(":visible");return this.anchors.filter('[href="#'+a.first().attr("id")+'"]')},getVisibleTabs:function(){var b=this,c=a();return this.tablist.find("li:not(.separator):not(.hidden):not(.is-disabled):not(.application-menu-trigger)").each(function(){var d=a(this);b.isTabOverflowed(d)||(c=c.add(d))}),c},getOverflowTabs:function(){var b=this,c=a();return this.tablist.find("li:not(.separator):not(.hidden):not(.is-disabled):not(.application-menu-trigger)").each(function(){var d=a(this);b.isTabOverflowed(d)&&(c=c.add(d))}),c},setOverflow:function(){var a=this.element[0],b=this.tablist[0],c=this.hasMoreButton(),d=this.isScrollableTabs();this.isModuleTabs()&&this.adjustModuleTabs();var e,f,g,h,i;d?(g=this.tablistContainer[0].scrollWidth,h=this.tablistContainer[0].offsetWidth,i=g>h):(e=window.getComputedStyle(b,null),f=parseInt(e.getPropertyValue("height"))+1,i=b.scrollHeight>f),i?c||a.classList.add("has-more-button"):c&&a.classList.remove("has-more-button"),this.adjustSpilloverNumber()},adjustModuleTabs:function(){var b,c,d=this,e=this.tablist.find("li:not(.separator):not(.application-menu-trigger):not(:hidden)"),f=this.tablist.find(".application-menu-trigger"),g=f.length>0,h=this.tablist.outerWidth(),i=120,j=g?f.outerWidth():0;if(e.children("a").removeAttr("style"),e.removeAttr("style").each(function(){var b=a(this);d.isTabOverflowed(b)&&(e=e.not(b))}),!e.length)return i=h-j+101,void(this.moreButton[0].style.width=i+"px");b=window.getComputedStyle(e.eq(0).children()[0]),c=parseInt(b.paddingLeft)+parseInt(b.paddingRight),this.moreButton[0].hasAttribute("style")&&this.moreButton[0].removeAttribute("style"),(i=(h-j)/e.length-1)<120&&(i=120);for(var k,l,m="no",n=0;n<e.length;n++)k=e.eq(n).children("a"),k[0].style.width="",!0===this.settings.moduleTabsTooltips&&(m="no",l=parseInt(window.getComputedStyle(e[n]).width),l>i-c&&(m="yes"),k.data("cutoffTitle",m)),e[n].style.width=i+"px",k[0].style.width=i+"px";this.adjustSpilloverNumber()},adjustSpilloverNumber:function(){var b=this.moreButton.find(".more-text"),c=this.tablist.find("li:not(.separator):not(.hidden):not(.is-disabled):not(.application-menu-trigger)"),d=this.getOverflowTabs();c.length<=d.length?b.text(""+Locale.translate("Tabs")):b.text(""+Locale.translate("More"));var e=this.moreButton.find(".count");e.length||(e=a('<span class="count"></span>'),this.moreButton.children("span").first().prepend(e)),e.text(d.length+" ")},select:function(a){var b=a.replace(/#/g,""),c=this.getAnchor(b);this.positionFocusState(void 0,!1),this.focusBar(c.parent()),this.activate(c.attr("href")),this.changeHash(b),c.focus()},buildPopupMenu:function(b){function c(){a(this).off("close.tabs selected.tabs"),g.moreButton.removeClass("popup-is-open"),g.positionFocusState(void 0),g.focusBar()}function d(b,c){var d=c.attr("href"),e=d.substr(1,d.length),f=g.doGetTab(e)||a(),h=f?f.children("a"):a(),i=c.data("original-tab").parent();i.is(".add-tab-button")&&(h=g.handleAddButton(),i=h.parent(),d=h.attr("href"),g.element.trigger("tab-added",[h])),g.activate(d),f.length&&h.length&&"function"==typeof h[0].onclick&&h[0].onclick.apply(h[0]),g.moreButton.focus(),g.scrollTabList(f)}function e(){n.off(),g.hideFocusState(),a("#tab-container-popupmenu").remove()}function f(b){var c=a(this),d=c.closest("li");d.is(".dismissible")&&c.is(".close")&&(b.preventDefault(),b.stopPropagation(),g.closeDismissibleTab(d.children("a").attr("href")),g.popupmenu.close())}var g=this;g.popupmenu&&(g.popupmenu.destroy(),a("#tab-container-popupmenu").off("focus.popupmenu").remove(),a(document).off("keydown.popupmenu"));var h=a("#tab-container-popupmenu"),i="";this.isScrollableTabs()&&(i=" is-selectable"),0===h.length?h=a('<ul id="tab-container-popupmenu" class="tab-list-spillover'+i+'">').appendTo("body"):h.html("");for(var j=g.tablist.children("li"),k=Locale.isRTL(),l=0;l<j.length;l++)!function(b){var c=a(b),d=c.children("a");if(!c.is(":hidden")&&(g.isScrollableTabs()||g.isTabOverflowed(c))){if(c.is(".separator"))return void c.clone().appendTo(h);var e=c.clone(),f=e.children("a");if(e[0].classList.remove("tab"),e[0].classList.contains("is-selected")&&(e[0].classList.remove("is-selected"),g.isScrollableTabs()&&e[0].classList.add("is-checked")),e[0].removeAttribute("style"),e.children(".icon").off().appendTo(f),e.appendTo(h),c.data("moremenu-link",f),f.find(".icon-more").remove(),f.data("original-tab",d),f.onclick=void 0,c.is(".has-popupmenu")){var i=a("#"+b.getAttribute("aria-controls")),j=i.clone(),k=j.children("li");j[0].classList.remove("has-popupmenu"),k.each(function(b){var c=a(this),d=c.children("a"),e=i.children("li").eq(b),f=e.children("a");d.data("original-tab",f),f.data("moremenu-link",d)}),j.insertAfter(f)}}}(j[l]);g.tablist.children("li:not(.separator)").removeClass("is-focused");var m=1;this.isScrollableTabs()||(m=3),g.moreButton.popupmenu({autoFocus:!1,attachToBody:!0,menu:"tab-container-popupmenu",trigger:"immediate",offset:{x:m}}),g.moreButton.addClass("popup-is-open"),g.popupmenu=g.moreButton.data("popupmenu"),g.hasSquareFocusState()&&g.positionFocusState(g.moreButton),g.moreButton.on("close.tabs",c).on("selected.tabs",d);var n=g.popupmenu.menu;n.on("destroy.popupmenu",e).on("touchend.popupmenu touchcancel.popupmenu",".icon",f).on("click.popupmenu",".icon",f),b?g.popupmenu.highlight(n.find('a[href="'+b+'"]')):g.tablist.children(".is-selected").length>0?g.popupmenu.highlight(n.find('a[href="'+g.tablist.children(".is-selected").children("a").attr("href")+'"]')):g.popupmenu.highlight(n.find("li:first-child > a")),a(document).bindFirst("keydown.popupmenu",function(b){function c(){return this===document.activeElement}var d,e=b.which,f=a(b.target);switch(e){case 8:case 46:!function(a){a.altKey&&f.parent().is(".dismissible")&&g.closeDismissibleTab(f.attr("href"))}(b);break;case 37:d=k?40:38,f.is("a")&&(f.parent().is(":not(:first-child)")&&b.preventDefault(),a(document).trigger({type:"keydown.popupmenu",which:d}));break;case 38:!function(){n.find("li:first-child > a").filter(c).length>0&&(b.preventDefault(),a(document).off(b),g.popupmenu.close(),g.findLastVisibleTab())}();break;case 39:d=k?38:40,f.is("a")&&!f.parent(".submenu").length&&a(document).trigger({type:"keydown.popupmenu",which:d});break;case 40:!function(){var d=n.find("li:last-child > a");if(d.filter(c).length>0&&d.parent().is(":not(.submenu)")){if(b.preventDefault(),a(document).off(b),g.popupmenu.close(),g.settings.addTabButton)return void g.addTabButton.focus();g.findFirstVisibleTab()}}()}})},isTabOverflowed:function(a){if(this.isVerticalTabs()||this.isScrollableTabs())return!1;this.tablist.scrollTop()>0&&this.tablist.scrollTop(0);var b=Math.round(a[0].getBoundingClientRect().top),c=Math.round(this.tablist[0].getBoundingClientRect().top+1);return this.isModuleTabs()&&(c+=1),b>c},findLastVisibleTab:function(){var a=this.tablist.children("li:not(.separator):not(.hidden):not(.is-disabled)"),b=a.first();if(this.isScrollableTabs())return a.last().find("a").focus();for(;!this.isTabOverflowed(b);)b=a.eq(a.index(b)+1);a.eq(a.index(b)-1).find("a").focus()},findFirstVisibleTab:function(){this.tablist.children("li:not(.separator):not(.hidden):not(.is-disabled)").eq(0).find("a").focus()},focusBar:function(b,c){function d(a){var b=m.animatedBar[0].style;j=o[0].scrollLeft,i=o[0].scrollWidth,h=this.moreButton.outerWidth(!0),p?b.right=i+f-(q+j)+"px":b.left=q+j+"px",b.width=g+"px",a&&"function"==typeof a&&a()}if(this.hasAnimatedBar()&&b instanceof a&&b.length){var e,f,g,h,i,j,k,l,m=this,n=b,o=this.tablistContainer,p=Locale.isRTL();if(this.animatedBar.removeClass("no-transition"),!n||void 0===n||!n.length||!m.anchors.length)return void this.animatedBar.removeClass("visible");l=window.getComputedStyle(n[0],null),e=parseInt(l.getPropertyValue("padding-left"),10)||0,f=parseInt(l.getPropertyValue("padding-right"),10)||0,g=parseInt(l.getPropertyValue("width"))||0,n.is(".tab")&&(k=window.getComputedStyle(n.children("a")[0]),e+=parseInt(k.getPropertyValue("padding-left"),10)||0,f+=parseInt(k.getPropertyValue("padding-right"),10)||0);var q=p?f+n.position().left+n.outerWidth(!0):n.position().left;clearTimeout(m.animationTimeout),this.animatedBar.addClass("visible"),this.animationTimeout=setTimeout(d.apply(this,[c]),0)}},defocusBar:function(){if(this.hasAnimatedBar()){var a=this,b=Locale.isRTL()?0:a.animatedBar.position().left+a.animatedBar.outerWidth()/2;clearTimeout(a.animationTimeout),this.animatedBar[0].style.left=b+"px",this.animatedBar[0].style.width=0,this.animationTimeout=setTimeout(function(){a.animatedBar&&a.animatedBar.length&&a.animatedBar.removeClass("visible").removeAttr("style")},350)}},scrollTabList:function(b){if(this.tablistContainer&&b&&b instanceof a&&b.length){var c,d=Soho.DOM.getDimensions(b[0]),e=Soho.DOM.getDimensions(this.tablistContainer[0]),f=d.left,g=d.right;f<e.left+40&&(c=-1*Math.round(Math.abs(e.left-f))-40),g>e.right-40&&(c=Math.round(Math.abs(g-e.right))+40),0===c&&(c=void 0),this.tablistContainer.smoothScroll(c,250)}},hideFocusState:function(){this.hasSquareFocusState()&&this.focusState.removeClass("is-visible")},positionFocusState:function(b,c){if(this.hasSquareFocusState()){var d=this;if(!(b=void 0!==b?a(b):d.moreButton.hasClass("is-selected")?d.moreButton:d.tablist.children(".is-selected").length>0?d.tablist.children(".is-selected").children("a"):void 0)||void 0===b||!b.length||b.is(this.moreButton)&&this.isScrollableTabs())return void this.focusState.removeClass("is-visible");b.is("a")&&(b=b.parent()),b.is(".add-tab-button, .tab-more")?this.focusState.parent().is(this.element)||this.focusState.prependTo(this.element):this.focusState.parent().is(this.tablistContainer)||this.focusState.prependTo(this.tablistContainer);var e=this.focusState[0],f=Soho.DOM.getDimensions(b[0]),g=b[0].classList,h=!this.isHeaderTabs()||this.isHeaderTabs()&&this.element[0].classList.contains("alternate"),i=this.isVerticalTabs(),j=Locale.isRTL(),k=i?0:this.moreButton.outerWidth(!0),l=this.element,m=this.tablistContainer,n=m&&this.focusState.parent().is(m);f=function(a,c,d){var e,f,g,l,m=c[0].getBoundingClientRect();if(a.top=a.top-m.top,i&&(a.top=a.top+c[0].scrollTop),j?a.right=m.right-a.right:a.left=a.left-m.left,d){if(l=d?d[0].scrollLeft:0,g=d?d[0].scrollWidth:0,j&&!i){var o=a.left;h?(f=parseInt(window.getComputedStyle(b[0]).marginLeft),a.left=g-f-a.right+l,a.right=g-f-o+l):(a.left=g-(a.right+l+k+32),a.right=g-(o+l+k+32))}else a.left=a.left+l,a.right=a.right+l;n&&(e=parseInt(window.getComputedStyle(c[0])["padding"+(j?"Right":"Left")]),a.left=a.left+(j?e:-1*e),a.right=a.right+(j?e:-1*e))}return h&&!i&&(a.height=a.height-1),a}(f,l,m);var o="";for(var p in f)f.hasOwnProperty(p)&&(o.length&&(o+=" "),o+=p+": "+f[p]+"px;");e.setAttribute("style",o);var q=g.contains("is-selected")?"add":"remove";e.classList[q]("is-selected");var r=!0===c?"add":"remove";e.classList[r]("is-visible")}},checkFocusedElements:function(){var a=this,b=a.tablist;!this.hasSquareFocusState()||0!==b.find(".is-focused").length||a.moreButton.hasClass("is-focused")||a.moreButton.hasClass("popup-is-open")||a.focusState.removeClass("is-visible"),this.hasAnimatedBar()&&0===b.find(".is-selected").length&&!a.moreButton.hasClass("is-selected")&&a.defocusBar()},updated:function(){return this.teardown().init()},disableOtherTabs:function(){return this.disable(!0)},disable:function(b){b||this.element.prop("disabled",!0).addClass("is-disabled"),this.disabledElems||(this.disabledElems=[]);var c=this,d=this.tablist.children("li:not(.separator)");b&&(d=d.filter(":not(.application-menu-trigger)")),d.each(function(){var d=a(this),e=d.children("a");if(!(b&&c.isActive(e.attr("href"))||((d.is(".is-disabled")||!0===e.prop("disabled"))&&c.disabledElems.push({elem:d,originalTabindex:d.attr("tabindex"),originalDisabled:e.prop("disabled")}),d.addClass("is-disabled"),e.prop("disabled",!0),d.is(".application-menu-trigger")||d.is(".add-tab-button")))){var f=a(e.attr("href"));f.addClass("is-disabled"),f.find("*").each(function(){var b=a(this);b.is("input.dropdown, input.multiselect")||(("-1"===b.attr("tabindex")||b.attr("disabled"))&&c.disabledElems.push({elem:b,originalTabindex:b.attr("tabindex"),originalDisabled:b.prop("disabled")}),b.disable())})}}),this.moreButton.addClass("is-disabled"),this.isModuleTabs()&&!b&&this.element.children(".toolbar").disable(),this.updateAria(a())},enable:function(){this.element.prop("disabled",!1).removeClass("is-disabled");var b=this;this.tablist.children("li:not(.separator)").each(function(){var c=a(this),d=c.children("a");if(c.removeClass("is-disabled"),d.prop("disabled",!1),!c.is(".application-menu-trigger")&&!c.is(".add-tab-button")){var e=a(d.attr("href"));e.removeClass("is-disabled"),e.find("*").each(function(){var b=a(this);b.enable&&"function"==typeof b.enable&&b.enable()}),a.each(b.disabledElems,function(a,b){var c=b.elem.is(".tab")?b.elem.children("a"):b.elem;if(b.elem.disable&&"function"==typeof b.elem.disable&&b.elem.disable(),b.elem.is("li"))return void b.elem.addClass("is-disabled");b.elem.is("input.dropdown, input.multiselect")||(b.elem.attr("tabindex",b.originalTabindex),c.prop("disabled",b.originalDisabled))})}}),this.moreButton.removeClass("is-disabled"),this.isModuleTabs()&&this.element.children(".toolbar").enable(),this.disabledElems=[],this.updateAria(this.tablist.find(".is-selected > a"))},closeDismissibleTab:function(a){return this.remove(a)},teardown:function(){this.panels.removeAttr("style"),this.tablist.off().removeAttr("role").removeAttr("aria-multiselectable");var b=this.tablist.children("li");if(b.off().removeAttr("role").removeClass("is-selected"),b.filter(".has-popupmenu").each(function(){var b=a(this).data("popupmenu");b&&(b.menu.children("li:not(.separator)").each(function(){var b=a(this),c=b.children("a"),d=c.data("panel-link");a.removeData(c[0],"panel-link"),d&&d.length&&a.removeData(d[0],"tab-link")}),b.destroy())}),this.panels.off(),this.anchors.off().removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabindex"),this.settings.moduleTabsTooltips&&this.anchors.each(function(){var b=a(this).data("tooltip");b&&"function"==typeof b.destroy&&b.destroy()}),this.element.off("focusout.tabs updated.tabs activated.tabs"),a("body").off("resize.tabs"+this.tabsIndex),this.tabsIndex=void 0,this.moreButton.data("popupmenu")){var c=this.moreButton.data("popupmenu");c.menu.find("li:not(.separator)").each(function(){var b=a(this),c=b.children("a");c.data("original-tab")&&a.removeData(c[0],"original-tab")}),c.destroy()}return this.removeHelperMarkupEvents(),this.tablistContainer&&this.tablistContainer.off("mousewheel.tabs"),this.hasSquareFocusState()&&(this.focusState.remove(),this.focusState=void 0),this.hasAnimatedBar()&&(this.animatedBar.remove(),this.animatedBar=void 0),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,g))})},a.fn.verticaltabs=a.fn.tabs,a.fn.tag=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="tag",e={},f=a.extend({},e,b);return c.prototype={init:function(){this.element.hideFocus(),this.handleEvents()},remove:function(b,c){c=c instanceof jQuery?c:a(c);var d=c.parent();this.element.triggerHandler("beforetagremove",{event:b,element:c}),c.remove(),d.triggerHandler("aftertagremove",{event:b})},destroy:function(){this.element.off("keydown.tag"),a(".dismissable-btn, .dismissible-btn",this.element).off("click.tag").remove(),a.removeData(this.element[0],d)},handleEvents:function(){var b=this,c=a('<span class="dismissible-btn">'+a.createIcon("close")+'<span class="audible"> '+Locale.translate("Close")+"</span></span>");b.element.is(".is-dismissable, .is-dismissible")&&(b.element.append(c),c.on("click.tag",function(a){b.remove(a,b.element)}),b.element.on("keydown.tag",function(a){8===(a||window.event).keyCode&&b.remove(a,this)}))}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.textarea=function(b){function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="textarea",e={characterCounter:!0,printable:!0,charRemainingText:null,charMaxText:null},f=a.extend({},e,b);return c.prototype={init:function(){this.isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),this.isSafari=-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")&&-1===navigator.userAgent.indexOf("Android"),this.element.addClass(this.element.is(".textarea-xs")?"input-xs":this.element.is(".textarea-sm")?"input-sm":this.element.is(".textarea-lg")?"input-lg":""),this.settings.characterCounter&&this.element.attr("maxlength")&&(this.counter=a('<span class="textarea-wordcount">Chars Left..</span>').insertAfter(this.element)),this.settings.printable&&(this.printarea=a('<span class="textarea-print"></span>').insertBefore(this.element)),this.handleEvents(),this.updateCounter(this)},isSelected:function(a){return"number"==typeof a.selectionStart?0===a.selectionStart&&a.selectionEnd===a.value.length:void 0!==document.selection?(a.focus(),document.selection.createRange().text===a.value):void 0},isPrintable:function(a){return a>47&&a<58||a>64&&a<91||a>95&&a<112||a>185&&a<193||a>218&&a<223},countLinebreaks:function(a){return(a.match(/\n/g)||[]).length},updateCounter:function(a){var b=a.element.val(),c=this.isChrome||this.isSafari,d=b.length+(c?this.countLinebreaks(b):0),e=a.element.attr("maxlength"),f=parseInt(e)-d,g=(a.settings.charRemainingText?a.settings.charRemainingText:"CharactersLeft"===Locale.translate("CharactersLeft")?"Characters Left":Locale.translate("CharactersLeft")).replace("{0}",f.toString());a.counter&&(0===d?(g=(a.settings.charMaxText?a.settings.charMaxText:Locale.translate("CharactersMax"))+e,a.counter.text(g),a.counter.removeClass("almost-empty")):(a.counter.text(g),f<10?a.counter.addClass("almost-empty"):a.counter.removeClass("almost-empty"))),a.printarea&&a.printarea.text(a.element.val())},enable:function(){this.element.prop("disabled",!1).prop("readonly",!1)},disable:function(){this.element.prop("disabled",!0)},isDisabled:function(){return this.element.prop("disabled")},readonly:function(){this.element.prop("readonly",!0)},updated:function(){this.destroy(),this.init()},destroy:function(){a.removeData(this.element[0],d),this.printarea&&this.printarea.length&&this.printarea.remove(),this.counter&&this.counter.length&&this.counter.remove(),this.element.off("keyup.textarea, focus.textarea, updated.dropdown, keypress.textarea, blur.textarea")},handleEvents:function(){var a=this;this.element.on("keyup.textarea",function(){a.updateCounter(a)}).on("focus.textarea",function(){a.counter&&a.counter.addClass("focus")}).on("updated.dropdown",function(){a.updated()}).on("keypress.textarea",function(b){var c=a.element.val().length,d=a.element.attr("maxlength");if([97,99,118,120].indexOf(b.which)>-1&&(b.metaKey||b.ctrlKey))return void a.updateCounter(a);a.isPrintable(b.which)&&c>=d&&!a.isSelected(this)&&b.preventDefault()}).on("blur.textarea",function(){a.updateCounter(a),a.counter&&a.counter.removeClass("focus")})}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},a.fn.timepicker=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="timepicker",e={timeFormat:Locale.calendar().timeFormat||"h:mm a",minuteInterval:5,secondInterval:5,mode:"standard",roundToInterval:!1,parentElement:null},f=a.extend({},e,b);return c.prototype={init:function(){this.setup().build().handleEvents().roundMinutes()},setup:function(){function b(a,b){(!b||["minute","second"].indexOf(b)<0)&&(b="minute");var c=e[b+"Interval"];if(void 0===a||isNaN(a))return c;var d=parseInt(a,10);return d>0&&d<60?d:c}function c(a){return!0===a}return this.element.is("[data-round-to-interval]")&&(this.settings.roundToInterval=c(this.element.attr("data-round-to-interval"))),this.element.is("[data-minute-interval]")&&(this.settings.minuteInterval=b(this.element.attr("data-minute-interval"),"minute")),this.settings.timeFormat=function(a){return a&&(a.match("h")||a.match("HH"))&&a.match("mm")?a:e.timeFormat}(24===parseInt(this.element.attr("data-force-hour-mode"))?"HH:mm":this.settings.timeFormat),this.settings.minuteInterval=b(this.settings.minuteInterval,"minute"),this.settings.secondInterval=b(this.settings.secondInterval,"second"),this.settings.mode=function(b){var c=["standard","range"];return a.inArray(b,c)>-1?b:e.mode}(this.settings.mode),this.settings.roundToInterval=c(this.settings.roundToInterval),this.dayPeriods=Locale.calendar().dayPeriods,this},build:function(){return this.settings.parentElement?(this.trigger=a(),this.buildStandardPopup(),this.setupStandardEvents(),this):(this.trigger=this.element.next("svg.icon"),0===this.trigger.length&&(this.trigger=a.createIconElement("clock").insertAfter(this.element)),this.addAria(),this.mask(),this)},addAria:function(){this.element.attr({"aria-expanded":"false",role:"combobox"}),this.label=a('label[for="'+this.element.attr("id")+'"]'),this.label.append('<span class="audible">'+Locale.translate("UseArrow")+"</span>")},handleKeys:function(){var a=this;this.element.on("keydown.timepicker",function(b){var c=!1;if(27===b.which&&a.isOpen()&&(c=!0,a.closeTimePopup()),40!==b.which||a.isOpen()||(c=!0,a.openTimePopup()),c)return b.stopPropagation(),b.preventDefault(),!1})},handleBlur:function(){var a=this;this.element.on("blur.timepicker",function(){a.roundMinutes(),setTimeout(function(){a.isOpen()&&0===a.popup.find(":focus").length&&a.closeTimePopup()},20)})},is24HourFormat:function(a){return a||(a=this.settings.timeFormat),(a.match("HH")||[]).length>0},hasSeconds:function(a){return a||(a=this.settings.timeFormat),(a.match("ss")||[]).length>0},getTimeSeparator:function(){return Locale.calendar().dateFormat.timeSeparator},roundMinutes:function(){if(this.getBoolean(this.settings.roundToInterval)){var a=this.element.val(),b=this.getTimeSeparator(),c=a?a.split(b):[],d=this.settings.minuteInterval;if(c[1]){if(!this.is24HourFormat(this.settings.timeFormat)){var e=c[1].split(" ");c[1]=e[0],e[1]&&c.push(e[1])}if(c[1]=parseInt(c[1],10),c[1]%d!=0){c[1]=Math.round(c[1]/d)*d,c[1]=c[1].toString(),c[1]=(c[1].length<2?"0":"")+c[1],"60"===c[1]&&(c[1]="00",c[0]=(parseInt(c[0])+1).toString());var f=c[0]+b+c[1]+" "+(c[2]?c[2]:"");this.element.val(f)}}}},mask:function(){this.element.data("mask")&&"object"==typeof this.element.data("mask")&&this.element.data("mask").destroy(),this.element.data("mask",void 0);var b=this.getTimeSeparator(),c="##"+b+"##"+(this.hasSeconds()?b+"##":"")+(this.is24HourFormat()?"":" am"),d="time",e={time:"blur"},f=this.element.attr("data-validate"),g=this.element.attr("data-validation-events");"required"!==f||g?f&&g&&(f.indexOf("no-default-validation")>-1?(d=f.replace(/no-default-validation/g,""),e=a.fn.parseOptions(this.element,"data-validation-events")):(d=f+" "+d,a.extend(e,a.fn.parseOptions(this.element,"data-validation-events")))):(d=f+" "+d,a.extend(e,{required:"change blur"})),this.element.attr("data-validate",d).attr("data-validation-events",JSON.stringify(e)).mask({pattern:c,mode:"group"}).validate().triggerHandler("updated")},buildStandardPopup:function(){var b,c,d=this,e=a('<div class="timepicker-popup-content"></div>'),f=this.getTimeSeparator(),g="";this.initValues=d.getTimeFromField();var h=a('<div class="time-parts"></div>').appendTo(e),i=this.is24HourFormat(),j=this.hasSeconds(),k=i?0:1,l=i?24:13;for(this.hourSelect=a('<select id="timepicker-hours" class="hours dropdown"></select>');k<l;)c="",parseInt(d.initValues.hours,10)===k&&(c=" selected"),d.hourSelect.append(a("<option"+c+">"+k+"</option>")),k++;h.append(a('<label for="timepicker-hours" class="audible">'+Locale.translate("Hours")+"</label>")),h.append(this.hourSelect),h.append(a('<span class="label colons">'+f+"</span>"));var m=0;for(this.minuteSelect=a('<select id="timepicker-minutes" class="minutes dropdown"></select>');m<=59;)g=m<10?"0"+m:m,c="",parseInt(d.initValues.minutes,10)===m&&(c=" selected"),d.minuteSelect.append(a("<option"+c+">"+g+"</option>")),m+=d.settings.minuteInterval;if(this.minuteSelect.find("option[selected]").length||this.minuteSelect.prepend(a("<option selected>"+d.initValues.minutes+"</option>")),h.append(a('<label for="timepicker-minutes" class="audible">'+Locale.translate("Minutes")+"</label>")),h.append(this.minuteSelect),j){var n=0;for(b=a('<select id="timepicker-seconds" class="seconds dropdown"></select>');n<=59;)g=n<10?"0"+n:n,c="",(parseInt(d.initValues.seconds,10)===n||!d.initValues.seconds&&"00"===g)&&(c=" selected"),b.append(a("<option"+c+">"+g+"</option>")),n+=d.settings.secondInterval;b.find("option[selected]").length||b.prepend(a("<option selected>"+d.initValues.seconds+"</option>")),h.append(a('<span class="label colons">'+f+"</span>")),h.append(a('<label for="timepicker-seconds" class="audible">'+Locale.translate("Seconds")+"</label>")),h.append(b)}if(this.periodSelect=a('<select id="timepicker-period" class="period dropdown"></select>'),!i){h.append(a('<span class="label colons"></span>'));for(var o=Locale.calendar().dayPeriods,p=0,q=new RegExp(d.initValues.period,"i"),r="AM";p<2;)r=0===p?"AM":"PM",c="",q.test(o[p])&&(c=" selected"),this.periodSelect.append(a('<option value="'+r+'"'+c+">"+o[p]+"</option>")),p++;h.append(a('<label for="timepicker-period" class="audible">'+Locale.translate("TimePeriod")+"</label>")),h.append(this.periodSelect)}if(this.settings.parentElement)this.settings.parentElement.append(e),d.popup=this.settings.parentElement.find(".timepicker-popup-content").addClass("timepicker-popup").attr("id","timepicker-popup");else{e.append('<div class="modal-buttonset"><button type="button" class="btn-modal-primary set-time">'+Locale.translate("SetTime")+"</button></div>");var s=this.element,t=Locale.isRTL()?"right":"left";this.element.parent().is(".datagrid-cell-wrapper")&&(t="center",s=this.element.next(".icon")),this.trigger.popover({content:e,trigger:"immediate",placement:"bottom",placementOpts:{parent:s,parentXAlignment:t,strategies:["flip","nudge","shrink"]},tooltipElement:"#timepicker-popup"}).on("show.timepicker",function(a,b){d.afterShow(b)}).on("hide.timepicker",function(){d.element.focus()})}if(this.trigger.data("tooltip")){(d.popup=this.trigger.data("tooltip").tooltip).addClass("timepicker-popup")}},afterShow:function(a){var b=this;a.find("button").button(),this.hourSelect.val(this.initValues.hours),this.hourSelect.data("dropdown").pseudoElem.find("span").text(this.initValues.hours),this.minuteSelect.val(this.initValues.minutes),this.minuteSelect.data("dropdown").pseudoElem.find("span").text(this.initValues.minutes),b.is24HourFormat()||(this.periodSelect.val(this.initValues.period),this.periodSelect.data("dropdown").pseudoElem.find("span").text(this.initValues.period)),a.find("div.dropdown").first().focus(),a.find(".set-time").off("click.timepicker").onTouchClick("timepicker").on("click.timepicker",function(a){a.preventDefault(),b.setTimeOnField(),b.closeTimePopup()})},setupStandardEvents:function(){var a=this;a.popup.on("touchend.timepicker touchcancel.timepicker",".set-time",function(a){a.preventDefault(),a.target.click()}).on("keydown.timepicker","input.dropdown",function(b){var c=!1;if(27===b.which&&(c=!0,a.closeTimePopup(),a.element.focus()),32===b.which&&(c=!0,a.popup.find(".set-time").click()),37===b.which||39===b.which){c=!0;var d=a.popup.find('input[id$="-shdo"]');if(37===b.which){var e=d.eq(d.index(this)-1);e&&0!==e.length||(e=d.eq(d.length)),e.focus()}if(39===b.which){var f=d.eq(d.index(this)+1);f&&0!==f.length||(f=d.eq(0)),f.focus()}}if(c)return b.preventDefault(),b.stopPropagation(),!1}),a.trigger.on("hide.timepicker",function(){a.onPopupHide()})},buildRangePopup:function(){},setupRangeEvents:function(){},getTimeFromField:function(a){function b(a){return f.dayPeriods.indexOf(a)>-1}function c(a){return a.replace(/^\s+|\s+$/g,"")}function d(a){return!a||isNaN(a)?"00":(a=parseInt(a),a=a<10?"0"+a:a)}var e,f=this,g=a||this.element.val(),h=this.getTimeSeparator(),i=g.split(h),j={};return this.is24HourFormat()||(e=i[i.length-1].split(" "),i.pop(),i=i.concat(e)),i[0]&&i[0].length&&!isNaN(i[0])||(i[0]="1"),i[0]=parseInt(i[0],10),isNaN(i[0])||(i[0]=""+parseInt(i[0],10)),j.hours=i[0],i[1]?(i[1]=c(i[1]),i[1]=d(i[1]),j.minutes=i[1]):j.minutes="00",function(a){a?(a=c(a),f.hasSeconds()?(a=d(a),j.seconds=a):(b(a)||(a=Locale.translateDayPeriod("AM")),j.period=a)):f.is24HourFormat()||(f.hasSeconds()?(a="00",j.seconds=a):(a=Locale.translateDayPeriod("AM"),j.period=a))}(i[2]),i[3]?(i[3]=c(i[3]),j.period=i[3]):!this.is24HourFormat()&&this.hasSeconds()&&(j.period=Locale.translateDayPeriod("AM")),j},setTimeOnField:function(){var b=a("#timepicker-hours").val()||"",c=a("#timepicker-minutes").val()||"",d=a("#timepicker-seconds").val()||"",e=(a("#timepicker-period").val()||"").toUpperCase(),f=this.getTimeSeparator(),g=""+b+f+c+(this.hasSeconds()?f+d:"");e=this.is24HourFormat()||""!==e?e:a("#timepicker-period-shdo").val(),g+=e?" "+Locale.translateDayPeriod(e):"",this.element.val(g).trigger("change"),this.element.focus()},isOpen:function(){return this.popup&&!this.popup.hasClass("is-hidden")},openTimePopup:function(){var a=this;a.setup(),this.element.is(":disabled")||this.element.attr("readonly")||(this.popup&&!this.popup.hasClass("is-hidden")&&a.closeTimePopup(),this.element.addClass("is-active"),"range"===a.settings.mode?(a.buildRangePopup(),a.setupRangeEvents()):(a.buildStandardPopup(),a.setupStandardEvents()),this.element.attr({"aria-expanded":"true"}),this.popup.find("div.dropdown").first().focus())},closeTimePopup:function(){this.trigger.data("tooltip")&&this.trigger.data("tooltip").hide()},onPopupHide:function(){"standard"===this.settings.mode&&(a("#timepicker-hours").data("dropdown").destroy(),
a("#timepicker-minutes").data("dropdown").destroy(),this.hasSeconds()&&a("#timepicker-seconds").data("dropdown").destroy(),this.is24HourFormat()||a("#timepicker-period").data("dropdown").destroy(),this.popup.off("click.timepicker touchend.timepicker touchcancel.timepicker keydown.timepicker")),this.element.attr({"aria-expanded":"false"}),this.trigger.off("hide.timepicker show.timepicker"),this.trigger.data("tooltip").destroy(),this.trigger.data("tooltip",void 0),a("#timepicker-popup").remove(),this.element.removeClass("is-active")},toggleTimePopup:function(){this.isOpen()?this.closeTimePopup():this.openTimePopup()},value:function(a){var b=this.element.val();if(!a||!1===a)return b;var c=Locale.calendar().dateFormat.timeSeparator,d=new RegExp(c,"g");b=b.replace(d,"");var e=b.split(" ");return e[0].length<4&&(b="0"+e[0]+(e[1]?e[1]:"")),b},enable:function(){this.element.removeAttr("disabled readonly").closest(".field").removeClass("is-disabled")},readonly:function(){this.enable(),this.element.attr("readonly","readonly")},disable:function(){this.enable(),this.element.attr("disabled","disabled").closest(".field").addClass("is-disabled")},isDisabled:function(){return this.element.prop("disabled")},getBoolean:function(a){var b=+a;return isNaN(b)?!!String(a).toLowerCase().replace(!1,""):!!b},updated:function(){return this.teardown().init()},teardown:function(){this.trigger.off("keydown.timepicker"),this.element.off("focus.timepicker blur.timepicker keydown.timepicker"),this.popup&&this.closeTimePopup(),this.trigger.remove();var a=this.element.data("mask");return a&&"function"==typeof a.destroy&&a.destroy(),this.label.find(".audible").remove(),this},destroy:function(){this.teardown(),a.removeData(this.element[0],"validate"),a.removeData(this.element[0],d)},handleEvents:function(){var a=this;return this.trigger.onTouchClick("timepicker").on("click.timepicker",function(){a.toggleTimePopup()}),this.handleKeys(),this.handleBlur(),this}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})};var H=window.Tmpl={};H.Template=function(a,b,c,d){a=a||{},this.r=a.code||this.r,this.c=c,this.options=d||{},this.text=b||"",this.partials=a.partials||{},this.subs=a.subs||{},this.buf=""};var I=/\S/,J=/\n/g,K=/\r/g,L=/\\/g,M=/\u2028/,N=/\u2029/,O=/&/g,P=/</g,Q=/>/g,R=/\'/g,S=/\"/g,T=/[&<>\"\']/;H.Template.prototype={r:function(a,b,c){return""},v:u,t:q,render:function(a,b,c){return this.ri([a],b||{},c)},ri:function(a,b,c){return this.r(a,b,c)},ep:function(a,b){var c=this.partials[a],d=b[c.name];if(c.instance&&c.base===d)return c.instance;if("string"==typeof d){if(!this.c)throw new Error("No compiler available.");d=this.c.compile(d,this.options)}if(!d)return null;if(this.partials[a].base=d,c.subs){b.stackText||(b.stackText={});for(var e in c.subs)b.stackText[e]||(b.stackText[e]=void 0!==this.activeSub&&b.stackText[this.activeSub]?b.stackText[this.activeSub]:this.text);d=p(d,c.subs,c.partials,this.stackSubs,this.stackPartials,b.stackText)}return this.partials[a].instance=d,d},rp:function(a,b,c,d){var e=this.ep(a,c);return e?e.ri(b,c,d):""},rs:function(b,c,d){var e=b[b.length-1];if(!a.isArray(e))return void d(b,c,this);for(var f=0;f<e.length;f++)b.push(e[f]),d(b,c,this),b.pop()},s:function(b,c,d,e,f,g,h){var i;return(!a.isArray(b)||0!==b.length)&&("function"==typeof b&&(b=this.ms(b,c,d,e,f,g,h)),i=!!b,!e&&i&&c&&c.push("object"==typeof b?b:c[c.length-1]),i)},d:function(b,c,d,e){var f,g=b.split("."),h=this.f(g[0],c,d,e),i=this.options.modelGet,j=null;if("."===b&&a.isArray(c[c.length-2]))h=c[c.length-1];else for(var l=1;l<g.length;l++)f=k(g[l],h,i),void 0!==f?(j=h,h=f):h="";return!(e&&!h)&&(e||"function"!=typeof h||(c.push(j),h=this.mv(h,c,d),c.pop()),h)},f:function(a,b,c,d){for(var e=!1,f=null,g=!1,h=this.options.modelGet,i=b.length-1;i>=0;i--)if(f=b[i],void 0!==(e=k(a,f,h))){g=!0;break}return g?(d||"function"!=typeof e||(e=this.mv(e,b,c)),e):!d&&""},ls:function(a,b,c,d,e){var f=this.options.delimiters;return this.options.delimiters=e,this.b(this.ct(q(a.call(b,d)),b,c)),this.options.delimiters=f,!1},ct:function(a,b,c){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(a,this.options).render(b,c)},b:function(a){this.buf+=a},fl:function(){var a=this.buf;return this.buf="",a},ms:function(a,b,c,d,e,f,g){var h,i=b[b.length-1],j=a.call(i);return"function"==typeof j?!!d||(h=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(j,i,c,h.substring(e,f),g)):j},mv:function(a,b,c){var d=b[b.length-1],e=a.call(d);return"function"==typeof e?this.ct(q(e.call(d)),d,c):e},sub:function(a,b,c,d){var e=this.subs[a];e&&(this.activeSub=a,e(b,c,this,d),this.activeSub=!1)}},H.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},H.scan=function(a,b){function c(){j.length>0&&(k.push({tag:"_t",text:new String(j)}),j="")}function d(){for(var a=!0,b=n;b<k.length;b++)if(!(a=H.tags[k[b].tag]<H.tags._v||"_t"==k[b].tag&&null===k[b].text.match(I)))return!1;return a}function e(a,b){if(c(),a&&d())for(var e,f=n;f<k.length;f++)k[f].text&&((e=k[f+1])&&">"===e.tag&&(e.indent=k[f].text.toString()),k.splice(f,1));else b||k.push({tag:"\n"});l=!1,n=k.length}var f=a.length,g=0,h=null,i=null,j="",k=[],l=!1,m=0,n=0,o="{{",p="}}";for(b&&(b=b.split(" "),o=b[0],p=b[1]),m=0;m<f;m++)0===g?t(o,a,m)?(--m,c(),g=1):"\n"===a.charAt(m)?e(l):j+=a.charAt(m):1===g?(m+=o.length-1,i=H.tags[a.charAt(m+1)],h=i?a.charAt(m+1):"_v","="===h?(m=function(a,b){var c="="+p,d=a.indexOf(c,b),e=s(a.substring(a.indexOf("=",b)+1,d)).split(" ");return o=e[0],p=e[e.length-1],d+c.length-1}(a,m),g=0):(i&&m++,g=2),l=m):t(p,a,m)?(k.push({tag:h,n:s(j),otag:o,ctag:p,i:"/"===h?l-o.length:m+p.length}),j="",m+=p.length-1,g=0,"{"===h&&("}}"===p?m++:r(k[k.length-1]))):j+=a.charAt(m);return e(l,!0),k};var U={_t:!0,"\n":!0,$:!0,"/":!0};H.stringify=function(a,b,c){return"{code: function (c,p,i) { "+H.wrapMain(a.code)+" },"+x(a)+"}"};var V=0;H.generate=function(a,b,c){V=0;var d={code:"",subs:{},partials:{}};return H.walk(a,d),c.asString?this.stringify(d,b,c):this.makeTemplate(d,b,c)},H.wrapMain=function(a){return'var t=this;t.b(i=i||"");'+a+"return t.fl();"},H.template=H.Template,H.makeTemplate=function(a,b,c){var d=this.makePartials(a);return d.code=new Function("c","p","i",this.wrapMain(a.code)),new this.template(d,b,this,c)},H.makePartials=function(a){var b,c={subs:{},partials:a.partials,name:a.name};for(b in c.partials)c.partials[b]=this.makePartials(c.partials[b]);for(b in a.subs)c.subs[b]=new Function("c","p","t","i",a.subs[b]);return c},H.codegen={"#":function(a,b){b.code+="if(t.s(t."+y(a.n)+'("'+o(a.n)+'",c,p,1),c,p,0,'+a.i+","+a.end+',"'+a.otag+" "+a.ctag+'")){t.rs(c,p,function(c,p,t){',H.walk(a.nodes,b),b.code+="});c.pop();}"},"^":function(a,b){b.code+="if(!t.s(t."+y(a.n)+'("'+o(a.n)+'",c,p,1),c,p,1,0,0,"")){',H.walk(a.nodes,b),b.code+="};"},">":z,"<":function(a,b){var c={partials:{},code:"",subs:{},inPartial:!0};H.walk(a.nodes,c);var d=b.partials[z(a,b)];d.subs=c.subs,d.partials=c.partials},$:function(a,b){var c={subs:{},code:"",partials:b.partials,prefix:a.n};H.walk(a.nodes,c),b.subs[a.n]=c.code,b.inPartial||(b.code+='t.sub("'+o(a.n)+'",c,p,i);')},"\n":function(a,b){b.code+=l('"\\n"'+(a.last?"":" + i"))},_v:function(a,b){b.code+="t.b(t.v(t."+y(a.n)+'("'+o(a.n)+'",c,p,0)));'},_t:function(a,b){b.code+=l('"'+o(a.text)+'"')},"{":A,"&":A},H.walk=function(a,b){for(var c,d=0,e=a.length;d<e;d++)(c=H.codegen[a[d].tag])&&c(a[d],b);return b},H.parse=function(a,b,c){return c=c||{},v(a,"",[],c.sectionTags||[])},H.cache={},H.cacheKey=function(a,b){return[a,!!b.asString,!!b.disableLambda,b.delimiters,!!b.modelGet].join("||")},H.compile=function(a,b){b=b||{};var c=H.cacheKey(a,b),d=this.cache[c];if(d){var e=d.partials;for(var f in e)delete e[f].instance;return d}return d=this.generate(this.parse(this.scan(a,b.delimiters),a,b),a,b),this.cache[c]=d,d},a.fn.toolbar=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="toolbar",e={rightAligned:!1,maxVisibleButtons:3,resizeContainers:!0,favorButtonset:!0},f=a.extend({},e,b);return c.prototype={init:function(){return this.setup().build().handleEvents()},setup:function(){return this.settings.maxVisibleButtons<=0&&(this.settings.maxVisibleButtons=e.maxVisibleButtons),this},build:function(){function b(){return a(this).parent(".buttonset, .inline").length}var c=this;if(this.element.attr("role","toolbar"),this.settings.resizeContainers&&this.element.is(":not(:hidden)")&&this.element[0].classList.add("do-resize"),this.buildAriaLabel(),this.id||(this.id=parseInt(a(".toolbar, .formatter-toolbar").index(this.element),10)),this.title=this.element.children(".title"),this.title.length?(this.element[0].classList.add("has-title"),this.cutoffTitle=!1,this.title.on("beforeshow.toolbar",function(){return c.cutoffTitle}).tooltip({content:""+this.title.text().trim()})):this.element[0].classList.remove("has-title"),this.buttonset=this.element.children(".buttonset"),this.buttonset.length||(this.buttonset=a('<div class="buttonset"></div>'),this.title.length?this.buttonset.insertAfter(this.title):this.buttonset.prependTo(this.element)),this.buttonset[this.settings.rightAligned?"addClass":"removeClass"]("right-aligned"),this.more=this.element.find(".btn-actions"),0===this.more.length&&!this.element.hasClass("no-actions-button")){var d=this.element.find(".more");d.length||(d=a('<div class="more"></div>').appendTo(this.element)),this.more=a('<button class="btn-actions" type="button"></button>').html(a.createIcon({icon:"more"})+'<span class="audible">'+Locale.translate("MoreActions")+"</span>").appendTo(d)}this.buttonsetItems=this.buttonset.children("button").add(this.buttonset.find("input")),this.items=this.buttonsetItems.add(this.title.children("button")).add(this.more),this.items.filter('button, input[type="button"], [class^="btn"]').each(function(){a(this).data("button")||a(this).button()}),this.items.filter(".searchfield, .toolbar-searchfield-wrapper, .searchfield-wrapper").each(function(b,c){var d=a(c);if(d.is(".toolbar-searchfield-wrapper, .searchfield-wrapper")&&(d=d.children(".searchfield")),!d.data("searchfield")){var e=a.extend({},a.fn.parseOptions(d[0]));d.toolbarsearchfield(e)}});var e=this.more.data("popupmenu"),f=this.more.attr("aria-controls");e?this.moreMenu=e.menu:(this.moreMenu=a("#"+f),this.moreMenu.length||(this.moreMenu=this.more.next(".popupmenu")),this.moreMenu.length||(this.moreMenu=a('<ul id="popupmenu-toolbar-'+this.id+'" class="popupmenu"></ul>').insertAfter(this.more))),this.defaultMenuItems=this.moreMenu.children("li:not(.separator)").length>0;var g=[];if(this.items.not(this.more).filter(b).each(function(){g.push(c.buildMoreActionsMenuItem(a(this)))}),g.reverse(),a.each(g,function(a,b){""!==b.text()&&b.prependTo(c.moreMenu)}),e)this.more.on("beforeopen.toolbar",function(){c.refreshMoreActionsMenu(c.moreMenu)}).triggerHandler("updated");else{var h=a.fn.parseOptions(this.more[0]);this.more.popupmenu(a.extend({},h,{trigger:"click",menu:this.moreMenu})).on("beforeopen.toolbar",function(){c.refreshMoreActionsMenu(c.moreMenu)})}return function(){c.items.attr("tabindex","-1");var a=c.items.filter(".is-selected");a.length?(c.activeButton=a.first().attr("tabindex","0"),c.items.not(c.activeButton).removeClass("is-selected")):(a=c.items.filter(":visible:not(:disabled)").first().attr("tabindex","0"),c.activeButton=a,c.element.is(":hidden, .is-hidden")?c.activeButton=c.items.filter(":not(:disabled)").first().attr("tabindex","0"):c.isItemOverflowed(a)&&(a.attr("tabindex","-1"),c.activeButton=c.more.addClass("is-selected").attr("tabindex","0")))}(),this.adjustMenuItemVisibility(),this.handleResize(),this.element.triggerHandler("rendered"),this},buildMoreActionsMenuItem:function(b){function c(b,f,g){var h=b.children("li"),i=f.attr("id");f.children("li").each(function(b,e){var f=a(e),g=h.eq(b),i=f.children("a"),j=g.children("a"),k=f.attr("id"),l=i.attr("id");k&&f.removeAttr("id").attr("data-original-menu-item",k),l&&i.removeAttr("id").attr("data-original-menu-anchor",l),j.data("action-button-link",i),i.data("original-button",j);var m=g.children(".wrapper").children(".popupmenu"),n=f.children(".wrapper").children(".popupmenu");m.length&&n.length&&c(m,n,f),d&&f.removeClass("is-checked")}),f.removeAttr("id").attr("data-original-menu",i),g.addClass("submenu");var j;g.is(e)&&(j=g.children(".wrapper"),j&&j.length||(j=a('<div class="wrapper"></div>')),j.html(f),g.append(j))}var d=!1;if(!0===b.data("skipit"))return void b.data("skipit",void 0);var e,f=b.data("action-button-link");f&&f.length?e=f.parent():(e=a("<li></li>"),f=a('<a href="#"></a>').appendTo(e),b.data("action-button-link",f),f.data("original-button",b)),b.hasClass("hidden")&&e.addClass("hidden"),b.is(":disabled")?e.addClass("is-disabled"):e.removeClass("is-disabled"),f.text(this.getItemText(b));var g=a.getBaseURL("#icon-dropdown"),h=b.children(".icon").filter(function(){var b=a(this).getIconName();return b&&b!==g&&-1===b.indexOf("dropdown")});h&&h.length&&(f.html("<span>"+f.text()+"</span>"),h.clone().detach().prependTo(f));var i=e.find("b");if(i.length&&(this.moreMenu.addClass("has-icons"),i.detach().prependTo(e)),b.is(".btn-menu")){b.data("popupmenu")?f.children(".icon.arrow").length||f.append(a.createIcon({classes:"icon arrow icon-dropdown",icon:"dropdown"})):b.popupmenu();var j=b.data("popupmenu").menu;c(j,j.clone(),e)}return b.is("[data-popdown]")&&b.popdown(),e},refreshMoreActionsMenu:function(b){var c=this;a("li > a",b).each(function(){var b,d,e=a(this),f=e.parent(),g=e.data("originalButton"),h=c.getItemText(g);g&&(e.find("span").length?e.find("span").text(h.trim()):e.text(h.trim()),g.is(".hidden")||g.parent().is(".hidden")?f.addClass("hidden"):f.removeClass("hidden"),g.parent().is(".is-disabled")||g.is(":disabled")?(f.addClass("is-disabled"),e.attr("tabindex","-1")):(f.removeClass("is-disabled"),e.removeAttr("disabled")),g.is("a")&&(b=g.parent("li"),b.is(".is-checked")?f.addClass("is-checked"):f.removeClass("is-checked")),g.is(".btn-menu")&&(d=e.parent().find(".popupmenu").first(),c.refreshMoreActionsMenu(d)))})},getItemText:function(a){if(a){var b=a.find(".audible"),c=a.attr("title"),d=a.data("tooltip"),e=d&&"string"==typeof d.content?d.content:void 0;return b.length?b.text():""!==c&&void 0!==c?a.attr("title"):e||a.text()}},handleEvents:function(){var b=this;return this.items.off("keydown.toolbar").on("keydown.toolbar",function(a){b.handleKeys(a)}).off("click.toolbar").on("click.toolbar",function(a){b.handleClick(a)}),this.items.filter(".btn-menu, .btn-actions").off("close.toolbar").on("close.toolbar",function(){var c,d=a(this);if(d.is(".is-overflowed"))return void((c=b.getLastVisibleButton())&&c.length&&c[0].focus());d.focus(),b.buttonset.scrollTop(0)}),this.items.not(this.more).off("selected.toolbar").on("selected.toolbar",function(a,c){a.stopPropagation(),b.handleSelected(a,c)}),this.more.on("keydown.toolbar",function(a){b.handleKeys(a)}).on("beforeopen.toolbar",function(){b.adjustMenuItemVisibility()}).on("selected.toolbar",function(a,c){a.stopPropagation(),b.handleSelected(a,c)}),this.more.off("show-submenu.toolbar").on("show-submenu.toolbar",function(a,c){b.handleTransferToMenuButtonItem(a,c)}),this.element.off("updated.toolbar").on("updated.toolbar",function(a){a.stopPropagation(),b.updated()}).off("recalculate-buttons.toolbar").on("recalculate-buttons.toolbar",function(a,c){b.handleResize(c)}).off("scrollup.toolbar").on("scrollup.toolbar",function(){var a=b.element.parents(".tab-container.module-tabs");a.length&&a.scrollTop(0)}),a("body").off("resize.toolbar-"+this.id).on("resize.toolbar-"+this.id,function(){b.handleResize()}),this.handleResize(),this},handleTransferToMenuButtonItem:function(a,b){var c=b.children("a").data("original-button");if(c){var d=c.data("popupmenu");d&&"function"==typeof d.settings.beforeOpen&&(d.callSource(a),this.buildMoreActionsMenuItem(c))}},handleSelected:function(b,c){var d,e,f,g,h=c.data("original-button"),i=c.parent();if(i.is(".hidden, .is-disabled")||c.is("[readonly], [disabled]"))return void b.preventDefault();if(h&&h.length>0){if(d=h.listEvents(),e=this.element.listEvents(),this.setActiveButton(h),h.attr("ng-click")||h.attr("data-ng-click"))return void h.trigger("click");for(var j=["click","touchend","touchcancel"],k=0;k<j.length;k++){var l=j[k];if(e&&e[l]&&e[l].delegateCount>0){var m=this.element,n=a.Event(l);return n.target=m.find(h)[0],void m.trigger(n)}if(d&&d[l]||h[0]["on"+l])return void h.trigger(l)}return f=h.parents(".popupmenu"),(g=f.data("trigger"),f.length&&g instanceof a&&g.length)?void g.triggerHandler("selected",[h]):void this.triggerSelect(h)}this.triggerSelect(c)},handleClick:function(b){return this.setActiveButton(a(b.currentTarget)),this.triggerSelect(a(b.currentTarget)),!1},handleKeys:function(b){var c=this,d=b.which,e=a(b.target),f=e.is(".btn-actions"),g=Locale.isRTL();(37===d&&e.is(":not(input)")||37===d&&e.is("input")&&b.shiftKey||38===d&&e.is(":not(input.is-open)"))&&(b.preventDefault(),f?c.setActiveButton(g?c.getFirstVisibleButton():c.getLastVisibleButton()):c.navigate(g?1:-1)),(39===d&&e.is(":not(input)")||39===d&&e.is("input")&&b.shiftKey||40===d&&e.is(":not(input.is-open)"))&&(b.preventDefault(),f?c.setActiveButton(g?c.getLastVisibleButton():c.getFirstVisibleButton()):c.navigate(g?-1:1))},handleResize:function(a){if(this.settings.resizeContainers){var b=a?a.title:void 0,c=a?a.buttonset:void 0;this.sizeContainers(b,c)}for(var d=this._getButtonsetButtons(),e=0;e<d.length;e++)d[e].removeClass("is-overflowed");this.element.is(":not(:hidden)")&&(this.adjustMenuItemVisibility(),this.toggleMoreMenu())},sizeContainers:function(b,c){function d(a){return a+"px"}var e=this.element[0],f=this.title[0],g=this.buttonset[0],h=this.more[0];if(this.title&&this.title.length){if(this.element.is(":hidden"))return g.style.width="",f.style.width="",void e.classList.remove("do-resize");g.style.width="",f.style.width="",e.classList.contains("do-resize")||e.classList.add("do-resize");var i=a(e).getHiddenSize(),j=a(g).getHiddenSize(),k=a(f).getHiddenSize(),l=a(h).getHiddenSize(),m=parseInt(i.padding.left)+parseInt(i.padding.right);isNaN(l.width)&&(l.width=50),(isNaN(j.width)||j.width<0)&&(j.width=0);var n,o,p;return this.cutoffTitle=!1,(b&&c&&!isNaN(b)&&!isNaN(c)?(n=parseInt(b),o=parseInt(c)):j.scrollWidth+k.scrollWidth+l.width+m>i.width&&(this.settings.favorButtonset?(o=j.width,n=i.width-(m+j.width+l.width)):(n=k.scrollWidth,o=i.width-(m+k.scrollWidth+l.width))),this.settings.favorButtonset)?(n<74&&(this.cutoffTitle=!0,p=Math.abs(n-74),n=74,o-=p),g.style.width=d(o+2),f.style.width=d(n-2),this):(o<0&&(this.cutoffTitle=!0,p=Math.abs(o-0),o=0,n-=p),f.style.width=d(n+2),g.style.width=d(o-2),this)}},navigate:function(a){var b,c=this.items.filter(":visible:not(:disabled)"),d=c.index(this.activeButton),e=d+a;return e>=0&&e<c.length&&(b=c.eq(e)),e>=c.length&&(b=c.first()),-1===e&&(b=c.last()),this.isItemOverflowed(b)&&(b=this.more),this.setActiveButton(b),!1},getLastVisibleButton:function(){for(var b,c,d=a(this.items.get().reverse()).not(this.more),e=0;!b&&e<d.length;){if(c=a(d[e]),!this.isItemOverflowed(c)){b=c;break}e++}for(b&&0!==b.length||(b=d.first());b.length&&b.is(".separator, *:disabled, *:hidden");)b=b.prev();return b},getFirstVisibleButton:function(){for(var a=0,b=this.items,c=b.eq(a);c.is(".separator, *:disabled, *:hidden");)a++,c=b.eq(a);return c},setActiveButton:function(a,b){function c(){return d.hasNoMoreButton()||!d.element.hasClass("has-more-button")?d.getLastVisibleButton():d.more}if(a[0]!==this.activeButton[0]){var d=this;this.items.add(this.more).attr("tabindex","-1").removeClass("is-selected"),this.activeButton=function(){if(a.is("a"))return c();var b=d.more.data("tooltip");return a[0]===d.more[0]?(b&&b.tooltip.is(":not(.hidden)")&&b.hide(),c()):d.isItemOverflowed(a)&&!a.is(".searchfield")?c():a}(),this.activeButton.addClass("is-selected").attr("tabindex","0"),b||(this.activeButton[0].focus(),this.element.triggerHandler("navigate",[this.activeButton]))}},triggerSelect:function(b){var c=a(b);c.is(this.more)||c.is(".btn-menu, li.submenu")||this.element.triggerHandler("selected",[c])},_getButtonsetButtons:function(){for(var a,b=[],c=this.buttonsetItems,d=0;d<c.length;d++)a=c.eq(d),void 0!==a.data("action-button-link")&&a.is(":not(.searchfield)")&&b.push(a);return b},getVisibleButtons:function(a){var b,c=this,d=[],e=[];for(a&&Array.isArray(a)||(a=this._getButtonsetButtons()),b=0;b<a.length;b++)a[b][0].classList.remove("is-overflowed");for(b=0;b<a.length;b++)!function(a,b){c.isItemOverflowed(b)?d.push(b):e.push(b)}(0,a[b]);return{visible:e,hidden:d}},adjustMenuItemVisibility:function(a){function b(a,b){var d=a[0],e=a.data("action-button-link").parent()[0],f=d.classList.contains("hidden");if(b)return e.classList.add("hidden"),void d.classList.remove("is-overflowed");f||e.classList.remove("hidden"),d.classList.add("is-overflowed"),a.find(".icon").length&&(c="addClass")}var c="removeClass";a||(a=this.getVisibleButtons());var d=0;for(d;d<a.visible.length;d++)b(a.visible[d],!0);for(d=0;d<a.hidden.length;d++)b(a.hidden[d],!1);this.moreMenu.find(".icon").length&&(c="addClass"),this.moreMenu[c]("has-icons")},isItemOverflowed:function(b){if(this.hasNoMoreButton())return!1;if(!b||0===b.length)return!0;if(this.title.length&&this.buttonsetItems.filter(":not(.hidden)").index(b)>=this.settings.maxVisibleButtons)return!0;this.buttonset.scrollTop()>0&&this.buttonset.scrollTop(0),b instanceof a&&b.length&&(b=b[0]);var c=b.classList,d=window.getComputedStyle(b);if(c.contains("btn-actions"))return!0;if(c.contains("searchfield"))return!1;if("none"===d.display)return!0;var e=Locale.isRTL(),f=b.getBoundingClientRect(),g=this.buttonset[0].getBoundingClientRect(),h=e?f.left<=g.left:f.right>=g.right;return!0==f.bottom>=g.bottom||!0===h},hasNoMoreButton:function(){return this.element[0].classList.contains("no-more-button")},toggleMoreMenu:function(){if(!this.element.hasClass("no-actions-button")){var a=this.moreMenu.children("li:not(.separator)"),b=a.not(".hidden"),c="removeClass";(this.defaultMenuItems||b.length>0)&&(c="addClass"),this.element[c]("has-more-button");var d=this.more.data("popupmenu");if("removeClass"===c){if(!d)return;d.close();var e=d.menu.find("li:not(.separator)").children("a"),f=!1;e.add(this.more).each(function(){document.activeElement===this&&(f=!0)}),f&&this.getLastVisibleButton()[0].focus()}}},buildAriaLabel:function(){if(!this.element.attr("aria-label")){var b=1===this.element.closest(".header").length,c=this.element.attr("id")||"",d=this.element.children(".title"),e=this.element.prev("label"),f=this.element.prev(".label"),g=b?a("header.header").find("h1").text():d.length?d.filter("div").text():e.length?e.text():f.length?f.text():c+" "+Locale.translate("Toolbar");this.element.attr("aria-label",g.replace(/\s+/g," ").trim())}},updated:function(){this.unbind().teardown().init()},enable:function(){this.element.prop("disabled",!1),this.items.prop("disabled",!1),this.more.prop("disabled",!1)},disable:function(){this.element.prop("disabled",!0),this.items.prop("disabled",!0),this.more.prop("disabled",!0).data("popupmenu").close()},unbind:function(){return this.items.offTouchClick("toolbar").off("keydown.toolbar click.toolbar focus.toolbar blur.toolbar"),this.more.off("keydown.toolbar beforeopen.toolbar selected.toolbar"),a("body").off("resize.toolbar-"+this.id),this},teardown:function(){var b=this;if(this.title&&this.title.length){var c=this.title.off("beforeshow.toolbar").data("tooltip");c&&c.destroy()}return this.moreMenu.children("li").each(function(){b.teardownMoreActionsMenuItem(a(this),!0)}),this},teardownMoreActionsMenuItem:function(b,c){var d=this,e=a(b),f=e.children("a"),g=f.data("original-button");f.off("updated.toolbar mousedown.toolbar click.toolbar touchend.toolbar touchcancel.toolbar recalculate-buttons.toolbar");var h=e.find(".icon");h.length&&h.remove();var i;e.is(".submenu")&&(i=e.children(".wrapper").children(".popupmenu"),i.children("li").each(function(){d.teardownMoreActionsMenuItem(a(this),!0)})),g&&g.length&&(a.removeData(f[0],"original-button"),a.removeData(g[0],"action-button-link"),f.remove(),i&&i.off().parent(".wrapper").off().remove(),c&&e.remove())},destroy:function(){if(this.unbind().teardown(),this.buttonset.children(".searchfield-wrapper").length){var b=this.buttonset.children(".searchfield-wrapper").children(".searchfield");b.data("toolbarsearchfield")&&b.data("toolbarsearchfield").destroy()}this.more.length&&void 0!==this.more.data("popupmenu")&&this.more.data("popupmenu").destroy(),this.element[0].classList.remove("do-resize"),this.buttonset[0].style.width="",this.title&&this.title.length&&(this.title[0].style.width=""),this.element.removeAttr("role").removeAttr("aria-label"),a.removeData(this.element[0],d)}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})};a.fn.toolbarsearchfield=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="toolbarsearchfield",e={clearable:!0,collapsible:!0,collapsibleOnMobile:!0},f=a.extend({},e,b);return c.prototype={init:function(){return this.build().handleEvents()},build:function(){this.id||(this.id=this.element.uniqueId("toolbar-searchfield")),this.input=this.element,this.toolbarParent=this.element.parents(".toolbar"),this.containmentParent=this.toolbarParent;var b=this.containmentParent.closest(".module-tabs");b.length&&(this.containmentParent=b),this.getToolbarElements();var c=this.element.attr("placeholder")||this.element.prev("label, .label").text().trim();c&&""!==c||(c=Locale.translate("Keyword")),this.input.attr({"aria-label":c});var d=a.extend({noToolbarSearchfieldInvoke:!0},this.settings,a.fn.parseOptions(this.input[0]));this.input.searchfield(d),this.inputWrapper=this.input.parent(),this.inputWrapper.addClass("toolbar-searchfield-wrapper"),d.categories&&(this.button=this.inputWrapper.find(".searchfield-category-button"));var e=this.settings.collapsible?"removeClass":"addClass";return this.inputWrapper[e]("non-collapsible"),this.xButton=this.inputWrapper.children(".icon.close"),this.adjustOnBreakpoint(),this},handleDeactivationEvents:function(){return this.addDocumentDeactivationEvents()},addDocumentDeactivationEvents:function(){var b=this;if(!this.handleOutsideStr){var c=["click"].map(function(a){return a+"."+b.id});this.handleOutsideStr=c.join(" ")}a(document).on(b.handleOutsideStr,function(a){b.handleOutsideClick(a)})},removeDocumentDeactivationEvents:function(){var b=this;a(document).off(this.handleOutsideStr,function(a){b.handleOutsideClick(a)})},hasFocus:function(){return this.element.data("searchfield").hasFocus()},handleFocus:function(){function a(){b.expand()}var b=this;if(clearTimeout(this.focusTimer),this.inputWrapper.addClass("has-focus"),this.fastExpand)return void a();this.focusTimer=setTimeout(a,0)},handleFakeBlur:function(){function a(){b.collapse()}var b=this;clearTimeout(this.focusTimer),this.focusTimer=setTimeout(a,100)},handleOutsideClick:function(){this.hasFocus()||(a(document).off(this.outsideEventStr),this.collapse())},handleKeydown:function(a){if(9===a.which)return this.handleFakeBlur()},handleOutsideKeydown:function(b){var c=b.which;return this.fastExpand=!1,9===c?(this.fastExpand=!0,this.handleFakeBlur()):!a(b.target).is(this.input)&&!a(b.target).is(this.inputWrapper)||37!==c&&38!==c&&39!==c&&40!==c?void 0:this.handleFakeBlur()},handlePopupBeforeOpen:function(a,b){return!!b&&(!!this.inputWrapper.is(".is-open")||(this.button.focus(),!1))},getFillSize:function(b,c){function d(a){if(!a)return 0;if(!isNaN(parseInt(a)))return parseInt(a);if(a instanceof jQuery){if(!a.length)return;a.is(".title")&&(a=a.next(".buttonset")),a=a[0]}return a}function e(b,c){if(!isNaN(b))return null===b||void 0===b?0:b;c&&"string"==typeof c||(c="left");var d=["left","right"];-1===a.inArray(c,d)&&(c=d[0]);var e;return(b instanceof HTMLElement||b instanceof SVGElement)&&(e=b.getBoundingClientRect()),e[c]}var f=0,g=0;if(b=d(b),c=d(c),f=e(b),g=e(c,function(){var d="left";return(b===c||a(c).length&&a(c).is(".buttonset"))&&(d="right"),d}()),!f&&!g)return 230;var h=g-f;return h<=230?230:h>=450?450:h},setClosedWidth:function(){if(this.button instanceof a&&this.button.length){var b=window.getComputedStyle(this.button[0]),c=parseInt(b.width),d=parseInt(b.paddingLeft)+parseInt(b.paddingRight);this.inputWrapper[0]&&(this.inputWrapper[0].style.width=c+d+"px")}},setOpenWidth:function(){if(this.inputWrapper[0]&&(this.inputWrapper[0].style.width=this.openWidth),this.button instanceof a&&this.button.length){var b=window.getComputedStyle(this.button[0]),c=parseInt(b.width),d=parseInt(b.paddingLeft)+parseInt(b.paddingRight),e=2*parseInt(b.borderWidth),f="calc(100% - "+(c+d+e-2)+"px)";this.input[0].style.width=f}},calculateOpenWidth:function(){var a,b=this.element.parents(".toolbar").children(".buttonset"),c=this.inputWrapper.next();if(c.is(".title")&&(c=b),this.shouldBeFullWidth())return a="100%",this.toolbarParent.closest(".header").length&&(a="calc(100% - 40px)"),this.toolbarParent.closest(".tab-container.module-tabs").length&&(a="calc(100% - 1px)"),void(this.openWidth=a);if(b.length){var d=b.offset().left+10,e=c;e.length||(e=b.offset().left+10+b.outerWidth(!0)),a=this.getFillSize(d,e),this.openWidth=a-1+"px"}},isActive:function(){return this.inputWrapper.hasClass("active")},isOpen:function(){return this.inputWrapper.hasClass("is-open")},adjustOnBreakpoint:function(){if(this.shouldBeFullWidth())if(this.hasFocus()){if(this.appendToParent(),this.calculateOpenWidth(),this.setOpenWidth(),this.isExpanded)return;this.expand()}else!0===this.settings.collapsibleOnMobile&&this.isExpanded&&this.collapse();else this.appendToButtonset(),this.settings.collapsible||(this.calculateOpenWidth(),this.setOpenWidth(),this.isExpanded||this.expand()),!this.hasFocus()&&!0===this.settings.collapsible&&this.isExpanded&&this.collapse()},getToolbarElements:function(){this.buttonsetElem=this.toolbarParent.children(".buttonset")[0],this.toolbarParent.children(".title").length&&(this.titleElem=this.toolbarParent.children(".title")[0])},expand:function(a){function b(){c.isOpen()||(c.inputWrapper.addClass("is-open"),c.calculateOpenWidth(),c.setOpenWidth());var b=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);a&&!b||c.input.focus();var d=[];f&&d.push(f),c.toolbarParent.triggerHandler("recalculate-buttons",d),c.inputWrapper.triggerHandler("expanded"),c.isExpanded=!0}var c=this,d=!this.shouldBeFullWidth();if(!this.isActive()){var e,f,g=this.toolbarParent.data("toolbar");if(g&&(e=this.toolbarParent.data("toolbar").settings),this.animationTimer&&clearTimeout(this.animationTimer),void 0===this.buttonsetElem&&this.getToolbarElements(),d){var h=parseInt(window.getComputedStyle(this.buttonsetElem).width),i=230;h<230&&(i=230-h);var j=h+230;if(f={buttonset:j},e&&!0===e.favorButtonset&&this.titleElem){var k,l=window.getComputedStyle(this.toolbarParent[0]),m=window.getComputedStyle(this.titleElem),n=parseInt(l.width),o=parseInt(l.paddingLeft)+parseInt(l.paddingRight),p=parseInt(m.width),q=this.toolbarParent.children("more"),r=0;q.length&&(k=window.getComputedStyle(q[0]),r=k.width),n<o+p+j+r&&(f.title=p-i)}!0}else this.appendToParent();if(this.inputWrapper.addClass("active"),this.addDocumentDeactivationEvents(),this.shouldExpandOnMobile())return void b();this.animationTimer=setTimeout(b,0)}},collapse:function(){function b(){d.button instanceof a&&d.button.length?d.setClosedWidth():d.inputWrapper.removeAttr("style")}function c(){d.fastExpand=!1,b(),d.button&&d.button.length&&d.button.data("popupmenu").close(!1,!0),d.inputWrapper.removeClass("is-open").triggerHandler("collapsed"),d.removeDocumentDeactivationEvents(),d.isExpanded=!1,"ios"===Soho.env.os.name&&a("head").triggerHandler("enable-zoom"),
d.inputWrapper.one(a.fn.transitionEndName(),function(){d.toolbarParent.triggerHandler("recalculate-buttons")})}var d=this,e="removeClass";if(this.appendToButtonset(),""!==this.input.val().trim()&&(e="addClass"),this.inputWrapper[e]("has-text"),this.animationTimer&&clearTimeout(this.animationTimer),d.inputWrapper.removeClass("active"),d.hasFocus()||d.inputWrapper.removeClass("has-focus"),!(!1===d.settings.collapsible&&!1===d.settings.collapsibleOnMobile||!1===d.settings.collapsible&&!0===d.settings.collapsibleOnMobile&&!d.shouldBeFullWidth()))return this.fastExpand||!this.shouldExpandOnMobile()?void c():void(this.animationTimer=setTimeout(c,310))},saveFocus:function(){this.hasFocus()&&(this.focusElem=document.activeElement)},restoreFocus:function(){this.focusElem&&(this.focusElem.focus(),this.focusElem=void 0)},appendToParent:function(){this.inputWrapper.parent().is(this.containmentParent)||(this.saveFocus(),this.elemBeforeWrapper=this.inputWrapper.prev(),this.inputWrapper.detach().prependTo(this.containmentParent),Soho.utils.fixSVGIcons(this.inputWrapper),this.restoreFocus())},appendToButtonset:function(){this.inputWrapper.parent().is(this.containmentParent)&&(this.saveFocus(),this.elemBeforeWrapper instanceof a&&this.elemBeforeWrapper.length?(this.inputWrapper.detach().insertAfter(this.elemBeforeWrapper),this.elemBeforeWrapper=null):this.inputWrapper.prependTo(this.toolbarParent.children(".buttonset")),this.removeDocumentDeactivationEvents(),this.toolbarParent.triggerHandler("scrollup"),Soho.utils.fixSVGIcons(this.inputWrapper),this.restoreFocus())},shouldBeFullWidth:function(){var a=this.inputWrapper.closest(".header"),b=!1;return a.length&&(b=a.width()<Soho.breakpoints.phone),b||Soho.breakpoints.isBelow("phone-to-tablet")},shouldExpandOnMobile:function(){return!0!==this.settings.collapsible&&(!0===this.settings.collapsibleOnMobile||this.shouldBeFullWidth())},updated:function(){return this.teardown().init()},enable:function(){this.inputWrapper.addClass("is-disabled"),this.input.prop("disabled",!0)},disable:function(){this.inputWrapper.removeClass("is-disabled"),this.input.prop("disabled",!1)},teardown:function(){return this.inputWrapper.off("mousedown.toolbarsearchfield focusin.toolbarsearchfield keydown.toolbarsearchfield collapse.toolbarsearchfield"),this.inputWrapper.find(".icon").remove(),a(document).off(this.outsideEventStr),this.toolbarParent.off("navigate.toolbarsearchfield"),this.element.off("blur.toolbarsearchfield"),this.xButton&&this.xButton.length&&this.xButton.remove(),a(document).off("keydown."+this.id),a("body").off("resize."+this.id),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)},handleEvents:function(){var b=this;return this.inputWrapper.on("mousedown.toolbarsearchfield",function(){b.fastExpand=!0}).on("focusin.toolbarsearchfield",function(a){b.handleFocus(a)}).on("keydown.toolbarsearchfield",function(a){b.handleKeydown(a)}).on("collapse.toolbarsearchfield",function(){b.collapse()}),this.button&&this.button.length&&this.button.on("beforeopen.toolbarsearchfield",function(a,c){return b.handlePopupBeforeOpen(a,c)}),this.toolbarParent.on("navigate.toolbarsearchfield",function(){b.hasFocus()||b.collapse()}),a(document).on("keydown."+this.id,function(a){b.handleOutsideKeydown(a)}),a("body").on("resize."+this.id,function(){b.adjustOnBreakpoint()}),b.adjustOnBreakpoint(),"ios"===Soho.env.os.name&&this.element.on("blur.toolbarsearchfield",function(){a("head").triggerHandler("disable-zoom")}),this}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.tooltip=function(b,c){"use strict";function d(b,c){this.settings=a.extend({},f,c),this.element=a(b),Soho.logTimeStart(e),this.init(),Soho.logTimeEnd(e)}var e="tooltip",f={content:null,offset:{top:10,left:10},placement:"top",trigger:"hover",title:null,beforeShow:null,popover:null,closebutton:null,isError:!1,isErrorColor:!1,tooltipElement:null,parentElement:null,keepOpen:!1,extraClass:null,placementOpts:void 0,maxWidth:null};return d.prototype={init:function(){this.setup(),this.appendTooltip(),"immediate"!==this.settings.trigger&&this.setContent(this.settings.content,!0),this.handleEvents()},setup:function(){this.activeElement=this.settings.parentElement instanceof a&&this.settings.parentElement.length?this.settings.parentElement:this.element,this.descriptionId=a(".tooltip-description").length+1,this.description=this.element.parent().find(".tooltip-description"),!this.description.length&&this.settings.isError&&(this.description=a('<span id="tooltip-description-'+this.descriptionId+'" class="tooltip-description audible"></span>').insertAfter(this.element)),this.element.is(".dropdown, .multiselect")&&(this.activeElement=this.element.nextAll(".dropdown-wrapper:first").find(">.dropdown"));var b=this.element.attr("title");(!this.settings.popover&&b&&b.length||!this.settings.popover&&this.settings.title)&&(this.settings.content=this.settings.title?this.settings.title:b,this.element.removeAttr("title")),this.isPopover=null!==this.settings.content&&"object"==typeof this.settings.content||!0===this.settings.popover,this.settings.closebutton=!(!this.settings.closebutton&&!this.element.data("closebutton")),this.element.data("extraClass")&&this.element.data("extraClass").length&&(this.settings.extraClass=this.element.data("extraClass")),this.isRTL=Locale.isRTL()},addAria:function(){this.content&&(this.description.text(this.content),this.content=this.addClassToLinks(this.content,"links-clickable"),this.isPopover||this.element.removeAttr("title").attr("aria-describedby",this.description.attr("id")),this.isPopover&&"click"===this.settings.trigger&&this.element.attr("aria-haspopup",!0))},addClassToLinks:function(b,c){if(b instanceof a&&b.length>0)return b;var d=a("<div/>").html(b);return a("a",d).addClass(c),d.html()},appendTooltip:function(){if(this.tooltip=a(this.settings.tooltipElement?this.settings.tooltipElement:"#tooltip"),!this.tooltip.length){var b=this.settings.tooltipElement?this.settings.tooltipElement.substring(1,this.settings.tooltipElement.length):"tooltip";this.tooltip=a('<div class="'+(this.isPopover?"popover":"tooltip")+' bottom is-hidden" role="tooltip" id="'+b+'"><div class="arrow"></div><div class="tooltip-content"></div></div>')}this.tooltip.place({container:this.scrollparent,parent:this.activeElement,placement:this.settings.placement,strategy:"flip"}),this.setTargetContainer()},handleEvents:function(){function a(){c.tooltip.hasClass("is-hidden")||c.hide(),c.show()}var b,c=this;"hover"!==this.settings.trigger||this.settings.isError||(this.element.is(".dropdown, .multiselect")?this.activeElement:this.element).on("mouseenter.tooltip",function(){b=setTimeout(function(){c.show()},400)}).on("mouseleave.tooltip mousedown.tooltip click.tooltip mouseup.tooltip",function(){clearTimeout(b),setTimeout(function(){c.hide()},400)}).on("updated.tooltip",function(){c.updated()}),"click"===this.settings.trigger&&this.element.on("click.tooltip",function(){a()}),"immediate"===this.settings.trigger&&(b=setTimeout(function(){a()},1)),"focus"===this.settings.trigger&&this.element.on("focus.tooltip",function(){c.show()}).on("blur.tooltip",function(){c.settings.keepOpen||c.hide()}),this.matchMedia=window.matchMedia("(orientation: landscape)"),this.mediaQueryListener=function(){c.tooltip.hasClass("is-hidden")||c.close()},this.matchMedia.addListener(this.mediaQueryListener)},setContent:function(b,c){function d(){!0!==c&&(e.addAria(),e.render())}var e=this,f=this.settings.content,g=void 0===b||null===b,h=void 0===f||null===f;if(g&&h)return!1;if("function"==typeof f&&(b=f),g&&(b=f),b===this.content)return d(),!0;if(b instanceof a&&b.length)return this.content=b.addClass("hidden"),d(),!0;if("string"==typeof b){if(!b.length)return!1;if(b=Locale.translate(b)||b,0===b.indexOf("#")){var i=a(""+b);return!!i.length&&(this.content=i,d(),!0)}}else{if("function"!=typeof b)return!1;var j=b.call(this.element);if(!j||"string"!=typeof j||!j.length)return!1;b=j}return this.content=a.sanitizeHTML(b),this.content="<p>"+this.content+"</p>",d(),!0},render:function(){return this.isPopover?this.renderPopover():this.renderTooltip()},renderTooltip:function(){var a=this.tooltip[0].querySelectorAll(".tooltip-title")[0],b=this.tooltip[0].querySelectorAll(".tooltip-content")[0],c=this.settings.extraClass,d=this.content,e=this.tooltip[0],f="tooltip is-hidden";c&&(f+=" "+c),e.setAttribute("class",f),a&&(a.style.display="none"),b.previousElementSibling.classList.contains("arrow")||b.insertAdjacentHTML("beforebegin",'<div class="arrow"></div>'),"string"==typeof this.content?b.innerHTML=d:b.innerHTML=d[0].innerHTML},renderPopover:function(){var b=this,c=this.settings.extraClass,d=this.content,e=this.tooltip.find(".tooltip-content"),f=this.tooltip[0].querySelector(".tooltip-title"),g="popover is-hidden";if(c&&(g+=" "+c),this.tooltip[0].setAttribute("class",g),"string"==typeof d?(d=a(d),e.html(d),e.find(".hidden").removeClass("hidden")):e.html(d),d[0].classList.remove("hidden"),e[0].firstElementChild.classList.remove("hidden"),null!==this.settings.title)if(f)f.childNodes[0].nodeValue=this.settings.title;else{var h=document.createDocumentFragment();f=document.createElement("div"),f.innerHTML=this.settings.title,f.classList.add("tooltip-title"),h.appendChild(f),this.tooltip[0].insertBefore(h,this.tooltip[0].firstChild)}if(this.settings.closebutton&&f&&!f.firstElementChild){var i=a('<button type="button" class="btn-icon l-pull-right" style="margin-top: -9px">'+a.createIcon({classes:["icon-close"],icon:"close"})+"<span>Close</span></button>").on("click",function(){b.hide()});f.appendChild(i[0])}d.initialize()},open:function(){return this.show()},show:function(b,c){var d=this;if(this.isInPopup=!1,b&&(this.settings=a.extend({},this.settings,b)),this.settings.beforeShow&&!c){var e=function(a){d.show({content:a},!0)};return"string"==typeof this.settings.beforeShow?void window[this.settings.beforeShow](e):void this.settings.beforeShow(e)}var f=!0;!1!==(f=this.setContent(this.content))&&!1!==(f=this.element.triggerHandler("beforeshow",[this.tooltip]))&&(this.tooltip[0].setAttribute("style",""),this.tooltip[0].classList.add(this.settings.placement),(this.settings.isError||this.settings.isErrorColor)&&this.tooltip[0].classList.add("is-error"),this.position(),this.element.trigger("show",[this.tooltip]),setTimeout(function(){a(document).on("mouseup.tooltip",function(b){var c=a(b.target);d.settings.isError||"focus"===d.settings.trigger||c.is(d.element)&&c.is("svg.icon")||a("#editor-popup").length&&a("#colorpicker-menu").length||0===c.closest(".popover").length&&0===c.closest(".dropdown-list").length&&d.hide(b)}).on("keydown.tooltip",function(a){(27===a.which||d.settings.isError)&&d.hide()}),!d.settings.isError||d.element.is(":visible")||d.element.is(".dropdown")||d.hide(),void 0===window.orientation&&a("body").on("resize.tooltip",function(){d.hide()}),a("body").on("scroll.tooltip",function(){d.hide()}),d.element.closest(".modal-body-wrapper").on("scroll.tooltip",function(){d.hide()}),d.element.closest(".scrollable").on("scroll.tooltip",function(){d.hide()}),d.element.closest(".datagrid-body").on("scroll.tooltip",function(){d.hide()}),d.settings.isError&&d.tooltip.on("click.tooltip",function(){d.hide()}),d.element.trigger("aftershow",[d.tooltip])},400))},setTargetContainer:function(){var b=a("body");this.scrollparent=this.element.closest(".page-container.scrollable"),this.scrollparent.length&&(b=this.scrollparent),this.settings.parentElement&&(b=this.settings.parentElement),b[0].appendChild(this.tooltip[0])},handleAfterPlace:function(a,b){this.tooltip.data("place").setArrowPosition(a,b,this.tooltip),this.tooltip.triggerHandler("tooltipafterplace",[b])},position:function(){this.setTargetContainer(),this.tooltip[0].classList.remove("is-hidden");var b=this,c=this.isPopover?20:10,d=this.settings.placementOpts||{},e=a.extend({},{x:0,y:c,container:this.scrollparent,containerOffsetX:d.containerOffsetX||this.settings.offset.left,containerOffsetY:d.containerOffsetY||this.settings.offset.top,parent:d.parent||this.activeElement,placement:d.placement||this.settings.placement,strategies:["flip","nudge"]},d);return"left"!==e.placement&&"right"!==e.placement||(e.x=c,e.y=0),this.tooltip.one("afterplace.tooltip",function(a,c){b.handleAfterPlace(a,c)}),this.tooltip.data("place").place(e),this},close:function(){return this.hide()},hide:function(){if(!this.settings.keepOpen){if(this.isInPopup)return void this.settings.content.addClass("hidden");this.tooltip[0].classList.add("is-hidden"),this.tooltip[0].style.left="",this.tooltip[0].style.top="",this.tooltip.find(".arrow").removeAttr("style"),this.detachOpenEvents(),0===a(".popover").not(".is-hidden").length&&(a(document).off("mouseup.tooltip keydown.tooltip"),a("body").off("resize.tooltip")),this.element.trigger("hide",[this.tooltip])}},updated:function(){var a=this;return"immediate"===a.settings.trigger?setTimeout(function(){a.show()},100):a.setContent(),this},detachOpenEvents:function(){this.tooltip.off("click.tooltip"),a(document).off("mouseup.tooltip"),a("body").off("resize.tooltip scroll.tooltip"),this.element.closest(".modal-body-wrapper").off("scroll.tooltip"),this.element.closest(".scrollable").off("scroll.tooltip"),this.element.closest(".datagrid-body").off("scroll.tooltip")},teardown:function(){return this.description.remove(),this.descriptionId=void 0,this.activeElement=void 0,this.element.removeAttr("aria-describedby").removeAttr("aria-haspopup"),this.tooltip.hasClass("is-hidden")||this.hide(),this.element.off("mouseenter.tooltip mouseleave.tooltip mousedown.tooltip click.tooltip mouseup.tooltip updated.tooltip focus.tooltip blur.tooltip"),this.detachOpenEvents(),this.matchMedia&&this.matchMedia.removeListener(this.mediaQueryListener),this},destroy:function(){this.teardown(),a.removeData(this.element[0],e)}},this.each(function(){var f=a.data(this,e);if(f)return"function"==typeof f[b]&&f[b](c),f.settings=a.extend({},f.settings,b),void f.updated();f=a.data(this,e,new d(this,b))})},a.fn.popover=a.fn.tooltip,a.fn.tree=function(b){function c(b){this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="tree",e={selectable:"single",hideCheckboxes:!1,menuId:null,useStepUI:!1,folderIconOpen:"open-folder",folderIconClosed:"closed-folder",sortable:!1,onBeforeSelect:null},f=a.extend({},e,b);return c.prototype={init:function(){this.settings=a.extend({},f),this.isIe11="ie"===Soho.env.browser.name&&"11"===Soho.env.browser.version,this.initTree(),this.handleKeys(),this.setupEvents(),this.loadData(this.settings.dataset),this.syncDataset(this.element),this.initSelected(),this.focusFirst(),this.attachMenu(this.settings.menuId),this.createSortable()},initTree:function(){var b=this,c=this.settings,d=this.element.find("a"),e=this.element.attr("data-selectable");c.selectable=void 0===e||"single"!==e.toLowerCase()&&"multiple"!==e.toLowerCase()?c.selectable:e,this.isMultiselect="multiple"===c.selectable,c.hideCheckboxes=c.hideCheckboxes||!this.isMultiselect,this.element.addClass(this.isMultiselect?" is-muliselect":""),d.each(function(){var c=a(this);b.decorateNode(c)})},initSelected:function(){var b=this;this.element.find("li").each(function(){b.setNodeStatus(a("a:first",this))})},focusFirst:function(){this.element.find("a:first").attr("tabindex","0")},setFocus:function(a){a.focus()},decorateNode:function(b){var c,d=0,e=b.attr("data-badge"),f=b.attr("data-alert-icon"),g={elem:a('<span class="tree-badge badge"></span>')},h=b.parentsUntil(this.element,"ul[role=group].is-disabled").length>0,i=b.hasClass("is-disabled")||h;if(void 0!==e&&(e=a.fn.parseOptions(b,"data-badge")),b.attr({role:"treeitem",tabindex:"-1","aria-selected":"false"}),i){b.addClass("is-disabled").attr("aria-disabled","true");var j=b.next();j.is("ul.is-open")&&(a("a",j).addClass("is-disabled").attr("aria-disabled","true"),a("ul",b.parent()).addClass("is-disabled"))}d=b.parentsUntil(this.element,"ul").length-1,b.attr("aria-level",d+1);var k=b.parent().index();b.attr("aria-posinset",k+1);var l=b.closest("li").siblings().addBack().length;b.attr("aria-setsize",l),b.next("ul").children().length>0&&b.attr("aria-expanded",b.next().hasClass("is-open")?"true":"false"),c=b.next();var m=b.contents().filter(function(){return!a(this).is(".tree-badge")}).text();b.text(""),0===b.children("svg.icon-tree").length&&(b.prepend(a.createIcon({icon:"tree-node",classes:["icon-tree"]})),this.settings.useStepUI&&b.prepend(a.createIcon({icon:f,classes:["step-alert","icon-"+f]}))),this.isMultiselect&&!this.settings.hideCheckboxes&&b.append('<span class="tree-checkbox"></span>'),e&&!e.remove&&(g.text="",void 0!==e.text&&(g.text=e.text.toString(),g.elem.html(g.text),1===g.text.length&&g.elem.addClass("round")),/info|good|error|alert|pending/i.test(e.type)?g.elem.addClass(e.type):e.type&&"#"===e.type.charAt(0)&&7===e.type.length&&g.elem.css("background-color",e.type),""!==g.elem.text()&&b.append(g.elem),e.type&&-1!==e.type.indexOf("pending")&&g.elem.text("")),b.append('<span class="tree-text">'+m+"</span>"),b.is('[class^="icon"]')&&this.setTreeIcon(b.find("svg.icon-tree"),b.attr("class")),c.is("ul")&&(c.attr("role","group").parent().addClass("folder"),this.setTreeIcon(b.find("svg.icon-tree"),c.hasClass("is-open")?this.settings.folderIconOpen:this.settings.folderIconClosed),b.attr("class")&&-1===b.attr("class").indexOf("open")&&-1===b.attr("class").indexOf("closed")&&(b.attr("class",i?"is-disabled":""),this.setTreeIcon(b.find("svg.icon-tree"),c.hasClass("is-open")?this.settings.folderIconOpen:this.settings.folderIconClosed)),b.is('[class^="icon"]')&&this.setTreeIcon(b.find("svg.icon-tree"),c.hasClass("is-open")?b.attr("class"):b.attr("class").replace("open","closed"))),b.addClass("hide-focus"),b.hideFocus()},setTreeIcon:function(a,b){var c=b.replace(/#?icon-|hide-focus|\s?/gi,"");a.changeIcon(c)},expandAll:function(b){var c=this;b=b||this.element.find("ul[role=group]"),b.each(function(){var b=a(this);b.addClass("is-open"),c.setTreeIcon(b.prev("a").find("svg.icon-tree"),c.settings.folderIconOpen),b.prev("a").is('[class^="icon"]')&&c.setTreeIcon(b.prev("svg.icon-tree"),b.prev("a").attr("class"))})},collapseAll:function(b){var c=this;b=b||this.element.find("ul[role=group]"),b.each(function(){var b=a(this);b.removeClass("is-open"),c.setTreeIcon(b.prev("a").find("svg.icon-tree"),c.settings.folderIconClosed),b.prev("a").is('[class^="icon"]')&&c.setTreeIcon(b.prev("a").find("svg.icon-tree"),b.prev("a").attr("class").replace("open","closed").replace(" hide-focus","").replace(" is-selected","")),b.prev("a").is('[class^="icon"]')&&c.setTreeIcon(b.prev("svg.icon-tree"),b.prev("a").attr("class").replace("open","closed"))})},isjQuery:function(a){return a&&(a instanceof jQuery||a.constructor.prototype.jquery)},selectNodeById:function(a){this.selectNodeByJquerySelector("#"+a)},selectNodeByJquerySelector:function(b){var c=this.isjQuery(b)?b:a(b);if(c.length&&!c.is(".is-disabled")){var d=c.parentsUntil(this.element,"ul[role=group]");this.expandAll(d),this.selectNode(c,!0)}},unSelectedNode:function(b,c){if(0!==b.length){var d=this;a("a",this.element).attr("tabindex","-1"),b.attr("tabindex","0"),a("a:not(.is-disabled)",b.parent()).attr("aria-selected","false").parent().removeClass("is-selected"),this.syncNode(b),this.setNodeStatus(b),c&&b.focus(),a("li",d.element).removeClass("is-active"),b.parent().addClass("is-active"),setTimeout(function(){var a=b.data("jsonData")||{};d.element.triggerHandler("unselected",{node:b,data:a})},0)}},selectNode:function(a,b){var c=this;if(0!==a.length){var d;"function"==typeof c.settings.onBeforeSelect?(d=c.settings.onBeforeSelect(a),d.done&&"function"==typeof d.done?d.done(function(d){d&&c.selectNodeFinish(a,b)}):d&&c.selectNodeFinish(a,b)):c.selectNodeFinish(a,b)}},selectNodeFinish:function(b,c){var d=this,e=a("a",this.element);e.attr("tabindex","-1"),b.attr("tabindex","0"),this.isMultiselect?a("a:not(.is-disabled)",b.parent()).attr("aria-selected","true").parent().addClass("is-selected"):(e.attr("aria-selected","false").parent().removeClass("is-selected"),e.attr("aria-selected","false").removeClass("is-selected"),b.attr("aria-selected","true").parent().addClass("is-selected")),this.syncNode(b),this.loading||this.setNodeStatus(b),c&&b.focus(),a("li",d.element).removeClass("is-active"),b.parent().addClass("is-active"),setTimeout(function(){var a=b.data("jsonData")||{};d.element.triggerHandler("selected",{node:b,data:a})},0)},setNodeStatus:function(b){var c,d=this,e=b.data("jsonData");if(!this.isMultiselect)return b.removeClass("is-selected is-partial"),void(e&&e.selected&&b.addClass("is-selected"));var f=function(b,c){b.each(function(){var b=a("a:first",this),e=b.parent(),f=d.getSelectedStatus(b,c);"mixed"===f?e.removeClass("is-selected is-partial").addClass("is-partial"):f?e.removeClass("is-selected is-partial").addClass("is-selected"):e.removeClass("is-selected is-partial"),d.syncNode(b)})},g=!1;c=b.parent().find("li.folder"),f(c,g),g=!(!c.length&&e&&!e.selected),c=b.parentsUntil(this.element,"li.folder"),f(c,g)},getSelectedStatus:function(b,c){var d,e=0,f=0,g=0;return b.parent().find("a").each(function(b){c&&0===b||(e++,d=a(this).data("jsonData"),d&&d.selected?f++:g++)}),e===f||e!==g&&"mixed"},toggleNode:function(a){var b=a.next(),c=this;if(b.is('ul[role="group"]'))if(b.hasClass("is-open"))c.setTreeIcon(a.closest(".folder").removeClass("is-open").end().find("svg.icon-tree"),c.settings.folderIconClosed),a.closest(".folder a").is('[class^="icon"]')&&c.setTreeIcon(a.closest(".folder a").find("svg.icon-tree"),a.closest(".folder a").attr("class").replace("open","closed").replace(" hide-focus","").replace(" is-selected","")),c.isAnimating=!0,c.isMultiselect||(c.unSelectedNode(a.parent().find("li.is-selected"),!1),a.removeClass("is-selected")),b.one("animateclosedcomplete",function(){b.removeClass("is-open"),c.isAnimating=!1}).animateClosed(),a.attr("aria-expanded","true"!==a.attr("aria-expanded"));else{var d=a.data("jsonData");if(c.settings.source&&d.children&&0===d.children.length){var e=function(e){var f=d.id,g=c.findById(f);g.children=e,c.addChildNodes(g,a.parent()),a.removeClass("is-loading"),c.loading=!1,c.openNode(b,a),d.children=e,a.data("jsonData",d),c.selectNode(a,!0),c.initSelected()},f={node:a,data:a.data("jsonData")};return c.settings.source(f,e),a.addClass("is-loading"),void(c.loading=!0)}c.openNode(b,a)}},openNode:function(a,b){var c=this;c.setTreeIcon(b.closest(".folder").addClass("is-open").end().find("svg.icon-tree"),c.settings.folderIconOpen),b.is('[class^="icon"]')&&c.setTreeIcon(b.find("svg.icon-tree"),b.attr("class").replace(" hide-focus","").replace(" is-selected","")),c.isAnimating=!0,a.one("animateopencomplete",function(){c.isAnimating=!1}).addClass("is-open").css("height",0).animateOpen(),b.attr("aria-expanded","true"!==b.attr("aria-expanded"))},setupEvents:function(){var a=this;a.element.on("updated.tree",function(){a.initTree()})},handleKeys:function(){var b=this;this.element.on("click.tree","a:not(.is-clone)",function(c){var d=a(this),e=d.parent();return d.is(".is-disabled, .is-loading")||(b.isMultiselect?a(c.target).is(".icon")&&e.is(".folder")?b.toggleNode(d):e.is(".is-selected, .is-partial")?b.unSelectedNode(d,!0):b.selectNode(d,!0):(b.selectNode(d,!0),b.toggleNode(d)),c.stopPropagation()),!1}),this.element.on("focus.tree","a",function(){var b=a(this);if(0===parseInt(b.attr("aria-level"))&&1===parseInt(b.attr("aria-posinset"))&&b.hasClass("is-disabled")){var c=a.Event("keydown.tree");return c.keyCode=40,void b.trigger(c)}}),this.element.on("keydown.tree","a",function(c){var d,e,f=c.charCode||c.keyCode,g=a(this);if(!b.isAnimating){if(40===f){var h=b.getNextNode(g);b.setFocus(h)}if(38===f){var i=b.getPreviousNode(g);b.setFocus(i)}if(32===c.keyCode&&g.trigger("click.tree"),37===f)return Locale.isRTL()?g.next().hasClass("is-open")?(e=g.next().find("a:first"),b.setFocus(e)):b.toggleNode(g):g.next().hasClass("is-open")?b.toggleNode(g):(e=g.closest(".folder").find("a:first"),b.setFocus(e)),c.stopPropagation(),!1;if(39===f)return Locale.isRTL()?g.next().hasClass("is-open")?b.toggleNode(g):(d=g.closest(".folder").find("a:first"),b.setFocus(d)):g.next().hasClass("is-open")?(d=g.next().find("a:first"),b.setFocus(d)):(b.toggleNode(g),b.setFocus(g)),c.stopPropagation(),!1;36===f&&(d=b.element.find("a:first:visible"),b.setFocus(d)),35===f&&(d=b.element.find("a:last:visible"),b.setFocus(d))}}),this.element.on("keypress.tree","a",function(c){var d=c.charCode||c.keyCode,e=a(this);if(d>=37&&d<=40||32===d)return c.stopPropagation(),!1;0!==c.which&&e.closest("li").nextAll().find("a:visible").each(function(){var d=a(this);if(d.text().substr(0,1).toLowerCase()===String.fromCharCode(c.which).toLowerCase())return b.setFocus(d),!1})})},loadData:function(a){var b=this;if(a){b.element.empty(),b.loading=!0;for(var c=0;c<a.length;c++)b.addNode(a[c],"bottom");b.loading=!1,b.syncDataset(b.element)}},addToDataset:function(a,b){var c;return a.parent&&(c=this.findById(a.parent)),"bottom"!==b||a.parent||c||this.settings.dataset.push(a),"top"!==b||a.parent||c||this.settings.dataset.unshift(a),a.parent&&c&&(c.children||(c.children=[]),"bottom"===b?c.children.push(a):c.children.unshift(a)),!(a.parent&&!c)},findById:function(a,b){var c,d=this;b||(b=this.settings.dataset);for(c in b){var e=b[c];if(e.id===a)return e;if(e.children){var f=d.findById(a,e.children);if(f)return f}}return null},getNodeByIdIfSelected:function(a,b){var c=this.findById(a,b);return c&&c.selected?c:null},getSelectedNodes:function(){var b,c,d=[];return a("li.is-selected",this.element).each(function(){b=a("a:first",this),c=b.data("jsonData"),d.push({node:b,data:c})}),d},getNextNode:function(a){var b=a.parent().next().find("a:first"),c=a.next();if(c.is("ul.is-open")&&(b=c.find("a:first")),b.hasClass("is-disabled")&&(b=b.parent().next().find("a:first")),0===b.length)for(var d=0,e=a;d<1e3&&(e=e.parent().closest(".folder"),b=e.next().find("a:first"),!b.length);d++);return b.hasClass("is-disabled")&&(b=this.getNextNode(b)),b},getPreviousNode:function(a){var b=a.parent().prev().find("a:first"),c=b.parent();return c.is(".folder.is-open")&&c.find("ul.is-open a").length&&!c.find("ul.is-disabled").length&&(b=c.find("ul.is-open a:last")),b.hasClass("is-disabled")&&(b=b.parent().prev().find("a:first"),c=b.parent(),c.is(".folder.is-open")&&c.find("ul.is-open a").length&&!c.find("ul.is-disabled").length&&(b=c.find("ul.is-open a:last"))),0===b.length&&(b=a.closest("ul").prev("a")),b.hasClass("is-disabled")&&(b=this.getPreviousNode(b)),b},syncDataset:function(b){var c=[],d=this;b.children("li").each(function(){var b=a(this),e=b.find("a:first"),f=d.syncNode(e);c.push(f)}),this.settings.dataset=c},syncNode:function(b){var c={},d=this,e=b.data("jsonData");c.node=b,c.id=b.attr("id"),c.text=b.find(".tree-text").text(),b.hasClass("is-open")&&(c.open=!0),b.attr("href")&&(c.href=b.attr("href")),b.parent().is(".is-selected")&&(c.selected=!0);var f=b.attr("class");if(f&&f.indexOf("icon")>-1&&(c.icon=b.attr("class")),b.next().is("ul")){var g=b.next();c.children=[],g.children("li").each(function(){var b=a(this),e=b.find("a:first");c.children.push(d.syncNode(e))})}return e&&(delete e.selected,c=a.extend({},e,c)),b.data("jsonData",c),c},addNode:function(b,c){var d=a("<li></li>"),e=a('<a href="#"></a>').appendTo(d),f="object"==typeof b.badge?JSON.stringify(b.badge):b.badge;c=c||"bottom",e.attr({id:b.id,href:b.href,"data-badge":f,"data-alert-icon":b.alertIcon}).text(b.text),b.open&&e.parent().addClass("is-open"),b.disabled&&e.addClass("is-disabled"),b.icon&&e.addClass(b.icon);var g=!!this.loading||this.addToDataset(b,c);return b.parent instanceof jQuery&&(g=!0),!(c instanceof jQuery)||b.parent&&g||b.parent instanceof jQuery||(c.append(d),g=!0),"bottom"!==c||b.parent&&g||this.element.append(d),"top"!==c||b.parent&&g||this.element.prepend(d),b.parent?(g&&"string"==typeof b.parent&&(d=this.element.find("#"+b.parent).parent(),!b.disabled&&d.is(".is-selected")&&void 0===b.selected&&(b.selected=!0),this.addAsChild(b,d)),b.parent&&b.parent instanceof jQuery&&(d=b.parent,b.parent.is("a")&&(d=b.parent.parent()),this.addAsChild(b,d)),b.node=d.find("ul li a#"+b.id)):(this.addChildNodes(b,d),b.node=d.children("a").first()),this.decorateNode(e),b.selected&&this.selectNode(e,b.focus),e.data("jsonData",b),d},addAsChild:function(b,c){var d=c.find("ul").first();0===d.length&&(d=a("<ul></ul>").appendTo(c),d.addClass("folder")),d.addClass(b.open?"is-open":""),this.decorateNode(c.find("a").first()),b.parent="",this.addNode(b,d)},addChildNodes:function(b,c){var d=this,e=c.find("ul");if(!b.children)return void e.remove();if(0===e.length&&(e=a("<ul></ul>").appendTo(c),e.addClass(b.open?"is-open":""),e.addClass("folder")),e.empty(),b.children)for(var f=0;f<b.children.length;f++){var g=b.children[f];d.addNode(g,e)}},isTrue:function(a){return void 0!==a&&null!==a&&("boolean"==typeof a&&!0===a||"string"==typeof a&&"true"===a.toLowerCase())},isFalse:function(a){return void 0!==a&&null!==a&&("boolean"==typeof a&&!1===a||"string"==typeof a&&"false"===a.toLowerCase())},updateNode:function(b){var c=this.findById(b.id);if(b.node&&(c={},c.node=b.node),c){var d=c.node.parent(),e=this.isTrue(b.disabled)||this.isFalse(b.enabled),f=this.isTrue(b.enabled)||this.isFalse(b.disabled);if(b.badge){var g=c.node.find(".tree-badge:first");g.length||b.badge.remove||b.badge.remove||void 0===b.badge.text||""===a.trim(b.badge.text)||(a('<span class="tree-badge badge"></span>').insertBefore(c.node.find(".tree-text:first")),g=c.node.find(".tree-badge:first")),g.length&&(void 0!==b.badge.text&&(b.badge.text=b.badge.text.toString(),g.text(b.badge.text).removeClass("round"),1===b.badge.text.length&&g.addClass("round")),void 0!==b.badge.type&&(g.removeClass("info good error alert pending"),/info|good|error|alert|pending/i.test(b.badge.type)?g.addClass(b.badge.type):b.type&&"#"===b.badge.type.charAt(0)&&7===b.badge.type.length&&g.elem.css("background-color",b.badge.type),-1!==b.badge.type.indexOf("pending")&&g.text("")),c.badge=b.badge,this.parseBool(b.badge.remove)&&(g.remove(),void 0!==c.badge&&delete c.badge))}if(b.text&&(c.node.find(".tree-text").first().text(b.text),c.text=b.text),b.icon&&(this.setTreeIcon(c.node.find("svg.icon-tree").first(),b.icon),c.icon=b.icon),e&&(c.node.addClass("is-disabled").attr("aria-disabled","true"),d.is(".folder.is-open")&&a("a, ul[role=group]",d).addClass("is-disabled").attr("aria-disabled","true")),f){c.node.parentsUntil(this.element,"ul[role=group].is-disabled").length>0||(c.node.removeClass("is-disabled").removeAttr("aria-disabled"),d.is(".folder.is-open")&&a("a, ul[role=group]",d).removeClass("is-disabled").removeAttr("aria-disabled"))}b.node&&this.syncDataset(this.element),b.children&&(b.children.length?this.addChildNodes(b,d):this.removeChildren(b,d))}},parseBool:function(a){return!/^(false|0)$/i.test(a)&&!!a},removeChildren:function(a,b){var c=b.find("ul");this.setTreeIcon(b.find("svg.icon-tree").first(),a.icon||"icon-tree-node"),b.removeClass("folder is-open"),c.remove()},removeNode:function(a){var b=this.findById(a.id);a instanceof jQuery?(b=a,b.parent().remove()):b&&b.node.parent().remove(),b&&this.syncDataset(this.element)},attachMenu:function(b){var c=this;b&&this.element.off("contextmenu.tree").on("contextmenu.tree","a",function(d){var e=a(this);return d.preventDefault(),a(d.currentTarget).popupmenu({menuId:b,eventObj:d,trigger:"immediate",attachToBody:!0}).off("selected").on("selected",function(a,b){c.element.triggerHandler("menuselect",{node:e,item:b})}),c.element.triggerHandler("menuopen",{menu:a("#"+b),node:e}),!1})},createSortable:function(){function b(){f.loading||(clearInterval(d),a(f.linkSelector,f.element).each(function(){var b=a(this);b.on("mousedown.tree",function(c){c.preventDefault(),e=3!==c.which&&(!a(c.target).is(".icon")||!b.parent().is(".folder"))}).drag({clone:!0,cloneAppendTo:b.closest("li"),clonePosIsFixed:!0}).on("dragstart.tree",function(d,g,h){
if(!h||!e)return b.removeClass("is-dragging"),void(h&&h.remove());c=h,c.removeAttr("id").addClass("is-dragging-clone"),c.find(".tree-checkbox, .tree-badge").remove(),f.sortable={startIndex:a(f.linkSelector,f.element).index(b),startNode:b,startIcon:a("svg.icon-tree",b).getIconName(),startUl:b.closest("ul"),startFolderNode:b.closest("ul").prev("a"),startWidth:b.outerWidth()},d.preventDefault(),d.stopImmediatePropagation()}).on("drag.tree",function(a,b){c&&(c[0].style.left=b.left+"px",c[0].style.top=b.top+"px",c[0].style.opacity="1",f.setDragOver(c,b))}).on("dragend.tree",function(b,d){if(f.targetArrow.hide(),a(f.linkSelector,f.element).removeClass("is-over"),c&&f.sortable.overDirection){c[0].style.left=d.left+"px",c[0].style.top=d.top+"px";var e=f.sortable.startNode.parent(),g=f.sortable.overNode.parent();"over"===f.sortable.overDirection?(g.is(".folder")||f.convertFileToFolder(f.sortable.overNode),a("ul:first",g).append(e),g.is(".is-open")||f.toggleNode(f.sortable.overNode)):"up"===f.sortable.overDirection?e.insertBefore(g):"down"===f.sortable.overDirection&&(g.is(".is-open")?a("ul:first",g).prepend(e):e.insertAfter(g)),0===a("li",f.sortable.startUl).length&&f.sortable.startFolderNode.data("oldData")&&"file"===f.sortable.startFolderNode.data("oldData").type&&f.convertFolderToFile(f.sortable.startFolderNode),f.isIe11&&e.find(".icon-tree").each(function(){var b=a(this);f.setTreeIcon(b,b.find("use").attr("xlink:href"))}),f.syncDataset(f.element),f.isMultiselect&&f.initSelected()}})}))}if(this.settings.sortable){var c,d,e,f=this;f.targetArrow=f.element.prev(".tree-drag-target-arrow"),f.linkSelector="a:not(.is-dragging-clone, .is-disabled)",f.targetArrow.length||(a('<div class="tree-drag-target-arrow"></div>').insertBefore(f.element),f.targetArrow=f.element.prev(".tree-drag-target-arrow")),d=setInterval(b,10)}},setDragOver:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this,s=r.element[0].getBoundingClientRect(),t=20,u=function(){r.sortable.overNode=null,r.sortable.overIndex=null,r.sortable.overDirection=null,r.targetArrow.hide(),r.setTreeIcon(a("svg.icon-tree",b),"icon-cancel")};if(c.top>s.top-t&&c.top<s.bottom+t&&c.left>s.left-t-r.sortable.startWidth&&c.left<s.left+s.height+t){for(j=a(r.linkSelector,r.element),t=2,l=0,m=j.length;l<m;l++)if(p=null,k=j[l].getBoundingClientRect(),c.top>k.top-t&&c.top<k.bottom+t){if(h=a(j[l]),!!h.parentsUntil(r.element,".folder").filter(function(){return a("a:first",this).is(r.sortable.startNode)}).length){u();continue}g=h.parent(),n=k.left,i=h.closest("ul"),d=parseInt(g[0].style.marginTop,10)>0?2:0,e=l-1===r.sortable.startIndex&&i.is(r.sortable.startUl),f=l+1===r.sortable.startIndex&&i.is(r.sortable.startUl),j.removeClass("is-over"),q=function(){if(!p)return void u();r.setTreeIcon(a("svg.icon-tree",b),r.sortable.startIcon),"over"===p?(r.targetArrow.hide(),h.is(".is-disabled")||h.addClass("is-over")):(j.removeClass("is-over"),o="up"===p?k.top-1.5-(g.is(".is-active")?3:0):k.bottom+(g.next().is(".is-active")?-1:1.5)+d,r.targetArrow[0].style.left=n+"px",r.targetArrow[0].style.top=o+"px",r.targetArrow.show()),r.sortable.overNode=h,r.sortable.overIndex=l,r.sortable.overDirection=p},l!==r.sortable.startIndex&&(c.left>k.left-t-r.sortable.startWidth&&c.left<k.right+t?p=!e&&c.top<k.top?"up":!f&&c.top>k.top+2*t?"down":"over":!e&&c.top<k.top?p="up":f||(p="down")),q(p)}}else u()},convertFileToFolder:function(b){var c=a('<ul role="group"></ul>'),d={icon:a("svg.icon-tree",b).getIconName(),type:"file"};if(b.is('[class^="icon"]')){var e=b.attr("class").replace(" hide-focus","").replace(" is-selected","");d.iconClass=e,b.removeClass(e)}b.data("oldData",d),b.parent("li").addClass("folder").append(c),this.setTreeIcon(a("svg.icon-tree",b),this.settings.folderIconClosed)},convertFolderToFile:function(b){var c=b.parent(".folder");c.removeClass("folder is-open"),a("ul:first",c).remove(),c.length&&(this.setTreeIcon(a("svg.icon-tree",b),b.data("oldData")?b.data("oldData").icon:"tree-node"),b.data("oldData")&&b.data("oldData").iconClass&&b.addClass(b.data("oldData").iconClass),b.data("oldData",null))},destroy:function(){this.settings.sortable&&(this.element.find("a").each(function(){var b=a(this),c=b.data("drag");b.off("mousedown.tree"),c&&c.destroy&&c.destroy()}),this.element.prev(".tree-drag-target-arrow").remove()),this.element.removeData(d),this.element.off("contextmenu.tree updated.tree click.tree focus.tree keydown.tree keypress.tree").empty()}},this.each(function(){var g=a.data(this,d);g?g.settings=a.extend({},e,b):g=a.data(this,d,new c(this,f))})},B.prototype={init:function(){this.fields="input, textarea, select, div[data-validate], div[data-validation]",this.isPlaceholderSupport=!!("placeholder"in document.createElement("input")),this.inputs=this.element.find(this.fields),this.element.is(this.fields)&&(this.inputs=a().add(this.element)),this.timeout=null},extractEvents:function(a){if(a.indexOf("{")>-1&&(a=JSON.parse(a.replace(/'/g,'"'))),"object"==typeof a){var b="";for(var c in a)-1===b.indexOf(a[c])&&(b+=a[c]+" ");b=b.split(" ").join(".validate "),a=b}return a},filterValidations:function(a,b){var c=[];if(!a)return[];if(a.indexOf("{")>-1&&(a=JSON.parse(a.replace(/'/g,'"'))),"object"==typeof a)for(var d in a)b&&a[d].indexOf(b)>-1&&c.push(d);return c},attachEvents:function(){var b=this,c="[data-validate],[data-validation]";this.inputs.each(function(){var b=a(this),c=b.attr("data-validate")||b.attr("data-validation");c&&c.indexOf("required")>-1&&b.addClass("required")}),this.inputs.filter("input, textarea, div").filter(c).not("input[type=checkbox], [readonly]").each(function(){var c=a(this),d=c.attr("data-validation-events"),e=d||"blur.validate change.validate keyup.validate";e=b.extractEvents(e),c.on(e,function(c){if("keyup"!==c.type||9!==c.keyCode){var d=a(this);setTimeout(function(){"true"!==d.attr("data-disable-validation")&&!d.hasClass("disable-validation")&&"is-hidden"!==d[0].style.visibility&&d.is(":visible")&&(d.closest(".modal-engaged").length&&!d.closest(".modal-body").length||b.validate(d,!0,c))},300)}})}),this.inputs.filter("input[type=checkbox]").filter(c).on("click.validate",function(c){b.validate(a(this),!0,c)}),this.inputs.filter(":radio").on("click.validate",function(c){b.validate(a(this),!0,c)});var d=this.inputs.filter("select").filter(c);if(d.length&&(d.on("change.validate",function(c){b.validate(a(this),!0,c)}).on("listopened.validate",function(){var b=a(this),c=b.data("tooltip");b.next(".dropdown-wrapper").next(".error-message").hide(),c&&document.activeElement===b.data("dropdown").searchInput[0]&&c.hide(),a("#validation-tooltip").hide()}).on("listclosed.validate",function(){var b=a(this),c=b.data("tooltip");b.next(".dropdown-wrapper").next(".error-message").show(),c&&document.activeElement!==b.data("dropdown").searchInput[0]&&c.show()}),d.filter(function(){return void 0!==a(this).data("dropdown")}).data("dropdown").pseudoElem.on("blur.validate",function(c){var d=a(this).closest(".field, .field-short").find("select");b.validate(d,!0,c)})),this.element.is("form")){var e=function(a){a.stopPropagation(),a.preventDefault(),b.validateForm(function(a){b.element.off("submit.validate"),b.element.trigger("validated",a),b.element.data("isValid",a),b.element.on("submit.validate",e)})};this.element.on("submit.validate",e)}},validateForm:function(b){var c=this,d=[];c.inputs=this.element.find(c.fields),c.inputs.each(function(b){var e=a(this);if(e.attr("data-validate")){if("true"===e.attr("data-disable-validation")||e.hasClass("disable-validation"))return!0;for(var f=c.validate(e,!1,b),g=0;g<f.length;g++)d.push(f[g])}}),a.when.apply(a,d).then(function(){b(!0)},function(){b(!1)})},setModalPrimaryBtn:function(b,c,d){var e=b.closest(".modal"),f=e.find("[data-validate]:visible").add("select[data-validate], :checkbox[data-validate]"),g=!0;f.length>0&&f.each(function(){var b=a(this);if(b.data("isValid",d),!(b.closest(".datagrid-filter-wrapper").length>0)){var c=null!==b[0].offsetParent;b.is(".required")?!c&&!b.is("select, :checkbox")||b.val()||(g=!1):!c&&!b.is("select, :checkbox")||b.isValid()||(g=!1)}}),g?c.removeAttr("disabled"):c.attr("disabled","disabled")},value:function(a){return a.is("input[type=checkbox]")?a.prop("checked"):a.is("div")?a[0].innerHTML:a.val()},getTypes:function(a,b){var c,d=this.filterValidations(a.attr("data-validation-events"),b.type);return c=a.is("input.dropdown")&&a.prev().prev("select").attr("data-validate")?a.prev().prev("select").attr("data-validate").split(" "):a.is("input.dropdown")&&a.prev().prev("select").attr("data-validation")?a.prev().prev("select").attr("data-validation").split(" "):a.attr("data-validation")?a.attr("data-validation").split(" "):a.attr("data-validate")?a.attr("data-validate").split(" "):[],d.length>0&&(c=c.filter(function(a){return-1!==d.indexOf(a)})),"keyup"===b.type&&(c=c.filter(function(a){return"date"!==a&&"time"!==a})),c},setErrorOnParent:function(b){var c,d,e,f,g=a.createIcon({classes:["icon-error"],icon:"error"}),h=b.closest(".tab-panel, .expandable-pane"),i=b.closest(".tab-container, .tab-panel-container, .expandable-area"),j=h.attr("id");if(i.is(".tab-panel-container")&&(i=i.prev(".tab-container")),i.is(".tab-container"))c=a('.tab-list a[href="#'+j+'"]',i).closest(".tab"),c.length?a(".count",c).length&&(c=a(".count",c)):(j=a('a[href="#'+j+'"]',".popupmenu").closest(".popupmenu").attr("id"),c=a('.tab-list .tab[aria-controls="'+j+'"]',i),d=j);else{if(!i.is(".expandable-area"))return;c=a('.expandable-header[aria-controls="'+j+'"] .title',i)}d&&d.length&&(e=h.add(a(a(d).attr("href"))),a('a[role="menuitem"]',"#"+d).each(function(){e=e.add(a(a(this).attr("href")))})),f=a('a[href="#'+h.attr("id")+'"]',"#"+j),h&&a(".error",h).length||e&&a(".error",e).length?(a(".error",h).length||(f.removeClass("is-error"),a(".icon-error",f).remove()),a(".error",h).length&&a(".error",e).length&&!a(".icon-error",f).length&&f.addClass("is-error").append(g),a(".icon-error",c).length||c.addClass("is-error").append(g)):(c=c.add(f),c.removeClass("is-error"),a(".icon-error",c).remove())},validate:function(b,c,d){var e,f,g,h,i=this,j=i.getTypes(b,d)||[],k=[],l=[],m=i.value(b),n=b.attr("placeholder"),o=function(a,c){if(!1===e.positive&&i.removePositive(b),a)0===l.length&&(i.removeError(b),f.resolve(),e.positive&&(i.addError(b,e.message,e.inline,c),i.removeError(b),f.resolve(),i.addPositive(b)));else{if(!i.isPlaceholderSupport&&m===n&&e.message!==Locale.translate("Required"))return;i.addError(b,e.message,"tooltip"!==b.attr("data-error-type"),c),l.push(e.msg),f.reject()}i.setErrorOnParent(b)};for(i.removeError(b),b.removeData("data-errormessage"),g=0,h=j.length;g<h;g++)e=a.fn.validation.rules[j[g]],f=a.Deferred(),e&&(a("#calendar-popup").is(":visible")||(e.async?e.check(m,b,o):o(e.check(m,b),c),k.push(f)));return k},getField:function(a){return a.is("select")&&void 0!==a.data("dropdown")&&(a=a.data("dropdown").pseudoElem),a},hasError:function(a){return this.getField(a).hasClass("error")},addError:function(b,c,d,e){var f=this.getField(b).addClass("error"),g=f.data("data-errormessage"),h=c;if(g&&(h=/^\u2022/.test(g)?"":"• ",h+=g+"<br>• "+c),f.data("data-errormessage",h),void 0!==a.fn.toast&&a("body").toast({title:Locale.translate("Error"),audibleOnly:!0,message:h}),!d)return void this.showTooltipError(b,h,e);var i=b.closest(".modal").find(".btn-modal-primary").not(".no-validation");i.length&&this.setModalPrimaryBtn(b,i,!1),this.showInlineError(f,c)},showErrorIcon:function(b){var c=this.getField(b).addClass("error"),d=a.createIconElement({classes:["icon-error"],icon:"error"});return 0===c.parent(".field, .field-short").find("svg.icon-error").length?(b.parent().is(".editor-container")&&b.parent().addClass("is-error"),1===b.parent(":not(.editor-container)").find(".btn-actions").length?b.parent().find(".btn-actions").before(d):1===b.parent().find(".data-description").length?b.parent().find(".data-description").before(d):1===b.parent().find(".field-info").length?b.parent().find(".field-info").before(d):b.is("textarea")?b.after(d):b.is(".dropdown, .multiselect")?b.parent().find(".dropdown-wrapper").append(d):b.is(".spinbox")?b.parent().append(d):(b.is(".lookup"),b.parent().append(d)),a(".icon-confirm",c.parent(".field, .field-short")).remove()):d=c.parent(".field, .field-short").find("svg.icon-error"),d},showTooltipError:function(b,c,d){function e(b){var c=g[0].getBoundingClientRect(),d=i.tooltip[0].getBoundingClientRect(),e=a("html").is('[dir="rtl"]'),f=b.x,h=0;return e?d.left<c.left&&(h+=c.left-d.left):d.right>c.right&&(h+=-1*(d.right-c.right)),b.setCoordinate("x",f+h),b.nudges||(b.nudges={}),b.nudges.x=h,b}if(!b.is(":radio")){var f=this.showErrorIcon(b),g=b;if(b.is(".dropdown, .multiselect")&&void 0!==b.data("dropdown")){var h=b.data("dropdown").pseudoElem;g=h,h.addClass("error")}var i=f.data("tooltip");i?i.content=c:(f.tooltip({content:c,placement:"bottom",placementOpts:{callback:e},trigger:"focus",isError:!0,tooltipElement:"#validation-tooltip"}),i=f.data("tooltip")),b.on("focus.validate",function(){i&&i.show()}).on("blur.validate",function(){i&&i.hide()}),d&&i&&i.show()}},toggleRadioError:function(b,c,d,e){var f,g,h=b.attr("name");h&&h.length&&(f=a(':radio[name="'+h+'"], :radio[name="'+h+'"] + label'),g=b.parent().is(".inline")?a(':radio[name="'+h+'"]:last').parent():a(':radio[name="'+h+'"]:last + label'),e?(f.addClass("error"),a(d).addClass("radio-group-error").insertAfter(g)):(f.removeClass("error"),g.next(".radio-group-error").remove()))},showInlineError:function(b,c){var d=this.getField(b).addClass("error"),e='<div class="error-message">'+a.createIcon({classes:["icon-error"],icon:"error"})+'<pre class="audible">'+Locale.translate("Error")+'</pre><p class="message-text">'+c+"</p></div>";b.is(":radio")?this.toggleRadioError(b,c,e,!0):(d.closest(".field, .field-short").find(".formatter-toolbar").addClass("error"),d.closest(".field, .field-short").append(e)),b.parent().find(".icon-confirm").remove()},addPositive:function(b){var c=a.createIcon({icon:"confirm",classes:"icon-confirm"});a(".icon-confirm",b.parent(".field, .field-short")).length||b.parent(".field, .field-short").append(c)},removeError:function(b){var c=this.getField(b),d=b.is(":radio"),e=b.attr("data-error-type");if(this.inputs.filter("input, textarea").off("focus.validate"),b.removeClass("error"),b.removeData("data-errormessage"),e){var f=b.find(".icon.error").data("tooltip");f&&f.destroy(),"validation-tooltip"===b.attr("aria-describedby")&&(b.removeAttr("aria-describedby"),a("#validation-tooltip").remove())}d?this.toggleRadioError(b):b.next(".icon-error").off("click.validate").remove(),(b.hasClass("dropdown")||b.hasClass("multiselect"))&&(b.next().next().removeClass("error"),b.next().find("div.dropdown").removeClass("error").removeData("data-errormessage"),b.parent().find(".dropdown-wrapper > .icon-error").off("click.validate").remove()),d||(b.next().next(".icon-error").remove(),b.next(".inforCheckboxLabel").next(".icon-error").remove(),b.parent(".field, .field-short").find("span.error").remove(),b.parent().find(".icon-error").remove(),b.off("focus.validate focus.tooltip")),c.attr("data-placeholder")&&(c.attr("placeholder",c.attr("data-placeholder")),c.removeAttr("data-placeholder")),b.is(".dropdown, .multiselect")&&b.data("dropdown").pseudoElem.removeClass("error").removeAttr("placeholder"),b.parent().is(".editor-container")&&b.parent().removeClass("is-error");var g=b.closest(".modal").find(".btn-modal-primary").not(".no-validation");g.length&&this.setModalPrimaryBtn(b,g,!0),b.closest(".field, .field-short").find(".error-message").remove(),b.parent(".field, .field-short").find(".formatter-toolbar").removeClass("error")},removePositive:function(b){a(".icon-confirm",b.parent(".field, .field-short")).remove()}},a.fn.addError=function(b){var c={message:"",showTooltip:!1,inline:!0},d=a.extend({},c,b);return this.each(function(){new B(this,d).addError(a(this),d.message,d.inline,d.showTooltip)})},a.fn.removeError=function(b){var c={message:""},d=a.extend({},c,b);return this.each(function(){new B(this,d).removeError(a(this))})},a.fn.validate=function(b,c){var d={inline:!0},e=a.extend({},d,b);return this.each(function(){var f=a.data(this,"validate");f?("function"==typeof f[b]&&f[b](c),f.settings=a.extend({},d,b)):(f=a.data(this,"validate",new B(this,e)),f.attachEvents())})};var W=function(){var b=this;this.rules={required:{isNotEmpty:function(b,c){return!(!("placeholder"in document.createElement("input"))&&c&&(b===c.attr("placeholder")||b===Locale.translate("Required"))||("string"==typeof b?(b=a.trim(b.replace(/<\/?[^>]*>/g,"")),0===a.trim(b).length):"number"==typeof b?isNaN(b):!b))},isRadioChecked:function(b){var c=b.attr("name");return c&&c.length&&a('input[name="'+c+'"]:radio:checked').length},check:function(b,c){var d=this,e=!0;return c.closest(".modal").find("input.required, textarea.required, select.required").not(":hidden").each(function(){d.isNotEmpty(a(this).val())||(e=!1)}),e?c.closest(".modal").find(".btn-modal-primary").not(".no-validation").removeAttr("disabled"):c.closest(".modal").find(".btn-modal-primary").not(".no-validation").attr("disabled","disabled"),this.message=Locale.translate("Required"),c.is(":radio")?this.isRadioChecked(c):this.isNotEmpty(b,c)},message:"Required"},date:{check:function(a,b){if(this.message=Locale.translate("InvalidDate"),a instanceof Date)return a&&a.getTime&&!isNaN(a.getTime());var c=a.indexOf(":")>-1?Locale.calendar().dateFormat.datetime:Locale.calendar().dateFormat.short;b&&b.data("datepicker")&&(c=b.data("datepicker").pattern);var d=!("MMMM d"===c||"yyyy"===c);return void 0!==Locale.parseDate(a,c,d)||""===a},message:"Invalid Date"},availableDate:{check:function(a,c){this.message=Locale.translate("UnavailableDate");var d=!0;if(""!==a&&b.rules.date.check(a)){var e,f,g,h,i,j=new Date(a),k=c.data("datepicker").settings;if(k)for(h=new Date(k.disable.minDate).setHours(0,0,0,0),i=new Date(k.disable.maxDate).setHours(0,0,0,0),-1!==k.disable.dayOfWeek.indexOf(j.getDay())&&(d=!1),j=j.setHours(0,0,0,0),(j<=h||j>=i)&&(d=!1),k.disable.dates.length&&"string"==typeof k.disable.dates&&(k.disable.dates=[k.disable.dates]),f=0,g=k.disable.dates.length;f<g;f++)if(e=new Date(k.disable.dates[f]),j===e.setHours(0,0,0,0)){d=!1;break}d=!!(d&&!k.disable.isEnable||!d&&k.disable.isEnable)}return d},message:"Unavailable Date"},email:{check:function(a){this.message=Locale.translate("EmailValidation");var b=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,16}(?:\.[a-z]{2})?)$/i;return!a.length||b.test(a)},message:"EmailValidation"},enableSubmit:{check:function(a,c){var d=c.closest(".signin").find('button[type="submit"]');return a.length&&(b.rules.email.check(a)||b.rules.passwordConfirm.check(a,c))?d.enable():d.disable(),!0},message:""},emailPositive:{check:function(c,d){if(a.trim(c).length&&!d.is("[readonly]")){b.rules.emailPositive.positive=!0,this.message=Locale.translate("EmailValidation");var e=b.rules.email.check(c,d);return e&&(this.message=""),e}return b.rules.emailPositive.positive=!1,!0},message:"EmailValidation"},passwordReq:{check:function(a){this.message=Locale.translate("PasswordValidation");var b=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{10,}$/;return!a.length||a.match(b)},message:"PasswordValidation"},passwordConfirm:{check:function(c,d){this.message=Locale.translate("PasswordConfirmValidation");var e=a('input[type="password"]:not('+d.attr("id")+")",d.closest(".signin")).eq(0).val(),f=c===e&&b.rules.passwordReq.check(e);return!c.length||f},message:"PasswordConfirmValidation"},time:{check:function(a,b){a=a.replace(/ /g,""),this.message=Locale.translate("InvalidTime");var c,d,e=b&&b.data("timepicker")?b.data("timepicker").settings:{},f=e&&e.timeFormat?e.timeFormat:Locale.calendar().timeFormat,g=(f.match("HH")||[]).length>0,h=g?24:12,i=a.indexOf(Locale.calendar().dateFormat.timeSeparator),j=0;if(""===a)return!0;if(j=parseInt(a.substring(0,i)),c=parseInt(a.substring(i+1,i+3)),j.toString().length<1||isNaN(j)||parseInt(j)<0||parseInt(j)>h)return!1;if(c.toString().length<1||isNaN(c)||parseInt(c)<0||parseInt(c)>59)return!1;if(!g){if(parseInt(j)<1)return!1;var k=new RegExp(Locale.calendar().dayPeriods[0],"i"),l=new RegExp(Locale.calendar().dayPeriods[1],"i");if(d=a.match(k)||a.match(l)||[],0===d.length)return!1}return!0},message:"Invalid Time"},test:{check:function(a){return"1"===a},message:"Value is not valid (test)."}}};a.fn.validation=new W,a.fn.isValid=function(){return!!a(this).data("isValid")},a.fn.checkValidation=function(){var b=a(this),c=b.data("validate"),d=function(a){b.data("isValid",a)};if(c&&c.validate){var e=c.validate(b,!1,0);a.when.apply(a,e).always(function(){a.each(e,function(){this.done(function(){d(!0)}).fail(function(){d(!1)})})})}},a.fn.resetForm=function(){var b=a(this).find("input, select, textarea");b.removeClass("error"),a(this).find(".error").removeClass("error"),a(this).find(".icon-error").remove(),a(this).find(".icon-confirm").remove(),a(this).find(".error-message").remove(),setTimeout(function(){a("#validation-errors").addClass("is-hidden")},300),b.data("isDirty",!1).removeClass("isDirty"),a(this).find(".isDirty").removeClass("isDirty"),a(this).is("form")&&a(this)[0].reset()},a.fn.wizard=function(b){"use strict";function c(b){this.settings=a.extend({},f),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="wizard",e={ticks:null},f=a.extend({},e,b);return c.prototype={init:function(){this.build().handleEvents()},build:function(){return this.header=this.element.find(".wizard-header"),this.header.length||(this.header=a('<div class="wizard-header"></div>').appendTo(this.element)),this.bar=this.element.find(".bar"),this.bar.length||(this.bar=a('<div class="bar"></div>').appendTo(this.header)),this.completedRange=this.element.find(".completed-range"),this.completedRange.length||(this.completedRange=a('<div class="completed-range"></div>').appendTo(this.bar)),this.buildTicks().updateRange(),this},buildTicks:function(){var b=this.settings.ticks,c=this;if(this.ticks=this.bar.children(".tick"),!this.ticks.length&&b){for(var d=0;d<b.length;d++){var e=a('<a ng-click="handleClick()" class="tick '+(b[d].state?b[d].state:"")+'" href="'+(b[d].href?b[d].href:"#")+'"><span class="label">'+b[d].label+"</span></a>");b[d].ngClick&&e.attr("ng-click",b[d].ngClick),c.bar.append(e)}this.ticks=this.bar.children(".tick")}return this.positionTicks(),a(".tick",c.element).each(function(){var b=a(this);b.hasClass("is-disabled")&&b.removeAttr("onclick ng-click")}),this.element.find(".wizard-header")[0].style.opacity="1",this},positionTicks:function(){for(var b=this.ticks.length,c=100/(b-1),d=[],e=0;e<b;e++)d.push(function(a){return 0===a?0:a===b-1?100:c*a}(e));this.ticks.each(function(b){var c=a(this),e=c.children(".label"),f=Locale.isRTL()?100-d[b]:d[b];this.style.left=f+"%";for(var g=0,h=e.length;g<h;g++)e[g].style.left="-"+(e.outerWidth()/2-c.outerWidth()/2)+"px";c.is(".is-disabled")&&c.attr("tabindex","-1")})},updateRange:function(){var a=this.ticks.filter(".current").last(),b=0;return a.length&&(b=100*parseFloat(window.getComputedStyle(a[0]).left)/parseFloat(window.getComputedStyle(a.parent()[0]).width),b=Locale.isRTL()?100-b:b),this.completedRange[0].style.width=b+"%",this},updated:function(){return this.buildTicks().updateRange(),this},teardown:function(){return this.ticks.offTouchClick("wizard").off("click.wizard"),this.element.off("updated.wizard"),this.ticks.remove(),this},select:function(a,b){return this.activate(a,b)},activate:function(b,c){if(void 0===b&&!c)return this;var d=this;if(c=function(){var e;return void 0===b||void 0!==b&&null!==b&&b.type&&b.target||c||(c=b),void 0===c?(e=a(b.target),e.is(".label")?e.parent():e):"number"==typeof c?d.ticks.eq(c):c}(),b&&(c.is("[disabled], .is-disabled")||!c.is("a")))return b.preventDefault(),b.stopPropagation(),this;if(!1===this.element.triggerHandler("beforeactivate",[c]))return this;var e=this.ticks.index(c);return this.ticks.removeClass("complete current").eq(e).addClass("current").prevAll(".tick").addClass("complete"),this.updateRange(),this.element.trigger("activated",[c]),setTimeout(function(){d.element.trigger("afteractivated",[c])},300),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)},handleEvents:function(){var b=this;return this.element.on("updated",function(){b.updated()}),this.ticks.onTouchClick("wizard").on("click.wizard",function(c){b.activate(c,a(this))}),this}},this.each(function(){var e=a.data(this,d);e?(e.settings=a.extend({},e.settings,b),e.updated()):e=a.data(this,d,new c(this,f))})},a.fn.zoom=function(b){"use strict";function c(b,c){this.settings=a.extend({},c),this.element=a(b),Soho.logTimeStart(d),this.init(),Soho.logTimeEnd(d)}var d="zoom",e=a.extend({},b);return c.prototype={init:function(){return this.build().handleEvents()},build:function(){return this.viewport=this.element.find("meta[name=viewport]"),this.body=a("body"),this},handleEvents:function(){var a=this;return this.element.on("updated."+d,function(){a.updated()}).on("enable-zoom",function(){a.enableZoom()}).on("disable-zoom",function(){a.disableZoom()}),"ios"!==Soho.env.os.name?this:(this.body.on("touchstart.zoomdisabler","input, label",function(){a.noZoomTimeout||a.disableZoom()}).on("touchend.zoomdisabler","input, label",function(){a.noZoomTimeout&&(clearTimeout(a.noZoomTimeout),a.noZoomTimeout=null),a.noZoomTimeout=setTimeout(function(){a.noZoomTimeout=null,a.enableZoom()},600)}),this)},enableZoom:function(){this.viewport[0].setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=1")},disableZoom:function(){this.viewport[0].setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0")},updated:function(){return this.teardown().init()},teardown:function(){return this.element.off("updated."+d+" enable-zoom disable-zoom"),this.body.off("touchstart.zoomdisabler touchend.zoomdisabler"),this},destroy:function(){this.teardown(),a.removeData(this.element[0],d)}},this.each(function(){var f=a.data(this,d);f?(f.settings=a.extend({},f.settings,b),f.updated()):f=a.data(this,d,new c(this,e))})}});
//# sourceMappingURL=sohoxi.map